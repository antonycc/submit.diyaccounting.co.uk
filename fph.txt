
> web-submit-diyaccounting-co-uk@0.0.2-4 test:postVatReturnFraudPreventionHeadersBehaviour-proxy-report
> HMRC_ACCOUNT=sandbox npm run test:postVatReturnFraudPreventionHeadersBehaviour-proxy ; npm run test-report -- --testName postVatReturnFraudPreventionHeadersBehaviour --testFile behaviour-tests/postVatReturnFraudPreventionHeaders.behaviour.test.js --envFile .env.proxy && ./scripts/publish-web-test-local.sh target/behaviour-test-results/test-report-postVatReturnFraudPreventionHeadersBehaviour.json web-test-local


> web-submit-diyaccounting-co-uk@0.0.2-4 test:postVatReturnFraudPreventionHeadersBehaviour-proxy
> npx dotenv -e .env.proxy -- npm run test:postVatReturnFraudPreventionHeadersBehaviour


> web-submit-diyaccounting-co-uk@0.0.2-4 test:postVatReturnFraudPreventionHeadersBehaviour
> playwright test --project=postVatReturnFraudPreventionHeadersBehaviour

dotenvConfigIfNotBlank: Loading environment config from .env
dotenvConfigIfNotBlank: Loading environment config from .env
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:08.766Z","msg":"Reading CDK configuration from /Users/antony/projects/submit.diyaccounting.co.uk/cdk-application/cdk.json"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:08.767Z","msg":"CDK context:"}
dotenvConfigIfNotBlank: Loading environment config from .env
dotenvConfigIfNotBlank: Loading environment config from .env
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:08.773Z","msg":"envFilePath: .env.proxy"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:08.773Z","msg":"envName: proxy"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:08.773Z","msg":"serverPort: 3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:08.773Z","msg":"runTestServer: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:08.773Z","msg":"runProxy: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:08.773Z","msg":"runMockOAuth2: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:08.773Z","msg":"testAuthProvider: mock"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:08.773Z","msg":"testAuthUsername: user"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:08.773Z","msg":"baseUrl: https://wanted-finally-anteater.ngrok-free.app/"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:08.773Z","msg":"hmrcTestUsername: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:08.773Z","msg":"hmrcTestPassword: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:08.773Z","msg":"hmrcTestVatNumber: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:08.773Z","msg":"runDynamoDb: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:08.773Z","msg":"bundleTableName: test-bundle-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:08.773Z","msg":"hmrcApiRequestsTableName: test-hmrc-api-requests-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:08.773Z","msg":"receiptsTableName: test-receipts-table"}

Running 1 test using 1 worker

dotenvConfigIfNotBlank: Loading environment config from .env
dotenvConfigIfNotBlank: Loading environment config from .env
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:09.651Z","msg":"Reading CDK configuration from /Users/antony/projects/submit.diyaccounting.co.uk/cdk-application/cdk.json"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:09.652Z","msg":"CDK context:"}
dotenvConfigIfNotBlank: Loading environment config from .env
dotenvConfigIfNotBlank: Loading environment config from .env
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:09.658Z","msg":"envFilePath: .env.proxy"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:09.658Z","msg":"envName: proxy"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:09.658Z","msg":"serverPort: 3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:09.658Z","msg":"runTestServer: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:09.658Z","msg":"runProxy: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:09.658Z","msg":"runMockOAuth2: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:09.658Z","msg":"testAuthProvider: mock"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:09.659Z","msg":"testAuthUsername: user"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:09.659Z","msg":"baseUrl: https://wanted-finally-anteater.ngrok-free.app/"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:09.659Z","msg":"hmrcTestUsername: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:09.659Z","msg":"hmrcTestPassword: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:09.659Z","msg":"hmrcTestVatNumber: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:09.659Z","msg":"runDynamoDb: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:09.659Z","msg":"bundleTableName: test-bundle-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:09.659Z","msg":"hmrcApiRequestsTableName: test-hmrc-api-requests-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:09.659Z","msg":"receiptsTableName: test-receipts-table"}
Starting beforeAll hook...
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:10.306Z","msg":"[dynamodb]: runDynamoDb=run, bundleTableName=test-bundle-table, hmrcApiRequestsTableName=test-hmrc-api-requests-table, receiptsTableName=test-receipts-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:10.306Z","msg":"[dynamodb]: DYNAMODB_PORT not set; using ephemeral port (0)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:10.306Z","msg":"[dynamodb]: Starting dynalite (local DynamoDB) server..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:10.314Z","msg":"[dynamodb]: Started at http://127.0.0.1:61028"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:10.315Z","msg":"[dynamodb]: Ensuring bundle table: 'test-bundle-table' exists on endpoint 'http://127.0.0.1:61028'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:10.344Z","msg":"[dynamodb]: ℹ️ Table 'test-bundle-table' not found on endpoint 'http://127.0.0.1:61028', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:10.350Z","msg":"[dynamodb]: ✅ Created table 'test-bundle-table' on endpoint 'http://127.0.0.1:61028'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:10.350Z","msg":"[dynamodb]: Ensuring HMRC API requests table: 'test-hmrc-api-requests-table' exists on endpoint 'http://127.0.0.1:61028'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:10.356Z","msg":"[dynamodb]: ℹ️ Table 'test-hmrc-api-requests-table' not found on endpoint 'http://127.0.0.1:61028', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:10.359Z","msg":"[dynamodb]: ✅ Created table 'test-hmrc-api-requests-table' on endpoint 'http://127.0.0.1:61028'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:10.359Z","msg":"[dynamodb]: Ensuring receipts table: 'test-receipts-table' exists on endpoint 'http://127.0.0.1:61028'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:10.366Z","msg":"[dynamodb]: ℹ️ Table 'test-receipts-table' not found on endpoint 'http://127.0.0.1:61028', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:10.368Z","msg":"[dynamodb]: ✅ Created table 'test-receipts-table' on endpoint 'http://127.0.0.1:61028'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:10.368Z","msg":"[dynamodb]: Ensuring async requests table: 'test-hmrc-vat-return-post-async-requests-table' exists on endpoint 'http://127.0.0.1:61028'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:10.375Z","msg":"[dynamodb]: ℹ️ Table 'test-hmrc-vat-return-post-async-requests-table' not found on endpoint 'http://127.0.0.1:61028', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:10.377Z","msg":"[dynamodb]: ✅ Created table 'test-hmrc-vat-return-post-async-requests-table' on endpoint 'http://127.0.0.1:61028'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:10.377Z","msg":"[dynamodb]: Ensuring async requests table: 'test-hmrc-vat-return-get-async-requests-table' exists on endpoint 'http://127.0.0.1:61028'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:10.382Z","msg":"[dynamodb]: ℹ️ Table 'test-hmrc-vat-return-get-async-requests-table' not found on endpoint 'http://127.0.0.1:61028', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:10.385Z","msg":"[dynamodb]: ✅ Created table 'test-hmrc-vat-return-get-async-requests-table' on endpoint 'http://127.0.0.1:61028'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:10.385Z","msg":"[dynamodb]: Ensuring async requests table: 'test-hmrc-vat-obligation-get-async-requests-table' exists on endpoint 'http://127.0.0.1:61028'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:10.389Z","msg":"[dynamodb]: ℹ️ Table 'test-hmrc-vat-obligation-get-async-requests-table' not found on endpoint 'http://127.0.0.1:61028', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-07T23:25:10.391Z","msg":"[dynamodb]: ✅ Created table 'test-hmrc-vat-obligation-get-async-requests-table' on endpoint 'http://127.0.0.1:61028'"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:10.391Z","msg":"[auth]: runMockOAuth2=run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:10.391Z","msg":"[auth]: Starting mock-oauth2-server process..."}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-07T23:25:10.393Z","msg":"[auth]: Checking server readiness for... http://localhost:8080/default/debugger"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-07T23:25:10.789Z","msg":"[auth]: Server is ready! at http://localhost:8080/default/debugger"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:10.789Z","msg":"[http]: runTestServer=run, httpServerPort=3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:10.789Z","msg":"[http]: Starting server process..."}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-07T23:25:10.792Z","msg":"[http]: Checking server readiness for... http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-07T23:25:10.796Z","msg":"[http]: Starting server at http://127.0.0.1:3000 after error TypeError: fetch failed"}
{"level":50,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-07T23:25:10.798Z","msg":"[http]: Server check attempt 1/15 failed: fetch failed from http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:11.176Z","msg":"[http-stdout]: > web-submit-diyaccounting-co-uk@0.0.2-4 server\n> npx dotenv -e .env.proxy -- node app/bin/server.js"}
{"level":50,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-07T23:25:11.799Z","msg":"[http]: Server check attempt 2/15 failed: fetch failed from http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:11.925Z","msg":"[http-stdout]: dotenvConfigIfNotBlank: Loading environment config from .env"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:11.932Z","msg":"[http-stdout]: dotenvConfigIfNotBlank: Loading environment config from .env"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:11.938Z","msg":"[http-stdout]: Listening at http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:11.939Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:11.939Z\",\"msg\":\"Listening at http://127.0.0.1:3000\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:12.805Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:12.805Z\",\"msg\":\"HTTP GET /\"}"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-07T23:25:12.812Z","msg":"[http]: Response body"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-07T23:25:12.812Z","msg":"[http]: Server is ready! at http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:12.812Z","msg":"[proxy]: runLocalSslProxy called (delegating to runLocalNgrokProxy)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:12.812Z","msg":"[proxy]: runProxy=run, httpServerPort=3000, baseUrl=https://wanted-finally-anteater.ngrok-free.app/"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:12.812Z","msg":"[proxy]: Starting ngrok tunnel using @ngrok/ngrok..."}
{"level":30,"source":"app/bin/ngrok.js","time":"2026-01-07T23:25:12.812Z","msg":"[ngrok]: Starting ngrok tunnel for address: 3000, domain: wanted-finally-anteater.ngrok-free.app, pooling: true"}
{"level":30,"source":"app/bin/ngrok.js","time":"2026-01-07T23:25:13.234Z","msg":"[ngrok]: ✅ Tunnel established at https://wanted-finally-anteater.ngrok-free.app"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:13.234Z","msg":"[proxy]: Started at https://wanted-finally-anteater.ngrok-free.app"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-07T23:25:13.234Z","msg":"[proxy]: Checking server readiness for... https://wanted-finally-anteater.ngrok-free.app"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:13.374Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:13.374Z\",\"msg\":\"HTTP GET /\"}"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-07T23:25:13.403Z","msg":"[proxy]: Server is ready! at https://wanted-finally-anteater.ngrok-free.app"}
beforeAll hook completed successfully
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:14.314Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[HMRC Test User] Sandbox mode detected without full credentials - creating test user
[HMRC Test User] Creating HMRC sandbox test user with VAT enrolment using client credentials
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:14.319Z","message":"[HMRC Test User Creation] Starting test user creation","url":"https://test-api.service.hmrc.gov.uk/create-test-user/organisations","serviceNames":["mtd-vat"],"hmrcClientId":"uqMHA6Rs..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:14.319Z","message":"[HMRC Test User Creation] Request details (pre-token)","method":"POST","url":"https://test-api.service.hmrc.gov.uk/create-test-user/organisations","body":{"serviceNames":["mtd-vat"]}}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:14.319Z","message":"[HMRC Test User Creation] Requesting OAuth2 access token","tokenUrl":"https://test-api.service.hmrc.gov.uk/oauth/token","grantType":"client_credentials"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:14.478Z","message":"[HMRC Test User Creation] Token response received","status":200,"statusText":"OK","hasAccessToken":true}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:14.479Z","message":"[HMRC Test User Creation] Request details (create-test-user)","method":"POST","url":"https://test-api.service.hmrc.gov.uk/create-test-user/organisations","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"Bearer ***REDACTED***"},"body":{"serviceNames":["mtd-vat"]}}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:15.036Z","message":"[HMRC Test User Creation] Response received","status":201,"statusText":"Created","responseBody":{"userId":"441080096176","password":"2CEUk53dZILD","userFullName":"Alex Felix","emailAddress":"alex.felix@example.com","organisationDetails":{"name":"Company MFZDLX","address":{"line1":"18 Regent Street","line2":"Hatfield","postcode":"TS19 1PA"}},"individualDetails":{"firstName":"Alex","lastName":"Felix","dateOfBirth":"1968-12-16","address":{"line1":"12 Latimer Place","line2":"Leeds","postcode":"TS25 1PA"}},"vatRegistrationDate":"2010-01-07","groupIdentifier":"787754013071","vrn":"299294688"}}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:15.037Z","message":"[HMRC Test User Creation] Test user created successfully","userId":"441080096176","userFullName":"Alex Felix","organisationName":"Company MFZDLX"}
[HMRC Test User] Successfully created test user:
  User ID: 441080096176
  User Full Name: Alex Felix
  VAT Registration Number: 299294688
  Organisation: Company MFZDLX
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:15.037Z","message":"[HMRC Test User] Saving test user details to JSON files","outputDir":"/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour","repoRoot":"/Users/antony/projects/submit.diyaccounting.co.uk"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:15.038Z","message":"[HMRC Test User] Saved test user to artifact directory","path":"/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/hmrc-test-user.json"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:15.038Z","message":"[HMRC Test User] Saved test user to repository root","path":"/Users/antony/projects/submit.diyaccounting.co.uk/hmrc-test-user.json"}
[HMRC Test User] Updated environment variables with generated credentials
Loading document...
[NAVIGATION] (1/4) Going to: https://wanted-finally-anteater.ngrok-free.app/ - Loading home page
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:15.377Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:15.377Z\",\"msg\":\"HTTP GET /\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:15.445Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:15.445Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:15.464Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:15.464Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:15.465Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:15.465Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:15.469Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:15.468Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:15.469Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:15.469Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:15.485Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:15.485Z\",\"msg\":\"HTTP GET /widgets/hamburger-menu.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:15.487Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:15.487Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:15.489Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:15.489Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:15.490Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:15.490Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
[BROWSER CONSOLE log]: Current activity cleared
[BROWSER CONSOLE log]: User is not authenticated
[BROWSER CONSOLE log]: User is not authenticated
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:15.555Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:15.555Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:15.560Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:15.560Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:15.562Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:15.562Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:15.661Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:15.661Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
Checking home page...
[USER INTERACTION] Clicking: a:has-text('Log in') - Clicking login link
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:16.186Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:16.186Z\",\"msg\":\"HTTP GET /auth/login.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:16.261Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:16.261Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:16.261Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:16.261Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:16.262Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:16.262Z\",\"msg\":\"HTTP GET /images/g-logo.png\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:16.285Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:16.285Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:16.286Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:16.286Z\",\"msg\":\"HTTP GET /widgets/hamburger-menu.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:16.288Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:16.287Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:16.288Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:16.288Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:16.289Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:16.289Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:16.291Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:16.290Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:16.291Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:16.291Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:16.291Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:16.291Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:16.292Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:16.292Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:16.293Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:16.293Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}"}
[BROWSER CONSOLE log]: Current activity cleared
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:16.378Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:16.378Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:16.383Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:16.383Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:16.384Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:16.383Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:16.445Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:16.445Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
Logging in...
[USER INTERACTION] Clicking: button:has-text('Continue with mock-oauth2-server') - Continue with OAuth provider
[BROWSER CONSOLE log]: Initiating navikt/mock-oauth2-server login
[BROWSER CONSOLE log]: Clear stored tokens and user info
[BROWSER CONSOLE log]: Getting auth URL. Remote call initiated: GET /api/v1/mock/authUrl?state=1bhvs8ya14p
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:17.132Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:17.132Z\",\"msg\":\"HTTP GET /api/v1/mock/authUrl?state=1bhvs8ya14p\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:17.134Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:17.134Z\",\"requestId\":\"3d1b808e-c861-4541-9979-ceaf290983d7\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"3d1b808e-c861-4541-9979-ceaf290983d7\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/mock/authUrl?state=1bhvs8ya14p&state=1bhvs8ya14p\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"cognito:username\":\"test\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/mock/authUrl\"}},\"path\":\"/api/v1/mock/authUrl\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/auth/login.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-client-request-id\":\"ce4b988b-b472-4a6f-88e8-64b76fa0c088\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-request-id\":\"3d1b808e-c861-4541-9979-ceaf290983d7\"},\"queryStringParameters\":{\"state\":\"1bhvs8ya14p\"},\"rawQueryString\":\"state=1bhvs8ya14p\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:17.134Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/non-lambda-mocks/mockAuthUrlGet.js\",\"time\":\"2026-01-07T23:25:17.134Z\",\"requestId\":\"3d1b808e-c861-4541-9979-ceaf290983d7\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"3d1b808e-c861-4541-9979-ceaf290983d7\",\"message\":\"Generating mock authorization URL\",\"state\":\"1bhvs8ya14p\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:17.134Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:17.134Z\",\"requestId\":\"3d1b808e-c861-4541-9979-ceaf290983d7\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"3d1b808e-c861-4541-9979-ceaf290983d7\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/mock/authUrl?state=1bhvs8ya14p&state=1bhvs8ya14p\",\"response\":{\"statusCode\":200,\"headers\":{\"x-request-id\":\"3d1b808e-c861-4541-9979-ceaf290983d7\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"3d1b808e-c861-4541-9979-ceaf290983d7\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"authUrl\\\":\\\"http://localhost:8080/oauth/authorize?response_type=code&client_id=debugger&redirect_uri=https%3A%2F%2Fwanted-finally-anteater.ngrok-free.app%2Fauth%2FloginWithMockCallback.html&scope=openid%20somescope&state=1bhvs8ya14p&identity_provider=MockOAuth2Server\\\"}\"}}"}
[BROWSER CONSOLE log]: Got auth URL. Remote call completed successfully: GET /api/v1/mock/authUrl?state=1bhvs8ya14p {authUrl: http://localhost:8080/oauth/authorize?response_typ…te=1bhvs8ya14p&identity_provider=MockOAuth2Server}
[BROWSER CONSOLE log]: Status message: Handing off to http://localhost:8080/oauth/authorize?response_type=code&client_id=debugger&redirect_uri=https%3A%2F%2Fwanted-finally-anteater.ngrok-free.app%2Fauth%2FloginWithMockCallback.html&scope=openid%20somescope&state=1bhvs8ya14p&identity_provider=MockOAuth2Server Type: info
[BROWSER CONSOLE log]: Redirecting to navikt/mock-oauth2-server
[USER INTERACTION] Filling: input[name="username"] with value: "user" - Entering username
[USER INTERACTION] Filling: textarea[name="claims"] with value: "{"email":"user@example.com"}" - Entering identity claims
[USER INTERACTION] Clicking: input[type="submit"][value="Sign-in"] - Submitting sign-in form
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.019Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.019Z\",\"msg\":\"HTTP GET /auth/loginWithMockCallback.html?code=xHEsRkmTVeGB7dcoW1cN8eoEThLzhjb9sq91rsMB80A&state=1bhvs8ya14p\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.090Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.090Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.090Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.090Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.092Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.092Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.114Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.114Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.114Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.114Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.115Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.115Z\",\"msg\":\"HTTP GET /widgets/hamburger-menu.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.116Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.116Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.116Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.116Z\",\"msg\":\"HTTP GET /widgets/loading-spinner.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.116Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.116Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
[BROWSER CONSOLE log]: Authentication callback received with code: xHEsRkmTVeGB7dcoW1cN8eoEThLzhjb9sq91rsMB80A
[BROWSER CONSOLE log]: Status message: Exchanging authorization code for access token... Type: info
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.212Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.212Z\",\"msg\":\"HTTP POST /api/v1/mock/token\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.243Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.243Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
[BROWSER CONSOLE log]: Received tokens from mock {"token_type":"Bearer","id_token":"eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njc4MjgzMTksImF6cCI6ImRlYnVnZ2VyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njc4MzE5MTksImlhdCI6MTc2NzgyODMxOSwianRpIjoiZWRjM2ZlOTYtOTc4NC00Y2I0LWFhYTUtMTFkMzRhMjI3M2M4IiwidGlkIjoiZGVmYXVsdCIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSJ9.NSdRhZD50hOTZBmVt5zCfwpFmJvLf1YEqvbUryuufZno8otXhzN1jlQDolr8neRqbEahoNn0C70Sc1i8DFKRmAGzel6euB6-2BcqlLDJiYmd37c4PeKveuIrCGQUBLoqfOX8bHfYMSbi9kGuTcACyL107waLMCWl2St5cPvRzD8Cx102e0ptwt82lbO5Cs2SOvPHksOW_rIZJLf1xlujajEZgprF4mPU9USTTVcakQB7wWXBcx8TfDVTMWEEX-iLDJIb9BJO3hx1Cv4O44RDw1orZYjouFwgL124s4FEAtWdAIFXJN7MFjTP7mUQVmNZzw_N6ykSQK-6Df4e4OmQSg","access_token":"eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVmYXVsdCIsIm5iZiI6MTc2NzgyODMxOSwiYXpwIjoiZGVidWdnZXIiLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvZGVmYXVsdCIsImV4cCI6MTc2NzgzMTkxOSwiaWF0IjoxNzY3ODI4MzE5LCJqdGkiOiJkMGZkNmFmNi1iZGRmLTRhZTQtYTlhNy02YTZmMGE0ZDQ5ZTYiLCJ0aWQiOiJkZWZhdWx0IiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.aV-rgk1D59ZNj0h4va3vLnmFFnZ0t6QJJ2Fbbfir8Zp6ginHaL3mIkxabLknWE-pWZ5DzrD9TKiEt9wjgo7Q-DSMjjnbD-74BJ18qoSomDq4g2lyTY6BBxwWGAkYdbSIbzPL_vuowytQzQd86FIKlhQ_leT9oU3qniu0abuD87WkXR2Z5hXk2a-wmSKwX59oO2O0f9wzdc5L5G6Rfc37V72PI1uWjSHn7dVaU3AdPSBlqMiitAi5Xv2XGD6cq5Rtp9vlEpfDhrvE-HCDIcoyYuAER7MlyZTiOfy-UtwKJ_pcYyojQ5iJHrgKX_FoNt31OddF4AL7tEGFVWy-S6iFBQ","refresh_token":"42933ecb-3b7c-44d6-9d8d-5af10c189530","expires_in":3599}
[BROWSER CONSOLE log]: Received id_token from mock {"sub":"user","aud":"debugger","nbf":1767828319,"azp":"debugger","iss":"http://localhost:8080/default","exp":1767831919,"iat":1767828319,"jti":"edc3fe96-9784-4cb4-aaa5-11d34a2273c8","tid":"default","email":"user@example.com"}
[BROWSER CONSOLE log]: User authenticated successfully using mock: user@example.com
[BROWSER CONSOLE log]: Status message: Authenticated successfully. Fetching bundles... Type: info
[BROWSER CONSOLE log]: Status message: Authenticated successfully. Redirecting... Type: info
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.780Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.780Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.865Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.865Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.930Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.930Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.932Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.932Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.939Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.939Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.940Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.940Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.940Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.940Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.953Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.953Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.954Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.954Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:19.954Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:19.954Z\",\"msg\":\"HTTP GET /widgets/hamburger-menu.js\"}"}
[BROWSER CONSOLE log]: Current activity cleared
[BROWSER CONSOLE log]: User is authenticated
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE log]: User is authenticated
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.024Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:20.024Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.024Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:20.024Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.024Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/subHasher.js\",\"time\":\"2026-01-07T23:25:20.024Z\",\"message\":\"Using USER_SUB_HASH_SALT from environment (local dev/test)\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.025Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:20.025Z\",\"requestId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njc4MjgzMTksImF6cCI6ImRlYnVnZ2VyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njc4MzE5MTksImlhdCI6MTc2NzgyODMxOSwianRpIjoiZWRjM2ZlOTYtOTc4NC00Y2I0LWFhYTUtMTFkMzRhMjI3M2M4IiwidGlkIjoiZGVmYXVsdCIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSJ9.NSdRhZD50hOTZBmVt5zCfwpFmJvLf1YEqvbUryuufZno8otXhzN1jlQDolr8neRqbEahoNn0C70Sc1i8DFKRmAGzel6euB6-2BcqlLDJiYmd37c4PeKveuIrCGQUBLoqfOX8bHfYMSbi9kGuTcACyL107waLMCWl2St5cPvRzD8Cx102e0ptwt82lbO5Cs2SOvPHksOW_rIZJLf1xlujajEZgprF4mPU9USTTVcakQB7wWXBcx8TfDVTMWEEX-iLDJIb9BJO3hx1Cv4O44RDw1orZYjouFwgL124s4FEAtWdAIFXJN7MFjTP7mUQVmNZzw_N6ykSQK-6Df4e4OmQSg\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/index.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.025Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:20.025Z\",\"requestId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.025Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:20.025Z\",\"requestId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.025Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:20.025Z\",\"requestId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.025Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:20.025Z\",\"requestId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.025Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:20.025Z\",\"requestId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.025Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:20.025Z\",\"requestId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.101Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:20.101Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.102Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:20.102Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.102Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:20.102Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.118Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:20.118Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.118Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:20.118Z\",\"requestId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njc4MjgzMTksImF6cCI6ImRlYnVnZ2VyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njc4MzE5MTksImlhdCI6MTc2NzgyODMxOSwianRpIjoiZWRjM2ZlOTYtOTc4NC00Y2I0LWFhYTUtMTFkMzRhMjI3M2M4IiwidGlkIjoiZGVmYXVsdCIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSJ9.NSdRhZD50hOTZBmVt5zCfwpFmJvLf1YEqvbUryuufZno8otXhzN1jlQDolr8neRqbEahoNn0C70Sc1i8DFKRmAGzel6euB6-2BcqlLDJiYmd37c4PeKveuIrCGQUBLoqfOX8bHfYMSbi9kGuTcACyL107waLMCWl2St5cPvRzD8Cx102e0ptwt82lbO5Cs2SOvPHksOW_rIZJLf1xlujajEZgprF4mPU9USTTVcakQB7wWXBcx8TfDVTMWEEX-iLDJIb9BJO3hx1Cv4O44RDw1orZYjouFwgL124s4FEAtWdAIFXJN7MFjTP7mUQVmNZzw_N6ykSQK-6Df4e4OmQSg\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/index.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.118Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:20.118Z\",\"requestId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:20.118Z\",\"requestId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.119Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:20.118Z\",\"requestId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.119Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:20.119Z\",\"requestId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:20.119Z\",\"requestId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.119Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:20.119Z\",\"requestId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.147Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:20.147Z\",\"requestId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:20.147Z\",\"requestId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:20.147Z\",\"requestId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":0}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:20.147Z\",\"requestId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.147Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:20.147Z\",\"requestId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"f8b2684c-84fe-46bb-ba3b-fa39e1cd78e5\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.148Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:20.148Z\",\"requestId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.148Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:20.148Z\",\"requestId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:20.148Z\",\"requestId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":0}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:20.148Z\",\"requestId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.148Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:20.148Z\",\"requestId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"a195a611-9e76-42ee-84d3-c32626b28d3d\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.174Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:20.173Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:20.246Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:20.246Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
Checking home page...
CloudWatch RUM analytics consent dialog is visible, accepting...
[USER INTERACTION] Clicking: button:has-text("Accept") - Accept CloudWatch RUM consent
Opening hamburger menu...
[USER INTERACTION] Clicking: button.hamburger-btn - Opening hamburger menu
[USER INTERACTION] Clicking: a[href*='bundles.html'] - Clicking Bundles in hamburger menu
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.370Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:22.370Z\",\"msg\":\"HTTP GET /account/bundles.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.436Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:22.436Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.436Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:22.436Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.437Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:22.437Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.459Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:22.459Z\",\"msg\":\"HTTP GET /lib/bundle-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.460Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:22.460Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.461Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:22.461Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.461Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:22.461Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.462Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:22.462Z\",\"msg\":\"HTTP GET /widgets/loading-spinner.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.462Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:22.462Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.463Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:22.463Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.464Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:22.464Z\",\"msg\":\"HTTP GET /widgets/hamburger-menu.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.464Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:22.464Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
[BROWSER CONSOLE log]: User is authenticated
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.550Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:22.550Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.551Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:22.551Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.552Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:22.551Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.552Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:22.552Z\",\"requestId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njc4MjgzMTksImF6cCI6ImRlYnVnZ2VyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njc4MzE5MTksImlhdCI6MTc2NzgyODMxOSwianRpIjoiZWRjM2ZlOTYtOTc4NC00Y2I0LWFhYTUtMTFkMzRhMjI3M2M4IiwidGlkIjoiZGVmYXVsdCIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSJ9.NSdRhZD50hOTZBmVt5zCfwpFmJvLf1YEqvbUryuufZno8otXhzN1jlQDolr8neRqbEahoNn0C70Sc1i8DFKRmAGzel6euB6-2BcqlLDJiYmd37c4PeKveuIrCGQUBLoqfOX8bHfYMSbi9kGuTcACyL107waLMCWl2St5cPvRzD8Cx102e0ptwt82lbO5Cs2SOvPHksOW_rIZJLf1xlujajEZgprF4mPU9USTTVcakQB7wWXBcx8TfDVTMWEEX-iLDJIb9BJO3hx1Cv4O44RDw1orZYjouFwgL124s4FEAtWdAIFXJN7MFjTP7mUQVmNZzw_N6ykSQK-6Df4e4OmQSg\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/account/bundles.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.552Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:22.552Z\",\"requestId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:22.552Z\",\"requestId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:22.552Z\",\"requestId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.552Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:22.552Z\",\"requestId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:22.552Z\",\"requestId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.552Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:22.552Z\",\"requestId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.555Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:22.555Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:22.555Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:22.555Z\",\"requestId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njc4MjgzMTksImF6cCI6ImRlYnVnZ2VyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njc4MzE5MTksImlhdCI6MTc2NzgyODMxOSwianRpIjoiZWRjM2ZlOTYtOTc4NC00Y2I0LWFhYTUtMTFkMzRhMjI3M2M4IiwidGlkIjoiZGVmYXVsdCIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSJ9.NSdRhZD50hOTZBmVt5zCfwpFmJvLf1YEqvbUryuufZno8otXhzN1jlQDolr8neRqbEahoNn0C70Sc1i8DFKRmAGzel6euB6-2BcqlLDJiYmd37c4PeKveuIrCGQUBLoqfOX8bHfYMSbi9kGuTcACyL107waLMCWl2St5cPvRzD8Cx102e0ptwt82lbO5Cs2SOvPHksOW_rIZJLf1xlujajEZgprF4mPU9USTTVcakQB7wWXBcx8TfDVTMWEEX-iLDJIb9BJO3hx1Cv4O44RDw1orZYjouFwgL124s4FEAtWdAIFXJN7MFjTP7mUQVmNZzw_N6ykSQK-6Df4e4OmQSg\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/account/bundles.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"71768834-4a27-4413-a2d4-3ef357c82f53\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:22.555Z\",\"requestId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:22.555Z\",\"requestId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:22.555Z\",\"requestId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:22.555Z\",\"requestId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:22.555Z\",\"requestId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.555Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:22.555Z\",\"requestId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.558Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:22.558Z\",\"requestId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.558Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:22.558Z\",\"requestId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:22.558Z\",\"requestId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":0}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:22.558Z\",\"requestId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.558Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:22.558Z\",\"requestId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"fe83042a-cb4c-4cc1-ad0b-daffcf5c07cd\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.558Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:22.558Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.559Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:22.559Z\",\"requestId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.559Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:22.559Z\",\"requestId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:22.559Z\",\"requestId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.559Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:22.559Z\",\"requestId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:22.559Z\",\"requestId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"71768834-4a27-4413-a2d4-3ef357c82f53\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.641Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:22.641Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.644Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:22.644Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:22.695Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:22.695Z\",\"msg\":\"HTTP GET /submit.environment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:23.203Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
Ensuring Test bundle is present...
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (1/5)
[polling to ensure present]: Test bundle still not present.
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (2/5)
[polling to ensure present]: Test bundle still not present.
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (3/5)
[polling to ensure present]: Test bundle still not present.
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (4/5)
[polling to ensure present]: Test bundle still not present.
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (5/5)
[polling to ensure present]: Test bundle still not present.
Test bundle not present, requesting...
Requesting Test bundle...
[polling be ready to request]: Test bundle request button already visible.
[USER INTERACTION] Clicking: button:has-text('Request Test') - Request Test
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.490Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:29.489Z\",\"msg\":\"HTTP POST /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.490Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:29.490Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.490Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:29.490Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"content-length\":\"35\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njc4MjgzMTksImF6cCI6ImRlYnVnZ2VyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njc4MzE5MTksImlhdCI6MTc2NzgyODMxOSwianRpIjoiZWRjM2ZlOTYtOTc4NC00Y2I0LWFhYTUtMTFkMzRhMjI3M2M4IiwidGlkIjoiZGVmYXVsdCIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSJ9.NSdRhZD50hOTZBmVt5zCfwpFmJvLf1YEqvbUryuufZno8otXhzN1jlQDolr8neRqbEahoNn0C70Sc1i8DFKRmAGzel6euB6-2BcqlLDJiYmd37c4PeKveuIrCGQUBLoqfOX8bHfYMSbi9kGuTcACyL107waLMCWl2St5cPvRzD8Cx102e0ptwt82lbO5Cs2SOvPHksOW_rIZJLf1xlujajEZgprF4mPU9USTTVcakQB7wWXBcx8TfDVTMWEEX-iLDJIb9BJO3hx1Cv4O44RDw1orZYjouFwgL124s4FEAtWdAIFXJN7MFjTP7mUQVmNZzw_N6ykSQK-6Df4e4OmQSg\",\"cache-control\":\"no-cache\",\"content-type\":\"application/json\",\"ngrok-skip-browser-warning\":\"any value\",\"origin\":\"https://wanted-finally-anteater.ngrok-free.app\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/account/bundles.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"x-wait-time-ms\":\"0\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"bundleId\\\":\\\"test\\\",\\\"qualifiers\\\":{}}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.490Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-01-07T23:25:29.490Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Processing bundle request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.490Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:29.490Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.491Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-01-07T23:25:29.490Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Processing bundle request for user\",\"userId\":\"user\",\"bundleId\":\"test\",\"waitTimeMs\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.491Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:29.491Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Executing synchronous processing\",\"userId\":\"user\",\"waitTimeMs\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.491Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-01-07T23:25:29.491Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"grantBundle entry\",\"userId\":\"user\",\"requestedBundle\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.491Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:29.491Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.491Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:29.491Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.496Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:29.496Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.496Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:29.496Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.500Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-01-07T23:25:29.499Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Loaded catalog bundle:\",\"bundleId\":\"test\",\"catalogBundle\":{\"id\":\"test\",\"name\":\"Test\",\"allocation\":\"on-request\",\"cap\":10,\"timeout\":\"P1D\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.500Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-01-07T23:25:29.500Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"[Catalog bundle] Bundle requires manual allocation, proceeding:\",\"requestedBundle\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.500Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-01-07T23:25:29.500Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"[Catalog bundle] Bundle cap not yet reached:\",\"requestedBundle\":\"test\",\"currentCount\":0,\"cap\":10}\n{\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-01-07T23:25:29.500Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Granting bundle to user:\",\"userId\":\"user\",\"requestedBundle\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.500Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-01-07T23:25:29.500Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"New bundle details:\",\"newBundle\":{\"bundleId\":\"test\",\"expiry\":\"2026-01-08\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.500Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-01-07T23:25:29.500Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Updated user bundles:\",\"userId\":\"user\",\"currentBundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-01-08\"}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.501Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:29.500Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Updating bundles for user user with 1\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-01-08\"}]}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:29.500Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.501Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:29.501Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.505Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:29.504Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.505Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:29.505Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:29.505Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Current bundles for user user in DynamoDB count: 0\",\"currentBundles\":[]}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:29.505Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Current bundle IDs for user user in DynamoDB count: undefined\",\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.505Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:29.505Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"New bundle IDs for user user count: undefined\",\"newBundleIds\":{}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:29.505Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Bundles to remove for user user in DynamoDB\",\"bundlesToRemove\":[]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.505Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:29.505Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Checking if bundle test needs adding for user user in DynamoDB\",\"bundle\":{\"bundleId\":\"test\",\"expiry\":\"2026-01-08\"}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:29.505Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Adding new bundle test for user user in DynamoDB\",\"bundle\":{\"bundleId\":\"test\",\"expiry\":\"2026-01-08\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.505Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:29.505Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"putBundle [table: test-bundle-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.505Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:29.505Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Storing bundle\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"userId\":\"user\",\"bundle\":{\"bundleId\":\"test\",\"expiry\":\"2026-01-08\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.505Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:29.505Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Storing bundle in DynamoDB as item\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"item\":{\"bundleId\":\"test\",\"expiry\":\"2026-01-08T00:00:00.000Z\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-01-07T23:25:29.505Z\",\"ttl\":1770508800,\"ttl_datestamp\":\"2026-02-08T00:00:00.000Z\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.511Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:29.511Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Bundle stored in DynamoDB as item\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"item\":{\"bundleId\":\"test\",\"expiry\":\"2026-01-08T00:00:00.000Z\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-01-07T23:25:29.505Z\",\"ttl\":1770508800,\"ttl_datestamp\":\"2026-02-08T00:00:00.000Z\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:29.511Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:29.511Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Updated bundles for user user in DynamoDB\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-01-08\"}]}\n{\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-01-07T23:25:29.511Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Bundle granted to user:\",\"userId\":\"user\",\"newBundle\":{\"bundleId\":\"test\",\"expiry\":\"2026-01-08\"}}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:29.511Z\",\"requestId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"edda342c-9bce-495a-a761-12e67a4a3223\",\"message\":\"Returning result with status 201\"}"}
[BROWSER CONSOLE log]: Status message: Bundle "Test" added successfully. Type: success
[polling to ensure request completed]: Test bundle already present.
[USER INTERACTION] Clicking: button:has-text('Back to Home') - Back to Home
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.172Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:30.172Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.245Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:30.243Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.263Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:30.263Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.284Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:30.283Z\",\"msg\":\"HTTP GET /widgets/hamburger-menu.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.284Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:30.284Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.285Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:30.285Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.286Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:30.286Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.287Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:30.287Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.287Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:30.287Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.292Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:30.292Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
[BROWSER CONSOLE log]: Current activity cleared
[BROWSER CONSOLE log]: User is authenticated
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE log]: User is authenticated
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.370Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:30.370Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.371Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:30.371Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.371Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:30.371Z\",\"requestId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njc4MjgzMTksImF6cCI6ImRlYnVnZ2VyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njc4MzE5MTksImlhdCI6MTc2NzgyODMxOSwianRpIjoiZWRjM2ZlOTYtOTc4NC00Y2I0LWFhYTUtMTFkMzRhMjI3M2M4IiwidGlkIjoiZGVmYXVsdCIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSJ9.NSdRhZD50hOTZBmVt5zCfwpFmJvLf1YEqvbUryuufZno8otXhzN1jlQDolr8neRqbEahoNn0C70Sc1i8DFKRmAGzel6euB6-2BcqlLDJiYmd37c4PeKveuIrCGQUBLoqfOX8bHfYMSbi9kGuTcACyL107waLMCWl2St5cPvRzD8Cx102e0ptwt82lbO5Cs2SOvPHksOW_rIZJLf1xlujajEZgprF4mPU9USTTVcakQB7wWXBcx8TfDVTMWEEX-iLDJIb9BJO3hx1Cv4O44RDw1orZYjouFwgL124s4FEAtWdAIFXJN7MFjTP7mUQVmNZzw_N6ykSQK-6Df4e4OmQSg\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/index.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.371Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:30.371Z\",\"requestId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:30.371Z\",\"requestId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.371Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:30.371Z\",\"requestId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:30.371Z\",\"requestId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.371Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:30.371Z\",\"requestId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.371Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:30.371Z\",\"requestId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.374Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:30.374Z\",\"requestId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.375Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:30.374Z\",\"requestId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:30.374Z\",\"requestId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:30.374Z\",\"requestId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.375Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:30.374Z\",\"requestId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"d93ab006-7d50-427c-90a3-4164ed9e80a1\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-08T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-07T23:25:29.505Z\\\",\\\"ttl\\\":1770508800,\\\"ttl_datestamp\\\":\\\"2026-02-08T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.375Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:30.375Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.381Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:30.381Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.381Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:30.381Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.381Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:30.381Z\",\"requestId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njc4MjgzMTksImF6cCI6ImRlYnVnZ2VyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njc4MzE5MTksImlhdCI6MTc2NzgyODMxOSwianRpIjoiZWRjM2ZlOTYtOTc4NC00Y2I0LWFhYTUtMTFkMzRhMjI3M2M4IiwidGlkIjoiZGVmYXVsdCIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSJ9.NSdRhZD50hOTZBmVt5zCfwpFmJvLf1YEqvbUryuufZno8otXhzN1jlQDolr8neRqbEahoNn0C70Sc1i8DFKRmAGzel6euB6-2BcqlLDJiYmd37c4PeKveuIrCGQUBLoqfOX8bHfYMSbi9kGuTcACyL107waLMCWl2St5cPvRzD8Cx102e0ptwt82lbO5Cs2SOvPHksOW_rIZJLf1xlujajEZgprF4mPU9USTTVcakQB7wWXBcx8TfDVTMWEEX-iLDJIb9BJO3hx1Cv4O44RDw1orZYjouFwgL124s4FEAtWdAIFXJN7MFjTP7mUQVmNZzw_N6ykSQK-6Df4e4OmQSg\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/index.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.382Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:30.381Z\",\"requestId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:30.382Z\",\"requestId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:30.382Z\",\"requestId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.382Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:30.382Z\",\"requestId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:30.382Z\",\"requestId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.382Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:30.382Z\",\"requestId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.385Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:30.384Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.386Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:30.386Z\",\"requestId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.386Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:30.386Z\",\"requestId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:30.386Z\",\"requestId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:30.386Z\",\"requestId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:30.386Z\",\"requestId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"c8fe28ff-4e58-4064-9529-4245ac56c377\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-08T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-07T23:25:29.505Z\\\",\\\"ttl\\\":1770508800,\\\"ttl_datestamp\\\":\\\"2026-02-08T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.479Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:30.478Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:30.479Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:30.479Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
Opening hamburger menu...
[USER INTERACTION] Clicking: button.hamburger-btn - Opening hamburger menu
[USER INTERACTION] Clicking: a[href*='bundles.html'] - Clicking Bundles in hamburger menu
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.607Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:31.607Z\",\"msg\":\"HTTP GET /account/bundles.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.668Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:31.668Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.669Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:31.668Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.672Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:31.671Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.693Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:31.693Z\",\"msg\":\"HTTP GET /lib/bundle-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.694Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:31.694Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.699Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:31.699Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.700Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:31.699Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.700Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:31.700Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.701Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:31.701Z\",\"msg\":\"HTTP GET /widgets/hamburger-menu.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.701Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:31.701Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.702Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:31.702Z\",\"msg\":\"HTTP GET /widgets/loading-spinner.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.703Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:31.703Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
[BROWSER CONSOLE log]: User is authenticated
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.782Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:31.782Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.782Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:31.782Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.783Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:31.783Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.783Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:31.783Z\",\"requestId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njc4MjgzMTksImF6cCI6ImRlYnVnZ2VyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njc4MzE5MTksImlhdCI6MTc2NzgyODMxOSwianRpIjoiZWRjM2ZlOTYtOTc4NC00Y2I0LWFhYTUtMTFkMzRhMjI3M2M4IiwidGlkIjoiZGVmYXVsdCIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSJ9.NSdRhZD50hOTZBmVt5zCfwpFmJvLf1YEqvbUryuufZno8otXhzN1jlQDolr8neRqbEahoNn0C70Sc1i8DFKRmAGzel6euB6-2BcqlLDJiYmd37c4PeKveuIrCGQUBLoqfOX8bHfYMSbi9kGuTcACyL107waLMCWl2St5cPvRzD8Cx102e0ptwt82lbO5Cs2SOvPHksOW_rIZJLf1xlujajEZgprF4mPU9USTTVcakQB7wWXBcx8TfDVTMWEEX-iLDJIb9BJO3hx1Cv4O44RDw1orZYjouFwgL124s4FEAtWdAIFXJN7MFjTP7mUQVmNZzw_N6ykSQK-6Df4e4OmQSg\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/account/bundles.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"770077fe-a96e-4640-accb-477b8e8c5e69\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.783Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:31.783Z\",\"requestId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.783Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:31.783Z\",\"requestId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.783Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:31.783Z\",\"requestId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:31.783Z\",\"requestId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.783Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:31.783Z\",\"requestId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.783Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:31.783Z\",\"requestId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.786Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:31.785Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:31.785Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:31.786Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:31.786Z\",\"requestId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njc4MjgzMTksImF6cCI6ImRlYnVnZ2VyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njc4MzE5MTksImlhdCI6MTc2NzgyODMxOSwianRpIjoiZWRjM2ZlOTYtOTc4NC00Y2I0LWFhYTUtMTFkMzRhMjI3M2M4IiwidGlkIjoiZGVmYXVsdCIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSJ9.NSdRhZD50hOTZBmVt5zCfwpFmJvLf1YEqvbUryuufZno8otXhzN1jlQDolr8neRqbEahoNn0C70Sc1i8DFKRmAGzel6euB6-2BcqlLDJiYmd37c4PeKveuIrCGQUBLoqfOX8bHfYMSbi9kGuTcACyL107waLMCWl2St5cPvRzD8Cx102e0ptwt82lbO5Cs2SOvPHksOW_rIZJLf1xlujajEZgprF4mPU9USTTVcakQB7wWXBcx8TfDVTMWEEX-iLDJIb9BJO3hx1Cv4O44RDw1orZYjouFwgL124s4FEAtWdAIFXJN7MFjTP7mUQVmNZzw_N6ykSQK-6Df4e4OmQSg\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/account/bundles.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:31.786Z\",\"requestId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:31.786Z\",\"requestId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:31.786Z\",\"requestId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:31.786Z\",\"requestId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:31.786Z\",\"requestId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:31.786Z\",\"requestId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.788Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:31.788Z\",\"requestId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.788Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:31.788Z\",\"requestId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:31.788Z\",\"requestId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:31.788Z\",\"requestId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:31.788Z\",\"requestId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"770077fe-a96e-4640-accb-477b8e8c5e69\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-08T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-07T23:25:29.505Z\\\",\\\"ttl\\\":1770508800,\\\"ttl_datestamp\\\":\\\"2026-02-08T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.790Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:31.789Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.791Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:31.791Z\",\"requestId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.791Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:31.791Z\",\"requestId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:31.791Z\",\"requestId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:31.791Z\",\"requestId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.792Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:31.791Z\",\"requestId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"c5a65782-c87c-4ce6-b643-19e9adff8a57\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-08T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-07T23:25:29.505Z\\\",\\\"ttl\\\":1770508800,\\\"ttl_datestamp\\\":\\\"2026-02-08T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.879Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:31.879Z\",\"msg\":\"HTTP GET /submit.environment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:31.879Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:31.879Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
[USER INTERACTION] Clicking: button:has-text('Back to Home') - Back to Home
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.739Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:32.739Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.801Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:32.801Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.805Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:32.805Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.826Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:32.826Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.827Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:32.827Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.828Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:32.827Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.828Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:32.828Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.829Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:32.829Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.829Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:32.829Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.830Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:32.830Z\",\"msg\":\"HTTP GET /widgets/hamburger-menu.js\"}"}
[BROWSER CONSOLE log]: Current activity cleared
[BROWSER CONSOLE log]: User is authenticated
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE log]: User is authenticated
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.916Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:32.915Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.916Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:32.916Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.916Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:32.916Z\",\"requestId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njc4MjgzMTksImF6cCI6ImRlYnVnZ2VyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njc4MzE5MTksImlhdCI6MTc2NzgyODMxOSwianRpIjoiZWRjM2ZlOTYtOTc4NC00Y2I0LWFhYTUtMTFkMzRhMjI3M2M4IiwidGlkIjoiZGVmYXVsdCIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSJ9.NSdRhZD50hOTZBmVt5zCfwpFmJvLf1YEqvbUryuufZno8otXhzN1jlQDolr8neRqbEahoNn0C70Sc1i8DFKRmAGzel6euB6-2BcqlLDJiYmd37c4PeKveuIrCGQUBLoqfOX8bHfYMSbi9kGuTcACyL107waLMCWl2St5cPvRzD8Cx102e0ptwt82lbO5Cs2SOvPHksOW_rIZJLf1xlujajEZgprF4mPU9USTTVcakQB7wWXBcx8TfDVTMWEEX-iLDJIb9BJO3hx1Cv4O44RDw1orZYjouFwgL124s4FEAtWdAIFXJN7MFjTP7mUQVmNZzw_N6ykSQK-6Df4e4OmQSg\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/index.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.916Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:32.916Z\",\"requestId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:32.916Z\",\"requestId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:32.916Z\",\"requestId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:32.916Z\",\"requestId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.916Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:32.916Z\",\"requestId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.916Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:32.916Z\",\"requestId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.919Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:32.919Z\",\"requestId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:32.919Z\",\"requestId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.919Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:32.919Z\",\"requestId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.919Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:32.919Z\",\"requestId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:32.919Z\",\"requestId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"7d36c0fe-6e11-4f2c-a876-90409033d475\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-08T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-07T23:25:29.505Z\\\",\\\"ttl\\\":1770508800,\\\"ttl_datestamp\\\":\\\"2026-02-08T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.924Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:32.924Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.925Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:32.925Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.925Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:32.925Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.925Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:32.925Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.925Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:32.925Z\",\"requestId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njc4MjgzMTksImF6cCI6ImRlYnVnZ2VyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njc4MzE5MTksImlhdCI6MTc2NzgyODMxOSwianRpIjoiZWRjM2ZlOTYtOTc4NC00Y2I0LWFhYTUtMTFkMzRhMjI3M2M4IiwidGlkIjoiZGVmYXVsdCIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSJ9.NSdRhZD50hOTZBmVt5zCfwpFmJvLf1YEqvbUryuufZno8otXhzN1jlQDolr8neRqbEahoNn0C70Sc1i8DFKRmAGzel6euB6-2BcqlLDJiYmd37c4PeKveuIrCGQUBLoqfOX8bHfYMSbi9kGuTcACyL107waLMCWl2St5cPvRzD8Cx102e0ptwt82lbO5Cs2SOvPHksOW_rIZJLf1xlujajEZgprF4mPU9USTTVcakQB7wWXBcx8TfDVTMWEEX-iLDJIb9BJO3hx1Cv4O44RDw1orZYjouFwgL124s4FEAtWdAIFXJN7MFjTP7mUQVmNZzw_N6ykSQK-6Df4e4OmQSg\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/index.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.925Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:32.925Z\",\"requestId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:32.925Z\",\"requestId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:32.925Z\",\"requestId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.925Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:32.925Z\",\"requestId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:32.925Z\",\"requestId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.925Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:32.925Z\",\"requestId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.928Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:32.927Z\",\"requestId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.928Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:32.928Z\",\"requestId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:32.928Z\",\"requestId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:32.928Z\",\"requestId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:32.928Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:32.928Z\",\"requestId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"ded565e0-e38c-4404-b59e-cf234522f0b3\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-08T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-07T23:25:29.505Z\\\",\\\"ttl\\\":1770508800,\\\"ttl_datestamp\\\":\\\"2026-02-08T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:33.023Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:33.023Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:33.024Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:33.024Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:33.591Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: button:has-text('Submit VAT (HMRC Sandbox)') - Starting VAT return submission
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.368Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:34.368Z\",\"msg\":\"HTTP GET /hmrc/vat/submitVat.html?hmrcAccount=sandbox\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.436Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:34.432Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.450Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:34.450Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.461Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:34.461Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.476Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:34.476Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.477Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:34.477Z\",\"msg\":\"HTTP GET /lib/test-data-generator.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.478Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:34.478Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.478Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:34.478Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.479Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:34.479Z\",\"msg\":\"HTTP GET /widgets/hamburger-menu.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.484Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:34.483Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.484Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:34.484Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.485Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:34.485Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
[BROWSER CONSOLE log]: JS block finished loading.
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE log]: JS block started loading: DOMContentLoaded event handler
[BROWSER CONSOLE log]: OAuth callback handler (no action taken)
[BROWSER CONSOLE log]: JS block finished loading: DOMContentLoaded event handler
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.557Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:34.557Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.565Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:34.565Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.565Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:34.565Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.565Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:34.565Z\",\"requestId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njc4MjgzMTksImF6cCI6ImRlYnVnZ2VyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njc4MzE5MTksImlhdCI6MTc2NzgyODMxOSwianRpIjoiZWRjM2ZlOTYtOTc4NC00Y2I0LWFhYTUtMTFkMzRhMjI3M2M4IiwidGlkIjoiZGVmYXVsdCIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSJ9.NSdRhZD50hOTZBmVt5zCfwpFmJvLf1YEqvbUryuufZno8otXhzN1jlQDolr8neRqbEahoNn0C70Sc1i8DFKRmAGzel6euB6-2BcqlLDJiYmd37c4PeKveuIrCGQUBLoqfOX8bHfYMSbi9kGuTcACyL107waLMCWl2St5cPvRzD8Cx102e0ptwt82lbO5Cs2SOvPHksOW_rIZJLf1xlujajEZgprF4mPU9USTTVcakQB7wWXBcx8TfDVTMWEEX-iLDJIb9BJO3hx1Cv4O44RDw1orZYjouFwgL124s4FEAtWdAIFXJN7MFjTP7mUQVmNZzw_N6ykSQK-6Df4e4OmQSg\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:34.565Z\",\"requestId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.565Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:34.565Z\",\"requestId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:34.565Z\",\"requestId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:34.565Z\",\"requestId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:34.565Z\",\"requestId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.566Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:34.565Z\",\"requestId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.568Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:34.567Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:34.567Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:34.567Z\",\"requestId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njc4MjgzMTksImF6cCI6ImRlYnVnZ2VyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njc4MzE5MTksImlhdCI6MTc2NzgyODMxOSwianRpIjoiZWRjM2ZlOTYtOTc4NC00Y2I0LWFhYTUtMTFkMzRhMjI3M2M4IiwidGlkIjoiZGVmYXVsdCIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSJ9.NSdRhZD50hOTZBmVt5zCfwpFmJvLf1YEqvbUryuufZno8otXhzN1jlQDolr8neRqbEahoNn0C70Sc1i8DFKRmAGzel6euB6-2BcqlLDJiYmd37c4PeKveuIrCGQUBLoqfOX8bHfYMSbi9kGuTcACyL107waLMCWl2St5cPvRzD8Cx102e0ptwt82lbO5Cs2SOvPHksOW_rIZJLf1xlujajEZgprF4mPU9USTTVcakQB7wWXBcx8TfDVTMWEEX-iLDJIb9BJO3hx1Cv4O44RDw1orZYjouFwgL124s4FEAtWdAIFXJN7MFjTP7mUQVmNZzw_N6ykSQK-6Df4e4OmQSg\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:34.567Z\",\"requestId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:34.567Z\",\"requestId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:34.567Z\",\"requestId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:34.567Z\",\"requestId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:34.567Z\",\"requestId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:34.568Z\",\"requestId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.569Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:34.569Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.570Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:34.570Z\",\"requestId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:34.570Z\",\"requestId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.570Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:34.570Z\",\"requestId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:34.570Z\",\"requestId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.570Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:34.570Z\",\"requestId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"57dfdbd0-3772-4806-81a6-e2ba4c000f58\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-08T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-07T23:25:29.505Z\\\",\\\"ttl\\\":1770508800,\\\"ttl_datestamp\\\":\\\"2026-02-08T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.571Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:34.571Z\",\"requestId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:34.571Z\",\"requestId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:34.571Z\",\"requestId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:34.571Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:34.571Z\",\"requestId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:34.571Z\",\"requestId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"2c8327bb-1d6a-4ad3-a389-0d0467bb8b7a\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-08T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-07T23:25:29.505Z\\\",\\\"ttl\\\":1770508800,\\\"ttl_datestamp\\\":\\\"2026-02-08T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:35.775Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: #testDataLink a - Clicking add test data link
[BROWSER CONSOLE log]: [Test Data] Populated VAT submission form with test data
[USER INTERACTION] Filling: #vatNumber with value: "299294688" - Entering VAT number
[USER INTERACTION] Filling: #periodKey with value: "25U6" - Entering period key
[USER INTERACTION] Filling: #vatDue with value: "1000.00" - Entering VAT due amount
[USER INTERACTION] Clicking: button:has-text('Show Developer Options') - Show Developer Options
Checked runFraudPreventionHeaderValidation checkbox
[USER INTERACTION] Focusing: #submitBtn - the Submit button
[USER INTERACTION] Clicking: #submitBtn - Submitting VAT form
[BROWSER CONSOLE log]: Status message: Initiating HMRC authentication... Type: info
[BROWSER CONSOLE log]: Stored pending request and current activity: {"vatNumber":"299294688","periodKey":"25U6","vatDue":"1000.00","testScenario":"","runFraudPreventionHeaderValidation":true} /hmrc/vat/submitVat.html sandbox
[BROWSER CONSOLE log]: Using client-side generated HMRC Auth URL: https://test-api.service.hmrc.gov.uk/oauth/authorize?response_type=code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&redirect_uri=https%3A%2F%2Fwanted-finally-anteater.ngrok-free.app%2Factivities%2FsubmitVatCallback.html&scope=write%3Avat%20read%3Avat&state=93690888a7b84e5684da5d8fe2272ccd
[BROWSER CONSOLE log]: Current activity set to: /hmrc/vat/submitVat.html
[BROWSER CONSOLE log]: Status message: Redirecting to HMRC for authentication at https://test-api.service.hmrc.gov.uk/oauth/authorize?response_type=code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&redirect_uri=https%3A%2F%2Fwanted-finally-anteater.ngrok-free.app%2Factivities%2FsubmitVatCallback.html&scope=write%3Avat%20read%3Avat&state=93690888a7b84e5684da5d8fe2272ccd... Type: info
[BROWSER CONSOLE log]: Page transition initiated: Redirecting to HMRC OAuth URL https://test-api.service.hmrc.gov.uk/oauth/authorize?response_type=code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&redirect_uri=https%3A%2F%2Fwanted-finally-anteater.ngrok-free.app%2Factivities%2FsubmitVatCallback.html&scope=write%3Avat%20read%3Avat&state=93690888a7b84e5684da5d8fe2272ccd
[USER INTERACTION] Clicking: Continue button - Continuing with HMRC permission
[USER INTERACTION] Clicking: [Locator] - Continue
[USER INTERACTION] Clicking: Sign in to HMRC button - Starting HMRC authentication
[USER INTERACTION] Clicking: [Locator] - Sign in to the HMRC online service
[BROWSER ERROR]: Cannot read properties of null (reading 'addEventListener')
[BROWSER ERROR]: Cannot read properties of undefined (reading 'initAll')
[USER INTERACTION] Filling: #userId with value: "441080096176" - Entering HMRC user ID
[USER INTERACTION] Filling: #password with value: "2CEUk53dZILD" - Entering HMRC password
[USER INTERACTION] Clicking: Sign in button - Submitting HMRC credentials
[USER INTERACTION] Clicking: [Locator] - Sign in
[USER INTERACTION] Clicking: #givePermission - Give permission
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.564Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:47.564Z\",\"msg\":\"HTTP GET /activities/submitVatCallback.html?code=6cd5ad5c74194c2ead7487789211b1b1&state=93690888a7b84e5684da5d8fe2272ccd\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.633Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:47.633Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.633Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:47.633Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.656Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:47.656Z\",\"msg\":\"HTTP GET /widgets/hamburger-menu.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.656Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:47.656Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.657Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:47.657Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.657Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:47.657Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.658Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:47.658Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.659Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:47.659Z\",\"msg\":\"HTTP GET /widgets/loading-spinner.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.659Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:47.659Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
[BROWSER CONSOLE log]: OAuth callback handler
[BROWSER CONSOLE log]: Page transition initiated: Clearing URL parameters
[BROWSER CONSOLE log]: OAuth callback handler (normal completion)
[BROWSER CONSOLE log]: Status message: Exchanging authorization code for access token... Type: info
[BROWSER CONSOLE log]: Exchanging token. Remote call initiated: POST /api/v1/hmrc/token ++ Body: {"code":"6cd5ad5c74194c2ead7487789211b1b1"}
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.795Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:47.795Z\",\"msg\":\"HTTP POST /api/v1/hmrc/token\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.795Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:47.795Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.795Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:47.795Z\",\"requestId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/token?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/token\"}},\"path\":\"/api/v1/hmrc/token\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"content-length\":\"43\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njc4MjgzMTksImF6cCI6ImRlYnVnZ2VyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njc4MzE5MTksImlhdCI6MTc2NzgyODMxOSwianRpIjoiZWRjM2ZlOTYtOTc4NC00Y2I0LWFhYTUtMTFkMzRhMjI3M2M4IiwidGlkIjoiZGVmYXVsdCIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSJ9.NSdRhZD50hOTZBmVt5zCfwpFmJvLf1YEqvbUryuufZno8otXhzN1jlQDolr8neRqbEahoNn0C70Sc1i8DFKRmAGzel6euB6-2BcqlLDJiYmd37c4PeKveuIrCGQUBLoqfOX8bHfYMSbi9kGuTcACyL107waLMCWl2St5cPvRzD8Cx102e0ptwt82lbO5Cs2SOvPHksOW_rIZJLf1xlujajEZgprF4mPU9USTTVcakQB7wWXBcx8TfDVTMWEEX-iLDJIb9BJO3hx1Cv4O44RDw1orZYjouFwgL124s4FEAtWdAIFXJN7MFjTP7mUQVmNZzw_N6ykSQK-6Df4e4OmQSg\",\"cache-control\":\"no-cache\",\"content-type\":\"application/json\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"origin\":\"https://wanted-finally-anteater.ngrok-free.app\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/activities/submitVatCallback.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"code\\\":\\\"6cd5ad5c74194c2ead7487789211b1b1\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.795Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcTokenPost.js\",\"time\":\"2026-01-07T23:25:47.795Z\",\"requestId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"message\":\"Exchanging authorization code for HMRC access token\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.796Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcTokenPost.js\",\"time\":\"2026-01-07T23:25:47.796Z\",\"requestId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"msg\":\"Retrieving HMRC client secret from arn \"}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcTokenPost.js\",\"time\":\"2026-01-07T23:25:47.796Z\",\"requestId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"msg\":\"Secret retrieved from override and cached\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.796Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:47.796Z\",\"requestId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"message\":\"Request to POST https://test-api.service.hmrc.gov.uk/oauth/token\",\"url\":\"https://test-api.service.hmrc.gov.uk/oauth/token\",\"headers\":{\"Content-Type\":\"application/x-www-form-urlencoded\",\"x-request-id\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\"},\"body\":\"grant_type=authorization_code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&client_secret=049b662f-61ea-4113-b38d-a9c8b1bb9f13&redirect_uri=https%3A%2F%2Fwanted-finally-anteater.ngrok-free.app%2Factivities%2FsubmitVatCallback.html&code=6cd5ad5c74194c2ead7487789211b1b1\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:47.796Z\",\"requestId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"message\":\"Performing HTTP POST for token exchange\",\"providerUrl\":\"https://test-api.service.hmrc.gov.uk/oauth/token\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.835Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:47.835Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.836Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:47.835Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.836Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:47.836Z\",\"requestId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njc4MjgzMTksImF6cCI6ImRlYnVnZ2VyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njc4MzE5MTksImlhdCI6MTc2NzgyODMxOSwianRpIjoiZWRjM2ZlOTYtOTc4NC00Y2I0LWFhYTUtMTFkMzRhMjI3M2M4IiwidGlkIjoiZGVmYXVsdCIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSJ9.NSdRhZD50hOTZBmVt5zCfwpFmJvLf1YEqvbUryuufZno8otXhzN1jlQDolr8neRqbEahoNn0C70Sc1i8DFKRmAGzel6euB6-2BcqlLDJiYmd37c4PeKveuIrCGQUBLoqfOX8bHfYMSbi9kGuTcACyL107waLMCWl2St5cPvRzD8Cx102e0ptwt82lbO5Cs2SOvPHksOW_rIZJLf1xlujajEZgprF4mPU9USTTVcakQB7wWXBcx8TfDVTMWEEX-iLDJIb9BJO3hx1Cv4O44RDw1orZYjouFwgL124s4FEAtWdAIFXJN7MFjTP7mUQVmNZzw_N6ykSQK-6Df4e4OmQSg\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/activities/submitVatCallback.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:47.836Z\",\"requestId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:47.836Z\",\"requestId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:47.836Z\",\"requestId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:47.836Z\",\"requestId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:47.836Z\",\"requestId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.836Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:47.836Z\",\"requestId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.838Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:47.838Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.838Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:47.838Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.838Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:47.838Z\",\"requestId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njc4MjgzMTksImF6cCI6ImRlYnVnZ2VyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njc4MzE5MTksImlhdCI6MTc2NzgyODMxOSwianRpIjoiZWRjM2ZlOTYtOTc4NC00Y2I0LWFhYTUtMTFkMzRhMjI3M2M4IiwidGlkIjoiZGVmYXVsdCIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSJ9.NSdRhZD50hOTZBmVt5zCfwpFmJvLf1YEqvbUryuufZno8otXhzN1jlQDolr8neRqbEahoNn0C70Sc1i8DFKRmAGzel6euB6-2BcqlLDJiYmd37c4PeKveuIrCGQUBLoqfOX8bHfYMSbi9kGuTcACyL107waLMCWl2St5cPvRzD8Cx102e0ptwt82lbO5Cs2SOvPHksOW_rIZJLf1xlujajEZgprF4mPU9USTTVcakQB7wWXBcx8TfDVTMWEEX-iLDJIb9BJO3hx1Cv4O44RDw1orZYjouFwgL124s4FEAtWdAIFXJN7MFjTP7mUQVmNZzw_N6ykSQK-6Df4e4OmQSg\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/activities/submitVatCallback.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:47.838Z\",\"requestId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.839Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:47.838Z\",\"requestId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:47.838Z\",\"requestId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:47.838Z\",\"requestId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:47.838Z\",\"requestId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.839Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:47.839Z\",\"requestId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.840Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:47.839Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.842Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:47.842Z\",\"requestId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:47.842Z\",\"requestId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.842Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:47.842Z\",\"requestId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:47.842Z\",\"requestId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:47.842Z\",\"requestId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"e7d623a6-640a-4ba3-9693-96a44d887ce1\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-08T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-07T23:25:29.505Z\\\",\\\"ttl\\\":1770508800,\\\"ttl_datestamp\\\":\\\"2026-02-08T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.843Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:47.843Z\",\"requestId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:47.843Z\",\"requestId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:47.843Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:47.843Z\",\"requestId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:47.843Z\",\"requestId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:47.843Z\",\"requestId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"3e84a2e7-b619-44cd-9c88-9de9e0176d00\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-08T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-07T23:25:29.505Z\\\",\\\"ttl\\\":1770508800,\\\"ttl_datestamp\\\":\\\"2026-02-08T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.007Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:48.007Z\",\"requestId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"message\":\"HTTP POST response received with status and duration\",\"status\":200,\"duration\":211}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.009Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-07T23:25:48.008Z\",\"requestId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/oauth/token\",\"method\":\"POST\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.016Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-07T23:25:48.016Z\",\"requestId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/oauth/token\",\"method\":\"POST\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.016Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:48.016Z\",\"requestId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"message\":\"exchangeClientSecretForAccessToken response\",\"responseStatus\":200,\"responseTokens\":{\"access_token\":\"51fe4c873b08e36dd60497638fb229c3\",\"refresh_token\":\"0604b580d050b9975454747ab904cddb\",\"expires_in\":14400,\"scope\":\"write:vat read:vat\",\"token_type\":\"bearer\"},\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":32,\"tokenType\":\"bearer\",\"scope\":\"write:vat read:vat\",\"expiresIn\":14400,\"hasRefreshToken\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.016Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:48.016Z\",\"requestId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"message\":\"Token exchange succeeded\",\"accessTokenLength\":32,\"hasIdToken\":false,\"hasRefreshToken\":true,\"expiresIn\":14400,\"tokenType\":\"bearer\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.016Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:48.016Z\",\"requestId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/token?\",\"response\":{\"statusCode\":200,\"headers\":{\"x-request-id\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"dc1e574f-4e62-4b98-bd64-06f3d17118cb\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"accessToken\\\":\\\"51fe4c873b08e36dd60497638fb229c3\\\",\\\"hmrcAccessToken\\\":\\\"51fe4c873b08e36dd60497638fb229c3\\\",\\\"refreshToken\\\":\\\"0604b580d050b9975454747ab904cddb\\\",\\\"expiresIn\\\":14400,\\\"tokenType\\\":\\\"bearer\\\"}\"}}"}
[BROWSER CONSOLE log]: Exchanged token. Remote call completed successfully: POST /api/v1/hmrc/token {accessToken: 51fe4c873b08e36dd60497638fb229c3, hmrcAccessToken: 51fe4c873b08e36dd60497638fb229c3, refreshToken: 0604b580d050b9975454747ab904cddb, expiresIn: 14400, tokenType: bearer} 51fe4c873b08e36dd60497638fb229c3
[BROWSER CONSOLE log]: Status message: Obtained Access Token from HMRC... Type: info
[BROWSER CONSOLE log]: Current activity found: /hmrc/vat/submitVat.html
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.073Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:48.073Z\",\"msg\":\"HTTP GET /hmrc/vat/submitVat.html?hmrcAccount=sandbox\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.140Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:48.140Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.152Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:48.152Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.154Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:48.154Z\",\"msg\":\"HTTP GET /widgets/hamburger-menu.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.154Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:48.154Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.154Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:48.154Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.154Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:48.154Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.155Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:48.155Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.156Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:48.156Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.158Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:48.158Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.162Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:48.162Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.162Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:48.162Z\",\"msg\":\"HTTP GET /lib/test-data-generator.js\"}"}
[BROWSER CONSOLE log]: JS block finished loading.
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE log]: JS block started loading: DOMContentLoaded event handler
[BROWSER CONSOLE log]: OAuth callback handler (code present, auto-continue)
[BROWSER CONSOLE log]: Retrieved submission data: {vatNumber: 299294688, periodKey: 25U6, vatDue: 1000.00, testScenario: , runFraudPreventionHeaderValidation: true}
[BROWSER CONSOLE log]: Status message: Submitting VAT return to HMRC... Type: info
[BROWSER CONSOLE log]: JS block finished loading: DOMContentLoaded event handler
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.222Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:48.222Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.227Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:48.227Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.227Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:48.227Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.227Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:48.227Z\",\"requestId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njc4MjgzMTksImF6cCI6ImRlYnVnZ2VyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njc4MzE5MTksImlhdCI6MTc2NzgyODMxOSwianRpIjoiZWRjM2ZlOTYtOTc4NC00Y2I0LWFhYTUtMTFkMzRhMjI3M2M4IiwidGlkIjoiZGVmYXVsdCIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSJ9.NSdRhZD50hOTZBmVt5zCfwpFmJvLf1YEqvbUryuufZno8otXhzN1jlQDolr8neRqbEahoNn0C70Sc1i8DFKRmAGzel6euB6-2BcqlLDJiYmd37c4PeKveuIrCGQUBLoqfOX8bHfYMSbi9kGuTcACyL107waLMCWl2St5cPvRzD8Cx102e0ptwt82lbO5Cs2SOvPHksOW_rIZJLf1xlujajEZgprF4mPU9USTTVcakQB7wWXBcx8TfDVTMWEEX-iLDJIb9BJO3hx1Cv4O44RDw1orZYjouFwgL124s4FEAtWdAIFXJN7MFjTP7mUQVmNZzw_N6ykSQK-6Df4e4OmQSg\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.227Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:48.227Z\",\"requestId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:48.227Z\",\"requestId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:48.227Z\",\"requestId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.227Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:48.227Z\",\"requestId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:48.227Z\",\"requestId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.227Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:48.227Z\",\"requestId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.230Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:48.230Z\",\"requestId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.230Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:48.230Z\",\"requestId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:48.230Z\",\"requestId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:48.230Z\",\"requestId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:48.230Z\",\"requestId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"8d53829c-1a9d-4d57-9df7-5f6cbb061529\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-08T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-07T23:25:29.505Z\\\",\\\"ttl\\\":1770508800,\\\"ttl_datestamp\\\":\\\"2026-02-08T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.232Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:48.232Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.234Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:48.234Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.234Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:48.234Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.235Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:48.235Z\",\"requestId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njc4MjgzMTksImF6cCI6ImRlYnVnZ2VyIiwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njc4MzE5MTksImlhdCI6MTc2NzgyODMxOSwianRpIjoiZWRjM2ZlOTYtOTc4NC00Y2I0LWFhYTUtMTFkMzRhMjI3M2M4IiwidGlkIjoiZGVmYXVsdCIsImVtYWlsIjoidXNlckBleGFtcGxlLmNvbSJ9.NSdRhZD50hOTZBmVt5zCfwpFmJvLf1YEqvbUryuufZno8otXhzN1jlQDolr8neRqbEahoNn0C70Sc1i8DFKRmAGzel6euB6-2BcqlLDJiYmd37c4PeKveuIrCGQUBLoqfOX8bHfYMSbi9kGuTcACyL107waLMCWl2St5cPvRzD8Cx102e0ptwt82lbO5Cs2SOvPHksOW_rIZJLf1xlujajEZgprF4mPU9USTTVcakQB7wWXBcx8TfDVTMWEEX-iLDJIb9BJO3hx1Cv4O44RDw1orZYjouFwgL124s4FEAtWdAIFXJN7MFjTP7mUQVmNZzw_N6ykSQK-6Df4e4OmQSg\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.235Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:48.235Z\",\"requestId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:48.235Z\",\"requestId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"edc3fe96-9784-4cb4-aaa5-11d34a2273c8\",\"tid\":\"default\",\"email\":\"user@example.com\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:48.235Z\",\"requestId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.235Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:48.235Z\",\"requestId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:48.235Z\",\"requestId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.235Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:48.235Z\",\"requestId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.237Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:48.237Z\",\"requestId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.237Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:48.237Z\",\"requestId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-07T23:25:48.237Z\",\"requestId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:48.237Z\",\"requestId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.237Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:48.237Z\",\"requestId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle?\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"fbda0301-ed3f-4696-8f76-7ffef7db06c5\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-08T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-07T23:25:29.505Z\\\",\\\"ttl\\\":1770508800,\\\"ttl_datestamp\\\":\\\"2026-02-08T00:00:00.000Z\\\"}]}\"}}"}
[BROWSER CONSOLE log]: Submitting VAT. Remote call initiated: POST /api/v1/hmrc/vat/return ++ Body: {"vatNumber":"299294688","periodKey":"25U6","vatDue":"1000.00","accessToken":"51fe4c873b08e36dd60497638fb229c3","runFraudPreventionHeaderValidation":true}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.266Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:48.266Z\",\"msg\":\"HTTP POST /api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.267Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:48.266Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"default\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"d0fd6af6-bddf-4ae4-a9a7-6a6f0a4d49e6\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.267Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:48.267Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"default\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"d0fd6af6-bddf-4ae4-a9a7-6a6f0a4d49e6\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"content-length\":\"154\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer 51fe4c873b08e36dd60497638fb229c3\",\"cache-control\":\"no-cache\",\"content-type\":\"application/json\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"gov-client-device-id\":\"634e4eda-5bed-47f1-a333-0238b67f2283\",\"gov-client-public-ip\":\"88.97.27.180\",\"gov-client-public-ip-timestamp\":\"2026-01-07T23:25:48.237Z\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+00:00\",\"gov-client-user-ids\":\"browser=user\",\"gov-client-window-size\":\"width=1280&height=1446\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"origin\":\"https://wanted-finally-anteater.ngrok-free.app\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVmYXVsdCIsIm5iZiI6MTc2NzgyODMxOSwiYXpwIjoiZGVidWdnZXIiLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvZGVmYXVsdCIsImV4cCI6MTc2NzgzMTkxOSwiaWF0IjoxNzY3ODI4MzE5LCJqdGkiOiJkMGZkNmFmNi1iZGRmLTRhZTQtYTlhNy02YTZmMGE0ZDQ5ZTYiLCJ0aWQiOiJkZWZhdWx0IiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.aV-rgk1D59ZNj0h4va3vLnmFFnZ0t6QJJ2Fbbfir8Zp6ginHaL3mIkxabLknWE-pWZ5DzrD9TKiEt9wjgo7Q-DSMjjnbD-74BJ18qoSomDq4g2lyTY6BBxwWGAkYdbSIbzPL_vuowytQzQd86FIKlhQ_leT9oU3qniu0abuD87WkXR2Z5hXk2a-wmSKwX59oO2O0f9wzdc5L5G6Rfc37V72PI1uWjSHn7dVaU3AdPSBlqMiitAi5Xv2XGD6cq5Rtp9vlEpfDhrvE-HCDIcoyYuAER7MlyZTiOfy-UtwKJ_pcYyojQ5iJHrgKX_FoNt31OddF4AL7tEGFVWy-S6iFBQ\",\"x-client-request-id\":\"9cf4adc6-0d83-4153-b368-3e9fc9a98339\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"vatNumber\\\":\\\"299294688\\\",\\\"periodKey\\\":\\\"25U6\\\",\\\"vatDue\\\":\\\"1000.00\\\",\\\"accessToken\\\":\\\"51fe4c873b08e36dd60497638fb229c3\\\",\\\"runFraudPreventionHeaderValidation\\\":true}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.267Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:48.267Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"https://test-api.service.hmrc.gov.uk\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.267Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:48.267Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Extracting user information from event\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.267Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:48.267Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.267Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:48.267Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"default\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"d0fd6af6-bddf-4ae4-a9a7-6a6f0a4d49e6\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"content-length\":\"154\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer 51fe4c873b08e36dd60497638fb229c3\",\"cache-control\":\"no-cache\",\"content-type\":\"application/json\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"gov-client-device-id\":\"634e4eda-5bed-47f1-a333-0238b67f2283\",\"gov-client-public-ip\":\"88.97.27.180\",\"gov-client-public-ip-timestamp\":\"2026-01-07T23:25:48.237Z\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+00:00\",\"gov-client-user-ids\":\"browser=user\",\"gov-client-window-size\":\"width=1280&height=1446\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"origin\":\"https://wanted-finally-anteater.ngrok-free.app\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVmYXVsdCIsIm5iZiI6MTc2NzgyODMxOSwiYXpwIjoiZGVidWdnZXIiLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvZGVmYXVsdCIsImV4cCI6MTc2NzgzMTkxOSwiaWF0IjoxNzY3ODI4MzE5LCJqdGkiOiJkMGZkNmFmNi1iZGRmLTRhZTQtYTlhNy02YTZmMGE0ZDQ5ZTYiLCJ0aWQiOiJkZWZhdWx0IiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.aV-rgk1D59ZNj0h4va3vLnmFFnZ0t6QJJ2Fbbfir8Zp6ginHaL3mIkxabLknWE-pWZ5DzrD9TKiEt9wjgo7Q-DSMjjnbD-74BJ18qoSomDq4g2lyTY6BBxwWGAkYdbSIbzPL_vuowytQzQd86FIKlhQ_leT9oU3qniu0abuD87WkXR2Z5hXk2a-wmSKwX59oO2O0f9wzdc5L5G6Rfc37V72PI1uWjSHn7dVaU3AdPSBlqMiitAi5Xv2XGD6cq5Rtp9vlEpfDhrvE-HCDIcoyYuAER7MlyZTiOfy-UtwKJ_pcYyojQ5iJHrgKX_FoNt31OddF4AL7tEGFVWy-S6iFBQ\",\"x-client-request-id\":\"9cf4adc6-0d83-4153-b368-3e9fc9a98339\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"vatNumber\\\":\\\"299294688\\\",\\\"periodKey\\\":\\\"25U6\\\",\\\"vatDue\\\":\\\"1000.00\\\",\\\"accessToken\\\":\\\"51fe4c873b08e36dd60497638fb229c3\\\",\\\"runFraudPreventionHeaderValidation\\\":true}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.270Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:48.269Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.270Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:48.270Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.270Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:48.270Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.272Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:48.272Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.272Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:48.272Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:48.272Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-01-08T00:00:00.000Z\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-01-07T23:25:29.505Z\",\"ttl\":1770508800,\"ttl_datestamp\":\"2026-02-08T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.272Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:48.272Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\",\"requiredBundleIds\":[\"test\",\"guest\",\"business\",\"diylegacy\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.272Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:48.272Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.273Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-07T23:25:48.273Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":32,\"accessTokenPrefix\":\"51fe4c87...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.273Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-07T23:25:48.273Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"Checking for test scenario\":null}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.273Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-07T23:25:48.273Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":true}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-07T23:25:48.273Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Initiating new processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.273Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:48.273Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Marking request as processing in DynamoDB\",\"userId\":\"user\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.273Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-07T23:25:48.273Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-return-post-async-requests-table]\",\"status\":\"processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.274Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:48.274Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Starting async processing locally (no SQS queue URL)\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.274Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-07T23:25:48.274Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Validating fraud prevention headers for sandbox account\",\"hmrcAccount\":\"sandbox\",\"runFraudPreventionHeaderValidation\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.274Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-07T23:25:48.274Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Validating fraud prevention headers\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Public-IP\",\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Public-IP\",\"Gov-Vendor-Forwarded\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.276Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:48.276Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Checking persisted request status\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.276Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-07T23:25:48.276Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-return-post-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.290Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-07T23:25:48.290Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.290Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-07T23:25:48.290Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.291Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:48.290Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Yielding with HTTP 202 Accepted\",\"location\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.291Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:48.291Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return?\",\"response\":{\"statusCode\":202,\"headers\":{\"Gov-Client-Public-IP\":\"88.97.27.180\",\"Gov-Client-Device-ID\":\"634e4eda-5bed-47f1-a333-0238b67f2283\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Public-IP\":\"88.97.27.180\",\"Gov-Vendor-Forwarded\":\"by=88.97.27.180&for=88.97.27.180\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=0.0.2-4\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"Gov-Client-Public-IP-Timestamp\":\"2026-01-07T23:25:48.237Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+00:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"Retry-After\":\"5\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"Location\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"message\\\":\\\"Request accepted for processing\\\"}\"}}"}
[BROWSER CONSOLE log]: waiting async request [POST /api/v1/hmrc/vat/return] (timeout: 1630000ms)...
[BROWSER CONSOLE log]: Status message: Still processing... (poll #1) Type: info
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.410Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-07T23:25:48.410Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"INVALID_HEADERS\",\"validationMessage\":\"At least 1 header is invalid\"}\n{\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-07T23:25:48.410Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Fraud prevention header validation errors\",\"errors\":[{\"code\":\"MISSING_HEADER\",\"message\":\"Header missing. You will not be able to submit a header if the connection is between client and server in a private network. If this is the case, you must contact us explaining why you cannot submit this header.\",\"headers\":[\"gov-client-public-port\"]}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.410Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-07T23:25:48.410Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"MISSING_HEADER\",\"message\":\"Header missing. This may be correct for single factor authentication, for example username and password. If this is the case, you must contact us explaining why you cannot submit this header.\",\"headers\":[\"gov-client-multi-factor\"]},{\"code\":\"MISSING_HEADER\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]}]}\n{\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-07T23:25:48.410Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.413Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-07T23:25:48.413Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.413Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-07T23:25:48.413Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Request to POST https://test-api.service.hmrc.gov.uk/organisations/vat/299294688/returns\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/299294688/returns\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"Bearer 51fe4c873b08e36dd60497638fb229c3\",\"x-request-id\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"Gov-Client-Public-IP\":\"88.97.27.180\",\"Gov-Client-Device-ID\":\"634e4eda-5bed-47f1-a333-0238b67f2283\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Public-IP\":\"88.97.27.180\",\"Gov-Vendor-Forwarded\":\"by=88.97.27.180&for=88.97.27.180\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=0.0.2-4\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"Gov-Client-Public-IP-Timestamp\":\"2026-01-07T23:25:48.237Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+00:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"body\":{\"periodKey\":\"25U6\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":0,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0,\"finalised\":true},\"environment\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.414Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-07T23:25:48.414Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Request to POST https://test-api.service.hmrc.gov.uk/organisations/vat/299294688/returns\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/299294688/returns\",\"method\":\"POST\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"Bearer 51fe4c873b08e36dd60497638fb229c3\",\"x-request-id\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"Gov-Client-Public-IP\":\"88.97.27.180\",\"Gov-Client-Device-ID\":\"634e4eda-5bed-47f1-a333-0238b67f2283\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Public-IP\":\"88.97.27.180\",\"Gov-Vendor-Forwarded\":\"by=88.97.27.180&for=88.97.27.180\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=0.0.2-4\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"Gov-Client-Public-IP-Timestamp\":\"2026-01-07T23:25:48.237Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+00:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"body\":\"{\\\"periodKey\\\":\\\"25U6\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":0,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true}\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.569Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-07T23:25:48.569Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Response from POST https://test-api.service.hmrc.gov.uk/organisations/vat/299294688/returns\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/299294688/returns\",\"status\":201,\"hmrcResponseBody\":{\"processingDate\":\"2026-01-07T23:25:48.549Z\",\"formBundleNumber\":\"455184147206\",\"paymentIndicator\":\"DD\",\"chargeRefNumber\":\"7UNj8xC0x0VeKRpv\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.569Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-07T23:25:48.569Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/299294688/returns\",\"method\":\"POST\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.572Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-07T23:25:48.572Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/299294688/returns\",\"method\":\"POST\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.572Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-07T23:25:48.572Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Received HMRC response: {}\",\"httpResult\":{\"hmrcResponse\":{},\"hmrcResponseBody\":{\"processingDate\":\"2026-01-07T23:25:48.549Z\",\"formBundleNumber\":\"455184147206\",\"paymentIndicator\":\"DD\",\"chargeRefNumber\":\"7UNj8xC0x0VeKRpv\"}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.572Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-01-07T23:25:48.572Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"DynamoDB enabled, proceeding with putReceipt [table: test-receipts-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.573Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-01-07T23:25:48.572Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Storing receipt\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"userSub\":\"user\",\"receiptId\":\"2026-01-07T23:25:48.572Z-455184147206\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.574Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-01-07T23:25:48.574Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Storing receipt in DynamoDB as item\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"receiptId\":\"2026-01-07T23:25:48.572Z-455184147206\",\"ttl_datestamp\":\"2033-01-05T23:25:48.574Z\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.579Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-01-07T23:25:48.579Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Receipt stored in DynamoDB as item\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"receiptId\":\"2026-01-07T23:25:48.572Z-455184147206\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.579Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:48.579Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Local async processing completed successfully\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.579Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:48.579Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Marking async request as completed\",\"userSub\":\"user\",\"asyncRequestsTableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.579Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-07T23:25:48.579Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-return-post-async-requests-table]\",\"status\":\"completed\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:48.583Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-07T23:25:48.583Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
[BROWSER CONSOLE log]: re-trying async request [POST /api/v1/hmrc/vat/return] (poll #1, elapsed: 1004ms, timeout: 1630000ms, last status: 202)...
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:49.353Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:49.352Z\",\"msg\":\"HTTP POST /api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:49.353Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-07T23:25:49.353Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"default\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"d0fd6af6-bddf-4ae4-a9a7-6a6f0a4d49e6\",\"tid\":\"default\",\"email\":\"user@example.com\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:49.353Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:49.353Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"default\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"d0fd6af6-bddf-4ae4-a9a7-6a6f0a4d49e6\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"content-length\":\"154\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer 51fe4c873b08e36dd60497638fb229c3\",\"cache-control\":\"no-cache\",\"content-type\":\"application/json\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"gov-client-device-id\":\"634e4eda-5bed-47f1-a333-0238b67f2283\",\"gov-client-public-ip\":\"88.97.27.180\",\"gov-client-public-ip-timestamp\":\"2026-01-07T23:25:48.237Z\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+00:00\",\"gov-client-user-ids\":\"browser=user\",\"gov-client-window-size\":\"width=1280&height=1446\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"origin\":\"https://wanted-finally-anteater.ngrok-free.app\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVmYXVsdCIsIm5iZiI6MTc2NzgyODMxOSwiYXpwIjoiZGVidWdnZXIiLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvZGVmYXVsdCIsImV4cCI6MTc2NzgzMTkxOSwiaWF0IjoxNzY3ODI4MzE5LCJqdGkiOiJkMGZkNmFmNi1iZGRmLTRhZTQtYTlhNy02YTZmMGE0ZDQ5ZTYiLCJ0aWQiOiJkZWZhdWx0IiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.aV-rgk1D59ZNj0h4va3vLnmFFnZ0t6QJJ2Fbbfir8Zp6ginHaL3mIkxabLknWE-pWZ5DzrD9TKiEt9wjgo7Q-DSMjjnbD-74BJ18qoSomDq4g2lyTY6BBxwWGAkYdbSIbzPL_vuowytQzQd86FIKlhQ_leT9oU3qniu0abuD87WkXR2Z5hXk2a-wmSKwX59oO2O0f9wzdc5L5G6Rfc37V72PI1uWjSHn7dVaU3AdPSBlqMiitAi5Xv2XGD6cq5Rtp9vlEpfDhrvE-HCDIcoyYuAER7MlyZTiOfy-UtwKJ_pcYyojQ5iJHrgKX_FoNt31OddF4AL7tEGFVWy-S6iFBQ\",\"x-client-request-id\":\"9cf4adc6-0d83-4153-b368-3e9fc9a98339\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-request-id\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"vatNumber\\\":\\\"299294688\\\",\\\"periodKey\\\":\\\"25U6\\\",\\\"vatDue\\\":\\\"1000.00\\\",\\\"accessToken\\\":\\\"51fe4c873b08e36dd60497638fb229c3\\\",\\\"runFraudPreventionHeaderValidation\\\":true}\"}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:49.353Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"https://test-api.service.hmrc.gov.uk\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:49.353Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:49.353Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Extracting user information from event\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:49.353Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:49.353Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:49.353Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return?\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"default\",\"nbf\":1767828319,\"azp\":\"debugger\",\"iss\":\"http://localhost:8080/default\",\"exp\":1767831919,\"iat\":1767828319,\"jti\":\"d0fd6af6-bddf-4ae4-a9a7-6a6f0a4d49e6\",\"tid\":\"default\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"content-length\":\"154\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer 51fe4c873b08e36dd60497638fb229c3\",\"cache-control\":\"no-cache\",\"content-type\":\"application/json\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"gov-client-device-id\":\"634e4eda-5bed-47f1-a333-0238b67f2283\",\"gov-client-public-ip\":\"88.97.27.180\",\"gov-client-public-ip-timestamp\":\"2026-01-07T23:25:48.237Z\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+00:00\",\"gov-client-user-ids\":\"browser=user\",\"gov-client-window-size\":\"width=1280&height=1446\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"origin\":\"https://wanted-finally-anteater.ngrok-free.app\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVmYXVsdCIsIm5iZiI6MTc2NzgyODMxOSwiYXpwIjoiZGVidWdnZXIiLCJpc3MiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvZGVmYXVsdCIsImV4cCI6MTc2NzgzMTkxOSwiaWF0IjoxNzY3ODI4MzE5LCJqdGkiOiJkMGZkNmFmNi1iZGRmLTRhZTQtYTlhNy02YTZmMGE0ZDQ5ZTYiLCJ0aWQiOiJkZWZhdWx0IiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.aV-rgk1D59ZNj0h4va3vLnmFFnZ0t6QJJ2Fbbfir8Zp6ginHaL3mIkxabLknWE-pWZ5DzrD9TKiEt9wjgo7Q-DSMjjnbD-74BJ18qoSomDq4g2lyTY6BBxwWGAkYdbSIbzPL_vuowytQzQd86FIKlhQ_leT9oU3qniu0abuD87WkXR2Z5hXk2a-wmSKwX59oO2O0f9wzdc5L5G6Rfc37V72PI1uWjSHn7dVaU3AdPSBlqMiitAi5Xv2XGD6cq5Rtp9vlEpfDhrvE-HCDIcoyYuAER7MlyZTiOfy-UtwKJ_pcYyojQ5iJHrgKX_FoNt31OddF4AL7tEGFVWy-S6iFBQ\",\"x-client-request-id\":\"9cf4adc6-0d83-4153-b368-3e9fc9a98339\",\"x-forwarded-for\":\"88.97.27.180\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-request-id\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"vatNumber\\\":\\\"299294688\\\",\\\"periodKey\\\":\\\"25U6\\\",\\\"vatDue\\\":\\\"1000.00\\\",\\\"accessToken\\\":\\\"51fe4c873b08e36dd60497638fb229c3\\\",\\\"runFraudPreventionHeaderValidation\\\":true}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:49.354Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:49.354Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:49.354Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:49.355Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:49.354Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:49.357Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:49.357Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-07T23:25:49.357Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:49.358Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:49.357Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-01-08T00:00:00.000Z\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-01-07T23:25:29.505Z\",\"ttl\":1770508800,\"ttl_datestamp\":\"2026-02-08T00:00:00.000Z\"}],\"bundleCount\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:49.357Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\",\"requiredBundleIds\":[\"test\",\"guest\",\"business\",\"diylegacy\"],\"currentBundleIds\":{}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-07T23:25:49.357Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:49.358Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-07T23:25:49.358Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":32,\"accessTokenPrefix\":\"51fe4c87...\",\"isValidFormat\":true}}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-07T23:25:49.358Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"Checking for test scenario\":null}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:49.358Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-07T23:25:49.358Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-return-post-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:49.360Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-07T23:25:49.360Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-07T23:25:49.360Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":false}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:49.360Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-07T23:25:49.360Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Found persisted request\",\"status\":\"completed\"}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-07T23:25:49.360Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:49.360Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-07T23:25:49.360Z\",\"requestId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"correlationId\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return?\",\"response\":{\"statusCode\":200,\"headers\":{\"Gov-Client-Public-IP\":\"88.97.27.180\",\"Gov-Client-Device-ID\":\"634e4eda-5bed-47f1-a333-0238b67f2283\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Public-IP\":\"88.97.27.180\",\"Gov-Vendor-Forwarded\":\"by=88.97.27.180&for=88.97.27.180\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=0.0.2-4\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"Gov-Client-Public-IP-Timestamp\":\"2026-01-07T23:25:48.237Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+00:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"traceparent\":\"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01\",\"x-correlationid\":\"62e0f2fb-6eb6-402b-827f-f5b214f44899\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"receipt\\\":{\\\"processingDate\\\":\\\"2026-01-07T23:25:48.549Z\\\",\\\"formBundleNumber\\\":\\\"455184147206\\\",\\\"paymentIndicator\\\":\\\"DD\\\",\\\"chargeRefNumber\\\":\\\"7UNj8xC0x0VeKRpv\\\"},\\\"hmrcResponse\\\":{\\\"ok\\\":true,\\\"status\\\":201,\\\"statusText\\\":\\\"Created\\\",\\\"headers\\\":{\\\"cache-control\\\":\\\"no-cache,no-store,max-age=0\\\",\\\"connection\\\":\\\"keep-alive\\\",\\\"content-length\\\":\\\"140\\\",\\\"content-security-policy\\\":\\\"default-src 'self'\\\",\\\"content-type\\\":\\\"application/json\\\",\\\"date\\\":\\\"Wed, 07 Jan 2026 23:25:48 GMT\\\",\\\"receipt-id\\\":\\\"75ded624-ccf5-416e-a59b-53affadb3ca5\\\",\\\"receipt-signature\\\":\\\"This has been deprecated - DO NOT USE\\\",\\\"receipt-timestamp\\\":\\\"2026-01-07T23:25:48Z\\\",\\\"strict-transport-security\\\":\\\"max-age=31536000;\\\",\\\"vary\\\":\\\"Origin\\\",\\\"via\\\":\\\"1.1 4f2c05fa30365fcac05ad27ee136cce2.cloudfront.net (CloudFront)\\\",\\\"x-amz-cf-id\\\":\\\"_s6rdttUMq6NXG7pSdVyhSZN7RH6jpmwpNqn77I8Ev8VhAhZwRf0kg==\\\",\\\"x-amz-cf-pop\\\":\\\"LHR50-P6\\\",\\\"x-cache\\\":\\\"Miss from cloudfront\\\",\\\"x-content-type-options\\\":\\\"nosniff, nosniff\\\",\\\"x-correlationid\\\":\\\"75ded624-ccf5-416e-a59b-53affadb3ca5\\\",\\\"x-envoy-upstream-service-time\\\":\\\"50\\\",\\\"x-frame-options\\\":\\\"SAMEORIGIN\\\"}},\\\"hmrcResponseBody\\\":{\\\"processingDate\\\":\\\"2026-01-07T23:25:48.549Z\\\",\\\"formBundleNumber\\\":\\\"455184147206\\\",\\\"paymentIndicator\\\":\\\"DD\\\",\\\"chargeRefNumber\\\":\\\"7UNj8xC0x0VeKRpv\\\"},\\\"receiptId\\\":\\\"2026-01-07T23:25:48.572Z-455184147206\\\"}\"}}"}
[BROWSER CONSOLE log]: finished async request [POST /api/v1/hmrc/vat/return] (poll #1, elapsed: 1068ms, status: 200)
[BROWSER CONSOLE log]: Submitted VAT. Remote call completed successfully: POST /api/v1/hmrc/vat/return {receipt: Object, hmrcResponse: Object, hmrcResponseBody: Object, receiptId: 2026-01-07T23:25:48.572Z-455184147206} {processingDate: 2026-01-07T23:25:48.549Z, formBundleNumber: 455184147206, paymentIndicator: DD, chargeRefNumber: 7UNj8xC0x0VeKRpv}
[BROWSER CONSOLE log]: Status message: VAT return processed Type: success
[BROWSER CONSOLE log]: Page display transition: Displaying receipt and hiding form
[BROWSER CONSOLE log]: Current activity cleared
[BROWSER CONSOLE log]: Continue submission handler (success)
Waiting for VAT submission to complete and receipt to be displayed...
Current URL: https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/submitVat.html?hmrcAccount=sandbox
Page title: DIY Accounting Submit
Body element exists: true
Main content element exists: true
Receipt element exists: true
Receipt element style: display: block;
Form element exists: true
Form element style: display: none;
Receipt element visible: true
VAT submission flow completed successfully
[test body] Found userInfo in localStorage for test "Verify fraud prevention headers for VAT return submission": {"sub":"user","email":"user@example.com"}
[test body] Extracted userSub from localStorage for test "Verify fraud prevention headers for VAT return submission": user
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:52.152Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[HMRC Fraud Prevention] Checking fraud prevention header validation feedback for user sub: user
[test body] Found hmrcAccessToken in sessionStorage for test "Verify fraud prevention headers for VAT return submission"
Fetching fraud prevention headers validation feedback...
{"level":30,"source":"app/services/hmrcApi.js","time":"2026-01-07T23:25:52.193Z","message":"Getting fraud prevention headers validation feedback","url":"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/vat-mtd/validation-feedback","api":"vat-mtd"}
{"level":30,"source":"app/services/hmrcApi.js","time":"2026-01-07T23:25:52.706Z","message":"Fraud prevention header validation feedback response","status":200,"feedback":{"requests":[{"path":"/organisations/vat/144948637/obligations","method":"GET","requestTimestamp":"2026-01-07T22:50:09.470Z","code":"INVALID_HEADERS","headers":[{"header":"gov-client-browser-js-user-agent","value":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-connection-method","value":"WEB_APP_VIA_SERVER","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-device-id","value":"f29bc93d-98fd-40e9-974e-ce3ebba0a595","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-multi-factor","code":"MISSING_HEADER","errors":[],"warnings":["Header missing. This may be correct for single factor authentication, for example username and password. If this is the case, you must contact us explaining why you cannot submit this header."]},{"header":"gov-client-public-ip","value":"40.76.117.242","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-public-ip-timestamp","value":"2026-01-07T22:50:05.598Z","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-public-port","code":"MISSING_HEADER","errors":["Header missing. You will not be able to submit a header if the connection is between client and server in a private network. If this is the case, you must contact us explaining why you cannot submit this header."],"warnings":[]},{"header":"gov-client-screens","value":"width=1280&height=1446&colour-depth=24&scaling-factor=1","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-timezone","value":"UTC+00:00","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-user-ids","value":"server=anonymous","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-window-size","value":"width=1280&height=1446","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-vendor-forwarded","value":"by=40.76.117.242&for=40.76.117.242,by=40.76.117.242&for=3.172.32.174","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-vendor-license-ids","code":"MISSING_HEADER","errors":[],"warnings":["Header required"]},{"header":"gov-vendor-product-name","value":"web-submit-diyaccounting-co-uk","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-vendor-public-ip","value":"40.76.117.242","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-vendor-version","value":"web-submit-diyaccounting-co-uk=0.0.2-4","code":"VALID_HEADER","errors":[],"warnings":[]}],"crossValidation":[{"headers":["gov-vendor-forwarded","gov-vendor-public-ip","gov-client-public-ip"],"code":"VALID_HEADERS","errors":[]}]},{"path":"/organisations/vat/539491020/returns","method":"POST","requestTimestamp":"2026-01-07T23:22:53.471Z","code":"INVALID_HEADERS","headers":[{"header":"gov-client-browser-js-user-agent","value":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-connection-method","value":"WEB_APP_VIA_SERVER","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-device-id","value":"3908d470-27f5-4945-b665-19e8809c956f","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-multi-factor","code":"MISSING_HEADER","errors":[],"warnings":["Header missing. This may be correct for single factor authentication, for example username and password. If this is the case, you must contact us explaining why you cannot submit this header."]},{"header":"gov-client-public-ip","value":"88.97.27.180","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-public-ip-timestamp","value":"2026-01-07T23:22:53.257Z","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-public-port","code":"MISSING_HEADER","errors":["Header missing. You will not be able to submit a header if the connection is between client and server in a private network. If this is the case, you must contact us explaining why you cannot submit this header."],"warnings":[]},{"header":"gov-client-screens","value":"width=1280&height=1446&colour-depth=24&scaling-factor=1","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-timezone","value":"UTC+00:00","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-user-ids","value":"server=anonymous","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-window-size","value":"width=1280&height=1446","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-vendor-forwarded","value":"by=88.97.27.180&for=88.97.27.180","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-vendor-license-ids","code":"MISSING_HEADER","errors":[],"warnings":["Header required"]},{"header":"gov-vendor-product-name","value":"web-submit-diyaccounting-co-uk","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-vendor-public-ip","value":"88.97.27.180","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-vendor-version","value":"web-submit-diyaccounting-co-uk=0.0.2-4","code":"VALID_HEADER","errors":[],"warnings":[]}],"crossValidation":[{"headers":["gov-vendor-forwarded","gov-vendor-public-ip","gov-client-public-ip"],"code":"VALID_HEADERS","errors":[]}]},{"path":"/organisations/vat/144948637/returns/24Y9","method":"GET","requestTimestamp":"2026-01-07T22:49:57.713Z","code":"INVALID_HEADERS","headers":[{"header":"gov-client-browser-js-user-agent","value":"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-connection-method","value":"WEB_APP_VIA_SERVER","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-device-id","value":"96fc826c-dbb9-4375-a045-352c4e1c9152","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-multi-factor","code":"MISSING_HEADER","errors":[],"warnings":["Header missing. This may be correct for single factor authentication, for example username and password. If this is the case, you must contact us explaining why you cannot submit this header."]},{"header":"gov-client-public-ip","value":"40.76.117.242","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-public-ip-timestamp","value":"2026-01-07T22:49:53.082Z","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-public-port","code":"MISSING_HEADER","errors":["Header missing. You will not be able to submit a header if the connection is between client and server in a private network. If this is the case, you must contact us explaining why you cannot submit this header."],"warnings":[]},{"header":"gov-client-screens","value":"width=1280&height=1446&colour-depth=24&scaling-factor=1","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-timezone","value":"UTC+00:00","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-user-ids","value":"server=anonymous","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-client-window-size","value":"width=1280&height=1446","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-vendor-forwarded","value":"by=40.76.117.242&for=40.76.117.242,by=40.76.117.242&for=3.172.32.176","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-vendor-license-ids","code":"MISSING_HEADER","errors":[],"warnings":["Header required"]},{"header":"gov-vendor-product-name","value":"web-submit-diyaccounting-co-uk","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-vendor-public-ip","value":"40.76.117.242","code":"VALID_HEADER","errors":[],"warnings":[]},{"header":"gov-vendor-version","value":"web-submit-diyaccounting-co-uk=0.0.2-4","code":"VALID_HEADER","errors":[],"warnings":[]}],"crossValidation":[{"headers":["gov-vendor-forwarded","gov-vendor-public-ip","gov-client-public-ip"],"code":"VALID_HEADERS","errors":[]}]}]}}
{"level":50,"source":"app/services/hmrcApi.js","time":"2026-01-07T23:25:52.711Z","message":"Error auditing HMRC API request/response to DynamoDB","error":"Salt not initialized. Call initializeSalt() in your Lambda handler before using hashSub(). For local dev, set USER_SUB_HASH_SALT in .env file.","stack":"Error: Salt not initialized. Call initializeSalt() in your Lambda handler before using hashSub(). For local dev, set USER_SUB_HASH_SALT in .env file.\n    at hashSub (file:///Users/antony/projects/submit.diyaccounting.co.uk/app/services/subHasher.js:97:11)\n    at putHmrcApiRequest (file:///Users/antony/projects/submit.diyaccounting.co.uk/app/data/dynamoDbHmrcApiRequestRepository.js:49:21)\n    at getFraudPreventionHeadersFeedback (file:///Users/antony/projects/submit.diyaccounting.co.uk/app/services/hmrcApi.js:343:13)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at file:///Users/antony/projects/submit.diyaccounting.co.uk/behaviour-tests/steps/behaviour-hmrc-vat-steps.js:752:20\n    at TestStepInfoImpl._runStepBody (/Users/antony/projects/submit.diyaccounting.co.uk/node_modules/playwright/lib/worker/testInfo.js:487:14)\n    at /Users/antony/projects/submit.diyaccounting.co.uk/node_modules/playwright/lib/common/testType.js:245:20\n    at /Users/antony/projects/submit.diyaccounting.co.uk/node_modules/playwright/lib/common/testType.js:243:18\n    at TestTypeImpl._step (/Users/antony/projects/submit.diyaccounting.co.uk/node_modules/playwright/lib/common/testType.js:240:12)\n    at fetchFraudPreventionHeadersFeedback (file:///Users/antony/projects/submit.diyaccounting.co.uk/behaviour-tests/steps/behaviour-hmrc-vat-steps.js:748:3)\n    at checkFraudPreventionHeadersFeedback (file:///Users/antony/projects/submit.diyaccounting.co.uk/behaviour-tests/helpers/behaviour-helpers.js:778:20)\n    at file:///Users/antony/projects/submit.diyaccounting.co.uk/behaviour-tests/postVatReturnFraudPreventionHeaders.behaviour.test.js:326:36\n    at /Users/antony/projects/submit.diyaccounting.co.uk/node_modules/playwright/lib/worker/workerMain.js:322:9\n    at /Users/antony/projects/submit.diyaccounting.co.uk/node_modules/playwright/lib/worker/testInfo.js:311:11\n    at TimeoutManager.withRunnable (/Users/antony/projects/submit.diyaccounting.co.uk/node_modules/playwright/lib/worker/timeoutManager.js:67:14)\n    at TestInfoImpl._runWithTimeout (/Users/antony/projects/submit.diyaccounting.co.uk/node_modules/playwright/lib/worker/testInfo.js:309:7)\n    at /Users/antony/projects/submit.diyaccounting.co.uk/node_modules/playwright/lib/worker/workerMain.js:320:7\n    at WorkerMain._runTest (/Users/antony/projects/submit.diyaccounting.co.uk/node_modules/playwright/lib/worker/workerMain.js:295:5)\n    at WorkerMain.runTestGroup (/Users/antony/projects/submit.diyaccounting.co.uk/node_modules/playwright/lib/worker/workerMain.js:199:11)\n    at process.<anonymous> (/Users/antony/projects/submit.diyaccounting.co.uk/node_modules/playwright/lib/common/process.js:65:22)"}
Fraud prevention headers validation feedback received:
{
  "requests": [
    {
      "path": "/organisations/vat/144948637/obligations",
      "method": "GET",
      "requestTimestamp": "2026-01-07T22:50:09.470Z",
      "code": "INVALID_HEADERS",
      "headers": [
        {
          "header": "gov-client-browser-js-user-agent",
          "value": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-connection-method",
          "value": "WEB_APP_VIA_SERVER",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-device-id",
          "value": "f29bc93d-98fd-40e9-974e-ce3ebba0a595",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-multi-factor",
          "code": "MISSING_HEADER",
          "errors": [],
          "warnings": [
            "Header missing. This may be correct for single factor authentication, for example username and password. If this is the case, you must contact us explaining why you cannot submit this header."
          ]
        },
        {
          "header": "gov-client-public-ip",
          "value": "40.76.117.242",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-public-ip-timestamp",
          "value": "2026-01-07T22:50:05.598Z",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-public-port",
          "code": "MISSING_HEADER",
          "errors": [
            "Header missing. You will not be able to submit a header if the connection is between client and server in a private network. If this is the case, you must contact us explaining why you cannot submit this header."
          ],
          "warnings": []
        },
        {
          "header": "gov-client-screens",
          "value": "width=1280&height=1446&colour-depth=24&scaling-factor=1",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-timezone",
          "value": "UTC+00:00",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-user-ids",
          "value": "server=anonymous",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-window-size",
          "value": "width=1280&height=1446",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-vendor-forwarded",
          "value": "by=40.76.117.242&for=40.76.117.242,by=40.76.117.242&for=3.172.32.174",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-vendor-license-ids",
          "code": "MISSING_HEADER",
          "errors": [],
          "warnings": [
            "Header required"
          ]
        },
        {
          "header": "gov-vendor-product-name",
          "value": "web-submit-diyaccounting-co-uk",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-vendor-public-ip",
          "value": "40.76.117.242",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-vendor-version",
          "value": "web-submit-diyaccounting-co-uk=0.0.2-4",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        }
      ],
      "crossValidation": [
        {
          "headers": [
            "gov-vendor-forwarded",
            "gov-vendor-public-ip",
            "gov-client-public-ip"
          ],
          "code": "VALID_HEADERS",
          "errors": []
        }
      ]
    },
    {
      "path": "/organisations/vat/539491020/returns",
      "method": "POST",
      "requestTimestamp": "2026-01-07T23:22:53.471Z",
      "code": "INVALID_HEADERS",
      "headers": [
        {
          "header": "gov-client-browser-js-user-agent",
          "value": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-connection-method",
          "value": "WEB_APP_VIA_SERVER",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-device-id",
          "value": "3908d470-27f5-4945-b665-19e8809c956f",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-multi-factor",
          "code": "MISSING_HEADER",
          "errors": [],
          "warnings": [
            "Header missing. This may be correct for single factor authentication, for example username and password. If this is the case, you must contact us explaining why you cannot submit this header."
          ]
        },
        {
          "header": "gov-client-public-ip",
          "value": "88.97.27.180",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-public-ip-timestamp",
          "value": "2026-01-07T23:22:53.257Z",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-public-port",
          "code": "MISSING_HEADER",
          "errors": [
            "Header missing. You will not be able to submit a header if the connection is between client and server in a private network. If this is the case, you must contact us explaining why you cannot submit this header."
          ],
          "warnings": []
        },
        {
          "header": "gov-client-screens",
          "value": "width=1280&height=1446&colour-depth=24&scaling-factor=1",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-timezone",
          "value": "UTC+00:00",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-user-ids",
          "value": "server=anonymous",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-window-size",
          "value": "width=1280&height=1446",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-vendor-forwarded",
          "value": "by=88.97.27.180&for=88.97.27.180",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-vendor-license-ids",
          "code": "MISSING_HEADER",
          "errors": [],
          "warnings": [
            "Header required"
          ]
        },
        {
          "header": "gov-vendor-product-name",
          "value": "web-submit-diyaccounting-co-uk",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-vendor-public-ip",
          "value": "88.97.27.180",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-vendor-version",
          "value": "web-submit-diyaccounting-co-uk=0.0.2-4",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        }
      ],
      "crossValidation": [
        {
          "headers": [
            "gov-vendor-forwarded",
            "gov-vendor-public-ip",
            "gov-client-public-ip"
          ],
          "code": "VALID_HEADERS",
          "errors": []
        }
      ]
    },
    {
      "path": "/organisations/vat/144948637/returns/24Y9",
      "method": "GET",
      "requestTimestamp": "2026-01-07T22:49:57.713Z",
      "code": "INVALID_HEADERS",
      "headers": [
        {
          "header": "gov-client-browser-js-user-agent",
          "value": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-connection-method",
          "value": "WEB_APP_VIA_SERVER",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-device-id",
          "value": "96fc826c-dbb9-4375-a045-352c4e1c9152",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-multi-factor",
          "code": "MISSING_HEADER",
          "errors": [],
          "warnings": [
            "Header missing. This may be correct for single factor authentication, for example username and password. If this is the case, you must contact us explaining why you cannot submit this header."
          ]
        },
        {
          "header": "gov-client-public-ip",
          "value": "40.76.117.242",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-public-ip-timestamp",
          "value": "2026-01-07T22:49:53.082Z",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-public-port",
          "code": "MISSING_HEADER",
          "errors": [
            "Header missing. You will not be able to submit a header if the connection is between client and server in a private network. If this is the case, you must contact us explaining why you cannot submit this header."
          ],
          "warnings": []
        },
        {
          "header": "gov-client-screens",
          "value": "width=1280&height=1446&colour-depth=24&scaling-factor=1",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-timezone",
          "value": "UTC+00:00",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-user-ids",
          "value": "server=anonymous",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-client-window-size",
          "value": "width=1280&height=1446",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-vendor-forwarded",
          "value": "by=40.76.117.242&for=40.76.117.242,by=40.76.117.242&for=3.172.32.176",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-vendor-license-ids",
          "code": "MISSING_HEADER",
          "errors": [],
          "warnings": [
            "Header required"
          ]
        },
        {
          "header": "gov-vendor-product-name",
          "value": "web-submit-diyaccounting-co-uk",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-vendor-public-ip",
          "value": "40.76.117.242",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        },
        {
          "header": "gov-vendor-version",
          "value": "web-submit-diyaccounting-co-uk=0.0.2-4",
          "code": "VALID_HEADER",
          "errors": [],
          "warnings": []
        }
      ],
      "crossValidation": [
        {
          "headers": [
            "gov-vendor-forwarded",
            "gov-vendor-public-ip",
            "gov-client-public-ip"
          ],
          "code": "VALID_HEADERS",
          "errors": []
        }
      ]
    }
  ]
}
Logging out from home page
[USER INTERACTION] Clicking: a:has-text('Logout') - Logout
[BROWSER CONSOLE log]: Logging out user
[HTTP REQUEST FAILED] GET https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/submitVat.html?hmrcAccount=sandbox - net::ERR_ABORTED
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:53.015Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:53.015Z\",\"msg\":\"HTTP GET /hmrc/auth/login.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:53.085Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:53.085Z\",\"msg\":\"HTTP GET /hmrc/auth/submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:53.137Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:53.136Z\",\"msg\":\"HTTP GET /hmrc/auth/submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:53.137Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:53.137Z\",\"msg\":\"HTTP GET /hmrc/auth/widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:53.138Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:53.138Z\",\"msg\":\"HTTP GET /hmrc/auth/widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:53.139Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:53.138Z\",\"msg\":\"HTTP GET /hmrc/auth/widgets/hamburger-menu.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:53.139Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:53.139Z\",\"msg\":\"HTTP GET /hmrc/auth/lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:53.140Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:53.140Z\",\"msg\":\"HTTP GET /hmrc/auth/widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:53.140Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:53.140Z\",\"msg\":\"HTTP GET /hmrc/auth/lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:53.141Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-07T23:25:53.141Z\",\"msg\":\"HTTP GET /hmrc/auth/widgets/view-source-link.js\"}"}
[BROWSER ERROR]: Unexpected token '<'
[BROWSER ERROR]: Unexpected token '<'
[BROWSER ERROR]: Unexpected token '<'
[BROWSER ERROR]: Unexpected token '<'
[BROWSER ERROR]: Unexpected token '<'
[BROWSER ERROR]: Unexpected token '<'
[BROWSER CONSOLE error]: Failed to load module script: Expected a JavaScript-or-Wasm module script but the server responded with a MIME type of "text/html". Strict MIME type checking is enforced for module scripts per HTML spec.
[BROWSER ERROR]: Unexpected token '<'
[BROWSER CONSOLE log]: Current activity cleared
[BROWSER ERROR]: checkAuthStatus is not defined
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:53.285Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:53.285Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[Figures]: Selected 5 key screenshots from target/behaviour-test-results/screenshots/fraudPreventionHeadersVat-behaviour-test
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-01-07T23:25:53.289Z","msg":"Copied screenshot: 2026-01-07_23-25-38-570985055-10-fill-in-submission-pagedown.png"}
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-01-07T23:25:53.290Z","msg":"Copied screenshot: 2026-01-07_23-25-49-908347158-02-complete-vat-receipt.png"}
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-01-07T23:25:53.291Z","msg":"Copied screenshot: 2026-01-07_23-25-18-669129376-01-submit-mock.png"}
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-01-07T23:25:53.291Z","msg":"Copied screenshot: 2026-01-07_23-25-49-770629564-01-complete-vat-waiting.png"}
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-01-07T23:25:53.292Z","msg":"Copied screenshot: 2026-01-07_23-25-50-593187228-08-receipt.png"}
[Figures]: Copied 5 screenshots to /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-01-07T23:25:53.293Z","msg":"Wrote figures.json with 5 entries to /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/figures.json"}
[DynamoDB Export]: Starting export of all tables...
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-07T23:25:53.293Z","msg":"[dynamodb-export]: Starting export of all tables to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-07T23:25:53.293Z","msg":"[dynamodb-export]: Exporting table 'test-bundle-table' from endpoint 'http://127.0.0.1:61028' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/bundles.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-07T23:25:53.304Z","msg":"[dynamodb-export]: ✅ Exported 1 items from table 'test-bundle-table' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/bundles.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-07T23:25:53.304Z","msg":"[dynamodb-export]: ── BEGIN bundles.jsonl ──"}
{"bundleId":"test","expiry":"2026-01-08T00:00:00.000Z","hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","createdAt":"2026-01-07T23:25:29.505Z","ttl":1770508800,"ttl_datestamp":"2026-02-08T00:00:00.000Z"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-07T23:25:53.304Z","msg":"[dynamodb-export]: ── END bundles.jsonl ──"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-07T23:25:53.305Z","msg":"[dynamodb-export]: Exporting table 'test-hmrc-api-requests-table' from endpoint 'http://127.0.0.1:61028' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/hmrc-api-requests.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-07T23:25:53.310Z","msg":"[dynamodb-export]: ✅ Exported 3 items from table 'test-hmrc-api-requests-table' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/hmrc-api-requests.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-07T23:25:53.310Z","msg":"[dynamodb-export]: ── BEGIN hmrc-api-requests.jsonl ──"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-6d984ecc-ade5-4fa3-98a5-90f3e979bc07","requestId":"dc1e574f-4e62-4b98-bd64-06f3d17118cb","amznTraceId":null,"traceparent":"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01","url":"https://test-api.service.hmrc.gov.uk/oauth/token","method":"POST","httpRequest":{"method":"POST","headers":{"Content-Type":"application/x-www-form-urlencoded","x-request-id":"dc1e574f-4e62-4b98-bd64-06f3d17118cb","traceparent":"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01","x-correlationid":"dc1e574f-4e62-4b98-bd64-06f3d17118cb"},"body":"grant_type=authorization_code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&client_secret=049b662f-61ea-4113-b38d-a9c8b1bb9f13&redirect_uri=https%3A%2F%2Fwanted-finally-anteater.ngrok-free.app%2Factivities%2FsubmitVatCallback.html&code=6cd5ad5c74194c2ead7487789211b1b1"},"httpResponse":{"statusCode":200,"headers":{"cache-control":"no-cache,no-store,max-age=0","connection":"keep-alive","content-length":"172","content-security-policy":"default-src 'self'","content-type":"application/json","date":"Wed, 07 Jan 2026 23:25:48 GMT","strict-transport-security":"max-age=31536000;","via":"1.1 4f2c05fa30365fcac05ad27ee136cce2.cloudfront.net (CloudFront)","x-amz-cf-id":"A3HzC9GjeecvTSDX5l139jL_Xk80F0mM3pZrsi4fmtcNsvirivkXlg==","x-amz-cf-pop":"LHR50-P6","x-cache":"Miss from cloudfront","x-content-type-options":"nosniff","x-envoy-upstream-service-time":"65","x-frame-options":"SAMEORIGIN"},"body":{"access_token":"51fe4c873b08e36dd60497638fb229c3","refresh_token":"0604b580d050b9975454747ab904cddb","expires_in":14400,"scope":"write:vat read:vat","token_type":"bearer"}},"duration":211,"createdAt":"2026-01-07T23:25:48.010Z","ttl":1770506748,"ttl_datestamp":"2026-02-07T23:25:48.010Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-9c1783ba-fc05-431e-9d89-2db83e618e8a","requestId":"62e0f2fb-6eb6-402b-827f-f5b214f44899","amznTraceId":null,"traceparent":"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01","url":"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"Bearer 51fe4c873b08e36dd60497638fb229c3","Gov-Client-Public-IP":"88.97.27.180","Gov-Client-Device-ID":"634e4eda-5bed-47f1-a333-0238b67f2283","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Public-IP":"88.97.27.180","Gov-Vendor-Forwarded":"by=88.97.27.180&for=88.97.27.180","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=0.0.2-4","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36","Gov-Client-Public-IP-Timestamp":"2026-01-07T23:25:48.237Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+00:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"62e0f2fb-6eb6-402b-827f-f5b214f44899","traceparent":"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01","x-correlationid":"62e0f2fb-6eb6-402b-827f-f5b214f44899"}},"httpResponse":{"statusCode":200,"headers":{"cache-control":"no-cache,no-store,max-age=0","connection":"keep-alive","content-length":"757","content-security-policy":"default-src 'self'","content-type":"application/json","date":"Wed, 07 Jan 2026 23:25:48 GMT","strict-transport-security":"max-age=31536000;","vary":"Origin","via":"1.1 4f2c05fa30365fcac05ad27ee136cce2.cloudfront.net (CloudFront)","x-amz-cf-id":"HQQNdZ7j__nY-nAF5zSGLX3P25O81WgnU4Xmirbboj8U6VPt9Anq8w==","x-amz-cf-pop":"LHR50-P6","x-cache":"Miss from cloudfront","x-content-type-options":"nosniff","x-envoy-upstream-service-time":"31","x-frame-options":"SAMEORIGIN"},"body":{"specVersion":"3.3","code":"INVALID_HEADERS","message":"At least 1 header is invalid","errors":[{"code":"MISSING_HEADER","message":"Header missing. You will not be able to submit a header if the connection is between client and server in a private network. If this is the case, you must contact us explaining why you cannot submit this header.","headers":["gov-client-public-port"]}],"warnings":[{"code":"MISSING_HEADER","message":"Header missing. This may be correct for single factor authentication, for example username and password. If this is the case, you must contact us explaining why you cannot submit this header.","headers":["gov-client-multi-factor"]},{"code":"MISSING_HEADER","message":"Header required","headers":["gov-vendor-license-ids"]}]}},"duration":136,"createdAt":"2026-01-07T23:25:48.410Z","ttl":1770506748,"ttl_datestamp":"2026-02-07T23:25:48.410Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-b97f1467-9b67-4962-b0ee-35ffa00c3e77","requestId":"62e0f2fb-6eb6-402b-827f-f5b214f44899","amznTraceId":null,"traceparent":"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01","url":"https://test-api.service.hmrc.gov.uk/organisations/vat/299294688/returns","method":"POST","httpRequest":{"method":"POST","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"Bearer 51fe4c873b08e36dd60497638fb229c3","x-request-id":"62e0f2fb-6eb6-402b-827f-f5b214f44899","traceparent":"00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01","x-correlationid":"62e0f2fb-6eb6-402b-827f-f5b214f44899","Gov-Client-Public-IP":"88.97.27.180","Gov-Client-Device-ID":"634e4eda-5bed-47f1-a333-0238b67f2283","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Public-IP":"88.97.27.180","Gov-Vendor-Forwarded":"by=88.97.27.180&for=88.97.27.180","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=0.0.2-4","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36","Gov-Client-Public-IP-Timestamp":"2026-01-07T23:25:48.237Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+00:00","Gov-Client-Window-Size":"width=1280&height=1446"},"body":"{\"periodKey\":\"25U6\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":0,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0,\"finalised\":true}"},"httpResponse":{"statusCode":201,"headers":{"cache-control":"no-cache,no-store,max-age=0","connection":"keep-alive","content-length":"140","content-security-policy":"default-src 'self'","content-type":"application/json","date":"Wed, 07 Jan 2026 23:25:48 GMT","receipt-id":"75ded624-ccf5-416e-a59b-53affadb3ca5","receipt-signature":"This has been deprecated - DO NOT USE","receipt-timestamp":"2026-01-07T23:25:48Z","strict-transport-security":"max-age=31536000;","vary":"Origin","via":"1.1 4f2c05fa30365fcac05ad27ee136cce2.cloudfront.net (CloudFront)","x-amz-cf-id":"_s6rdttUMq6NXG7pSdVyhSZN7RH6jpmwpNqn77I8Ev8VhAhZwRf0kg==","x-amz-cf-pop":"LHR50-P6","x-cache":"Miss from cloudfront","x-content-type-options":"nosniff, nosniff","x-correlationid":"75ded624-ccf5-416e-a59b-53affadb3ca5","x-envoy-upstream-service-time":"50","x-frame-options":"SAMEORIGIN"},"body":{"processingDate":"2026-01-07T23:25:48.549Z","formBundleNumber":"455184147206","paymentIndicator":"DD","chargeRefNumber":"7UNj8xC0x0VeKRpv"}},"duration":154,"createdAt":"2026-01-07T23:25:48.569Z","ttl":1770506748,"ttl_datestamp":"2026-02-07T23:25:48.569Z"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-07T23:25:53.310Z","msg":"[dynamodb-export]: ── END hmrc-api-requests.jsonl ──"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-07T23:25:53.310Z","msg":"[dynamodb-export]: Exporting table 'test-receipts-table' from endpoint 'http://127.0.0.1:61028' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/receipts.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-07T23:25:53.314Z","msg":"[dynamodb-export]: ✅ Exported 1 items from table 'test-receipts-table' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/receipts.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-07T23:25:53.314Z","msg":"[dynamodb-export]: ── BEGIN receipts.jsonl ──"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","receiptId":"2026-01-07T23:25:48.572Z-455184147206","receipt":{"processingDate":"2026-01-07T23:25:48.549Z","formBundleNumber":"455184147206","paymentIndicator":"DD","chargeRefNumber":"7UNj8xC0x0VeKRpv"},"createdAt":"2026-01-07T23:25:48.574Z","ttl":1988580348,"ttl_datestamp":"2033-01-05T23:25:48.574Z"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-07T23:25:53.314Z","msg":"[dynamodb-export]: ── END receipts.jsonl ──"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-07T23:25:53.314Z","msg":"[dynamodb-export]: ✅ Completed export of all tables"}
[DynamoDB Export]: Export completed: [
  {
    table: [32m'bundles'[39m,
    itemCount: [33m1[39m,
    filePath: [32m'/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/bundles.jsonl'[39m
  },
  {
    table: [32m'hmrc-api-requests'[39m,
    itemCount: [33m3[39m,
    filePath: [32m'/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/hmrc-api-requests.jsonl'[39m
  },
  {
    table: [32m'receipts'[39m,
    itemCount: [33m1[39m,
    filePath: [32m'/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/receipts.jsonl'[39m
  }
]
[Validation Feedback]: Appended validation feedback to hmrc-api-requests.jsonl
Asserting HMRC API request exists: POST /oauth/token
[DynamoDB Assertions]: Found 1 OAuth token exchange request(s)
Asserting HMRC API request exists: POST /organisations/vat/299294688/returns
[DynamoDB Assertions]: Found 1 VAT return POST request(s)
[DynamoDB Assertions]: VAT POST request body validated successfully
[DynamoDB Assertions]: Found 0 Fraud prevention headers validation feedback GET request(s)
Asserting HMRC API request exists: GET /test/fraud-prevention-headers/validate
[DynamoDB Assertions]: Found 1 Fraud prevention headers validation GET request(s)
[DynamoDB Assertions]: Fraud prevention headers validation GET request #1 validated successfully with details:
[DynamoDB Assertions]: Request code: INVALID_HEADERS
[DynamoDB Assertions]: Errors: 1
[DynamoDB Assertions]: Warnings: 2
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 1 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 2 headers)
[DynamoDB Assertions]: Request code: INVALID_HEADERS
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[afterEach] Saving /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/userSub.txt for test "Verify fraud prevention headers for VAT return submission": user
{"level":30,"source":"app/services/subHasher.js","time":"2026-01-07T23:25:53.395Z","message":"Using USER_SUB_HASH_SALT from environment (local dev/test)"}
[fileHelper] Salt initialized successfully for test diagnostics
[afterEach] Saving /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/hashedUserSub.txt for test "Verify fraud prevention headers for VAT return submission": 5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0
Saving /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/traceparent.txt for test "Verify fraud prevention headers for VAT return submission": 00-dbc4c6ef6cc05fdbd8c7c50fe06972b7-4d8315614b43a893-01
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-07T23:25:54.393Z","msg":"[proxy]: kill() called on ngrok proxy, stopping..."}
{"level":30,"source":"app/bin/ngrok.js","time":"2026-01-07T23:25:54.393Z","msg":"[ngrok]: Closing tunnel..."}
{"level":30,"source":"app/bin/ngrok.js","time":"2026-01-07T23:25:54.449Z","msg":"[ngrok]: ✅ Tunnel closed"}
  ✘  1 [postVatReturnFraudPreventionHeadersBehaviour] › behaviour-tests/postVatReturnFraudPreventionHeaders.behaviour.test.js:171:1 › Verify fraud prevention headers for VAT return submission (40.2s)


  1) [postVatReturnFraudPreventionHeadersBehaviour] › behaviour-tests/postVatReturnFraudPreventionHeaders.behaviour.test.js:171:1 › Verify fraud prevention headers for VAT return submission 

    Error: Expected authenticated requests to have a single hashedSub (Submit VAT test), but found 2

    [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m1[39m
    Received: [31m2[39m

       at behaviour-tests/helpers/dynamodb-assertions.js:171

      169 |       authenticatedHashedSubs.length,
      170 |       `Expected authenticated requests to have a single hashedSub${desc}, but found ${authenticatedHashedSubs.length}`,
    > 171 |     ).toBe(1);
          |       ^
      172 |
      173 |     logger.info(
      174 |       `Found ${records.length} HMRC API requests: OAuth (${oauthRequests.length}) with hashedSub ${oauthHashedSubs[0]}, ` +
        at assertConsistentHashedSub (/Users/antony/projects/submit.diyaccounting.co.uk/behaviour-tests/helpers/dynamodb-assertions.js:171:7)
        at /Users/antony/projects/submit.diyaccounting.co.uk/behaviour-tests/postVatReturnFraudPreventionHeaders.behaviour.test.js:511:24

    attachment #1: screenshot (image/png) ──────────────────────────────────────────────────────────
    target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/test-finished-1.png
    ────────────────────────────────────────────────────────────────────────────────────────────────

    attachment #2: screenshot (image/png) ──────────────────────────────────────────────────────────
    target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/test-failed-2.png
    ────────────────────────────────────────────────────────────────────────────────────────────────

    Error Context: target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/error-context.md

    attachment #4: trace (application/zip) ─────────────────────────────────────────────────────────
    target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/trace.zip
    Usage:

        npx playwright show-trace target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/trace.zip

    ────────────────────────────────────────────────────────────────────────────────────────────────

  1 failed
    [postVatReturnFraudPreventionHeadersBehaviour] › behaviour-tests/postVatReturnFraudPreventionHeaders.behaviour.test.js:171:1 › Verify fraud prevention headers for VAT return submission 

To open last HTML report run:
[36m[39m
[36m  npx playwright show-report target/test-reports/html-report[39m
[36m[39m

> web-submit-diyaccounting-co-uk@0.0.2-4 test-report
> node scripts/generate-test-reports.js --testName html-report --testName postVatReturnFraudPreventionHeadersBehaviour --testFile behaviour-tests/postVatReturnFraudPreventionHeaders.behaviour.test.js --envFile .env.proxy

=== Generating Test Reports ===
Project root: /Users/antony/projects/submit.diyaccounting.co.uk
Results directory: /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results
Reports directory: /Users/antony/projects/submit.diyaccounting.co.uk/target/test-reports/html-report
Output directory: /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results
Node v22.17.0 | cwd=/Users/antony/projects/submit.diyaccounting.co.uk

Direct mode: generating report for test 'postVatReturnFraudPreventionHeadersBehaviour'
Reading test file behaviour-tests/postVatReturnFraudPreventionHeaders.behaviour.test.js (20KB)
Reading env file .env.proxy (2.2KB)
Searching fallback data in /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results
Explore dir for testContext.json: /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results
Found testContext.json at /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/testContext.json
Explore dir for hmrc-api-requests.jsonl: /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results
Found hmrc-api-requests.jsonl at /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/hmrc-api-requests.jsonl
findTestData result (fallback): testContext=true, api=true
Generating report for: postVatReturnFraudPreventionHeadersBehaviour
Read testContext from /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/testContext.json (16KB)
testContext keys: testId, name, title, description, hmrcApis, env, testData, validationFeedback, artefactsDir, screenshotPath, testStartTime
Reading HMRC API requests from: /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/hmrc-api-requests.jsonl
Open JSONL file (16KB): /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/hmrc-api-requests.jsonl
HMRC API request POST https://test-api.service.hmrc.gov.uk/oauth/token
undefined
undefined
HMRC API request GET https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate
undefined
undefined
HMRC API request POST https://test-api.service.hmrc.gov.uk/organisations/vat/299294688/returns
undefined
undefined
HMRC API request https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/vat-mtd/validation-feedback
undefined
undefined
Parsed 4 JSONL entries (0 failed)
Read 4 HMRC API requests
API request URL preview: https://test-api.service.hmrc.gov.uk/oauth/token, https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate, https://test-api.service.hmrc.gov.uk/organisations/vat/299294688/returns, https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/vat-mtd/validation-feedback
Playwright HTML report exists: /Users/antony/projects/submit.diyaccounting.co.uk/target/test-reports/html-report/index.html
Reading last-run metadata from /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/.last-run.json
Derived test status from .last-run.json: failed, failedTests: 1
Failed tests preview: ["09ad7a86c5d6b024ba57-7e9d69a90c6e120217e6"]
Test outcome: failed
Read test source file: behaviour-tests/postVatReturnFraudPreventionHeaders.behaviour.test.js
Read environment config: .env.proxy
Explore dir for figures.json: /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results
Found figures.json at /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/figures.json
Read figures.json (/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventi-0a863-s-for-VAT-return-submission-postVatReturnFraudPreventionHeadersBehaviour/figures.json) with 5 curated screenshots
Screenshot preview: 2026-01-07_23-25-38-570985055-10-fill-in-submission-pagedown.png, 2026-01-07_23-25-49-908347158-02-complete-vat-receipt.png, 2026-01-07_23-25-18-669129376-01-submit-mock.png, 2026-01-07_23-25-49-770629564-01-complete-vat-waiting.png, 2026-01-07_23-25-50-593187228-08-receipt.png
Copied figures.json to /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/postVatReturnFraudPreventionHeadersBehaviour-figures.json
Found video: video.webm
Found 5 screenshot(s)
Found 1 video(s)
Generated test-report-postVatReturnFraudPreventionHeadersBehaviour.json (67KB)

=== Test Report Generation Complete ===
target/behaviour-test-results/test-report-postVatReturnFraudPreventionHeadersBehaviour.json -> web/public/tests/test-report-web-test-local.json
2026-01-07_23-25-38-570985055-10-fill-in-submission-pagedown.png
2026-01-07_23-25-49-908347158-02-complete-vat-receipt.png
2026-01-07_23-25-18-669129376-01-submit-mock.png
2026-01-07_23-25-49-770629564-01-complete-vat-waiting.png
2026-01-07_23-25-50-593187228-08-receipt.png
Cleaned from 2026-01-07_23-25-38-570985055-10-fill-in-submission-pagedown.png to fill-in-submission-pagedown.png
target/behaviour-test-results/screenshots/fraudPreventionHeadersVat-behaviour-test/2026-01-07_23-25-38-570985055-10-fill-in-submission-pagedown.png -> web/public/tests/behaviour-test-results/web-test-local/fill-in-submission-pagedown.png
Cleaned from 2026-01-07_23-25-49-908347158-02-complete-vat-receipt.png to complete-vat-receipt.png
target/behaviour-test-results/screenshots/fraudPreventionHeadersVat-behaviour-test/2026-01-07_23-25-49-908347158-02-complete-vat-receipt.png -> web/public/tests/behaviour-test-results/web-test-local/complete-vat-receipt.png
Cleaned from 2026-01-07_23-25-18-669129376-01-submit-mock.png to submit-mock.png
target/behaviour-test-results/screenshots/fraudPreventionHeadersVat-behaviour-test/2026-01-07_23-25-18-669129376-01-submit-mock.png -> web/public/tests/behaviour-test-results/web-test-local/submit-mock.png
Cleaned from 2026-01-07_23-25-49-770629564-01-complete-vat-waiting.png to complete-vat-waiting.png
target/behaviour-test-results/screenshots/fraudPreventionHeadersVat-behaviour-test/2026-01-07_23-25-49-770629564-01-complete-vat-waiting.png -> web/public/tests/behaviour-test-results/web-test-local/complete-vat-waiting.png
Cleaned from 2026-01-07_23-25-50-593187228-08-receipt.png to receipt.png
target/behaviour-test-results/screenshots/fraudPreventionHeadersVat-behaviour-test/2026-01-07_23-25-50-593187228-08-receipt.png -> web/public/tests/behaviour-test-results/web-test-local/receipt.png
target/test-reports/html-report -> web/public/tests/test-reports/web-test-local/html-report
target/test-reports/html-report/index.html -> web/public/tests/test-reports/web-test-local/html-report/index.html
target/test-reports/html-report/trace -> web/public/tests/test-reports/web-test-local/html-report/trace
target/test-reports/html-report/trace/index.html -> web/public/tests/test-reports/web-test-local/html-report/trace/index.html
target/test-reports/html-report/trace/uiMode.Btcz36p_.css -> web/public/tests/test-reports/web-test-local/html-report/trace/uiMode.Btcz36p_.css
target/test-reports/html-report/trace/xtermModule.DYP7pi_n.css -> web/public/tests/test-reports/web-test-local/html-report/trace/xtermModule.DYP7pi_n.css
target/test-reports/html-report/trace/defaultSettingsView.ConWv5KN.css -> web/public/tests/test-reports/web-test-local/html-report/trace/defaultSettingsView.ConWv5KN.css
target/test-reports/html-report/trace/codeMirrorModule.C3UTv-Ge.css -> web/public/tests/test-reports/web-test-local/html-report/trace/codeMirrorModule.C3UTv-Ge.css
target/test-reports/html-report/trace/uiMode.BWTwXl41.js -> web/public/tests/test-reports/web-test-local/html-report/trace/uiMode.BWTwXl41.js
target/test-reports/html-report/trace/codicon.DCmgc-ay.ttf -> web/public/tests/test-reports/web-test-local/html-report/trace/codicon.DCmgc-ay.ttf
target/test-reports/html-report/trace/snapshot.html -> web/public/tests/test-reports/web-test-local/html-report/trace/snapshot.html
target/test-reports/html-report/trace/index.C4Y3Aw8n.css -> web/public/tests/test-reports/web-test-local/html-report/trace/index.C4Y3Aw8n.css
target/test-reports/html-report/trace/index.BxQ34UMZ.js -> web/public/tests/test-reports/web-test-local/html-report/trace/index.BxQ34UMZ.js
target/test-reports/html-report/trace/manifest.webmanifest -> web/public/tests/test-reports/web-test-local/html-report/trace/manifest.webmanifest
target/test-reports/html-report/trace/sw.bundle.js -> web/public/tests/test-reports/web-test-local/html-report/trace/sw.bundle.js
target/test-reports/html-report/trace/uiMode.html -> web/public/tests/test-reports/web-test-local/html-report/trace/uiMode.html
target/test-reports/html-report/trace/assets -> web/public/tests/test-reports/web-test-local/html-report/trace/assets
target/test-reports/html-report/trace/assets/codeMirrorModule-Bucv2d7q.js -> web/public/tests/test-reports/web-test-local/html-report/trace/assets/codeMirrorModule-Bucv2d7q.js
target/test-reports/html-report/trace/assets/defaultSettingsView-BEpdCv1S.js -> web/public/tests/test-reports/web-test-local/html-report/trace/assets/defaultSettingsView-BEpdCv1S.js
target/test-reports/html-report/trace/playwright-logo.svg -> web/public/tests/test-reports/web-test-local/html-report/trace/playwright-logo.svg
target/test-reports/html-report/data -> web/public/tests/test-reports/web-test-local/html-report/data
target/test-reports/html-report/data/72d2eace9f10fb03afb27c4948783eda79b8b3fc.zip -> web/public/tests/test-reports/web-test-local/html-report/data/72d2eace9f10fb03afb27c4948783eda79b8b3fc.zip
target/test-reports/html-report/data/4fb88036b94253af20dfdd57492899c1c8bd8c7a.png -> web/public/tests/test-reports/web-test-local/html-report/data/4fb88036b94253af20dfdd57492899c1c8bd8c7a.png
target/test-reports/html-report/data/27144a30301ffe1d3cc9f0ef7cf4030999bc3ce7.md -> web/public/tests/test-reports/web-test-local/html-report/data/27144a30301ffe1d3cc9f0ef7cf4030999bc3ce7.md
target/test-reports/html-report/data/15f980e1fb9b9c42fca30fcb46121df1cabdab22.png -> web/public/tests/test-reports/web-test-local/html-report/data/15f980e1fb9b9c42fca30fcb46121df1cabdab22.png
