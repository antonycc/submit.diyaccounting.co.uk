{
"findings": [
{
"issue": "Lack of security headers and permissive CORS",
"severity": "high",
"evidence": "Express server wires handlers without security middleware【197233811948917†L39-L52】",
"fix": "Add helmet and cors middleware; configure allowed origins via environment variable"
},
{
"issue": "No default CORS headers in JSON responses",
"severity": "medium",
"evidence": "httpResponse builds response without headers【68343395559148†L34-L49】",
"fix": "Set Access-Control-Allow-Origin and related headers in httpResponse or configure Express CORS"
},
{
"issue": "Secrets and access tokens logged in plaintext",
"severity": "high",
"evidence": "exchangeToken and submitVat handlers log tokens and secrets【841760619931964†L64-L87】【921498641816015†L64-L83】",
"fix": "Redact or omit sensitive tokens and client secrets from logs"
},
{
"issue": "Inefficient user-limit enforcement",
"severity": "medium",
"evidence": "bundle.js counts users by listing Cognito users and limits to 60 per page【522461150998847†L297-L324】",
"fix": "Track bundle counts in DynamoDB or iterate through all pages"
},
{
"issue": "JWT decoding without signature verification",
"severity": "medium",
"evidence": "decodeJwtNoVerify simply base64-decodes JWTs【921498641816015†L36-L45】【522461150998847†L19-L28】",
"fix": "Use @aws/jwt-verify or similar library to validate tokens against JWKs"
}
],
"backlog": [
{
"rank": 1,
"goal": "Security hardening and CORS configuration",
"impact": "Protects users from click-jacking and cross-site attacks; avoids leaking secrets",
"risk": "low",
"effort": "low-medium",
"dependencies": "Add helmet and cors packages",
"acceptance_criteria": "Responses include security and CORS headers; logs redact tokens",
"owner": "backend team"
},
{
"rank": 2,
"goal": "JWT verification and rate limiting",
"impact": "Prevents forged tokens and DoS",
"risk": "medium",
"effort": "medium",
"dependencies": "Add @aws/jwt-verify and rate limiting middleware",
"acceptance_criteria": "Invalid tokens return 401; requests over size limit are rejected",
"owner": "backend team"
},
{
"rank": 3,
"goal": "Efficient bundle counting",
"impact": "Scales with user base and enforces limits accurately",
"risk": "medium",
"effort": "medium-high",
"dependencies": "Requires new DynamoDB table and CDK changes",
"acceptance_criteria": "Bundle grants respect user limits even at >60 users",
"owner": "infrastructure team"
}
],
"diffs": [
{
"file": "app/bin/server.js",
"changes": "Import helmet and cors; use helmet(); configure cors with allowed origin and body size limit"
},
{
"file": "app/lib/responses.js",
"changes": "Add default Access-Control-Allow-* headers to response"
},
{
"file": "app/functions/exchangeToken.js",
"changes": "Redact sensitive information from logs by logging only status and token presence"
}
],
"commands": [
"git clone git@github.com:antonycc/submit.diyaccounting.co.uk.git",
"cd submit.diyaccounting.co.uk && npm install",
"npm run linting && npm run test:unit && npm run test:integration",
"npm run test:system && npm run test:browser",
"npm run test:infra",
"./mvnw clean package && npx cdk synth SubmitWebStack-dev && npx cdk deploy SubmitWebStack-dev"
]
}
