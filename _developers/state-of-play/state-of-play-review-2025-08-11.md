The GitHub repo `antonycc/submit.diyaccounting.co.uk` contains a monorepo combining the front‑end, server and infrastructure code needed to build a DIY VAT‑submission service for the UK’s Making Tax Digital (MTD) regime.  The README outlines the original MVP: a simple web form to submit VAT returns, with no persistent identity and receipts stored in S3.  The tech stack comprises a static HTML/JavaScript front‑end, a Node/Express backend (packaged as AWS Lambda functions) and an AWS CDK stack (Java) that provisions S3 buckets, CloudFront distributions and other resources.

### Current state of the repository

**Infrastructure (CDK)** – The `WebStack.java` file shows that the stack now creates a Cognito user pool with a custom string attribute called `bundles` and configures an identity provider for Google.  It sets up a custom domain on Route 53 for the Cognito hosted UI and deploys a certificate for it.  It also provisions a Lambda (container‑based) called `BundleLambda` whose handler lives in `app/functions/bundle.js`; this function updates the `custom:bundles` attribute for users and enforces expiry dates and user‑count limits.

**Backend** – The server (`app/bin/server.js`) exposes REST endpoints under `/api`.  It serves static files under `web/public`, calls HMRC OAuth/transaction Lambdas, and registers a `/api/request-bundle` POST route for bundle management.  The bundle handler decodes the Cognito JWT, looks up the user’s existing bundles (via the Cognito Admin API or in‑memory store when mocking) and, if below the configured expiry date and user‑limit, appends a `bundleId|EXPIRY=yyyy-mm-dd` string to the `custom:bundles` attribute and returns it to the client.  This function includes logic to count users with a given bundle by listing users in the entire user pool; it’s functional but would be inefficient at scale.

**Front‑end** – Static pages like `login.html` and `bundles.html` implement the user interface.  The login page offers federated sign‑in via Google and (for testing) a mock OAuth2 provider.  When the user clicks “Continue with Google”, a script obtains the Cognito authorisation URL and redirects the browser.  The bundles page shows available services (“HMRC Test API Bundle”, “HMRC Production API Bundle”, “Companies House API Bundle”) and calls `/api/request-bundle` when the user clicks **Add**.  It stores returned bundle data in `localStorage` and shows a message if the bundle was granted or already granted.  However, there is no GET endpoint or UI for viewing a user’s existing bundles—the page comments indicate this as a future enhancement.

### Gaps and suggested improvements

1. **Persisted identity vs. MVP description:**  The README still emphasises “no persistent identity—OAuth performed per submission”, yet the new Cognito/Google integration introduces persistent users and entitlements.  Update the README and user‑journey documentation to reflect the new login flow and bundle concept.
2. **User‑bundle retrieval:**  Currently only a POST endpoint exists for requesting bundles; the bundles page has a placeholder comment to fetch current bundles.  A GET endpoint should be added to return the user’s bundle list and expiry dates.  This would allow the UI to display existing entitlements and prevent clients from relying on localStorage.
3. **Scalability and concurrency:**  The bundle handler counts users by listing all users in the user pool, which will not scale beyond a few hundred accounts.  Consider storing bundle assignments in a DynamoDB table keyed by user ID and bundle ID, with secondary indexes for counts.  Use conditional writes to enforce user‑limit and avoid race conditions.
4. **Revocation and renewal:**  At present there is no way to revoke or update a bundle.  Implement endpoints to delete or renew bundles and update the Cognito attribute accordingly.
5. **UI polish and error handling:**  The front‑end could display better error messages (e.g., handle network failures or expired sessions) and show the expiry date and status of each bundle.  The “Coming soon” bundles should either be removed until implemented or link to sign‑up forms.
6. **Testing and documentation:**  Unit tests exist for many functions but the new bundle and Google login flows need end‑to‑end tests.  Provide an updated deployment guide describing environment variables (Google client ID/secret, Cognito domain prefix, bundle expiry/user limit) and how to obtain an HMRC developer account.

### Market context

The UK’s Making Tax Digital initiative obliges VAT‑registered businesses to keep digital records and submit returns using compatible software.  Many established accounting platforms (Sage Accounting, QuickBooks, Xero and others) have added MTD compliance to their general bookkeeping packages, and HMRC lists dozens of approved software providers.  TechRadar notes that tax software vendors have “altered \[their] accounting software to take Making Tax Digital into consideration” and there is a long list of approved packages.  In addition to full accounting suites, there is a niche market for *bridging software*.  Bridging tools act as an intermediary between a business’s spreadsheet and HMRC; they allow users to continue using Excel while meeting MTD requirements.  These tools provide a simple digital link to HMRC, avoiding manual copy‑and‑paste and the need to adopt a full accounting package.

### Competing in this market

To compete against both comprehensive accounting suites and simple bridging tools, a service like DIY Accounting Submit should target users who find full packages expensive or complex yet want more than a bare‑bones spreadsheet uploader.  Possible strategies include:

* **Position as a lightweight, open‑source alternative** to large vendors.  Emphasise transparency and extensibility; open source can build trust and attract a community.
* **Streamlined user experience**: Provide a simple sign‑up with Google and a guided VAT submission process.  Reduce friction by automatically pulling company details (e.g., from Companies House) once that bundle is ready.
* **Flexible bundle management**: Allow businesses to add services (HMRC VAT, income tax, Companies House API) as separate “bundles”.  Offer a clear pricing model and free tiers for small users.  Provide a dashboard showing active bundles, expiry dates and usage.
* **Bridging features**: Implement an Excel import feature to upload spreadsheets and map fields, so users can choose between a form, a file upload or integration with existing accounting software.  This would compete with bridging software while offering an upgrade path to more features.
* **Compliance and trust**: Ensure the service appears on HMRC’s list of approved software and clearly communicates security measures (encryption at rest, IAM policies, data retention).
* **Integrations**: Expand beyond HMRC VAT; for example, integrate with open banking APIs for real‑time transaction feeds or with Payment Service Providers to record VAT on sales.  Each integration could be a separate bundle that uses the existing Cognito attribute.

In summary, the repository already integrates AWS Cognito with Google sign‑in, stores bundle entitlements, and serves a working prototype.  To deliver a fully functional product, the team should complete the bundle lifecycle (retrieval, revocation, UI updates), update documentation to reflect persistent users, and plan for scalability.  By focusing on ease‑of‑use and targeted bundles while maintaining compliance, the project can occupy a niche between complex accounting suites and simple bridging software.
