
> @antonycc/web-submit-diyaccounting-co-uk@1.0.0 test:submitVatBehaviour-simulator
> npx dotenv -e .env.simulator -- npm run test:submitVatBehaviour


> @antonycc/web-submit-diyaccounting-co-uk@1.0.0 test:submitVatBehaviour
> playwright test --project=submitVatBehaviour

dotenvConfigIfNotBlank: Loading environment config from .env
dotenvConfigIfNotBlank: Loading environment config from .env
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:10.059Z","msg":"Reading CDK configuration from /Users/antony/projects/submit.diyaccounting.co.uk/cdk-application/cdk.json"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:10.060Z","msg":"CDK context:"}
dotenvConfigIfNotBlank: Loading environment config from .env
dotenvConfigIfNotBlank: Loading environment config from .env
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:10.069Z","msg":"envFilePath: .env.simulator"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:10.070Z","msg":"envName: simulator"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:10.070Z","msg":"serverPort: 3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:10.070Z","msg":"runTestServer: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:10.070Z","msg":"runProxy: off"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:10.070Z","msg":"runMockOAuth2: off"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:10.070Z","msg":"testAuthProvider: simulator"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:10.070Z","msg":"testAuthUsername: user"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:10.070Z","msg":"testAuthPassword: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:10.070Z","msg":"baseUrl: http://localhost:3000/"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:10.070Z","msg":"hmrcTestUsername: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:10.070Z","msg":"hmrcTestPassword: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:10.070Z","msg":"hmrcTestVatNumber: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:10.070Z","msg":"runDynamoDb: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:10.070Z","msg":"bundleTableName: test-bundle-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:10.070Z","msg":"hmrcApiRequestsTableName: test-hmrc-api-requests-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:10.070Z","msg":"receiptsTableName: test-receipts-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:10.070Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:10.071Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}

Running 1 test using 1 worker

dotenvConfigIfNotBlank: Loading environment config from .env
dotenvConfigIfNotBlank: Loading environment config from .env
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:11.440Z","msg":"Reading CDK configuration from /Users/antony/projects/submit.diyaccounting.co.uk/cdk-application/cdk.json"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:11.441Z","msg":"CDK context:"}
dotenvConfigIfNotBlank: Loading environment config from .env
dotenvConfigIfNotBlank: Loading environment config from .env
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:11.448Z","msg":"envFilePath: .env.simulator"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:11.448Z","msg":"envName: simulator"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:11.448Z","msg":"serverPort: 3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:11.448Z","msg":"runTestServer: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:11.448Z","msg":"runProxy: off"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:11.448Z","msg":"runMockOAuth2: off"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:11.448Z","msg":"testAuthProvider: simulator"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:11.449Z","msg":"testAuthUsername: user"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:11.449Z","msg":"testAuthPassword: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:11.449Z","msg":"baseUrl: http://localhost:3000/"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:11.449Z","msg":"hmrcTestUsername: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:11.449Z","msg":"hmrcTestPassword: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:11.449Z","msg":"hmrcTestVatNumber: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:11.449Z","msg":"runDynamoDb: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:11.449Z","msg":"bundleTableName: test-bundle-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:11.449Z","msg":"hmrcApiRequestsTableName: test-hmrc-api-requests-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:11.449Z","msg":"receiptsTableName: test-receipts-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:11.449Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:11.449Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
Starting beforeAll hook...
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:12.371Z","msg":"[dynamodb]: runDynamoDb=run, bundleTableName=test-bundle-table, hmrcApiRequestsTableName=test-hmrc-api-requests-table, receiptsTableName=test-receipts-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:12.371Z","msg":"[dynamodb]: Starting dynalite (local DynamoDB) server..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:12.377Z","msg":"[dynamodb]: Started at http://127.0.0.1:9001"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.377Z","msg":"[dynamodb]: Ensuring bundle table: 'test-bundle-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.411Z","msg":"[dynamodb]: ℹ️ Table 'test-bundle-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.424Z","msg":"[dynamodb]: ✅ Created table 'test-bundle-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.425Z","msg":"[dynamodb]: Ensuring HMRC API requests table: 'test-hmrc-api-requests-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.430Z","msg":"[dynamodb]: ℹ️ Table 'test-hmrc-api-requests-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.432Z","msg":"[dynamodb]: ✅ Created table 'test-hmrc-api-requests-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.432Z","msg":"[dynamodb]: Ensuring receipts table: 'test-receipts-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.437Z","msg":"[dynamodb]: ℹ️ Table 'test-receipts-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.440Z","msg":"[dynamodb]: ✅ Created table 'test-receipts-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.440Z","msg":"[dynamodb]: Ensuring passes table: 'test-passes-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.444Z","msg":"[dynamodb]: ℹ️ Table 'test-passes-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.446Z","msg":"[dynamodb]: ✅ Created table 'test-passes-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.446Z","msg":"[dynamodb]: Ensuring async requests table: 'test-hmrc-vat-return-post-async-requests-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.453Z","msg":"[dynamodb]: ℹ️ Table 'test-hmrc-vat-return-post-async-requests-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.456Z","msg":"[dynamodb]: ✅ Created table 'test-hmrc-vat-return-post-async-requests-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.456Z","msg":"[dynamodb]: Ensuring async requests table: 'test-hmrc-vat-return-get-async-requests-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.461Z","msg":"[dynamodb]: ℹ️ Table 'test-hmrc-vat-return-get-async-requests-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.463Z","msg":"[dynamodb]: ✅ Created table 'test-hmrc-vat-return-get-async-requests-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.463Z","msg":"[dynamodb]: Ensuring async requests table: 'test-hmrc-vat-obligation-get-async-requests-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.466Z","msg":"[dynamodb]: ℹ️ Table 'test-hmrc-vat-obligation-get-async-requests-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:23:12.468Z","msg":"[dynamodb]: ✅ Created table 'test-hmrc-vat-obligation-get-async-requests-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:12.469Z","msg":"[auth]: runMockOAuth2=off"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:12.469Z","msg":"[auth]: Skipping mock-oauth2-server process as runMockOAuth2 is not set to 'run'"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:12.469Z","msg":"[auth]: Starting HTTP simulator (replaces mock-oauth2-server and HMRC API)..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:12.469Z","msg":"[http-simulator]: runSimulator=run, port=9000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:12.469Z","msg":"[http-simulator]: Starting HTTP simulator..."}
[http-simulator] Started on http://localhost:9000
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:12.734Z","msg":"[http-simulator]: Started at http://localhost:9000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:12.734Z","msg":"[http]: runTestServer=run, httpServerPort=3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:12.734Z","msg":"[http]: Starting server process..."}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-02-03T20:23:12.738Z","msg":"[http]: Checking server readiness for... http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-02-03T20:23:12.745Z","msg":"[http]: Starting server at http://127.0.0.1:3000 after error TypeError: fetch failed"}
{"level":50,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-02-03T20:23:12.746Z","msg":"[http]: Server check attempt 1/15 failed: fetch failed from http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:12.912Z","msg":"[http-stdout]: dotenvConfigIfNotBlank: Loading environment config from .env"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:12.922Z","msg":"[http-stdout]: dotenvConfigIfNotBlank: Loading environment config from .env"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:12.925Z","msg":"[http-stdout]: Mock OAuth routes registered (TEST_AUTH_PROVIDER=simulator)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:12.929Z","msg":"[http-stdout]: Listening at http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:12.930Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:12.929Z\",\"msg\":\"Listening at http://127.0.0.1:3000\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:13.754Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:13.754Z\",\"msg\":\"HTTP GET /\"}"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-02-03T20:23:13.772Z","msg":"[http]: Response body"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-02-03T20:23:13.772Z","msg":"[http]: Server is ready! at http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:13.772Z","msg":"[proxy]: runProxy=off, httpServerPort=3000, baseUrl=http://localhost:3000/"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:13.772Z","msg":"[proxy]: Skipping ngrok tunnel as runProxy is not set to 'run'"}
beforeAll hook completed successfully
[HMRC Test User] Sandbox mode detected without full credentials - creating test user
[HMRC Test User] Creating HMRC sandbox test user with VAT enrolment using client credentials
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:14.403Z","message":"[HMRC Test User Creation] Starting test user creation","url":"http://localhost:9000/create-test-user/organisations","serviceNames":["mtd-vat"],"hmrcClientId":"uqMHA6Rs..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:14.403Z","message":"[HMRC Test User Creation] Request details (pre-token)","method":"POST","url":"http://localhost:9000/create-test-user/organisations","body":{"serviceNames":["mtd-vat"]}}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:14.403Z","message":"[HMRC Test User Creation] Requesting OAuth2 access token","tokenUrl":"http://localhost:9000/oauth/token","grantType":"client_credentials"}
[http-simulator] POST /oauth/token
[http-simulator:hmrc-oauth] POST /oauth/token grant_type=client_credentials
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:14.456Z","message":"[HMRC Test User Creation] Token response received","status":200,"statusText":"OK","hasAccessToken":true}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:14.456Z","message":"[HMRC Test User Creation] Request details (create-test-user)","method":"POST","url":"http://localhost:9000/create-test-user/organisations","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"[REDACTED]"},"body":{"serviceNames":["mtd-vat"]}}
[http-simulator] POST /create-test-user/organisations
[http-simulator:test-user] POST /create-test-user/organisations
[http-simulator:test-user] Created test user with VAT registration number: 711173646
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:14.474Z","message":"[HMRC Test User Creation] Response received","status":201,"statusText":"Created","responseBody":{"userId":"235992622910","password":"[REDACTED]","userFullName":"Test User","emailAddress":"[REDACTED]","organisationDetails":{"name":"Test Organisation Ltd","address":{"line1":"123 Test Street","line2":"Test Town","postcode":"TE1 1ST"}},"individualDetails":{"firstName":"Test","lastName":"User","dateOfBirth":"1980-01-01","address":{"line1":"123 Test Street","line2":"Test Town","postcode":"TE1 1ST"}},"vatRegistrationDate":"2026-02-03","groupIdentifier":"998188268052","vrn":"711173646"}}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:14.474Z","message":"[HMRC Test User Creation] Test user created successfully","userId":"235992622910","userFullName":"Test User","organisationName":"Test Organisation Ltd"}
[HMRC Test User] Successfully created test user:
  User ID: 235992622910
  User Full Name: Test User
  VAT registration number: 711173646
  Organisation: Test Organisation Ltd
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:14.475Z","message":"[HMRC Test User] Saving test user details to JSON files","outputDir":"/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour","repoRoot":"/Users/antony/projects/submit.diyaccounting.co.uk"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:14.475Z","message":"[HMRC Test User] Saved test user to artifact directory","path":"/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/hmrc-test-user.json"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:14.475Z","message":"[HMRC Test User] Saved test user to repository root","path":"/Users/antony/projects/submit.diyaccounting.co.uk/hmrc-test-user.json"}
[HMRC Test User] Updated environment variables with generated credentials
Loading document...
[NAVIGATION] (1/4) Going to: http://127.0.0.1:3000/ - Loading home page
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:14.854Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:14.854Z\",\"msg\":\"HTTP GET /\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:14.958Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:14.940Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:14.961Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:14.960Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:14.965Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:14.961Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:14.963Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:14.967Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:14.965Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:14.966Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:14.967Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:14.967Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:14.969Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:14.968Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:14.972Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:14.972Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.015Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.016Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.013Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.014Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.015Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.015Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.016Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.016Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.020Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.019Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.021Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.021Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.021Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.021Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.032Z","msg":"[BROWSER CONSOLE log]: User is not authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.033Z","msg":"[BROWSER CONSOLE log]: User is not authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.045Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.040Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.048Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.047Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.048Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.063Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.063Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
Checking home page...
✅ [Compliance] Privacy link visible on home page
✅ [Compliance] Terms link visible on home page
[USER INTERACTION] Clicking: a:has-text('Log in') - Clicking login link
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.793Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.793Z\",\"msg\":\"HTTP GET /auth/login.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.821Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.809Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.836Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.823Z\",\"msg\":\"HTTP GET /images/g-logo.png\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.824Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.825Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.825Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.825Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.842Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.838Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.841Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.842Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.842Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.845Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.842Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.844Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.844Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.849Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.849Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.885Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.904Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.893Z\",\"msg\":\"HTTP GET /submit.env\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.896Z\",\"msg\":\"HTTP GET /auth/login-mock-addon.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.896Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.897Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.910Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.908Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.908Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.909Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.909Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.910Z","msg":"[BROWSER CONSOLE error]: Loading the image 'https://avatars.githubusercontent.com/u/11848947?s=48&v=4' violates the following Content Security Policy directive: \"img-src 'self' data:\". The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.911Z","msg":"[HTTP REQUEST FAILED] GET https://avatars.githubusercontent.com/u/11848947?s=48&v=4 - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.912Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.910Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.910Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.927Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.927Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.928Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.928Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:15.935Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:15.935Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
Logging in...
[USER INTERACTION] Clicking: button:has-text('Continue with mock-oauth2-server') - Continue with OAuth provider
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:16.722Z","msg":"[BROWSER CONSOLE log]: Initiating navikt/mock-oauth2-server login"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:16.722Z","msg":"[BROWSER CONSOLE log]: Clear stored tokens and user info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:16.727Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:16.727Z\",\"msg\":\"HTTP GET /api/v1/mock/authUrl?state=65a94fe5ae649c64621697065b541b1a\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:16.733Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:16.730Z\",\"requestId\":\"9c1c100a-310b-43c2-ae23-b32729cb6acd\",\"traceparent\":\"00-4ae09534d3b8f96d8fe0ed78309baff6-02b10a019917afc4-01\",\"correlationId\":\"9c1c100a-310b-43c2-ae23-b32729cb6acd\",\"message\":\"Processing request with event\",\"request\":\"http://127.0.0.1:3000/api/v1/mock/authUrl?state=65a94fe5ae649c64621697065b541b1a\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"cognito:username\":\"test\",\"email\":\"[EMAIL]\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"127.0.0.1:3000\",\"path\":\"/api/v1/mock/authUrl\"}},\"path\":\"/api/v1/mock/authUrl\",\"headers\":{\"host\":\"127.0.0.1:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"9c1c100a-310b-43c2-ae23-b32729cb6acd\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-4ae09534d3b8f96d8fe0ed78309baff6-02b10a019917afc4-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://127.0.0.1:3000/auth/login.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"state\":\"65a94fe5ae649c64621697065b541b1a\"},\"rawQueryString\":\"state=65a94fe5ae649c64621697065b541b1a\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/non-lambda-mocks/mockAuthUrlGet.js\",\"time\":\"2026-02-03T20:23:16.731Z\",\"requestId\":\"9c1c100a-310b-43c2-ae23-b32729cb6acd\",\"traceparent\":\"00-4ae09534d3b8f96d8fe0ed78309baff6-02b10a019917afc4-01\",\"correlationId\":\"9c1c100a-310b-43c2-ae23-b32729cb6acd\",\"message\":\"Generating mock authorization URL\",\"state\":\"65a94fe5ae649c64621697065b541b1a\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:16.732Z\",\"requestId\":\"9c1c100a-310b-43c2-ae23-b32729cb6acd\",\"traceparent\":\"00-4ae09534d3b8f96d8fe0ed78309baff6-02b10a019917afc4-01\",\"correlationId\":\"9c1c100a-310b-43c2-ae23-b32729cb6acd\",\"message\":\"Responding to request with response\",\"request\":\"http://127.0.0.1:3000/api/v1/mock/authUrl?state=65a94fe5ae649c64621697065b541b1a\",\"response\":{\"statusCode\":200,\"headers\":{\"x-request-id\":\"9c1c100a-310b-43c2-ae23-b32729cb6acd\",\"traceparent\":\"00-4ae09534d3b8f96d8fe0ed78309baff6-02b10a019917afc4-01\",\"x-correlationid\":\"9c1c100a-310b-43c2-ae23-b32729cb6acd\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"authUrl\\\":\\\"http://localhost:9000/oauth/authorize?response_type=code&client_id=debugger&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Fauth%2FloginWithMockCallback.html&scope=openid%20somescope&state=65a94fe5ae649c64621697065b541b1a&identity_provider=MockOAuth2Server\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:16.738Z","msg":"[BROWSER CONSOLE log]: Status message: Handing off to http://localhost:9000/oauth/authorize?response_type=code&client_id=debugger&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Fauth%2FloginWithMockCallback.html&scope=openid%20somescope&state=65a94fe5ae649c64621697065b541b1a&identity_provider=MockOAuth2Server Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:16.739Z","msg":"[BROWSER CONSOLE log]: Redirecting to navikt/mock-oauth2-server"}
[http-simulator] GET /oauth/authorize?response_type=code&client_id=debugger&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Fauth%2FloginWithMockCallback.html&scope=openid%20somescope&state=65a94fe5ae649c64621697065b541b1a&identity_provider=MockOAuth2Server
[http-simulator:local-oauth] GET /oauth/authorize for client_id=debugger
[USER INTERACTION] Filling: input[name="username"] with value: "user" - Entering username
[USER INTERACTION] Filling: textarea[name="claims"] with value: "{"email":"user@example.com"}" - Entering identity claims
[USER INTERACTION] Clicking: input[type="submit"][value="Sign-in"] - Submitting sign-in form
[http-simulator] POST /oauth/authorize
[http-simulator:local-oauth] POST /oauth/authorize for username=user
[http-simulator:local-oauth] Redirecting to http://localhost:3000/auth/loginWithMockCallback.html?code=a77da29f2c3f4bec8d0302eabad46bdc&state=65a94fe5ae649c64621697065b541b1a
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.676Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.676Z\",\"msg\":\"HTTP GET /auth/loginWithMockCallback.html?code=a77da29f2c3f4bec8d0302eabad46bdc&state=65a94fe5ae649c64621697065b541b1a\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.769Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.762Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.764Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.765Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.766Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.772Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.771Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.771Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.773Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.772Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.773Z\",\"msg\":\"HTTP GET /widgets/loading-spinner.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.802Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.792Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.804Z","msg":"[BROWSER CONSOLE log]: Authentication callback received with code: a77da29f2c3f4bec8d0302eabad46bdc"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.807Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.804Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.804Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.805Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.806Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.809Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.809Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.811Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.810Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.810Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.812Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.811Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.822Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.822Z\",\"msg\":\"HTTP POST /api/v1/mock/token\"}"}
[http-simulator] POST /default/token
[http-simulator:local-oauth] POST /default/token grant_type=authorization_code
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.873Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.873Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.877Z","msg":"[BROWSER CONSOLE log]: Received tokens from mock {\"access_token\":\"eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJzdWIiOiJ1c2VyIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIiwiYXVkIjpbImRlYnVnZ2VyIl0sInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsIm5vbmNlIjoiNTY3OCIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo5MDAwL2RlZmF1bHQiLCJpYXQiOjE3NzAxNTAxOTgsIm5iZiI6MTc3MDE1MDE5OCwiZXhwIjoxNzcwMTUzNzk4LCJqdGkiOiJjMmI0YWY1Mi03YTdmLTRjZTgtOTI3Ni00YTdiNTQ1NzRkNDQifQ.\",\"id_token\":\"eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJzdWIiOiJ1c2VyIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIiwiYXVkIjpbImRlYnVnZ2VyIl0sInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsIm5vbmNlIjoiNTY3OCIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo5MDAwL2RlZmF1bHQiLCJpYXQiOjE3NzAxNTAxOTgsIm5iZiI6MTc3MDE1MDE5OCwiZXhwIjoxNzcwMTUzNzk4LCJqdGkiOiJjMmI0YWY1Mi03YTdmLTRjZTgtOTI3Ni00YTdiNTQ1NzRkNDQifQ.\",\"token_type\":\"Bearer\",\"expires_in\":3600,\"scope\":\"openid somescope\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.878Z","msg":"[BROWSER CONSOLE log]: Received id_token from mock {\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.878Z","msg":"[BROWSER CONSOLE log]: User authenticated successfully using mock: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.879Z","msg":"[BROWSER CONSOLE log]: MFA detected from mock IdP: [mfa, pwd] Stored metadata: {type: OTHER, timestamp: 2026-02-03T20:23:18.876Z, uniqueReference: 56b3d973-5ee7-4757-846b-02a20cd864ce}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.879Z","msg":"[BROWSER CONSOLE log]: Status message: Authenticated successfully. Fetching bundles... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.879Z","msg":"[BROWSER CONSOLE log]: Status message: Authenticated successfully. Redirecting... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.884Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.884Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.908Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.895Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.911Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.910Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.910Z\",\"msg\":\"HTTP GET /developer-mode.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.912Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.911Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.911Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.911Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.913Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.912Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.916Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.915Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.916Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.936Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.932Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.933Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.933Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.933Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.934Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.934Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.937Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.941Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.939Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.940Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.941Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.947Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.947Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.948Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.949Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.955Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.957Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.954Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:18.954Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/services/subHasher.js\",\"time\":\"2026-02-03T20:23:18.955Z\",\"message\":\"Using USER_SUB_HASH_SALT from environment (local dev/test)\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:18.956Z\",\"requestId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:18.956Z\",\"requestId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:18.956Z\",\"requestId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:18.956Z\",\"requestId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.958Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:18.964Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:18.957Z\",\"requestId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:18.958Z\",\"requestId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:18.958Z\",\"requestId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:18.963Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:19.049Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:19.049Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:19.049Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:19.049Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:19.050Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:19.049Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:19.050Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:19.050Z\",\"requestId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:19.050Z\",\"requestId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:19.050Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:19.050Z\",\"requestId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:19.050Z\",\"requestId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:19.050Z\",\"requestId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:19.051Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:19.050Z\",\"requestId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:19.051Z\",\"requestId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:19.068Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:19.068Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:19.097Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:19.097Z\",\"requestId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:19.098Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:19.097Z\",\"requestId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:19.098Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:19.098Z\",\"requestId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:19.103Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:19.103Z\",\"requestId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:19.103Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:19.103Z\",\"requestId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"d0b7cfe8-c7b4-4302-bf11-ed0c3a672331\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"test\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":0}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:19.105Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:19.105Z\",\"requestId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:19.105Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:19.105Z\",\"requestId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:19.105Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:19.105Z\",\"requestId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:19.112Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:19.110Z\",\"requestId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:19.110Z\",\"requestId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"31b1f007-4f61-4fa0-b60c-58c976a5b0c4\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"test\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":0}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:19.113Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:19.113Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
Checking home page...
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:20.433Z","msg":"[BROWSER CONSOLE log]: [Mock MFA] Injected MFA metadata: {type: TOTP, timestamp: 2026-01-08T00:09:01Z, uniqueReference: test-mfa-1770150200429}"}
[Mock MFA] Injected: type=TOTP, timestamp=2026-01-08T00:09:01Z, ref=test-mfa-1770150200429
CloudWatch RUM analytics consent dialog is visible, accepting...
[USER INTERACTION] Clicking: button:has-text("Accept") - Accept CloudWatch RUM consent
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:20.706Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:20.707Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:20.707Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:20.708Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:20.737Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:20.737Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
Navigating to Bundles via main navigation...
[USER INTERACTION] Clicking: nav.main-nav a:has-text('Bundles') - Clicking Bundles in main navigation
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.059Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.059Z\",\"msg\":\"HTTP GET /bundles.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.084Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.073Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.073Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.074Z\",\"msg\":\"HTTP GET /developer-mode.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.091Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.086Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.086Z\",\"msg\":\"HTTP GET /lib/bundle-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.087Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.088Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.088Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.088Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.090Z\",\"msg\":\"HTTP GET /widgets/loading-spinner.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.106Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.092Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.093Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.112Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.108Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.108Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.109Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.109Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.110Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.110Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.117Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.113Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.115Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.115Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.120Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.119Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:21.120Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.122Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:21.120Z\",\"requestId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"correlationId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"authorization\":\"[TOKEN]\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua-mobile\":\"?0\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/bundles.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:21.120Z\",\"requestId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"correlationId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:21.120Z\",\"requestId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"correlationId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:21.120Z\",\"requestId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"correlationId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:21.121Z\",\"requestId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"correlationId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:21.121Z\",\"requestId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"correlationId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:21.121Z\",\"requestId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"correlationId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.125Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.125Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.125Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.125Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.125Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.131Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.131Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.133Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.134Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:21.129Z\",\"requestId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"correlationId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:21.129Z\",\"requestId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"correlationId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:21.129Z\",\"requestId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"correlationId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":0}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:21.131Z\",\"requestId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"correlationId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:21.131Z\",\"requestId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"correlationId\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"x-correlationid\":\"84534df6-d950-43ef-a4a5-19cbb3b0617e\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"test\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":0}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.137Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.135Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.136Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.136Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:21.137Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:21.137Z\",\"requestId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/bundles.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:21.137Z\",\"requestId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.139Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:21.137Z\",\"requestId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:21.137Z\",\"requestId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:21.137Z\",\"requestId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:21.138Z\",\"requestId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:21.138Z\",\"requestId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.144Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.143Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:21.144Z\",\"requestId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.145Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:21.144Z\",\"requestId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:21.144Z\",\"requestId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.148Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:21.145Z\",\"requestId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:21.146Z\",\"requestId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"3e0612e4-2ade-4f81-b254-b2ce57027b20\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"test\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":0}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.152Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.151Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.158Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:21.158Z\",\"msg\":\"HTTP GET /submit.environment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:21.910Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
Ensuring Test bundle is present...
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (1/5)
[polling to ensure present]: Test bundle still not present.
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (2/5)
[polling to ensure present]: Test bundle still not present.
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (3/5)
[polling to ensure present]: Test bundle still not present.
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (4/5)
[polling to ensure present]: Test bundle still not present.
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (5/5)
[polling to ensure present]: Test bundle still not present.
"Request Test" button not visible (on-pass bundle), using pass API for fresh grant...
Creating and redeeming pass for bundle test...
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.454Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.453Z\",\"msg\":\"HTTP POST /api/v1/pass/admin\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.455Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/emailHash.js\",\"time\":\"2026-02-03T20:23:28.455Z\",\"message\":\"Using EMAIL_HASH_SECRET from environment (local dev/test)\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.456Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:28.456Z\",\"requestId\":\"2b23e421-19fe-4328-a0bc-29205756a6e1\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2b23e421-19fe-4328-a0bc-29205756a6e1\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/pass/admin\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"cognito:username\":\"test\",\"email\":\"[EMAIL]\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/pass/admin\"}},\"path\":\"/api/v1/pass/admin\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"103\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"2b23e421-19fe-4328-a0bc-29205756a6e1\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"content-type\":\"application/json\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/bundles.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"passTypeId\\\":\\\"test\\\",\\\"bundleId\\\":\\\"test\\\",\\\"validityPeriod\\\":\\\"P1D\\\",\\\"maxUses\\\":1,\\\"createdBy\\\":\\\"behaviour-test\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.456Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/passAdminPost.js\",\"time\":\"2026-02-03T20:23:28.456Z\",\"requestId\":\"2b23e421-19fe-4328-a0bc-29205756a6e1\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2b23e421-19fe-4328-a0bc-29205756a6e1\",\"message\":\"Creating admin pass\",\"passTypeId\":\"test\",\"bundleId\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.457Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbPassRepository.js\",\"time\":\"2026-02-03T20:23:28.457Z\",\"requestId\":\"2b23e421-19fe-4328-a0bc-29205756a6e1\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2b23e421-19fe-4328-a0bc-29205756a6e1\",\"message\":\"putPass [table: test-passes-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.457Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbPassRepository.js\",\"time\":\"2026-02-03T20:23:28.457Z\",\"requestId\":\"2b23e421-19fe-4328-a0bc-29205756a6e1\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2b23e421-19fe-4328-a0bc-29205756a6e1\",\"message\":\"Storing pass in DynamoDB\",\"passTypeId\":\"test\",\"bundleId\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.469Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbPassRepository.js\",\"time\":\"2026-02-03T20:23:28.468Z\",\"requestId\":\"2b23e421-19fe-4328-a0bc-29205756a6e1\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2b23e421-19fe-4328-a0bc-29205756a6e1\",\"message\":\"Pass stored in DynamoDB\",\"pk\":\"pass#lathe-swirl-paper-reign\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.469Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/passAdminPost.js\",\"time\":\"2026-02-03T20:23:28.469Z\",\"requestId\":\"2b23e421-19fe-4328-a0bc-29205756a6e1\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2b23e421-19fe-4328-a0bc-29205756a6e1\",\"message\":\"Admin pass created\",\"passTypeId\":\"test\",\"bundleId\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.469Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:28.469Z\",\"requestId\":\"2b23e421-19fe-4328-a0bc-29205756a6e1\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2b23e421-19fe-4328-a0bc-29205756a6e1\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/pass/admin\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"2b23e421-19fe-4328-a0bc-29205756a6e1\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"2b23e421-19fe-4328-a0bc-29205756a6e1\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"code\\\":\\\"lathe-swirl-paper-reign\\\",\\\"bundleId\\\":\\\"test\\\",\\\"passTypeId\\\":\\\"test\\\",\\\"validFrom\\\":\\\"2026-02-03T20:23:28.456Z\\\",\\\"validUntil\\\":\\\"2026-02-04T20:23:28.456Z\\\",\\\"maxUses\\\":1,\\\"restrictedToEmail\\\":false}\"}}"}
Pass creation result: {"ok":true,"code":"lathe-swirl-paper-reign","body":{"code":"lathe-swirl-paper-reign","bundleId":"test","passTypeId":"test","validFrom":"2026-02-03T20:23:28.456Z","validUntil":"2026-02-04T20:23:28.456Z","maxUses":1,"restrictedToEmail":false}}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.572Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.572Z\",\"msg\":\"HTTP POST /api/v1/pass\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.572Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:28.572Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.573Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:28.572Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/pass\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/pass\"}},\"path\":\"/api/v1/pass\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"34\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"content-type\":\"application/json\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/bundles.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"code\\\":\\\"lathe-swirl-paper-reign\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.573Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:28.573Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.573Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbPassRepository.js\",\"time\":\"2026-02-03T20:23:28.573Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"redeemPass [table: test-passes-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.584Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbPassRepository.js\",\"time\":\"2026-02-03T20:23:28.584Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"Pass redeemed in DynamoDB\",\"pk\":\"pass#lathe-swirl-paper-reign\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.585Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T20:23:28.584Z\",\"requestId\":null,\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"grantBundle entry\",\"userId\":\"user\",\"requestedBundle\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.585Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:28.585Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.585Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:28.585Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.589Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:28.589Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.589Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:28.589Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.592Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T20:23:28.592Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"Loaded catalog bundle:\",\"bundleId\":\"test\",\"catalogBundle\":{\"id\":\"test\",\"name\":\"Test\",\"levelName\":\"Test\",\"enable\":\"on-pass\",\"hidden\":true,\"allocation\":\"on-request\",\"timeout\":\"P1D\",\"tokensGranted\":10}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.592Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T20:23:28.592Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"[Catalog bundle] Bundle requires manual allocation, proceeding:\",\"requestedBundle\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.593Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T20:23:28.592Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"[Catalog bundle] No cap defined for bundle:\",\"requestedBundle\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.593Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T20:23:28.593Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"Granting bundle to user:\",\"userId\":\"user\",\"requestedBundle\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.593Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T20:23:28.593Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"New bundle details:\",\"newBundle\":{\"bundleId\":\"test\",\"expiry\":\"2026-02-04\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.593Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T20:23:28.593Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"Updated user bundles:\",\"userId\":\"user\",\"currentBundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.594Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:28.594Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"putBundle [table: test-bundle-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.594Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:28.594Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"Storing bundle\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"userId\":\"user\",\"bundle\":{\"bundleId\":\"test\",\"expiry\":\"2026-02-04\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.594Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:28.594Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"Storing bundle in DynamoDB as item\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"item\":{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T20:23:28.594Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.597Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:28.597Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"Bundle stored in DynamoDB as item\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"item\":{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T20:23:28.594Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.597Z","msg":"[http-stdout]: {\"_aws\":{\"Timestamp\":1770150208597,\"CloudWatchMetrics\":[{\"Namespace\":\"Submit/BundleCapacity\",\"Dimensions\":[[\"bundleId\"]],\"Metrics\":[{\"Name\":\"BundleGranted\",\"Unit\":\"Count\"}]}]},\"bundleId\":\"test\",\"BundleGranted\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.597Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T20:23:28.597Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"Bundle granted to user:\",\"userId\":\"user\",\"newBundle\":{\"bundleId\":\"test\",\"expiry\":\"2026-02-04\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null}}\n{\"level\":30,\"source\":\"app/functions/account/passPost.js\",\"time\":\"2026-02-03T20:23:28.597Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"Pass redeemed and bundle granted\",\"code\":\"lathe-swirl-paper-reign\",\"bundleId\":\"test\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.598Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:28.597Z\",\"requestId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/pass\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"454a5cf0-dd45-4790-abe6-a8ad17448e63\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"redeemed\\\":true,\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04\\\",\\\"grantStatus\\\":\\\"granted\\\"}\"}}"}
Pass redemption result: {"redeemed":true,"bundleId":"test","expiry":"2026-02-04","grantStatus":"granted"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.721Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.721Z\",\"msg\":\"HTTP GET /bundles.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.746Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.745Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.746Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.747Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.747Z\",\"msg\":\"HTTP GET /developer-mode.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.748Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.747Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.749Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.749Z\",\"msg\":\"HTTP GET /lib/bundle-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.749Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.749Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.750Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.750Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.751Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.751Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.758Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.754Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.756Z\",\"msg\":\"HTTP GET /widgets/loading-spinner.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.768Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.759Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.760Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.780Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.769Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.784Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.782Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.783Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.783Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.784Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.784Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.787Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.784Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.789Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.788Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.789Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.794Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.792Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.798Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.798Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.798Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.799Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.799Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.812Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.812Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.815Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.818Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.808Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:28.809Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:28.810Z\",\"requestId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/bundles.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:28.810Z\",\"requestId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:28.810Z\",\"requestId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:28.810Z\",\"requestId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:28.810Z\",\"requestId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:28.811Z\",\"requestId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:28.811Z\",\"requestId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.822Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.821Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.821Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.822Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.824Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.822Z\",\"msg\":\"HTTP GET /submit.environment-name.txt\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:28.822Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:28.823Z\",\"requestId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/bundles.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:28.823Z\",\"requestId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:28.823Z\",\"requestId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:28.823Z\",\"requestId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:28.823Z\",\"requestId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:28.823Z\",\"requestId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:28.824Z\",\"requestId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.828Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:28.828Z\",\"requestId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.828Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:28.828Z\",\"requestId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:28.828Z\",\"requestId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.832Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:28.831Z\",\"requestId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.832Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:28.832Z\",\"requestId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"06bdbde0-355f-4f3f-a101-5b6864259478\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.840Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:28.838Z\",\"requestId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:28.838Z\",\"requestId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:28.838Z\",\"requestId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.845Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:28.840Z\",\"requestId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:28.840Z\",\"requestId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"aca99d7b-dd8e-4c69-a825-cb6c9dd9e63e\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:28.848Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:28.848Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
Returning to home via home icon...
[USER INTERACTION] Clicking: .home-link - Home icon
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.811Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.810Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.834Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.830Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.831Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.832Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.832Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.832Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.833Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.836Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.835Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.839Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.838Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.842Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.840Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.864Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.864Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.863Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.864Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.866Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.865Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.866Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.866Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.866Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.866Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.867Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.867Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.870Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.870Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.870Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.872Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.871Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.878Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.881Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.881Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.881Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.882Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.882Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.888Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.888Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.890Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.890Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.886Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:29.887Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:29.887Z\",\"requestId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:29.887Z\",\"requestId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:29.887Z\",\"requestId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:29.887Z\",\"requestId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:29.887Z\",\"requestId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:29.887Z\",\"requestId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:29.888Z\",\"requestId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.893Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.892Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.892Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.894Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.893Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:29.893Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:29.894Z\",\"requestId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:29.894Z\",\"requestId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:29.894Z\",\"requestId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:29.894Z\",\"requestId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.896Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:29.894Z\",\"requestId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:29.895Z\",\"requestId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:29.895Z\",\"requestId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.899Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:29.898Z\",\"requestId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:29.898Z\",\"requestId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:29.898Z\",\"requestId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:29.899Z\",\"requestId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:29.899Z\",\"requestId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"f701bbd9-c2d4-41da-bed7-9925aa8bf8c6\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.902Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:29.901Z\",\"requestId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:29.901Z\",\"requestId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:29.901Z\",\"requestId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.906Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:29.903Z\",\"requestId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:29.903Z\",\"requestId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"c85384a9-54e9-4070-b19b-068a13222418\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.913Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.911Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:29.919Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:29.918Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:30.618Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:30.626Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:30.626Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:30.627Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:30.626Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:30.627Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:30.627Z\",\"requestId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:30.627Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:30.627Z\",\"requestId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:30.627Z\",\"requestId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:30.627Z\",\"requestId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:30.627Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:30.627Z\",\"requestId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:30.627Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:30.627Z\",\"requestId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:30.627Z\",\"requestId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:30.630Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:30.629Z\",\"requestId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:30.630Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:30.630Z\",\"requestId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:30.630Z\",\"requestId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:30.630Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:30.630Z\",\"requestId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:30.631Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:30.630Z\",\"requestId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"a69fff98-7138-4fc2-b799-faa09bb5017d\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
[Token check] Tokens before submission: 10
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:30.635Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: button:has-text('Submit VAT (HMRC Sandbox)') - Starting VAT return submission
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.442Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.442Z\",\"msg\":\"HTTP GET /hmrc/vat/submitVat.html?hmrcAccount=sandbox\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.473Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.457Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.457Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.478Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.475Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.475Z\",\"msg\":\"HTTP GET /lib/test-data-generator.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.476Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.477Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.477Z\",\"msg\":\"HTTP GET /lib/utils/obligation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.480Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.478Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.483Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.480Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.481Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.482Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.482Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.503Z","msg":"[BROWSER CONSOLE log]: JS block finished loading."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.507Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.502Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.503Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.504Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.504Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.505Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.505Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.510Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.508Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.509Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.509Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.514Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.513Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.520Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.520Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.524Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.525Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.526Z","msg":"[BROWSER CONSOLE log]: JS block started loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.530Z","msg":"[BROWSER CONSOLE log]: OAuth callback handler (no action taken)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.530Z","msg":"[BROWSER CONSOLE log]: JS block finished loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.531Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.532Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.530Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.530Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.531Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:31.531Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:31.531Z\",\"requestId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:31.531Z\",\"requestId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:31.531Z\",\"requestId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:31.531Z\",\"requestId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:31.531Z\",\"requestId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:31.531Z\",\"requestId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:31.532Z\",\"requestId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.534Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:31.533Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:31.533Z\",\"requestId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:31.533Z\",\"requestId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:31.533Z\",\"requestId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:31.533Z\",\"requestId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:31.533Z\",\"requestId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:31.533Z\",\"requestId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:31.534Z\",\"requestId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.535Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:31.535Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.536Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:31.536Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.536Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:31.536Z\",\"requestId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"content-type\":\"application/json\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.536Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:31.536Z\",\"requestId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:31.536Z\",\"requestId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.536Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:31.536Z\",\"requestId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:31.536Z\",\"requestId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.536Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:31.536Z\",\"requestId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.537Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:31.536Z\",\"requestId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.538Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:31.538Z\",\"requestId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.538Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:31.538Z\",\"requestId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.538Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:31.538Z\",\"requestId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.539Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:31.539Z\",\"requestId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.539Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:31.539Z\",\"requestId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"6bb4eb1b-164d-4339-9183-d028d7fa32e7\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.540Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:31.540Z\",\"requestId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.541Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:31.540Z\",\"requestId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:31.540Z\",\"requestId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.541Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:31.541Z\",\"requestId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.542Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:31.541Z\",\"requestId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"25836544-a05a-4a73-b341-5fac1005f650\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.544Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:31.544Z\",\"requestId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:31.544Z\",\"requestId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.545Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:31.544Z\",\"requestId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.545Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:31.545Z\",\"requestId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:31.545Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:31.545Z\",\"requestId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"963c3e47-44df-409c-9da2-85f358c95050\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:32.721Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Filling: #vatNumber with value: "711173646" - Entering VAT number
Set period dates: 2017-01-01 to 2017-03-31
[USER INTERACTION] Filling: #vatDueSales with value: "1000.00" - Entering VAT due on sales (Box 1)
[USER INTERACTION] Filling: #vatDueAcquisitions with value: "0.00" - Entering VAT due on acquisitions (Box 2)
[USER INTERACTION] Filling: #vatReclaimedCurrPeriod with value: "0.00" - Entering VAT reclaimed (Box 4)
[USER INTERACTION] Filling: #totalValueSalesExVAT with value: "5000" - Entering total sales ex VAT (Box 6)
[USER INTERACTION] Filling: #totalValuePurchasesExVAT with value: "0" - Entering total purchases ex VAT (Box 7)
[USER INTERACTION] Filling: #totalValueGoodsSuppliedExVAT with value: "0" - Entering goods supplied to EU (Box 8)
[USER INTERACTION] Filling: #totalAcquisitionsExVAT with value: "0" - Entering acquisitions from EU (Box 9)
Checked declaration checkbox
Enabled developer mode for test scenario
Developer section visible (controlled by global developer mode)
Checked runFraudPreventionHeaderValidation checkbox
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:36.273Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
Checked allowSandboxObligations checkbox
[USER INTERACTION] Focusing: #submitBtn - the Submit button
[USER INTERACTION] Clicking: #submitBtn - Submitting VAT form
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:37.522Z","msg":"[BROWSER CONSOLE log]: Status message: Initiating HMRC authentication... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:37.523Z","msg":"[BROWSER CONSOLE log]: Stored pending request and current activity: {\"vatNumber\":\"[VRN]\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":5000,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0,\"finalised\":true,\"testScenario\":\"\",\"runFraudPreventionHeaderValidation\":true,\"allowSandboxObligations\":true} /hmrc/vat/submitVat.html sandbox"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:37.523Z","msg":"[BROWSER CONSOLE log]: Using client-side generated HMRC Auth URL: http://localhost:9000/oauth/authorize?response_type=code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Factivities%2FsubmitVatCallback.html&scope=write%3Avat%20read%3Avat&state=7f089b36a3984520909e6b334543a76f"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:37.524Z","msg":"[BROWSER CONSOLE log]: Current activity set to: /hmrc/vat/submitVat.html"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:37.524Z","msg":"[BROWSER CONSOLE log]: Status message: Redirecting to HMRC for authentication at http://localhost:9000/oauth/authorize?response_type=code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Factivities%2FsubmitVatCallback.html&scope=write%3Avat%20read%3Avat&state=7f089b36a3984520909e6b334543a76f... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:37.524Z","msg":"[BROWSER CONSOLE log]: Page transition initiated: Redirecting to HMRC OAuth URL http://localhost:9000/oauth/authorize?response_type=code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Factivities%2FsubmitVatCallback.html&scope=write%3Avat%20read%3Avat&state=7f089b36a3984520909e6b334543a76f"}
[http-simulator] GET /oauth/authorize?response_type=code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Factivities%2FsubmitVatCallback.html&scope=write%3Avat%20read%3Avat&state=7f089b36a3984520909e6b334543a76f
[http-simulator:hmrc-oauth] GET /oauth/authorize for client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV, autoGrant=undefined
[USER INTERACTION] Clicking: Continue button - Continuing with HMRC permission
[USER INTERACTION] Clicking: [Locator] - Continue
[http-simulator] POST /oauth/authorize
[http-simulator:hmrc-oauth] POST /oauth/authorize for client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV, step=sign-in-choice
[http-simulator:hmrc-oauth] Showing sign-in choice page
[USER INTERACTION] Clicking: Sign in to HMRC button - Starting HMRC authentication
[USER INTERACTION] Clicking: [Locator] - Sign in to the HMRC online service
[http-simulator] POST /oauth/authorize
[http-simulator:hmrc-oauth] POST /oauth/authorize for client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV, step=credentials
[http-simulator:hmrc-oauth] Showing credentials page
[USER INTERACTION] Filling: #userId with value: "235992622910" - Entering HMRC user ID
[USER INTERACTION] Filling: #password with value: "OvknASkGWCgF" - Entering HMRC password
[USER INTERACTION] Clicking: Sign in button - Submitting HMRC credentials
[USER INTERACTION] Clicking: [Locator] - Sign in
[http-simulator] POST /oauth/authorize
[http-simulator:hmrc-oauth] POST /oauth/authorize for client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV, step=grant-permission
[http-simulator:hmrc-oauth] Showing grant permission page
[USER INTERACTION] Clicking: #givePermission - Give permission
[http-simulator] POST /oauth/authorize
[http-simulator:hmrc-oauth] POST /oauth/authorize for client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV, step=complete
[http-simulator:hmrc-oauth] Grant permission complete, generating code
[http-simulator:hmrc-oauth] Granting access, redirecting to http://localhost:3000/activities/submitVatCallback.html?code=3f21757432674fc19b79412b5f57f59f&state=7f089b36a3984520909e6b334543a76f
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.214Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.214Z\",\"msg\":\"HTTP GET /activities/submitVatCallback.html?code=3f21757432674fc19b79412b5f57f59f&state=7f089b36a3984520909e6b334543a76f\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.330Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.329Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.331Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.330Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.333Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.332Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.334Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.334Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.336Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.336Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.337Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.336Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.339Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.339Z\",\"msg\":\"HTTP GET /widgets/loading-spinner.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.340Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.339Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.369Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.348Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.373Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.371Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.371Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.372Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.374Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.374Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.374Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.376Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.376Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.378Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.377Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.379Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.379Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.386Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.387Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.388Z","msg":"[BROWSER CONSOLE log]: OAuth callback handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.388Z","msg":"[BROWSER CONSOLE log]: Page transition initiated: Clearing URL parameters"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.389Z","msg":"[BROWSER CONSOLE log]: OAuth callback handler (normal completion)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.389Z","msg":"[BROWSER CONSOLE log]: Status message: Exchanging authorization code for access token... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.389Z","msg":"[BROWSER CONSOLE log]: Exchanging token. Remote call initiated: POST /api/v1/hmrc/token ++ Body: {\"code\":\"3f21757432674fc19b79412b5f57f59f\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.397Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.399Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.400Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.402Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.400Z\",\"msg\":\"HTTP POST /api/v1/hmrc/token\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:44.400Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:44.401Z\",\"requestId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/token\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/token\"}},\"path\":\"/api/v1/hmrc/token\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"43\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"content-type\":\"application/json\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/activities/submitVatCallback.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"code\\\":\\\"3f21757432674fc19b79412b5f57f59f\\\"}\"}}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcTokenPost.js\",\"time\":\"2026-02-03T20:23:44.401Z\",\"requestId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"message\":\"Exchanging authorization code for HMRC access token\"}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcTokenPost.js\",\"time\":\"2026-02-03T20:23:44.401Z\",\"requestId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"msg\":\"Retrieving HMRC client secret from arn \"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.402Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcTokenPost.js\",\"time\":\"2026-02-03T20:23:44.401Z\",\"requestId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"msg\":\"Secret retrieved from override and cached\"}"}
{"level":50,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.403Z","msg":"[http-stderr]: {\"level\":50,\"time\":\"2026-02-03T20:23:44.403Z\",\"msg\":\"SENSITIVE DATA DETECTED in log output - credentials were present and have been redacted\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.403Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:44.403Z\",\"requestId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"message\":\"Request to POST http://localhost:9000/oauth/token\",\"url\":\"http://localhost:9000/oauth/token\",\"headers\":{\"Content-Type\":\"application/x-www-form-urlencoded\",\"x-request-id\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"59471e33-d620-4b20-9137-d1699a590d0e\"},\"body\":\"grant_type=authorization_code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&[SECRET]&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Factivities%2FsubmitVatCallback.html&code=3f21757432674fc19b79412b5f57f59f\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.403Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:44.403Z\",\"requestId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"message\":\"Performing HTTP POST for token exchange\",\"providerUrl\":\"http://localhost:9000/oauth/token\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.406Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.406Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.406Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.406Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.407Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:44.407Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.408Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:44.408Z\",\"requestId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/activities/submitVatCallback.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.408Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:44.408Z\",\"requestId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:44.408Z\",\"requestId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:44.408Z\",\"requestId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.409Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:44.408Z\",\"requestId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.409Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.409Z\",\"requestId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.409Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.409Z\",\"requestId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
[http-simulator] POST /oauth/token
[http-simulator:hmrc-oauth] POST /oauth/token grant_type=authorization_code
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.418Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:44.416Z\",\"requestId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"message\":\"HTTP POST response received with status and duration\",\"status\":200,\"duration\":13}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.418Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:44.418Z\",\"requestId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/oauth/token\",\"method\":\"POST\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.423Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.423Z\",\"requestId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.424Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.423Z\",\"requestId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.424Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:44.424Z\",\"requestId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.426Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:44.426Z\",\"requestId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.426Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:44.426Z\",\"requestId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"6d142261-0b0b-4571-976a-a3374a2cd322\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.430Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:44.429Z\",\"requestId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/oauth/token\",\"method\":\"POST\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.430Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:44.429Z\",\"requestId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"message\":\"exchangeClientSecretForAccessToken response\",\"responseStatus\":200,\"responseTokens\":{\"access_token\":\"[REDACTED]\",\"refresh_token\":\"[REDACTED]\",\"expires_in\":14400,\"scope\":\"write:vat read:vat\",\"token_type\":\"bearer\"},\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"tokenType\":\"bearer\",\"scope\":\"write:vat read:vat\",\"expiresIn\":14400,\"hasRefreshToken\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.430Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:44.430Z\",\"requestId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"message\":\"Token exchange succeeded\",\"accessTokenLength\":59,\"hasIdToken\":false,\"hasRefreshToken\":true,\"expiresIn\":14400,\"tokenType\":\"bearer\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.431Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:44.430Z\",\"requestId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/token\",\"response\":{\"statusCode\":200,\"headers\":{\"x-request-id\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"59471e33-d620-4b20-9137-d1699a590d0e\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"accessToken\\\":\\\"mock-hmrc-access-token-ca60729b-527e-42ae-8f99-58ba3c6aa879\\\",\\\"hmrcAccessToken\\\":\\\"mock-hmrc-access-token-ca60729b-527e-42ae-8f99-58ba3c6aa879\\\",\\\"refreshToken\\\":\\\"mock-hmrc-refresh-token-c03f217f-7070-4918-a5f7-931afca2e674\\\",\\\"expiresIn\\\":14400,\\\"tokenType\\\":\\\"bearer\\\"}\"}}"}
{"level":50,"time":"2026-02-03T20:23:44.434Z","msg":"SENSITIVE DATA DETECTED in log output - credentials were present and have been redacted"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.434Z","msg":"[BROWSER CONSOLE log]: Exchanged token. Remote call completed successfully: POST /api/v1/hmrc/token {[SECRET], [SECRET], [SECRET], expiresIn: 14400, tokenType: bearer} mock-hmrc-access-token-ca60729b-527e-42ae-8f99-58ba3c6aa879"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.435Z","msg":"[BROWSER CONSOLE log]: Status message: Obtained Access Token from HMRC... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.435Z","msg":"[BROWSER CONSOLE log]: Current activity found: /hmrc/vat/submitVat.html"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.440Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.440Z\",\"msg\":\"HTTP GET /hmrc/vat/submitVat.html?hmrcAccount=sandbox\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.480Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.458Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.484Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.483Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.484Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.486Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.485Z\",\"msg\":\"HTTP GET /lib/test-data-generator.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.485Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.486Z\",\"msg\":\"HTTP GET /developer-mode.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.487Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.486Z\",\"msg\":\"HTTP GET /lib/utils/obligation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.489Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.489Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.491Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.491Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.492Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.492Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.494Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.494Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.495Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.495Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.527Z","msg":"[BROWSER CONSOLE log]: JS block finished loading."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.531Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.527Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.527Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.528Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.528Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.529Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.529Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.532Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.532Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.535Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.532Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.537Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.535Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.536Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.545Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.545Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.550Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.550Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.552Z","msg":"[BROWSER CONSOLE log]: JS block started loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.554Z","msg":"[BROWSER CONSOLE log]: Restored form draft from 2026-02-03T20:23:35.637Z"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.554Z","msg":"[BROWSER CONSOLE log]: OAuth callback handler (code present, auto-continue)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.554Z","msg":"[BROWSER CONSOLE log]: Retrieved submission data: {vatNumber: [VRN], periodStart: 2017-01-01, periodEnd: 2017-03-31, vatDueSales: 1000, vatDueAcquisitions: 0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.557Z","msg":"[BROWSER CONSOLE log]: Status message: Submitting VAT return to HMRC... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.558Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.553Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.554Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:44.554Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:44.554Z\",\"requestId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:44.555Z\",\"requestId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:44.555Z\",\"requestId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:44.555Z\",\"requestId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:44.555Z\",\"requestId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.555Z\",\"requestId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.555Z\",\"requestId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.558Z","msg":"[BROWSER CONSOLE log]: JS block finished loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.559Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.558Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:44.559Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.563Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:44.559Z\",\"requestId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:44.559Z\",\"requestId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:44.559Z\",\"requestId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:44.559Z\",\"requestId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:44.560Z\",\"requestId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.560Z\",\"requestId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.560Z\",\"requestId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.567Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.563Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:44.563Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:44.564Z\",\"requestId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"content-type\":\"application/json\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:44.564Z\",\"requestId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:44.564Z\",\"requestId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:44.564Z\",\"requestId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:44.564Z\",\"requestId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.565Z\",\"requestId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.565Z\",\"requestId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.568Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.569Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.568Z\",\"requestId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.568Z\",\"requestId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:44.569Z\",\"requestId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.570Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:44.570Z\",\"requestId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.571Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:44.571Z\",\"requestId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"e316d851-3afe-437a-ac3b-2ff2748c55a9\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.572Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.572Z\",\"requestId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.572Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.572Z\",\"requestId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:44.572Z\",\"requestId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.574Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:44.574Z\",\"requestId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.575Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:44.574Z\",\"requestId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"9a6f9646-b079-49ee-9362-16a09b2a1b97\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.577Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.577Z\",\"requestId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.577Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.577Z\",\"requestId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:44.577Z\",\"requestId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.578Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:44.578Z\",\"requestId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.578Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:44.578Z\",\"requestId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"dde72ee6-cbd2-480d-a58f-992d233c39c8\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.644Z","msg":"[BROWSER CONSOLE log]: Submitting VAT. Remote call initiated: POST /api/v1/hmrc/vat/return ++ Body: {\"vatNumber\":\"[VRN]\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":5000,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0,\"finalised\":true,\"accessToken\":\"mock-hmrc-access-token-ca60729b-527e-42ae-8f99-58ba3c6aa879\",\"runFraudPreventionHeaderValidation\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.648Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:44.648Z\",\"msg\":\"HTTP POST /api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.648Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:44.648Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.649Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:44.649Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"434\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:23:44.642Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"3178f14f-236c-4169-bd93-a746f5ae6a42\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-initial-request\":\"true\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"25b7bb60-4788-4e0b-ab85-61462c86e2f7\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"vatNumber\\\":\\\"[VRN]\\\",\\\"periodStart\\\":\\\"2017-01-01\\\",\\\"periodEnd\\\":\\\"2017-03-31\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true,\\\"accessToken\\\":\\\"mock-hmrc-access-token-ca60729b-527e-42ae-8f99-58ba3c6aa879\\\",\\\"runFraudPreventionHeaderValidation\\\":true}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.649Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:44.649Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.649Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:44.649Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Extracting user information from event\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.649Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:44.649Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.650Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:44.650Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"434\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:23:44.642Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"3178f14f-236c-4169-bd93-a746f5ae6a42\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-initial-request\":\"true\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"25b7bb60-4788-4e0b-ab85-61462c86e2f7\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"vatNumber\\\":\\\"[VRN]\\\",\\\"periodStart\\\":\\\"2017-01-01\\\",\\\"periodEnd\\\":\\\"2017-03-31\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true,\\\"accessToken\\\":\\\"mock-hmrc-access-token-ca60729b-527e-42ae-8f99-58ba3c6aa879\\\",\\\"runFraudPreventionHeaderValidation\\\":true}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.651Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:44.651Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.651Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.651Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.651Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.651Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.655Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.655Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.655Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.655Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.656Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:44.655Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T20:23:28.594Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.656Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:44.656Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\",\"requiredBundleIds\":[\"test\",\"day-guest\",\"invited-guest\",\"resident-guest\",\"resident-pro-comp\",\"resident-pro\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.656Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:44.656Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.657Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/lib/buildFraudHeaders.js\",\"time\":\"2026-02-03T20:23:44.657Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"No public client IP detected in X-Forwarded-For\",\"xff\":\"\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.658Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:44.658Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"accessTokenPrefix\":\"mock-hmr...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.658Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:23:44.658Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"Checking for test scenario\":null}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.658Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:23:44.658Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Resolving periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vatNumber\":\"[VRN]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.659Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:23:44.658Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"msg\":\"Validating fraud prevention headers for HMRC API request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.659Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:44.659Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Validating fraud prevention headers\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
[http-simulator] GET /test/fraud-prevention-headers/validate
[http-simulator:fraud-headers] GET /test/fraud-prevention-headers/validate
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.665Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:44.664Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"VALID_WITH_WARNINGS\",\"validationMessage\":\"Headers valid with warnings\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.665Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:44.664Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]},{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-client-public-port\"]}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.665Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:44.665Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.669Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:44.668Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.669Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:44.669Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Request to GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"Gov-Client-Device-ID\":\"3178f14f-236c-4169-bd93-a746f5ae6a42\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:23:44.642Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"http://localhost:9000\"}}"}
[http-simulator] GET /organisations/vat/711173646/obligations?from=2017-01-01&to=2017-03-31&status=O
[http-simulator:vat-obligations] GET /organisations/vat/711173646/obligations from=2017-01-01 to=2017-03-31
[http-simulator:scenarios] Using default obligations with random periodKey: 21XA
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.673Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:44.672Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Response from GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"status\":200,\"hmrcResponseBody\":{\"obligations\":[{\"periodKey\":\"24OG\",\"start\":\"2017-04-01\",\"end\":\"2017-06-30\",\"due\":\"2017-08-07\",\"status\":\"O\"}]}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.673Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:44.673Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.676Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:44.676Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.676Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:23:44.676Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"allowSandboxObligations: Using first available open obligation with the requested year injected\",\"requestedPeriod\":{\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\"},\"rawPeriodKey\":\"24OG\",\"usedObligation\":\"17OG\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.676Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:23:44.676Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Resolved periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"resolvedPeriodKey\":\"17OG\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.679Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.678Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.679Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.679Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.681Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.681Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.681Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.681Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.681Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.681Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"consumeToken [table: test-bundle-table]\",\"bundleId\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.685Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:44.685Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Token consumed\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"bundleId\":\"test\",\"tokensRemaining\":9}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.685Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/tokenEnforcement.js\",\"time\":\"2026-02-03T20:23:44.685Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Token consumption result\",\"userId\":\"user\",\"activityId\":\"submit-vat-sandbox\",\"bundleId\":\"test\",\"consumed\":true,\"tokensRemaining\":9}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.685Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:23:44.685Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Token consumed for submission\",\"activityId\":\"submit-vat-sandbox\",\"tokensRemaining\":9}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.685Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:23:44.685Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":true}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:23:44.685Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Initiating new processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.686Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:44.686Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Marking request as processing in DynamoDB\",\"userId\":\"user\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.686Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:23:44.686Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-return-post-async-requests-table]\",\"status\":\"processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.686Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:44.686Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Starting async processing locally (no SQS queue URL)\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.686Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:23:44.686Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Validating fraud prevention headers for sandbox account\",\"hmrcAccount\":\"sandbox\",\"runFraudPreventionHeaderValidation\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.686Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:44.686Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Validating fraud prevention headers\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
[http-simulator] GET /test/fraud-prevention-headers/validate
[http-simulator:fraud-headers] GET /test/fraud-prevention-headers/validate
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.688Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:44.688Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Checking persisted request status\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:23:44.688Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-return-post-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.693Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:44.691Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"VALID_WITH_WARNINGS\",\"validationMessage\":\"Headers valid with warnings\"}\n{\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:44.692Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]},{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-client-public-port\"]}]}\n{\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:44.692Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.696Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:23:44.694Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"AsyncRequest not found in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:44.694Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Yielding with HTTP 202 Accepted\",\"location\":\"http://localhost:3000/api/v1/hmrc/vat/return\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:44.695Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"response\":{\"statusCode\":202,\"headers\":{\"Gov-Client-Device-ID\":\"3178f14f-236c-4169-bd93-a746f5ae6a42\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:23:44.642Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"Retry-After\":\"5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"Location\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"message\\\":\\\"Request accepted for processing\\\"}\"}}\n{\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:23:44.695Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.697Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:44.696Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.697Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:23:44.697Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Request to POST http://localhost:9000/organisations/vat/[VRN]/returns\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"Gov-Client-Device-ID\":\"3178f14f-236c-4169-bd93-a746f5ae6a42\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:23:44.642Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"body\":{\"periodKey\":\"17OG\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":5000,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0,\"finalised\":true},\"environment\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.697Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:44.697Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Request to POST http://localhost:9000/organisations/vat/[VRN]/returns\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns\",\"method\":\"POST\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"Gov-Client-Device-ID\":\"3178f14f-236c-4169-bd93-a746f5ae6a42\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:23:44.642Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"body\":\"{\\\"periodKey\\\":\\\"17OG\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true}\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.699Z","msg":"[BROWSER CONSOLE log]: waiting async request [POST /api/v1/hmrc/vat/return] (timeout: 1630000ms)..."}
[http-simulator] POST /organisations/vat/711173646/returns
[http-simulator:vat-returns] POST /organisations/vat/711173646/returns
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.700Z","msg":"[BROWSER CONSOLE log]: Status message: Still processing... (poll #1) Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.701Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:44.701Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Response from POST http://localhost:9000/organisations/vat/[VRN]/returns\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns\",\"status\":201,\"hmrcResponseBody\":{\"processingDate\":\"2026-02-03T20:23:44.700Z\",\"formBundleNumber\":\"351017507640\",\"paymentIndicator\":\"DD\",\"chargeRefNumber\":\"wMnbVPuS5weCJ2vm\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.701Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:44.701Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns\",\"method\":\"POST\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.705Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:44.705Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns\",\"method\":\"POST\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.705Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:23:44.705Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Received HMRC response: {}\",\"httpResult\":{\"hmrcResponse\":{},\"hmrcResponseBody\":{\"processingDate\":\"2026-02-03T20:23:44.700Z\",\"formBundleNumber\":\"351017507640\",\"paymentIndicator\":\"DD\",\"chargeRefNumber\":\"wMnbVPuS5weCJ2vm\"}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.706Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:23:44.706Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"DynamoDB enabled, proceeding with putReceipt [table: test-receipts-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.706Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:23:44.706Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Storing receipt\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"userSub\":\"user\",\"receiptId\":\"2026-02-03T20:23:44.706Z-351017507640\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.706Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:23:44.706Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Storing receipt in DynamoDB as item\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"receiptId\":\"2026-02-03T20:23:44.706Z-351017507640\",\"ttl_datestamp\":\"2033-02-01T20:23:44.706Z\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.710Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:23:44.710Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Receipt stored in DynamoDB as item\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"receiptId\":\"2026-02-03T20:23:44.706Z-351017507640\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.711Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:44.710Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Local async processing completed successfully\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.711Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:44.711Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Marking async request as completed\",\"userSub\":\"user\",\"asyncRequestsTableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.711Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:23:44.711Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-return-post-async-requests-table]\",\"status\":\"completed\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:44.716Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:23:44.716Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.700Z","msg":"[BROWSER CONSOLE log]: re-trying async request [POST /api/v1/hmrc/vat/return] (poll #1, elapsed: 1002ms, timeout: 1630000ms, last status: 202)..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.705Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:45.704Z\",\"msg\":\"HTTP POST /api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.705Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:45.705Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.706Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:45.705Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"434\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:23:44.642Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"3178f14f-236c-4169-bd93-a746f5ae6a42\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"25b7bb60-4788-4e0b-ab85-61462c86e2f7\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"vatNumber\\\":\\\"[VRN]\\\",\\\"periodStart\\\":\\\"2017-01-01\\\",\\\"periodEnd\\\":\\\"2017-03-31\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true,\\\"accessToken\\\":\\\"mock-hmrc-access-token-ca60729b-527e-42ae-8f99-58ba3c6aa879\\\",\\\"runFraudPreventionHeaderValidation\\\":true}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.706Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:45.705Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:45.706Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Extracting user information from event\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.706Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:45.706Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.706Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:45.706Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"434\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:23:44.642Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"3178f14f-236c-4169-bd93-a746f5ae6a42\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"25b7bb60-4788-4e0b-ab85-61462c86e2f7\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"vatNumber\\\":\\\"[VRN]\\\",\\\"periodStart\\\":\\\"2017-01-01\\\",\\\"periodEnd\\\":\\\"2017-03-31\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true,\\\"accessToken\\\":\\\"mock-hmrc-access-token-ca60729b-527e-42ae-8f99-58ba3c6aa879\\\",\\\"runFraudPreventionHeaderValidation\\\":true}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.708Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:45.708Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.708Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:45.708Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.708Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:45.708Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.712Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:45.712Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.712Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:45.712Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:45.712Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T20:23:28.594Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.713Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:45.712Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\",\"requiredBundleIds\":[\"test\",\"day-guest\",\"invited-guest\",\"resident-guest\",\"resident-pro-comp\",\"resident-pro\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.713Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:45.712Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.713Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/lib/buildFraudHeaders.js\",\"time\":\"2026-02-03T20:23:45.713Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"No public client IP detected in X-Forwarded-For\",\"xff\":\"\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.713Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:45.713Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"accessTokenPrefix\":\"mock-hmr...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.713Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:23:45.713Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"Checking for test scenario\":null}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.714Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:23:45.713Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Resolving periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vatNumber\":\"[VRN]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.714Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:23:45.714Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"msg\":\"Validating fraud prevention headers for HMRC API request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.714Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:45.714Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Validating fraud prevention headers\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
[http-simulator] GET /test/fraud-prevention-headers/validate
[http-simulator:fraud-headers] GET /test/fraud-prevention-headers/validate
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.717Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:45.717Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"VALID_WITH_WARNINGS\",\"validationMessage\":\"Headers valid with warnings\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.717Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:45.717Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]},{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-client-public-port\"]}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.718Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:45.717Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.721Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:45.721Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.722Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:45.722Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Request to GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"Gov-Client-Device-ID\":\"3178f14f-236c-4169-bd93-a746f5ae6a42\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:23:44.642Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"http://localhost:9000\"}}"}
[http-simulator] GET /organisations/vat/711173646/obligations?from=2017-01-01&to=2017-03-31&status=O
[http-simulator:vat-obligations] GET /organisations/vat/711173646/obligations from=2017-01-01 to=2017-03-31
[http-simulator:scenarios] Using default obligations with random periodKey: 26W6
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.724Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:45.724Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Response from GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"status\":200,\"hmrcResponseBody\":{\"obligations\":[{\"periodKey\":\"26S2\",\"start\":\"2017-04-01\",\"end\":\"2017-06-30\",\"due\":\"2017-08-07\",\"status\":\"O\"}]}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.724Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:45.724Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.727Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:45.727Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.728Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:23:45.727Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"allowSandboxObligations: Using first available open obligation with the requested year injected\",\"requestedPeriod\":{\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\"},\"rawPeriodKey\":\"26S2\",\"usedObligation\":\"17S2\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.728Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:23:45.728Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Resolved periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"resolvedPeriodKey\":\"17S2\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.728Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:23:45.728Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-return-post-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.732Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:23:45.732Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.732Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:23:45.732Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":false}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:23:45.732Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Found persisted request\",\"status\":\"completed\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.733Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:45.732Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.733Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:45.733Z\",\"requestId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"response\":{\"statusCode\":200,\"headers\":{\"Gov-Client-Device-ID\":\"3178f14f-236c-4169-bd93-a746f5ae6a42\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:23:44.642Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"88c2d846-3436-407d-96a7-d7f5040a0ed5\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"receipt\\\":{\\\"processingDate\\\":\\\"2026-02-03T20:23:44.700Z\\\",\\\"formBundleNumber\\\":\\\"351017507640\\\",\\\"paymentIndicator\\\":\\\"DD\\\",\\\"chargeRefNumber\\\":\\\"wMnbVPuS5weCJ2vm\\\"},\\\"hmrcResponse\\\":{\\\"ok\\\":true,\\\"status\\\":201,\\\"statusText\\\":\\\"Created\\\",\\\"headers\\\":{\\\"access-control-allow-headers\\\":\\\"Content-Type, Authorization, Accept\\\",\\\"access-control-allow-methods\\\":\\\"GET, POST, PUT, DELETE, OPTIONS\\\",\\\"access-control-allow-origin\\\":\\\"*\\\",\\\"connection\\\":\\\"keep-alive\\\",\\\"content-length\\\":\\\"140\\\",\\\"content-type\\\":\\\"application/json; charset=utf-8\\\",\\\"date\\\":\\\"Tue, 03 Feb 2026 20:23:44 GMT\\\",\\\"etag\\\":\\\"W/\\\\\\\"8c-53+i2w9/CbJ0igj6V9UPdXk54H4\\\\\\\"\\\",\\\"keep-alive\\\":\\\"timeout=5\\\",\\\"receipt-id\\\":\\\"2f1a9181-ddd6-4ca3-8329-0ce6de39610a\\\",\\\"receipt-signature\\\":\\\"This has been deprecated - DO NOT USE\\\",\\\"receipt-timestamp\\\":\\\"2026-02-03T20:23:44Z\\\",\\\"x-correlationid\\\":\\\"ea23bdb8-7af3-4d40-bf8e-bba47e2d9dee\\\",\\\"x-powered-by\\\":\\\"Express\\\"}},\\\"hmrcResponseBody\\\":{\\\"processingDate\\\":\\\"2026-02-03T20:23:44.700Z\\\",\\\"formBundleNumber\\\":\\\"351017507640\\\",\\\"paymentIndicator\\\":\\\"DD\\\",\\\"chargeRefNumber\\\":\\\"wMnbVPuS5weCJ2vm\\\"},\\\"periodKey\\\":\\\"17OG\\\",\\\"receiptId\\\":\\\"2026-02-03T20:23:44.706Z-351017507640\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.738Z","msg":"[BROWSER CONSOLE log]: finished async request [POST /api/v1/hmrc/vat/return] (poll #1, elapsed: 1038ms, status: 200)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.739Z","msg":"[BROWSER CONSOLE log]: Status message: VAT return processed Type: success"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.739Z","msg":"[BROWSER CONSOLE log]: Page display transition: Displaying receipt and hiding form {receipt: Object, hmrcResponse: Object, hmrcResponseBody: Object, periodKey: 17OG, receiptId: 2026-02-03T20:23:44.706Z-351017507640}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.741Z","msg":"[BROWSER CONSOLE log]: Continue submission handler (success, session storage cleared)"}
[Test] Captured resolved periodKey from response: 17OG
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.744Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:45.744Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.745Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:45.744Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.745Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:45.745Z\",\"requestId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"content-type\":\"application/json\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.745Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:45.745Z\",\"requestId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:45.745Z\",\"requestId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:45.745Z\",\"requestId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:45.745Z\",\"requestId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.746Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:45.745Z\",\"requestId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.746Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:45.745Z\",\"requestId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.750Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:45.750Z\",\"requestId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.750Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:45.750Z\",\"requestId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:45.750Z\",\"requestId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.752Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:45.751Z\",\"requestId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:45.752Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:45.752Z\",\"requestId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"768701f8-fed9-4a62-ad9b-0ff2b3741129\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
Waiting for VAT submission to complete and receipt to be displayed...
Current URL: http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox
Page title: Submit VAT Return - DIY Accounting
Body element exists: true
Main content element exists: true
Receipt element exists: true
Receipt element style: display: block;
Form element exists: true
Form element style: display: none;
Receipt element visible: true
[waitForSuccessOrError] SUCCESS: "VAT submission receipt" detected after 0s (poll #1)
formBundleNumber validated: 351017507640
chargeRefNumber validated: wMnbVPuS5weCJ2vm
processingDate validated: 3 February 2026 at 21:23 (parsed as 2026-02-03T20:23:00.000Z)
VAT submission flow completed successfully with validated receipt fields
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:48.958Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:48.955Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:48.961Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:48.960Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:48.960Z\",\"requestId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:48.961Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:48.961Z\",\"requestId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:48.961Z\",\"requestId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:48.961Z\",\"requestId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:48.961Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:48.961Z\",\"requestId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:48.961Z\",\"requestId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:48.962Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:48.961Z\",\"requestId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:48.974Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:48.968Z\",\"requestId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:48.968Z\",\"requestId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:48.969Z\",\"requestId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:48.970Z\",\"requestId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:48.970Z\",\"requestId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"a54645f9-d2d8-49a3-937c-7e33c78820ad\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
[Token check] Tokens after submission: 9
Navigating to Receipts via main navigation...
[USER INTERACTION] Clicking: nav.main-nav a:has-text('Receipts') - Clicking Receipts in main navigation
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.361Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.360Z\",\"msg\":\"HTTP GET /hmrc/receipt/receipts.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.384Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.374Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.374Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.389Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.386Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.387Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.387Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.389Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.389Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.389Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.402Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.392Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.405Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.404Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.406Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.405Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.406Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.406Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.407Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.407Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.407Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.407Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.408Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.407Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.414Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.412Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.413Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.414Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.425Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.425Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.425Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.425Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.425Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.434Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.434Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.436Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.440Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.439Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.440Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.439Z\",\"msg\":\"HTTP GET /api/v1/hmrc/receipt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.440Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.440Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.440Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.440Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.440Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.440Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.441Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:49.441Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.441Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:49.441Z\",\"requestId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/receipt/receipts.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.442Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:49.441Z\",\"requestId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.442Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:49.441Z\",\"requestId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:49.442Z\",\"requestId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:49.442Z\",\"requestId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.442Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:49.442Z\",\"requestId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.442Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:49.442Z\",\"requestId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.445Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:49.444Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:49.444Z\",\"requestId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/receipt\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/receipt\"}},\"path\":\"/api/v1/hmrc/receipt\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/receipt/receipts.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:49.444Z\",\"requestId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:49.444Z\",\"requestId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"message\":\"Extracting user information from event\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.445Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:49.445Z\",\"requestId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.445Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:49.445Z\",\"requestId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/receipt\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/receipt\"}},\"path\":\"/api/v1/hmrc/receipt\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/receipt/receipts.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.446Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:49.446Z\",\"requestId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.446Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:49.446Z\",\"requestId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:49.446Z\",\"requestId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.448Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:49.447Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:49.448Z\",\"requestId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/receipt/receipts.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:49.448Z\",\"requestId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:49.448Z\",\"requestId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:49.448Z\",\"requestId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:49.448Z\",\"requestId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:49.448Z\",\"requestId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.448Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:49.448Z\",\"requestId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.451Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:49.450Z\",\"requestId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:49.451Z\",\"requestId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.451Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:49.451Z\",\"requestId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.451Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:49.451Z\",\"requestId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.451Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:49.451Z\",\"requestId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"294e1164-b9c7-4b4d-a777-6f900fb78227\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.452Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:49.452Z\",\"requestId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:49.452Z\",\"requestId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.453Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:49.452Z\",\"requestId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T20:23:28.594Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.453Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:49.453Z\",\"requestId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/receipt\",\"requiredBundleIds\":[\"default\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.453Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:49.453Z\",\"requestId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/receipt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.454Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcReceiptGet.js\",\"time\":\"2026-02-03T20:23:49.453Z\",\"requestId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"message\":\"Listing user receipts\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.454Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:23:49.454Z\",\"requestId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"message\":\"DynamoDB enabled, proceeding with listUserReceipts [table: test-receipts-table]\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.454Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:23:49.454Z\",\"requestId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"message\":\"Retrieving receipts from DynamoDB\",\"userSub\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.457Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:49.456Z\",\"requestId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:49.457Z\",\"requestId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.458Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:49.457Z\",\"requestId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.459Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:49.458Z\",\"requestId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:49.459Z\",\"requestId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"ba876971-9f7e-474e-ad20-9296a4b96eeb\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.463Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:23:49.461Z\",\"requestId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"message\":\"Queried DynamoDB for user receipts\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:23:49.461Z\",\"requestId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"message\":\"Retrieved receipts from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:49.462Z\",\"requestId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/receipt\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"8b0af841-586d-4d48-af4f-a4bab5438eb7\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"receipts\\\":[{\\\"receiptId\\\":\\\"2026-02-03T20:23:44.706Z-351017507640\\\",\\\"key\\\":\\\"receipts/user/2026-02-03T20:23:44.706Z-351017507640.json\\\",\\\"name\\\":\\\"2026-02-03T20:23:44.706Z-351017507640.json\\\",\\\"timestamp\\\":\\\"2026-02-03T20:23:44.706Z\\\",\\\"formBundleNumber\\\":\\\"351017507640\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:44.706Z\\\",\\\"lastModified\\\":\\\"2026-02-03T20:23:44.706Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:49.465Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:49.465Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
Checking receipts page...
Found receipts, clicking on first receipt...
[USER INTERACTION] Clicking: [Locator] - Open first receipt
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:50.974Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:50.974Z\",\"msg\":\"HTTP GET /api/v1/hmrc/receipt/2026-02-03T20%3A23%3A44.706Z-351017507640.json\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:50.977Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:50.975Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:50.975Z\",\"requestId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/receipt/2026-02-03T20%3A23%3A44.706Z-351017507640.json\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/receipt/2026-02-03T20%3A23%3A44.706Z-351017507640.json\"}},\"path\":\"/api/v1/hmrc/receipt/2026-02-03T20%3A23%3A44.706Z-351017507640.json\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/receipt/receipts.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{\"name\":\"2026-02-03T20:23:44.706Z-351017507640.json\"}}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:50.975Z\",\"requestId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:50.975Z\",\"requestId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"message\":\"Extracting user information from event\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:50.975Z\",\"requestId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:50.975Z\",\"requestId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/receipt/2026-02-03T20%3A23%3A44.706Z-351017507640.json\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/receipt/2026-02-03T20%3A23%3A44.706Z-351017507640.json\"}},\"path\":\"/api/v1/hmrc/receipt/2026-02-03T20%3A23%3A44.706Z-351017507640.json\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/receipt/receipts.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{\"name\":\"2026-02-03T20:23:44.706Z-351017507640.json\"}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:50.978Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:50.977Z\",\"requestId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:50.977Z\",\"requestId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:50.977Z\",\"requestId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:50.981Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:50.981Z\",\"requestId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:50.981Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:50.981Z\",\"requestId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:50.981Z\",\"requestId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T20:23:28.594Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:50.981Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:50.981Z\",\"requestId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/receipt/2026-02-03T20%3A23%3A44.706Z-351017507640.json\",\"requiredBundleIds\":[\"default\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:50.982Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:50.981Z\",\"requestId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/receipt/2026-02-03T20%3A23%3A44.706Z-351017507640.json\"}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcReceiptGet.js\",\"time\":\"2026-02-03T20:23:50.982Z\",\"requestId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"message\":\"Retrieving single receipt\",\"receiptId\":\"2026-02-03T20:23:44.706Z-351017507640\",\"key\":\"receipts/user/2026-02-03T20:23:44.706Z-351017507640.json\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:50.983Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:23:50.982Z\",\"requestId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"message\":\"DynamoDB enabled, proceeding with getReceipt [table: test-receipts-table]\",\"userSub\":\"user\",\"receiptId\":\"2026-02-03T20:23:44.706Z-351017507640\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:50.983Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:23:50.983Z\",\"requestId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"message\":\"Retrieving receipt from DynamoDB\",\"userSub\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"receiptId\":\"2026-02-03T20:23:44.706Z-351017507640\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:50.985Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:23:50.985Z\",\"requestId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"4a2ff0c1-cebf-469b-84ca-04154f99e03d\",\"message\":\"Retrieved receipt from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"receiptId\":\"2026-02-03T20:23:44.706Z-351017507640\"}"}
Returning to home via main navigation...
[USER INTERACTION] Clicking: nav.main-nav a:has-text('Activities') - Clicking Activities in main navigation
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.331Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.330Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.375Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.372Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.373Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.373Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.374Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.374Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.375Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.385Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.385Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.387Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.386Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.386Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.430Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.428Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.429Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.430Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.431Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.430Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.430Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.431Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.432Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.431Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.438Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.437Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.440Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.438Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.440Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.458Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.458Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.458Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.460Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.460Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.461Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.476Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.479Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.483Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.486Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.475Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:52.480Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:52.480Z\",\"requestId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:52.481Z\",\"requestId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:52.481Z\",\"requestId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:52.481Z\",\"requestId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:52.481Z\",\"requestId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:52.481Z\",\"requestId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:52.481Z\",\"requestId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.492Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.491Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.491Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.494Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.492Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:52.493Z\",\"requestId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:52.493Z\",\"requestId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:52.493Z\",\"requestId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.495Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:52.495Z\",\"requestId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.495Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:52.495Z\",\"requestId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"b9552252-5990-43db-ba0d-7f1ed216d453\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.496Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:52.496Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.497Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:52.497Z\",\"requestId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:52.497Z\",\"requestId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.498Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:52.497Z\",\"requestId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:52.497Z\",\"requestId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:52.497Z\",\"requestId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.498Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:52.498Z\",\"requestId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.498Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:52.498Z\",\"requestId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.505Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:52.502Z\",\"requestId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:52.502Z\",\"requestId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:52.502Z\",\"requestId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:52.503Z\",\"requestId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:52.503Z\",\"requestId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"2ca6cd5f-ca43-429a-9c94-937fcebce01b\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.511Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.507Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.518Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:52.518Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:52.710Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: button:has-text('View VAT Return (HMRC Sandbox)') - Starting View VAT Return
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.664Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.664Z\",\"msg\":\"HTTP GET /hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.711Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.683Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.718Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.715Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.716Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.716Z\",\"msg\":\"HTTP GET /lib/test-data-generator.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.717Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.720Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.718Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.719Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.725Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.723Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.724Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.725Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.727Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.726Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.758Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.742Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.760Z","msg":"[BROWSER CONSOLE log]: JS block finished loading."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.765Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.761Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.761Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.763Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.763Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.764Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.764Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.770Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.770Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.772Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.772Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.773Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.773Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.783Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.783Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.784Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.784Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.793Z","msg":"[BROWSER CONSOLE log]: JS block started loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.793Z","msg":"[BROWSER CONSOLE log]: OAuth callback handler (accessToken found)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.793Z","msg":"[BROWSER CONSOLE log]: No pending return request found"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.793Z","msg":"[BROWSER CONSOLE log]: JS block finished loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.795Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.790Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:53.790Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:53.791Z\",\"requestId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:53.791Z\",\"requestId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:53.791Z\",\"requestId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:53.791Z\",\"requestId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:53.791Z\",\"requestId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:53.791Z\",\"requestId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:53.792Z\",\"requestId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.796Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.798Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.797Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.799Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:53.798Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.800Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:53.799Z\",\"requestId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.800Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:53.800Z\",\"requestId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.800Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:53.800Z\",\"requestId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.802Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:53.801Z\",\"requestId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.802Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:53.802Z\",\"requestId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"2272ebe1-4a00-4b4e-b52c-a25377736a1b\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.803Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:53.803Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.804Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:53.804Z\",\"requestId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.804Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:53.804Z\",\"requestId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.805Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:53.804Z\",\"requestId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.805Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:53.804Z\",\"requestId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:53.805Z\",\"requestId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:53.805Z\",\"requestId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:53.805Z\",\"requestId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.816Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:53.815Z\",\"requestId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:53.815Z\",\"requestId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:23:53.815Z\",\"requestId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.816Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:53.816Z\",\"requestId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:53.817Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:53.816Z\",\"requestId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"99eb3ca6-ad38-416a-b0ba-5d71881f99a0\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:54.993Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: #testDataLink a - Clicking add test data link
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:55.340Z","msg":"[BROWSER CONSOLE log]: [Test Data] Populated view VAT return form with test data"}
[USER INTERACTION] Filling: #vrn with value: "711173646" - Entering VAT registration number
Set period dates: 2017-01-01 to 2017-03-31
Enabled developer mode for test scenario
Developer section visible (controlled by global developer mode)
Checked runFraudPreventionHeaderValidation checkbox
[USER INTERACTION] Focusing: #retrieveBtn - Retrieve button
[USER INTERACTION] Clicking: #retrieveBtn - Submitting view VAT return form
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.005Z","msg":"[BROWSER CONSOLE log]: Status message: Retrieving VAT return... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.069Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:58.069Z\",\"msg\":\"HTTP GET /api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.069Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:58.069Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.071Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:58.070Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:23:58.064Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"98c65ed9-ca51-4d40-9398-39bce19c19a7\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"x-initial-request\":\"true\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"b9f51348-38a2-4058-845b-09a5f82ba709\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"runFraudPreventionHeaderValidation\":\"true\",\"allowSandboxObligations\":\"true\"},\"rawQueryString\":\"vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.071Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:58.070Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:58.070Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Extracting user information from event\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:58.071Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.071Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:58.071Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:23:58.064Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"98c65ed9-ca51-4d40-9398-39bce19c19a7\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"x-initial-request\":\"true\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"b9f51348-38a2-4058-845b-09a5f82ba709\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"runFraudPreventionHeaderValidation\":\"true\",\"allowSandboxObligations\":\"true\"},\"rawQueryString\":\"vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.072Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:58.072Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.072Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:58.072Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:58.072Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.074Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:58.074Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.074Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:58.074Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.074Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:58.074Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T20:23:28.594Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.074Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:58.074Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\",\"requiredBundleIds\":[\"test\",\"day-guest\",\"invited-guest\",\"resident-guest\",\"resident-pro-comp\",\"resident-pro\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.074Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:58.074Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.074Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/lib/buildFraudHeaders.js\",\"time\":\"2026-02-03T20:23:58.074Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"No public client IP detected in X-Forwarded-For\",\"xff\":\"\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.075Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:58.075Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"accessTokenPrefix\":\"mock-hmr...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.075Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:23:58.075Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.075Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:23:58.075Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Resolving periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vrn\":\"[VRN]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.075Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:23:58.075Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"msg\":\"Validating fraud prevention headers for HMRC API request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.075Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:58.075Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Validating fraud prevention headers\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
[http-simulator] GET /test/fraud-prevention-headers/validate
[http-simulator:fraud-headers] GET /test/fraud-prevention-headers/validate
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.080Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:58.079Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"VALID_WITH_WARNINGS\",\"validationMessage\":\"Headers valid with warnings\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.080Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:58.080Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]},{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-client-public-port\"]}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.080Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:58.080Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.083Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:58.083Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.083Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:58.083Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Request to GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"Gov-Client-Device-ID\":\"98c65ed9-ca51-4d40-9398-39bce19c19a7\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:23:58.064Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"http://localhost:9000\"}}"}
[http-simulator] GET /organisations/vat/711173646/obligations?from=2017-01-01&to=2017-03-31&status=F
[http-simulator:vat-obligations] GET /organisations/vat/711173646/obligations from=2017-01-01 to=2017-03-31
[http-simulator:scenarios] Using default obligations with random periodKey: 19VP
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.085Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:58.085Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Response from GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"status\":200,\"hmrcResponseBody\":{\"obligations\":[{\"periodKey\":\"19VP\",\"start\":\"2017-01-01\",\"end\":\"2017-03-31\",\"due\":\"2017-05-07\",\"status\":\"F\",\"received\":\"2017-05-06\"}]}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.085Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:58.085Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.087Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:58.087Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.087Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:23:58.087Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Resolved periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"resolvedPeriodKey\":\"19VP\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.087Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:23:58.087Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.087Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:23:58.087Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Initiating new processing\"}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:58.087Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Marking request as processing in DynamoDB\",\"userId\":\"user\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.087Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:23:58.087Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-return-get-async-requests-table]\",\"status\":\"processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.087Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:58.087Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Starting async processing locally (no SQS queue URL)\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.088Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:23:58.088Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Validating fraud prevention headers for sandbox account\",\"hmrcAccount\":\"sandbox\",\"runFraudPreventionHeaderValidation\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.088Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:58.088Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Validating fraud prevention headers\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
[http-simulator] GET /test/fraud-prevention-headers/validate
[http-simulator:fraud-headers] GET /test/fraud-prevention-headers/validate
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.089Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:58.088Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Checking persisted request status\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:23:58.088Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-return-get-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.091Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:58.091Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"VALID_WITH_WARNINGS\",\"validationMessage\":\"Headers valid with warnings\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.091Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:58.091Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]},{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-client-public-port\"]}]}\n{\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:58.091Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.093Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:23:58.093Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.093Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:23:58.093Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.094Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:58.093Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Yielding with HTTP 202 Accepted\",\"location\":\"http://localhost:3000/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.094Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:58.093Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"response\":{\"statusCode\":202,\"headers\":{\"Gov-Client-Device-ID\":\"98c65ed9-ca51-4d40-9398-39bce19c19a7\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:23:58.064Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"Retry-After\":\"5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"Location\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"message\\\":\\\"Request accepted for processing\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.094Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:58.094Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.095Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:58.094Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Request to GET http://localhost:9000/organisations/vat/[VRN]/returns/19VP\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns/19VP\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"Gov-Client-Device-ID\":\"98c65ed9-ca51-4d40-9398-39bce19c19a7\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:23:58.064Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"http://localhost:9000\"}}"}
[http-simulator] GET /organisations/vat/711173646/returns/19VP
[http-simulator:vat-returns] GET /organisations/vat/711173646/returns/19VP
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.096Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:58.096Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Response from GET http://localhost:9000/organisations/vat/[VRN]/returns/19VP\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns/19VP\",\"status\":200,\"hmrcResponseBody\":{\"periodKey\":\"19VP\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":0,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.096Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:58.096Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns/19VP\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.099Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:58.098Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns/19VP\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.099Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:58.099Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Local async processing completed successfully\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.099Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:58.099Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Marking async request as completed\",\"userSub\":\"user\",\"asyncRequestsTableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.099Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:23:58.099Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-return-get-async-requests-table]\",\"status\":\"completed\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.101Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:23:58.101Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.149Z","msg":"[BROWSER CONSOLE log]: waiting async request [GET /api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true] (timeout: 730000ms)..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:58.149Z","msg":"[BROWSER CONSOLE log]: Status message: Still processing... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.150Z","msg":"[BROWSER CONSOLE log]: re-trying async request [GET /api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true] (poll #1, elapsed: 1001ms, timeout: 730000ms, last status: 202)..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.154Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:23:59.154Z\",\"msg\":\"HTTP GET /api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.155Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:23:59.154Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.155Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:59.155Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:23:58.064Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"98c65ed9-ca51-4d40-9398-39bce19c19a7\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"b9f51348-38a2-4058-845b-09a5f82ba709\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"runFraudPreventionHeaderValidation\":\"true\",\"allowSandboxObligations\":\"true\"},\"rawQueryString\":\"vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.155Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:59.155Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:59.155Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Extracting user information from event\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.156Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:59.155Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.157Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:59.156Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:23:58.064Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"98c65ed9-ca51-4d40-9398-39bce19c19a7\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"b9f51348-38a2-4058-845b-09a5f82ba709\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"runFraudPreventionHeaderValidation\":\"true\",\"allowSandboxObligations\":\"true\"},\"rawQueryString\":\"vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:59.157Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:59.157Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:59.157Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.160Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:59.160Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.161Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:23:59.160Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:59.160Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T20:23:28.594Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.161Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:59.161Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\",\"requiredBundleIds\":[\"test\",\"day-guest\",\"invited-guest\",\"resident-guest\",\"resident-pro-comp\",\"resident-pro\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.162Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:23:59.161Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\"}\n{\"level\":40,\"source\":\"app/lib/buildFraudHeaders.js\",\"time\":\"2026-02-03T20:23:59.161Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"No public client IP detected in X-Forwarded-For\",\"xff\":\"\"}\n{\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:59.161Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"accessTokenPrefix\":\"mock-hmr...\",\"isValidFormat\":true}}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:23:59.161Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\"}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:23:59.161Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Resolving periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vrn\":\"[VRN]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.162Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:23:59.161Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"msg\":\"Validating fraud prevention headers for HMRC API request\"}\n{\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:59.162Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Validating fraud prevention headers\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
[http-simulator] GET /test/fraud-prevention-headers/validate
[http-simulator:fraud-headers] GET /test/fraud-prevention-headers/validate
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.164Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:59.164Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"VALID_WITH_WARNINGS\",\"validationMessage\":\"Headers valid with warnings\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.164Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:59.164Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]},{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-client-public-port\"]}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.165Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:59.164Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.167Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:59.167Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.168Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:59.167Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Request to GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"Gov-Client-Device-ID\":\"98c65ed9-ca51-4d40-9398-39bce19c19a7\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:23:58.064Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"http://localhost:9000\"}}"}
[http-simulator] GET /organisations/vat/711173646/obligations?from=2017-01-01&to=2017-03-31&status=F
[http-simulator:vat-obligations] GET /organisations/vat/711173646/obligations from=2017-01-01 to=2017-03-31
[http-simulator:scenarios] Using default obligations with random periodKey: 17U8
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.169Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:23:59.169Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Response from GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"status\":200,\"hmrcResponseBody\":{\"obligations\":[{\"periodKey\":\"17U8\",\"start\":\"2017-01-01\",\"end\":\"2017-03-31\",\"due\":\"2017-05-07\",\"status\":\"F\",\"received\":\"2017-05-06\"}]}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.169Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:59.169Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.172Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:23:59.171Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.172Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:23:59.172Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Resolved periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"resolvedPeriodKey\":\"17U8\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.172Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:23:59.172Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-return-get-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.174Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:23:59.173Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.174Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:23:59.174Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":false}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:23:59.174Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Found persisted request\",\"status\":\"completed\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.174Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:23:59.174Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.175Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:23:59.174Z\",\"requestId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"response\":{\"statusCode\":200,\"headers\":{\"Gov-Client-Device-ID\":\"98c65ed9-ca51-4d40-9398-39bce19c19a7\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:23:58.064Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"ebf1d6c8-7f85-432a-a946-a7773472fb01\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"periodKey\\\":\\\"19VP\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":0,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.179Z","msg":"[BROWSER CONSOLE log]: finished async request [GET /api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true] (poll #1, elapsed: 1028ms, status: 200)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.179Z","msg":"[BROWSER CONSOLE log]: Status message: VAT return retrieved. Type: success"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:23:59.179Z","msg":"[BROWSER CONSOLE log]: Hiding all status messages"}
[waitForSuccessOrError] SUCCESS: "VAT return results" detected after 0s (poll #1)
VAT due on sales validated: £1000.00
VAT due on acquisitions validated: £0.00
Total VAT due validated: £1000.00
VAT reclaimed on purchases validated: £0.00
View VAT return completed successfully with validated fields
Returning to home via main navigation...
[USER INTERACTION] Clicking: nav.main-nav a:has-text('Activities') - Clicking Activities in main navigation
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.240Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.240Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.268Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.254Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.255Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.256Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.257Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.275Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.269Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.270Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.270Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.271Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.272Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.293Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.290Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.291Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.294Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.295Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.294Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.296Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.295Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.297Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.296Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.296Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.297Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.298Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.298Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.300Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.300Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.308Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.308Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.308Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.308Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.308Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.308Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.316Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.317Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.324Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.315Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:24:00.315Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:24:00.316Z\",\"requestId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:00.316Z\",\"requestId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:24:00.316Z\",\"requestId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:00.316Z\",\"requestId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:00.316Z\",\"requestId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:00.316Z\",\"requestId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:00.317Z\",\"requestId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.325Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.327Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.327Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.329Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.327Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.327Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:24:00.328Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:24:00.328Z\",\"requestId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:00.328Z\",\"requestId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:24:00.328Z\",\"requestId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:00.328Z\",\"requestId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:00.328Z\",\"requestId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:00.328Z\",\"requestId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:00.328Z\",\"requestId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.331Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:00.330Z\",\"requestId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:00.330Z\",\"requestId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:00.330Z\",\"requestId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.331Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:24:00.331Z\",\"requestId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:24:00.331Z\",\"requestId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"816599ff-bdb4-4000-be76-a92f41525ff3\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.332Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:00.332Z\",\"requestId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.333Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:00.332Z\",\"requestId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:00.332Z\",\"requestId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.334Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:24:00.333Z\",\"requestId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.334Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:24:00.334Z\",\"requestId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"5055dd2b-79ba-41ba-a1b0-2f4aca3c18ed\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.341Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.340Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.345Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:00.345Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:00.502Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: button:has-text('VAT Obligations (HMRC Sandbox)') - Starting VAT Obligations
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.289Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.289Z\",\"msg\":\"HTTP GET /hmrc/vat/vatObligations.html?hmrcAccount=sandbox\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.318Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.300Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.300Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.321Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.320Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.320Z\",\"msg\":\"HTTP GET /lib/test-data-generator.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.320Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.322Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.321Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.321Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.321Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.327Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.324Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.325Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.326Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.347Z","msg":"[BROWSER CONSOLE log]: JS block finished loading."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.350Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.349Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.349Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.349Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.350Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.350Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.350Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.350Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.350Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.353Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.353Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.353Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.355Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.354Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.356Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.355Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.363Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.364Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.370Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.370Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.372Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.369Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:24:01.369Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:24:01.369Z\",\"requestId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:01.370Z\",\"requestId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:24:01.370Z\",\"requestId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:01.370Z\",\"requestId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:01.370Z\",\"requestId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:01.370Z\",\"requestId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:01.370Z\",\"requestId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.374Z","msg":"[BROWSER CONSOLE log]: JS block started loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.374Z","msg":"[BROWSER CONSOLE log]: OAuth callback handler (accessToken found)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.374Z","msg":"[BROWSER CONSOLE log]: No pending obligations request found"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.374Z","msg":"[BROWSER CONSOLE log]: JS block finished loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.375Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.375Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.374Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.376Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:01.376Z\",\"requestId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:01.376Z\",\"requestId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:01.376Z\",\"requestId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.377Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:24:01.377Z\",\"requestId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:24:01.377Z\",\"requestId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"b6d4b2ce-6690-4de8-8f35-b345f1d76280\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.378Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:01.378Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.378Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:24:01.378Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.378Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:24:01.378Z\",\"requestId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.379Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:01.378Z\",\"requestId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:24:01.378Z\",\"requestId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:01.378Z\",\"requestId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.379Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:01.378Z\",\"requestId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:01.379Z\",\"requestId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:01.379Z\",\"requestId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.381Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:01.381Z\",\"requestId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.381Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:01.381Z\",\"requestId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.381Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:01.381Z\",\"requestId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.382Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:24:01.382Z\",\"requestId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:01.382Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:24:01.382Z\",\"requestId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"dbf094ca-83bd-4a9d-bfc4-7a0e084362ba\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:02.664Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: #testDataLink a - Clicking add test data link
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:03.022Z","msg":"[BROWSER CONSOLE log]: [Test Data] Populated VAT obligations form with test data"}
[USER INTERACTION] Filling: #vrn with value: "711173646" - Entering VAT registration number
[USER INTERACTION] Filling: #fromDate with value: "2025-01-01" - Entering from date
[USER INTERACTION] Filling: #toDate with value: "2025-12-01" - Entering to date
[USER INTERACTION] Focusing: #status - the obligations status filter
[USER INTERACTION] Focusing: #retrieveBtn - Retrieve button
[USER INTERACTION] Clicking: #retrieveBtn - Submitting VAT obligations form
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.120Z","msg":"[BROWSER CONSOLE log]: Status message: Retrieving VAT obligations... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.239Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:06.239Z\",\"msg\":\"HTTP GET /api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.239Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:24:06.239Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.241Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:24:06.240Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/obligation\"}},\"path\":\"/api/v1/hmrc/vat/obligation\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:24:06.163Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"b757f21f-479d-4f7e-b31d-1fa10305fc56\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"x-initial-request\":\"true\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"7d51f830-a5c7-445d-a409-e1a85002488e\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"from\":\"2025-01-01\",\"to\":\"2025-12-01\"},\"rawQueryString\":\"vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:24:06.240Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:24:06.240Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Extracting user information from event\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:24:06.240Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:24:06.240Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/obligation\"}},\"path\":\"/api/v1/hmrc/vat/obligation\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:24:06.163Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"b757f21f-479d-4f7e-b31d-1fa10305fc56\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"x-initial-request\":\"true\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"7d51f830-a5c7-445d-a409-e1a85002488e\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"from\":\"2025-01-01\",\"to\":\"2025-12-01\"},\"rawQueryString\":\"vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:24:06.241Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.242Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:06.241Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:06.241Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.244Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:06.244Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.244Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:06.244Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:24:06.244Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T20:23:28.594Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.244Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:24:06.244Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/obligation\",\"requiredBundleIds\":[\"test\",\"day-guest\",\"invited-guest\",\"resident-guest\",\"resident-pro-comp\",\"resident-pro\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.244Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:24:06.244Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/obligation\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.244Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/lib/buildFraudHeaders.js\",\"time\":\"2026-02-03T20:24:06.244Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"No public client IP detected in X-Forwarded-For\",\"xff\":\"\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.245Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:24:06.245Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"accessTokenPrefix\":\"mock-hmr...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.245Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:24:06.245Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.245Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:24:06.245Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":true}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:24:06.245Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Initiating new processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.245Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:24:06.245Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Marking request as processing in DynamoDB\",\"userId\":\"user\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.245Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:24:06.245Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-obligation-get-async-requests-table]\",\"status\":\"processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.245Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:24:06.245Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Starting async processing locally (no SQS queue URL)\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.246Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:24:06.245Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Skipping fraud prevention header validation for HMRC API request\",\"hmrcAccount\":\"sandbox\",\"runFraudPreventionHeaderValidation\":false}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.246Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:24:06.246Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Request to GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2025-01-01&to=2025-12-01\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2025-01-01&to=2025-12-01\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"Gov-Client-Device-ID\":\"b757f21f-479d-4f7e-b31d-1fa10305fc56\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:24:06.163Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"http://localhost:9000\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.247Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:24:06.247Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Checking persisted request status\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.247Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:24:06.247Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-obligation-get-async-requests-table]\"}"}
[http-simulator] GET /organisations/vat/711173646/obligations?from=2025-01-01&to=2025-12-01
[http-simulator:vat-obligations] GET /organisations/vat/711173646/obligations from=2025-01-01 to=2025-12-01
[http-simulator:scenarios] Using default obligations with random periodKey: 17N0
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.251Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:24:06.251Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Response from GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2025-01-01&to=2025-12-01\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2025-01-01&to=2025-12-01\",\"status\":200,\"hmrcResponseBody\":{\"obligations\":[{\"periodKey\":\"17N0\",\"start\":\"2017-01-01\",\"end\":\"2017-03-31\",\"due\":\"2017-05-07\",\"status\":\"F\",\"received\":\"2017-05-06\"},{\"periodKey\":\"22U0\",\"start\":\"2017-04-01\",\"end\":\"2017-06-30\",\"due\":\"2017-08-07\",\"status\":\"O\"}]}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.251Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:24:06.251Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2025-01-01&to=2025-12-01\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.254Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:24:06.254Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.255Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:24:06.255Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.255Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:24:06.255Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Yielding with HTTP 202 Accepted\",\"location\":\"http://localhost:3000/api/v1/hmrc/vat/obligation\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.256Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:24:06.255Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"response\":{\"statusCode\":202,\"headers\":{\"Gov-Client-Device-ID\":\"b757f21f-479d-4f7e-b31d-1fa10305fc56\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:24:06.163Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"Retry-After\":\"5\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"Location\":\"http://localhost:3000/api/v1/hmrc/vat/obligation\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"message\\\":\\\"Request accepted for processing\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.263Z","msg":"[BROWSER CONSOLE log]: waiting async request [GET /api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01] (timeout: 730000ms)..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.263Z","msg":"[BROWSER CONSOLE log]: Status message: Still processing... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.263Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:24:06.262Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2025-01-01&to=2025-12-01\",\"method\":\"GET\"}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:24:06.262Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Local async processing completed successfully\"}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:24:06.263Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Marking async request as completed\",\"userSub\":\"user\",\"asyncRequestsTableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:24:06.263Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-obligation-get-async-requests-table]\",\"status\":\"completed\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:06.267Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:24:06.266Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.262Z","msg":"[BROWSER CONSOLE log]: re-trying async request [GET /api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01] (poll #1, elapsed: 1001ms, timeout: 730000ms, last status: 202)..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.268Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:07.268Z\",\"msg\":\"HTTP GET /api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.269Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:24:07.268Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.269Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:24:07.269Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/obligation\"}},\"path\":\"/api/v1/hmrc/vat/obligation\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:24:06.163Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"b757f21f-479d-4f7e-b31d-1fa10305fc56\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"7d51f830-a5c7-445d-a409-e1a85002488e\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"from\":\"2025-01-01\",\"to\":\"2025-12-01\"},\"rawQueryString\":\"vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.269Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:24:07.269Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:24:07.269Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Extracting user information from event\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:24:07.269Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.270Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:24:07.269Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/obligation\"}},\"path\":\"/api/v1/hmrc/vat/obligation\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:24:06.163Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"b757f21f-479d-4f7e-b31d-1fa10305fc56\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"7d51f830-a5c7-445d-a409-e1a85002488e\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"from\":\"2025-01-01\",\"to\":\"2025-12-01\"},\"rawQueryString\":\"vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.270Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:24:07.270Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.270Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:07.270Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.270Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:07.270Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.273Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:07.273Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.273Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:07.273Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:24:07.273Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T20:23:28.594Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.273Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:24:07.273Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/obligation\",\"requiredBundleIds\":[\"test\",\"day-guest\",\"invited-guest\",\"resident-guest\",\"resident-pro-comp\",\"resident-pro\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.273Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:24:07.273Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/obligation\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.273Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/lib/buildFraudHeaders.js\",\"time\":\"2026-02-03T20:24:07.273Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"No public client IP detected in X-Forwarded-For\",\"xff\":\"\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.273Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:24:07.273Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"accessTokenPrefix\":\"mock-hmr...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.274Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:24:07.273Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:24:07.273Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-obligation-get-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.276Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:24:07.275Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.276Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:24:07.276Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":false}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:24:07.276Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Found persisted request\",\"status\":\"completed\"}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:24:07.276Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.276Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:24:07.276Z\",\"requestId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"response\":{\"statusCode\":200,\"headers\":{\"Gov-Client-Device-ID\":\"b757f21f-479d-4f7e-b31d-1fa10305fc56\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:24:06.163Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"25d0da87-29ed-4710-bbd0-9a212caa1d6b\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"obligations\\\":[{\\\"periodKey\\\":\\\"17N0\\\",\\\"start\\\":\\\"2017-01-01\\\",\\\"end\\\":\\\"2017-03-31\\\",\\\"due\\\":\\\"2017-05-07\\\",\\\"status\\\":\\\"F\\\",\\\"received\\\":\\\"2017-05-06\\\"},{\\\"periodKey\\\":\\\"22U0\\\",\\\"start\\\":\\\"2017-04-01\\\",\\\"end\\\":\\\"2017-06-30\\\",\\\"due\\\":\\\"2017-08-07\\\",\\\"status\\\":\\\"O\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.279Z","msg":"[BROWSER CONSOLE log]: finished async request [GET /api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01] (poll #1, elapsed: 1018ms, status: 200)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.279Z","msg":"[BROWSER CONSOLE log]: Status message: VAT obligations retrieved. Type: success"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:07.280Z","msg":"[BROWSER CONSOLE log]: Hiding all status messages"}
[waitForSuccessOrError] SUCCESS: "VAT obligations results" detected after 0s (poll #1)
[verifyVatObligationsResults] Found 2 obligation(s) - validating shape
VAT Period validated: 1 Jan 2017 to 31 Mar 2017
VAT Period validated: 1 Apr 2017 to 30 Jun 2017
Dates validated for 1 Jan 2017 to 31 Mar 2017: due=7 May 2017, received=6 May 2017
Dates validated for 1 Apr 2017 to 30 Jun 2017: due=7 Aug 2017, received=-
No test scenario 1 fulfilled obligations and 1 open obligations
VAT obligations retrieval completed successfully
Returning to home via main navigation...
[USER INTERACTION] Clicking: nav.main-nav a:has-text('Activities') - Clicking Activities in main navigation
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:08.974Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:08.974Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.013Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.012Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.013Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.013Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.013Z\",\"msg\":\"HTTP GET /developer-mode.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.016Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.015Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.017Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.016Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.024Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.018Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.021Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.022Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.022Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.068Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.065Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.066Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.067Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.068Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.068Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.069Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.071Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.068Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.072Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.071Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.076Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.073Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.074Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.085Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.087Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.087Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.087Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.087Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.089Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.094Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.094Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.102Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.112Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.100Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:24:09.100Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:24:09.101Z\",\"requestId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:09.101Z\",\"requestId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:24:09.101Z\",\"requestId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:09.101Z\",\"requestId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:09.101Z\",\"requestId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:09.101Z\",\"requestId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:09.101Z\",\"requestId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.103Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.104Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:24:09.104Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:24:09.105Z\",\"requestId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:09.105Z\",\"requestId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:24:09.105Z\",\"requestId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"c2b4af52-7a7f-4ce8-9276-4a7b54574d44\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:09.105Z\",\"requestId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:09.105Z\",\"requestId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:09.105Z\",\"requestId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:09.105Z\",\"requestId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.122Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:09.119Z\",\"requestId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:09.119Z\",\"requestId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:09.119Z\",\"requestId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:24:09.120Z\",\"requestId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:24:09.120Z\",\"requestId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"33f8c0dc-3069-4636-9353-6310bd97aab2\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.121Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.132Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:09.123Z\",\"requestId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:24:09.123Z\",\"requestId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:24:09.124Z\",\"requestId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:24:09.125Z\",\"requestId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:24:09.125Z\",\"requestId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"correlationId\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"traceparent\":\"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01\",\"x-correlationid\":\"71ab646f-4dd5-4638-ab27-6111bc823f4a\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:23:28.594Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.137Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.136Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.143Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.143Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
[test body] Found userInfo in localStorage for test "Click through: Submit a VAT return to HMRC": {"sub":"user","email":"user@example.com"}
[test body] Extracted userSub from localStorage for test "Click through: Submit a VAT return to HMRC": user
Logging out from home page
[USER INTERACTION] Clicking: a:has-text('Logout') - Logout
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.778Z","msg":"[BROWSER CONSOLE log]: Logging out user"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.780Z","msg":"[HTTP REQUEST FAILED] GET http://localhost:3000/index.html - net::ERR_ABORTED"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.785Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.784Z\",\"msg\":\"HTTP GET /auth/login.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.809Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.801Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.802Z\",\"msg\":\"HTTP GET /images/g-logo.png\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.802Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.825Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.811Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.812Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.812Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.829Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.828Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.832Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.829Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.829Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.829Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.829Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.829Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.835Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.835Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.838Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.837Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.861Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.867Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.861Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.862Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.863Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.863Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.864Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.864Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.867Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.870Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.870Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.873Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.873Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.875Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.874Z\",\"msg\":\"HTTP GET /auth/login-mock-addon.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.879Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.879Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.885Z","msg":"[BROWSER CONSOLE error]: Loading the image 'https://avatars.githubusercontent.com/u/11848947?s=48&v=4' violates the following Content Security Policy directive: \"img-src 'self' data:\". The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.885Z","msg":"[HTTP REQUEST FAILED] GET https://avatars.githubusercontent.com/u/11848947?s=48&v=4 - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.885Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.886Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.886Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.886Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.886Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.895Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:24:09.895Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.997Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:24:09.997Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[Figures]: Selected 5 key screenshots from target/behaviour-test-results/screenshots/submitVat-behaviour-test
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-02-03T20:24:10.002Z","msg":"Copied screenshot: 2026-02-03_20-23-36-544079954-10-fill-in-submission-pagedown.png"}
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-02-03T20:24:10.003Z","msg":"Copied screenshot: 2026-02-03_20-23-46-094549721-02-complete-vat-receipt.png"}
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-02-03T20:24:10.003Z","msg":"Copied screenshot: 2026-02-03_20-23-42-080332805-01-submit-hmrc-auth.png"}
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-02-03T20:24:10.004Z","msg":"Copied screenshot: 2026-02-03_20-23-59-551555728-04-view-vat-return-results.png"}
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-02-03T20:24:10.005Z","msg":"Copied screenshot: 2026-02-03_20-23-18-101351961-01-submit-mock.png"}
[Figures]: Copied 5 screenshots to /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-02-03T20:24:10.007Z","msg":"Wrote figures.json with 5 entries to /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/figures.json"}
[Figures]: Generated figures.json in /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour
[DynamoDB Export]: Starting export of all tables...
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:24:10.007Z","msg":"[dynamodb-export]: Starting export of all tables to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:24:10.007Z","msg":"[dynamodb-export]: Exporting table 'test-bundle-table' from endpoint 'http://127.0.0.1:9001' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/bundles.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:24:10.019Z","msg":"[dynamodb-export]: ✅ Exported 1 items from table 'test-bundle-table' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/bundles.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:24:10.019Z","msg":"[dynamodb-export]: ── BEGIN bundles.jsonl ──"}
{"bundleId":"test","expiry":"2026-02-04T00:00:00.000Z","tokensGranted":10,"tokensConsumed":1,"tokenResetAt":null,"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","createdAt":"2026-02-03T20:23:28.594Z","ttl":1772582400,"ttl_datestamp":"2026-03-04T00:00:00.000Z"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:24:10.020Z","msg":"[dynamodb-export]: ── END bundles.jsonl ──"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:24:10.020Z","msg":"[dynamodb-export]: Exporting table 'test-hmrc-api-requests-table' from endpoint 'http://127.0.0.1:9001' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/hmrc-api-requests.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:24:10.030Z","msg":"[dynamodb-export]: ✅ Exported 14 items from table 'test-hmrc-api-requests-table' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/hmrc-api-requests.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:24:10.030Z","msg":"[dynamodb-export]: ── BEGIN hmrc-api-requests.jsonl ──"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-49054347-5a87-440c-87b2-55155f11c9be","requestId":"ebf1d6c8-7f85-432a-a946-a7773472fb01","amznTraceId":null,"traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","url":"http://localhost:9000/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Device-ID":"98c65ed9-ca51-4d40-9398-39bce19c19a7","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:23:58.064Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"ebf1d6c8-7f85-432a-a946-a7773472fb01","traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","x-correlationid":"ebf1d6c8-7f85-432a-a946-a7773472fb01"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"297","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:23:59 GMT","etag":"W/\"129-UFxb9UF4LOFfUrBiO2wN6GYy9Fo\"","keep-alive":"timeout=5","x-correlationid":"60105da3-1b59-461a-a7b3-76467b242232","x-powered-by":"Express"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"Headers valid with warnings","errors":[],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]},{"code":"***MASKED***","message":"Header required","headers":["gov-client-public-port"]}]}},"duration":2,"createdAt":"2026-02-03T20:23:59.164Z","ttl":1772569439,"ttl_datestamp":"2026-03-03T20:23:59.164Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-4c19b436-2a1e-4620-900f-0dc1e9397476","requestId":"88c2d846-3436-407d-96a7-d7f5040a0ed5","amznTraceId":null,"traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","url":"http://localhost:9000/organisations/vat/711173646/obligations?from=2017-01-01&to=2017-03-31&status=O","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"88c2d846-3436-407d-96a7-d7f5040a0ed5","traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","x-correlationid":"88c2d846-3436-407d-96a7-d7f5040a0ed5","Gov-Client-Device-ID":"3178f14f-236c-4169-bd93-a746f5ae6a42","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:23:44.642Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"110","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:23:45 GMT","etag":"W/\"6e-wdv6Cbh7eQnauYEoMT8dITzOlFc\"","keep-alive":"timeout=5","x-correlationid":"5a2f7ddd-966b-468a-8100-8ab08c158566","x-powered-by":"Express"},"body":{"obligations":[{"periodKey":"26S2","start":"2017-04-01","end":"2017-06-30","due":"2017-08-07","status":"O"}]}},"duration":2,"createdAt":"2026-02-03T20:23:45.724Z","ttl":1772569425,"ttl_datestamp":"2026-03-03T20:23:45.724Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-6d31422e-c0db-4a80-83de-c6f290501fe8","requestId":"ebf1d6c8-7f85-432a-a946-a7773472fb01","amznTraceId":null,"traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","url":"http://localhost:9000/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Device-ID":"98c65ed9-ca51-4d40-9398-39bce19c19a7","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:23:58.064Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"ebf1d6c8-7f85-432a-a946-a7773472fb01","traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","x-correlationid":"ebf1d6c8-7f85-432a-a946-a7773472fb01"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"297","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:23:58 GMT","etag":"W/\"129-UFxb9UF4LOFfUrBiO2wN6GYy9Fo\"","keep-alive":"timeout=5","x-correlationid":"343f8caf-bc15-4341-bec9-64a37324ecf4","x-powered-by":"Express"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"Headers valid with warnings","errors":[],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]},{"code":"***MASKED***","message":"Header required","headers":["gov-client-public-port"]}]}},"duration":4,"createdAt":"2026-02-03T20:23:58.080Z","ttl":1772569438,"ttl_datestamp":"2026-03-03T20:23:58.080Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-6f30c33c-1920-40f3-b809-ebded0cf46a7","requestId":"ebf1d6c8-7f85-432a-a946-a7773472fb01","amznTraceId":null,"traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","url":"http://localhost:9000/organisations/vat/711173646/returns/19VP","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"ebf1d6c8-7f85-432a-a946-a7773472fb01","traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","x-correlationid":"ebf1d6c8-7f85-432a-a946-a7773472fb01","Gov-Client-Device-ID":"98c65ed9-ca51-4d40-9398-39bce19c19a7","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:23:58.064Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"239","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:23:58 GMT","etag":"W/\"ef-hOzOfYVCLLvDTxNhwHZlHGiCfJA\"","keep-alive":"timeout=5","x-correlationid":"990f4090-0b7b-4212-b0a3-fe85811fee82","x-powered-by":"Express"},"body":{"periodKey":"19VP","vatDueSales":1000,"vatDueAcquisitions":0,"totalVatDue":1000,"vatReclaimedCurrPeriod":0,"netVatDue":1000,"totalValueSalesExVAT":0,"totalValuePurchasesExVAT":0,"totalValueGoodsSuppliedExVAT":0,"totalAcquisitionsExVAT":0}},"duration":1,"createdAt":"2026-02-03T20:23:58.096Z","ttl":1772569438,"ttl_datestamp":"2026-03-03T20:23:58.096Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-b420c2fc-765b-452e-9692-2203dff1bb64","requestId":"ebf1d6c8-7f85-432a-a946-a7773472fb01","amznTraceId":null,"traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","url":"http://localhost:9000/organisations/vat/711173646/obligations?from=2017-01-01&to=2017-03-31&status=F","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"ebf1d6c8-7f85-432a-a946-a7773472fb01","traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","x-correlationid":"ebf1d6c8-7f85-432a-a946-a7773472fb01","Gov-Client-Device-ID":"98c65ed9-ca51-4d40-9398-39bce19c19a7","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:23:58.064Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"134","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:23:58 GMT","etag":"W/\"86-sVS971reLMkI58664q08l2iSajc\"","keep-alive":"timeout=5","x-correlationid":"bcea4dd1-9d21-47a9-9255-b7f32827eaf9","x-powered-by":"Express"},"body":{"obligations":[{"periodKey":"19VP","start":"2017-01-01","end":"2017-03-31","due":"2017-05-07","status":"F","received":"2017-05-06"}]}},"duration":1,"createdAt":"2026-02-03T20:23:58.085Z","ttl":1772569438,"ttl_datestamp":"2026-03-03T20:23:58.085Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-b80d082d-cd65-4d45-956e-4b6df7061a0e","requestId":"88c2d846-3436-407d-96a7-d7f5040a0ed5","amznTraceId":null,"traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","url":"http://localhost:9000/organisations/vat/711173646/returns","method":"POST","httpRequest":{"method":"POST","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"88c2d846-3436-407d-96a7-d7f5040a0ed5","traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","x-correlationid":"88c2d846-3436-407d-96a7-d7f5040a0ed5","Gov-Client-Device-ID":"3178f14f-236c-4169-bd93-a746f5ae6a42","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:23:44.642Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"},"body":"{\"periodKey\":\"17OG\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":5000,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0,\"finalised\":true}"},"httpResponse":{"statusCode":201,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"140","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:23:44 GMT","etag":"W/\"8c-53+i2w9/CbJ0igj6V9UPdXk54H4\"","keep-alive":"timeout=5","receipt-id":"2f1a9181-ddd6-4ca3-8329-0ce6de39610a","receipt-signature":"This has been deprecated - DO NOT USE","receipt-timestamp":"2026-02-03T20:23:44Z","x-correlationid":"ea23bdb8-7af3-4d40-bf8e-bba47e2d9dee","x-powered-by":"Express"},"body":{"processingDate":"2026-02-03T20:23:44.700Z","formBundleNumber":"351017507640","paymentIndicator":"DD","chargeRefNumber":"wMnbVPuS5weCJ2vm"}},"duration":4,"createdAt":"2026-02-03T20:23:44.701Z","ttl":1772569424,"ttl_datestamp":"2026-03-03T20:23:44.701Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-c42af792-c115-4184-b081-86e3f4cc3857","requestId":"ebf1d6c8-7f85-432a-a946-a7773472fb01","amznTraceId":null,"traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","url":"http://localhost:9000/organisations/vat/711173646/obligations?from=2017-01-01&to=2017-03-31&status=F","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"ebf1d6c8-7f85-432a-a946-a7773472fb01","traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","x-correlationid":"ebf1d6c8-7f85-432a-a946-a7773472fb01","Gov-Client-Device-ID":"98c65ed9-ca51-4d40-9398-39bce19c19a7","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:23:58.064Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"134","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:23:59 GMT","etag":"W/\"86-raSV1/5p4VYq0qTZh3TDHeWm9WQ\"","keep-alive":"timeout=5","x-correlationid":"3777dc3b-da9a-4010-81bf-ff2787d1c752","x-powered-by":"Express"},"body":{"obligations":[{"periodKey":"17U8","start":"2017-01-01","end":"2017-03-31","due":"2017-05-07","status":"F","received":"2017-05-06"}]}},"duration":1,"createdAt":"2026-02-03T20:23:59.169Z","ttl":1772569439,"ttl_datestamp":"2026-03-03T20:23:59.169Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-c4f7122d-ad3b-4ce4-9321-64437c619e5c","requestId":"25d0da87-29ed-4710-bbd0-9a212caa1d6b","amznTraceId":null,"traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","url":"http://localhost:9000/organisations/vat/711173646/obligations?from=2025-01-01&to=2025-12-01","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"25d0da87-29ed-4710-bbd0-9a212caa1d6b","traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","x-correlationid":"25d0da87-29ed-4710-bbd0-9a212caa1d6b","Gov-Client-Device-ID":"b757f21f-479d-4f7e-b31d-1fa10305fc56","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:24:06.163Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"227","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:24:06 GMT","etag":"W/\"e3-GIOsXHc2yh9dmEj3TZiDFWgafnk\"","keep-alive":"timeout=5","x-correlationid":"736b658d-2096-4439-9d3a-c300802495e1","x-powered-by":"Express"},"body":{"obligations":[{"periodKey":"17N0","start":"2017-01-01","end":"2017-03-31","due":"2017-05-07","status":"F","received":"2017-05-06"},{"periodKey":"22U0","start":"2017-04-01","end":"2017-06-30","due":"2017-08-07","status":"O"}]}},"duration":5,"createdAt":"2026-02-03T20:24:06.251Z","ttl":1772569446,"ttl_datestamp":"2026-03-03T20:24:06.251Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-c5a5c9aa-856d-42c4-ac14-9f0d2999b9ad","requestId":"88c2d846-3436-407d-96a7-d7f5040a0ed5","amznTraceId":null,"traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","url":"http://localhost:9000/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Device-ID":"3178f14f-236c-4169-bd93-a746f5ae6a42","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:23:44.642Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"88c2d846-3436-407d-96a7-d7f5040a0ed5","traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","x-correlationid":"88c2d846-3436-407d-96a7-d7f5040a0ed5"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"297","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:23:44 GMT","etag":"W/\"129-UFxb9UF4LOFfUrBiO2wN6GYy9Fo\"","keep-alive":"timeout=5","x-correlationid":"7e6f5f2d-692c-4f5b-81ad-b5f1ed6be7a6","x-powered-by":"Express"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"Headers valid with warnings","errors":[],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]},{"code":"***MASKED***","message":"Header required","headers":["gov-client-public-port"]}]}},"duration":5,"createdAt":"2026-02-03T20:23:44.692Z","ttl":1772569424,"ttl_datestamp":"2026-03-03T20:23:44.692Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-cb522126-8a03-48c9-ab77-35e53a4b903a","requestId":"59471e33-d620-4b20-9137-d1699a590d0e","amznTraceId":null,"traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","url":"http://localhost:9000/oauth/token","method":"POST","httpRequest":{"method":"POST","headers":{"Content-Type":"application/x-www-form-urlencoded","x-request-id":"59471e33-d620-4b20-9137-d1699a590d0e","traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","x-correlationid":"59471e33-d620-4b20-9137-d1699a590d0e"},"body":"grant_type=authorization_code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&client_secret=mock-simulator-client-secret&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Factivities%2FsubmitVatCallback.html&code=***MASKED***"},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"227","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:23:44 GMT","etag":"W/\"e3-R/8WWvD0oJ13HLRTvWyVLnjqVw4\"","keep-alive":"timeout=5","x-powered-by":"Express"},"body":{"access_token":"***MASKED***","refresh_token":"***MASKED***","expires_in":14400,"scope":"write:vat read:vat","token_type":"bearer"}},"duration":13,"createdAt":"2026-02-03T20:23:44.418Z","ttl":1772569424,"ttl_datestamp":"2026-03-03T20:23:44.418Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-d41db3d1-0730-4fcb-860f-2571aaa739fe","requestId":"88c2d846-3436-407d-96a7-d7f5040a0ed5","amznTraceId":null,"traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","url":"http://localhost:9000/organisations/vat/711173646/obligations?from=2017-01-01&to=2017-03-31&status=O","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"88c2d846-3436-407d-96a7-d7f5040a0ed5","traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","x-correlationid":"88c2d846-3436-407d-96a7-d7f5040a0ed5","Gov-Client-Device-ID":"3178f14f-236c-4169-bd93-a746f5ae6a42","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:23:44.642Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"110","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:23:44 GMT","etag":"W/\"6e-6P4YYkFMvlKhDjA1n5qNL5PiIoQ\"","keep-alive":"timeout=5","x-correlationid":"93f2d5c2-a2b7-4e53-8510-36aa2ab7a3b2","x-powered-by":"Express"},"body":{"obligations":[{"periodKey":"24OG","start":"2017-04-01","end":"2017-06-30","due":"2017-08-07","status":"O"}]}},"duration":3,"createdAt":"2026-02-03T20:23:44.673Z","ttl":1772569424,"ttl_datestamp":"2026-03-03T20:23:44.673Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-e9cbbd68-ef61-4452-a565-f6bad9c9b996","requestId":"88c2d846-3436-407d-96a7-d7f5040a0ed5","amznTraceId":null,"traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","url":"http://localhost:9000/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Device-ID":"3178f14f-236c-4169-bd93-a746f5ae6a42","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:23:44.642Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"88c2d846-3436-407d-96a7-d7f5040a0ed5","traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","x-correlationid":"88c2d846-3436-407d-96a7-d7f5040a0ed5"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"297","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:23:44 GMT","etag":"W/\"129-UFxb9UF4LOFfUrBiO2wN6GYy9Fo\"","keep-alive":"timeout=5","x-correlationid":"ab700c47-189a-4cf6-ae3f-960d1998237d","x-powered-by":"Express"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"Headers valid with warnings","errors":[],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]},{"code":"***MASKED***","message":"Header required","headers":["gov-client-public-port"]}]}},"duration":4,"createdAt":"2026-02-03T20:23:44.665Z","ttl":1772569424,"ttl_datestamp":"2026-03-03T20:23:44.665Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-ea63fb28-ae90-4083-b910-4e176a4b5377","requestId":"88c2d846-3436-407d-96a7-d7f5040a0ed5","amznTraceId":null,"traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","url":"http://localhost:9000/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Device-ID":"3178f14f-236c-4169-bd93-a746f5ae6a42","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:23:44.642Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"88c2d846-3436-407d-96a7-d7f5040a0ed5","traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","x-correlationid":"88c2d846-3436-407d-96a7-d7f5040a0ed5"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"297","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:23:45 GMT","etag":"W/\"129-UFxb9UF4LOFfUrBiO2wN6GYy9Fo\"","keep-alive":"timeout=5","x-correlationid":"6abb9b09-21e8-4c63-b458-b7c2cb687d55","x-powered-by":"Express"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"Headers valid with warnings","errors":[],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]},{"code":"***MASKED***","message":"Header required","headers":["gov-client-public-port"]}]}},"duration":2,"createdAt":"2026-02-03T20:23:45.717Z","ttl":1772569425,"ttl_datestamp":"2026-03-03T20:23:45.717Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-f78df8cb-c6f5-418c-ba97-b3085a56dc47","requestId":"ebf1d6c8-7f85-432a-a946-a7773472fb01","amznTraceId":null,"traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","url":"http://localhost:9000/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Device-ID":"98c65ed9-ca51-4d40-9398-39bce19c19a7","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150200429","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:23:58.064Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"ebf1d6c8-7f85-432a-a946-a7773472fb01","traceparent":"00-5a2d876a92aa12599db5adf23bed47f5-c7b35b665f3c873c-01","x-correlationid":"ebf1d6c8-7f85-432a-a946-a7773472fb01"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"297","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:23:58 GMT","etag":"W/\"129-UFxb9UF4LOFfUrBiO2wN6GYy9Fo\"","keep-alive":"timeout=5","x-correlationid":"c4cd317a-1442-45a0-adcf-9d8613795762","x-powered-by":"Express"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"Headers valid with warnings","errors":[],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]},{"code":"***MASKED***","message":"Header required","headers":["gov-client-public-port"]}]}},"duration":2,"createdAt":"2026-02-03T20:23:58.091Z","ttl":1772569438,"ttl_datestamp":"2026-03-03T20:23:58.091Z"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:24:10.030Z","msg":"[dynamodb-export]: ── END hmrc-api-requests.jsonl ──"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:24:10.030Z","msg":"[dynamodb-export]: Exporting table 'test-receipts-table' from endpoint 'http://127.0.0.1:9001' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/receipts.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:24:10.035Z","msg":"[dynamodb-export]: ✅ Exported 1 items from table 'test-receipts-table' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/receipts.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:24:10.035Z","msg":"[dynamodb-export]: ── BEGIN receipts.jsonl ──"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","receiptId":"2026-02-03T20:23:44.706Z-351017507640","receipt":{"processingDate":"2026-02-03T20:23:44.700Z","formBundleNumber":"351017507640","paymentIndicator":"DD","chargeRefNumber":"wMnbVPuS5weCJ2vm"},"createdAt":"2026-02-03T20:23:44.706Z","ttl":1990902224,"ttl_datestamp":"2033-02-01T20:23:44.706Z"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:24:10.035Z","msg":"[dynamodb-export]: ── END receipts.jsonl ──"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:24:10.035Z","msg":"[dynamodb-export]: ✅ Completed export of all tables"}
[DynamoDB Export]: Export completed: [
  {
    table: [32m'bundles'[39m,
    itemCount: [33m1[39m,
    filePath: [32m'/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/bundles.jsonl'[39m
  },
  {
    table: [32m'hmrc-api-requests'[39m,
    itemCount: [33m14[39m,
    filePath: [32m'/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/hmrc-api-requests.jsonl'[39m
  },
  {
    table: [32m'receipts'[39m,
    itemCount: [33m1[39m,
    filePath: [32m'/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/receipts.jsonl'[39m
  }
]
Asserting HMRC API request exists: POST /oauth/token
[DynamoDB Assertions]: Found 1 OAuth token exchange request(s)
Asserting HMRC API request exists: POST /organisations/vat/711173646/returns
[DynamoDB Assertions]: Found 1 VAT return POST request(s)
Matched all expected values in http://localhost:9000/organisations/vat/711173646/returns: { [32m'httpRequest.method'[39m: [32m'POST'[39m, [32m'httpResponse.statusCode'[39m: [33m201[39m }
[DynamoDB Assertions]: VAT POST request body validated - periodKey format: 17OG
Asserting HMRC API request exists: GET /\/organisations\/vat\/711173646\/returns\/\w+/
[DynamoDB Assertions]: Found 1 VAT return GET request(s)
Matched all expected values in http://localhost:9000/organisations/vat/711173646/returns/19VP: { [32m'httpRequest.method'[39m: [32m'GET'[39m, [32m'httpResponse.statusCode'[39m: [33m200[39m }
[DynamoDB Assertions]: VAT GET response body validated - periodKey format: 19VP
[DynamoDB Assertions]: Found 0 Fraud prevention headers validation feedback GET request(s)
Asserting HMRC API request exists: GET /test/fraud-prevention-headers/validate
[DynamoDB Assertions]: Found 6 Fraud prevention headers validation GET request(s)
[DynamoDB Assertions]: Fraud prevention headers validation GET request #1 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 0
[DynamoDB Assertions]: Warnings: 2
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 0 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 2 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[DynamoDB Assertions]: Fraud prevention headers validation GET request #2 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 0
[DynamoDB Assertions]: Warnings: 2
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 0 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 2 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[DynamoDB Assertions]: Fraud prevention headers validation GET request #3 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 0
[DynamoDB Assertions]: Warnings: 2
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 0 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 2 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[DynamoDB Assertions]: Fraud prevention headers validation GET request #4 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 0
[DynamoDB Assertions]: Warnings: 2
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 0 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 2 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[DynamoDB Assertions]: Fraud prevention headers validation GET request #5 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 0
[DynamoDB Assertions]: Warnings: 2
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 0 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 2 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[DynamoDB Assertions]: Fraud prevention headers validation GET request #6 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 0
[DynamoDB Assertions]: Warnings: 2
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 0 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 2 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
{"level":30,"source":"behaviour-tests/helpers/dynamodb-assertions.js","time":"2026-02-03T20:24:10.080Z","msg":"Found 14 HMRC API requests: OAuth (1) with hashedSub 5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0, authenticated (13) with hashedSub 5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0"}
[DynamoDB Assertions]: Found 1 unique hashedSub value(s): 5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0
[afterEach] Saving /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/userSub.txt for test "Click through: Submit a VAT return to HMRC": user
{"level":30,"source":"app/services/subHasher.js","time":"2026-02-03T20:24:10.207Z","message":"Using USER_SUB_HASH_SALT from environment (local dev/test)"}
[fileHelper] Salt initialized successfully for test diagnostics
[afterEach] Saving /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/hashedUserSub.txt for test "Click through: Submit a VAT return to HMRC": 5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0
Saving /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/traceparent.txt for test "Click through: Submit a VAT return to HMRC": 00-4ae09534d3b8f96d8fe0ed78309baff6-02b10a019917afc4-01
[http-simulator] Stopped
  ✓  1 [submitVatBehaviour] › behaviour-tests/submitVat.behaviour.test.js:182:1 › Click through: Submit a VAT return to HMRC (58.0s)

  1 passed (1.1m)

To open last HTML report run:
[36m[39m
[36m  npx playwright show-report target/test-reports/html-report[39m
[36m[39m
