
> @antonycc/web-submit-diyaccounting-co-uk@1.0.0 test:submitVatBehaviour-simulator
> npx dotenv -e .env.simulator -- npm run test:submitVatBehaviour


> @antonycc/web-submit-diyaccounting-co-uk@1.0.0 test:submitVatBehaviour
> playwright test --project=submitVatBehaviour

dotenvConfigIfNotBlank: Loading environment config from .env
dotenvConfigIfNotBlank: Loading environment config from .env
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:33:57.961Z","msg":"Reading CDK configuration from /Users/antony/projects/submit.diyaccounting.co.uk/cdk-application/cdk.json"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:33:57.962Z","msg":"CDK context:"}
dotenvConfigIfNotBlank: Loading environment config from .env
dotenvConfigIfNotBlank: Loading environment config from .env
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:33:57.972Z","msg":"envFilePath: .env.simulator"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:33:57.972Z","msg":"envName: simulator"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:33:57.972Z","msg":"serverPort: 3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:33:57.972Z","msg":"runTestServer: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:33:57.972Z","msg":"runProxy: off"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:33:57.973Z","msg":"runMockOAuth2: off"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:33:57.973Z","msg":"testAuthProvider: simulator"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:33:57.973Z","msg":"testAuthUsername: user"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:33:57.973Z","msg":"testAuthPassword: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:33:57.973Z","msg":"baseUrl: http://localhost:3000/"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:33:57.973Z","msg":"hmrcTestUsername: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:33:57.973Z","msg":"hmrcTestPassword: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:33:57.973Z","msg":"hmrcTestVatNumber: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:33:57.973Z","msg":"runDynamoDb: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:33:57.973Z","msg":"bundleTableName: test-bundle-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:33:57.973Z","msg":"hmrcApiRequestsTableName: test-hmrc-api-requests-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:33:57.973Z","msg":"receiptsTableName: test-receipts-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:33:57.973Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:33:57.973Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}

Running 1 test using 1 worker

dotenvConfigIfNotBlank: Loading environment config from .env
dotenvConfigIfNotBlank: Loading environment config from .env
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:00.175Z","msg":"Reading CDK configuration from /Users/antony/projects/submit.diyaccounting.co.uk/cdk-application/cdk.json"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:00.176Z","msg":"CDK context:"}
dotenvConfigIfNotBlank: Loading environment config from .env
dotenvConfigIfNotBlank: Loading environment config from .env
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.182Z","msg":"envFilePath: .env.simulator"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.183Z","msg":"envName: simulator"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.183Z","msg":"serverPort: 3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.183Z","msg":"runTestServer: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.183Z","msg":"runProxy: off"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.183Z","msg":"runMockOAuth2: off"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.183Z","msg":"testAuthProvider: simulator"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.183Z","msg":"testAuthUsername: user"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.183Z","msg":"testAuthPassword: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.183Z","msg":"baseUrl: http://localhost:3000/"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.183Z","msg":"hmrcTestUsername: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.183Z","msg":"hmrcTestPassword: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.184Z","msg":"hmrcTestVatNumber: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.184Z","msg":"runDynamoDb: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.184Z","msg":"bundleTableName: test-bundle-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.184Z","msg":"hmrcApiRequestsTableName: test-hmrc-api-requests-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.184Z","msg":"receiptsTableName: test-receipts-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.184Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.184Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
Starting beforeAll hook...
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.879Z","msg":"[dynamodb]: runDynamoDb=run, bundleTableName=test-bundle-table, hmrcApiRequestsTableName=test-hmrc-api-requests-table, receiptsTableName=test-receipts-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.879Z","msg":"[dynamodb]: Starting dynalite (local DynamoDB) server..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:00.887Z","msg":"[dynamodb]: Started at http://127.0.0.1:9001"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:00.887Z","msg":"[dynamodb]: Ensuring bundle table: 'test-bundle-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:00.930Z","msg":"[dynamodb]: ℹ️ Table 'test-bundle-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:00.938Z","msg":"[dynamodb]: ✅ Created table 'test-bundle-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:00.938Z","msg":"[dynamodb]: Ensuring HMRC API requests table: 'test-hmrc-api-requests-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:00.947Z","msg":"[dynamodb]: ℹ️ Table 'test-hmrc-api-requests-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:00.951Z","msg":"[dynamodb]: ✅ Created table 'test-hmrc-api-requests-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:00.951Z","msg":"[dynamodb]: Ensuring receipts table: 'test-receipts-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:00.961Z","msg":"[dynamodb]: ℹ️ Table 'test-receipts-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:00.966Z","msg":"[dynamodb]: ✅ Created table 'test-receipts-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:00.966Z","msg":"[dynamodb]: Ensuring passes table: 'test-passes-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:00.974Z","msg":"[dynamodb]: ℹ️ Table 'test-passes-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:00.980Z","msg":"[dynamodb]: ✅ Created table 'test-passes-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:00.980Z","msg":"[dynamodb]: Ensuring async requests table: 'test-hmrc-vat-return-post-async-requests-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:00.990Z","msg":"[dynamodb]: ℹ️ Table 'test-hmrc-vat-return-post-async-requests-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:00.995Z","msg":"[dynamodb]: ✅ Created table 'test-hmrc-vat-return-post-async-requests-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:00.995Z","msg":"[dynamodb]: Ensuring async requests table: 'test-hmrc-vat-return-get-async-requests-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:01.002Z","msg":"[dynamodb]: ℹ️ Table 'test-hmrc-vat-return-get-async-requests-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:01.006Z","msg":"[dynamodb]: ✅ Created table 'test-hmrc-vat-return-get-async-requests-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:01.006Z","msg":"[dynamodb]: Ensuring async requests table: 'test-hmrc-vat-obligation-get-async-requests-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:01.012Z","msg":"[dynamodb]: ℹ️ Table 'test-hmrc-vat-obligation-get-async-requests-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T20:34:01.016Z","msg":"[dynamodb]: ✅ Created table 'test-hmrc-vat-obligation-get-async-requests-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:01.016Z","msg":"[auth]: runMockOAuth2=off"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:01.016Z","msg":"[auth]: Skipping mock-oauth2-server process as runMockOAuth2 is not set to 'run'"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:01.016Z","msg":"[auth]: Starting HTTP simulator (replaces mock-oauth2-server and HMRC API)..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:01.016Z","msg":"[http-simulator]: runSimulator=run, port=9000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:01.016Z","msg":"[http-simulator]: Starting HTTP simulator..."}
[http-simulator] Started on http://localhost:9000
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:01.130Z","msg":"[http-simulator]: Started at http://localhost:9000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:01.130Z","msg":"[http]: runTestServer=run, httpServerPort=3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:01.130Z","msg":"[http]: Starting server process..."}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-02-03T20:34:01.133Z","msg":"[http]: Checking server readiness for... http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-02-03T20:34:01.143Z","msg":"[http]: Starting server at http://127.0.0.1:3000 after error TypeError: fetch failed"}
{"level":50,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-02-03T20:34:01.145Z","msg":"[http]: Server check attempt 1/15 failed: fetch failed from http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:01.381Z","msg":"[http-stdout]: dotenvConfigIfNotBlank: Loading environment config from .env"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:01.394Z","msg":"[http-stdout]: dotenvConfigIfNotBlank: Loading environment config from .env"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:01.399Z","msg":"[http-stdout]: Mock OAuth routes registered (TEST_AUTH_PROVIDER=simulator)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:01.406Z","msg":"[http-stdout]: Listening at http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:01.407Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:01.406Z\",\"msg\":\"Listening at http://127.0.0.1:3000\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:02.150Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:02.150Z\",\"msg\":\"HTTP GET /\"}"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-02-03T20:34:02.161Z","msg":"[http]: Response body"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-02-03T20:34:02.161Z","msg":"[http]: Server is ready! at http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:02.161Z","msg":"[proxy]: runProxy=off, httpServerPort=3000, baseUrl=http://localhost:3000/"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:02.161Z","msg":"[proxy]: Skipping ngrok tunnel as runProxy is not set to 'run'"}
beforeAll hook completed successfully
[HMRC Test User] Sandbox mode detected without full credentials - creating test user
[HMRC Test User] Creating HMRC sandbox test user with VAT enrolment using client credentials
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:02.718Z","message":"[HMRC Test User Creation] Starting test user creation","url":"http://localhost:9000/create-test-user/organisations","serviceNames":["mtd-vat"],"hmrcClientId":"uqMHA6Rs..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:02.718Z","message":"[HMRC Test User Creation] Request details (pre-token)","method":"POST","url":"http://localhost:9000/create-test-user/organisations","body":{"serviceNames":["mtd-vat"]}}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:02.718Z","message":"[HMRC Test User Creation] Requesting OAuth2 access token","tokenUrl":"http://localhost:9000/oauth/token","grantType":"client_credentials"}
[http-simulator] POST /oauth/token
[http-simulator:hmrc-oauth] POST /oauth/token grant_type=client_credentials
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:02.744Z","message":"[HMRC Test User Creation] Token response received","status":200,"statusText":"OK","hasAccessToken":true}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:02.744Z","message":"[HMRC Test User Creation] Request details (create-test-user)","method":"POST","url":"http://localhost:9000/create-test-user/organisations","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"[REDACTED]"},"body":{"serviceNames":["mtd-vat"]}}
[http-simulator] POST /create-test-user/organisations
[http-simulator:test-user] POST /create-test-user/organisations
[http-simulator:test-user] Created test user with VAT registration number: 814376350
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:02.750Z","message":"[HMRC Test User Creation] Response received","status":201,"statusText":"Created","responseBody":{"userId":"617432341038","password":"[REDACTED]","userFullName":"Test User","emailAddress":"[REDACTED]","organisationDetails":{"name":"Test Organisation Ltd","address":{"line1":"123 Test Street","line2":"Test Town","postcode":"TE1 1ST"}},"individualDetails":{"firstName":"Test","lastName":"User","dateOfBirth":"1980-01-01","address":{"line1":"123 Test Street","line2":"Test Town","postcode":"TE1 1ST"}},"vatRegistrationDate":"2026-02-03","groupIdentifier":"124376643044","vrn":"814376350"}}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:02.750Z","message":"[HMRC Test User Creation] Test user created successfully","userId":"617432341038","userFullName":"Test User","organisationName":"Test Organisation Ltd"}
[HMRC Test User] Successfully created test user:
  User ID: 617432341038
  User Full Name: Test User
  VAT registration number: 814376350
  Organisation: Test Organisation Ltd
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:02.750Z","message":"[HMRC Test User] Saving test user details to JSON files","outputDir":"/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour","repoRoot":"/Users/antony/projects/submit.diyaccounting.co.uk"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:02.751Z","message":"[HMRC Test User] Saved test user to artifact directory","path":"/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/hmrc-test-user.json"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:02.751Z","message":"[HMRC Test User] Saved test user to repository root","path":"/Users/antony/projects/submit.diyaccounting.co.uk/hmrc-test-user.json"}
[HMRC Test User] Updated environment variables with generated credentials
Loading document...
[NAVIGATION] (1/4) Going to: http://127.0.0.1:3000/ - Loading home page
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:02.970Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:02.970Z\",\"msg\":\"HTTP GET /\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.057Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.045Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.046Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.063Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.059Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.059Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.061Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.067Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.064Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.066Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.074Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.067Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.070Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.087Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.076Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.096Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.092Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.092Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.093Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.093Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.094Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.094Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.096Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.098Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.098Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.100Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.098Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.105Z","msg":"[BROWSER CONSOLE log]: User is not authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.106Z","msg":"[BROWSER CONSOLE log]: User is not authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.111Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.109Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.117Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.116Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.117Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.128Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.127Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
Checking home page...
✅ [Compliance] Privacy link visible on home page
✅ [Compliance] Terms link visible on home page
[USER INTERACTION] Clicking: a:has-text('Log in') - Clicking login link
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.842Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.842Z\",\"msg\":\"HTTP GET /auth/login.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.861Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.856Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.856Z\",\"msg\":\"HTTP GET /images/g-logo.png\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.857Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.872Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.862Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.863Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.863Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.875Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.873Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.874Z\",\"msg\":\"HTTP GET /developer-mode.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.878Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.875Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.875Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.876Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.876Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.879Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.879Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.881Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.881Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.906Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.920Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.918Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.921Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.921Z\",\"msg\":\"HTTP GET /auth/login-mock-addon.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.922Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.922Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.923Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.923Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.923Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.923Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.924Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.923Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.925Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.924Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.929Z","msg":"[BROWSER CONSOLE error]: Loading the image 'https://avatars.githubusercontent.com/u/11848947?s=48&v=4' violates the following Content Security Policy directive: \"img-src 'self' data:\". The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.932Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.930Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.930Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.931Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.932Z","msg":"[HTTP REQUEST FAILED] GET https://avatars.githubusercontent.com/u/11848947?s=48&v=4 - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.947Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.947Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.947Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.947Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:03.954Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:03.954Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
Logging in...
[USER INTERACTION] Clicking: button:has-text('Continue with mock-oauth2-server') - Continue with OAuth provider
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:04.659Z","msg":"[BROWSER CONSOLE log]: Initiating navikt/mock-oauth2-server login"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:04.659Z","msg":"[BROWSER CONSOLE log]: Clear stored tokens and user info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:04.662Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:04.662Z\",\"msg\":\"HTTP GET /api/v1/mock/authUrl?state=e9afff87ff490d0805aa9fd56120d4d1\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:04.666Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:04.666Z\",\"requestId\":\"7abcfbf4-a1a2-49f4-984b-4c1f823b9ca5\",\"traceparent\":\"00-2a618e3d3344678701a47c1ea5d56426-fd72c1431b127a23-01\",\"correlationId\":\"7abcfbf4-a1a2-49f4-984b-4c1f823b9ca5\",\"message\":\"Processing request with event\",\"request\":\"http://127.0.0.1:3000/api/v1/mock/authUrl?state=e9afff87ff490d0805aa9fd56120d4d1\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"cognito:username\":\"test\",\"email\":\"[EMAIL]\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"127.0.0.1:3000\",\"path\":\"/api/v1/mock/authUrl\"}},\"path\":\"/api/v1/mock/authUrl\",\"headers\":{\"host\":\"127.0.0.1:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"7abcfbf4-a1a2-49f4-984b-4c1f823b9ca5\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-2a618e3d3344678701a47c1ea5d56426-fd72c1431b127a23-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://127.0.0.1:3000/auth/login.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"state\":\"e9afff87ff490d0805aa9fd56120d4d1\"},\"rawQueryString\":\"state=e9afff87ff490d0805aa9fd56120d4d1\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/non-lambda-mocks/mockAuthUrlGet.js\",\"time\":\"2026-02-03T20:34:04.666Z\",\"requestId\":\"7abcfbf4-a1a2-49f4-984b-4c1f823b9ca5\",\"traceparent\":\"00-2a618e3d3344678701a47c1ea5d56426-fd72c1431b127a23-01\",\"correlationId\":\"7abcfbf4-a1a2-49f4-984b-4c1f823b9ca5\",\"message\":\"Generating mock authorization URL\",\"state\":\"e9afff87ff490d0805aa9fd56120d4d1\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:04.667Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:04.666Z\",\"requestId\":\"7abcfbf4-a1a2-49f4-984b-4c1f823b9ca5\",\"traceparent\":\"00-2a618e3d3344678701a47c1ea5d56426-fd72c1431b127a23-01\",\"correlationId\":\"7abcfbf4-a1a2-49f4-984b-4c1f823b9ca5\",\"message\":\"Responding to request with response\",\"request\":\"http://127.0.0.1:3000/api/v1/mock/authUrl?state=e9afff87ff490d0805aa9fd56120d4d1\",\"response\":{\"statusCode\":200,\"headers\":{\"x-request-id\":\"7abcfbf4-a1a2-49f4-984b-4c1f823b9ca5\",\"traceparent\":\"00-2a618e3d3344678701a47c1ea5d56426-fd72c1431b127a23-01\",\"x-correlationid\":\"7abcfbf4-a1a2-49f4-984b-4c1f823b9ca5\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"authUrl\\\":\\\"http://localhost:9000/oauth/authorize?response_type=code&client_id=debugger&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Fauth%2FloginWithMockCallback.html&scope=openid%20somescope&state=e9afff87ff490d0805aa9fd56120d4d1&identity_provider=MockOAuth2Server\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:04.671Z","msg":"[BROWSER CONSOLE log]: Status message: Handing off to http://localhost:9000/oauth/authorize?response_type=code&client_id=debugger&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Fauth%2FloginWithMockCallback.html&scope=openid%20somescope&state=e9afff87ff490d0805aa9fd56120d4d1&identity_provider=MockOAuth2Server Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:04.671Z","msg":"[BROWSER CONSOLE log]: Redirecting to navikt/mock-oauth2-server"}
[http-simulator] GET /oauth/authorize?response_type=code&client_id=debugger&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Fauth%2FloginWithMockCallback.html&scope=openid%20somescope&state=e9afff87ff490d0805aa9fd56120d4d1&identity_provider=MockOAuth2Server
[http-simulator:local-oauth] GET /oauth/authorize for client_id=debugger
[USER INTERACTION] Filling: input[name="username"] with value: "user" - Entering username
[USER INTERACTION] Filling: textarea[name="claims"] with value: "{"email":"user@example.com"}" - Entering identity claims
[USER INTERACTION] Clicking: input[type="submit"][value="Sign-in"] - Submitting sign-in form
[http-simulator] POST /oauth/authorize
[http-simulator:local-oauth] POST /oauth/authorize for username=user
[http-simulator:local-oauth] Redirecting to http://localhost:3000/auth/loginWithMockCallback.html?code=91aeb26c6d8b4cd8841699e2cfd49c21&state=e9afff87ff490d0805aa9fd56120d4d1
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.482Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.481Z\",\"msg\":\"HTTP GET /auth/loginWithMockCallback.html?code=91aeb26c6d8b4cd8841699e2cfd49c21&state=e9afff87ff490d0805aa9fd56120d4d1\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.566Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.558Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.568Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.567Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.569Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.568Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.569Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.569Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.571Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.570Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.572Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.572Z\",\"msg\":\"HTTP GET /widgets/loading-spinner.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.573Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.572Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.574Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.574Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.602Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.591Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.607Z","msg":"[BROWSER CONSOLE log]: Authentication callback received with code: 91aeb26c6d8b4cd8841699e2cfd49c21"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.611Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.603Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.604Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.604Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.605Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.605Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.605Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.613Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.612Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.612Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.621Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.620Z\",\"msg\":\"HTTP POST /api/v1/mock/token\"}"}
[http-simulator] POST /default/token
[http-simulator:local-oauth] POST /default/token grant_type=authorization_code
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.666Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.666Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.672Z","msg":"[BROWSER CONSOLE log]: Received tokens from mock {\"access_token\":\"eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJzdWIiOiJ1c2VyIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIiwiYXVkIjpbImRlYnVnZ2VyIl0sInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsIm5vbmNlIjoiNTY3OCIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo5MDAwL2RlZmF1bHQiLCJpYXQiOjE3NzAxNTA4NDYsIm5iZiI6MTc3MDE1MDg0NiwiZXhwIjoxNzcwMTU0NDQ2LCJqdGkiOiIwN2FhYzAwNi03YmM4LTRjOWQtYTZmMy1lZTFlODQ2YTc4NjYifQ.\",\"id_token\":\"eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJzdWIiOiJ1c2VyIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIiwiYXVkIjpbImRlYnVnZ2VyIl0sInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsIm5vbmNlIjoiNTY3OCIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo5MDAwL2RlZmF1bHQiLCJpYXQiOjE3NzAxNTA4NDYsIm5iZiI6MTc3MDE1MDg0NiwiZXhwIjoxNzcwMTU0NDQ2LCJqdGkiOiIwN2FhYzAwNi03YmM4LTRjOWQtYTZmMy1lZTFlODQ2YTc4NjYifQ.\",\"token_type\":\"Bearer\",\"expires_in\":3600,\"scope\":\"openid somescope\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.673Z","msg":"[BROWSER CONSOLE log]: Received id_token from mock {\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.673Z","msg":"[BROWSER CONSOLE log]: User authenticated successfully using mock: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.673Z","msg":"[BROWSER CONSOLE log]: MFA detected from mock IdP: [mfa, pwd] Stored metadata: {type: OTHER, timestamp: 2026-02-03T20:34:06.667Z, uniqueReference: 5234f763-3ded-46da-a02c-d804f3ec437a}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.673Z","msg":"[BROWSER CONSOLE log]: Status message: Authenticated successfully. Fetching bundles... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.673Z","msg":"[BROWSER CONSOLE log]: Status message: Authenticated successfully. Redirecting... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.678Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.678Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.700Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.691Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.691Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.703Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.701Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.701Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.702Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.702Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.703Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.703Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.720Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.706Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.724Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.722Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.722Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.723Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.723Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.723Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.724Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.726Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.727Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.726Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.729Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.728Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.728Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.734Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.735Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.735Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.738Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.740Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.740Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.747Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.746Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.747Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.748Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:06.747Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.748Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/subHasher.js\",\"time\":\"2026-02-03T20:34:06.748Z\",\"message\":\"Using USER_SUB_HASH_SALT from environment (local dev/test)\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.748Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:06.748Z\",\"requestId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.748Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:06.748Z\",\"requestId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.749Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:06.748Z\",\"requestId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.749Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:06.749Z\",\"requestId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.749Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:06.749Z\",\"requestId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.749Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:06.749Z\",\"requestId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.750Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:06.750Z\",\"requestId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.752Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.752Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.752Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.752Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.753Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:06.753Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.753Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:06.753Z\",\"requestId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.753Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:06.753Z\",\"requestId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:06.753Z\",\"requestId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.754Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:06.753Z\",\"requestId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.754Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:06.753Z\",\"requestId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.754Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:06.754Z\",\"requestId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.754Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:06.754Z\",\"requestId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.834Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.834Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.875Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:06.875Z\",\"requestId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.875Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:06.875Z\",\"requestId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.875Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:06.875Z\",\"requestId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.880Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:06.880Z\",\"requestId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.881Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:06.881Z\",\"requestId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"945c2c46-3c46-4068-9d6e-ee6e90991dd1\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"test\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":0}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.882Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:06.882Z\",\"requestId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.882Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:06.882Z\",\"requestId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.882Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:06.882Z\",\"requestId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.885Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:06.885Z\",\"requestId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:06.885Z\",\"requestId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"9bf96862-6a25-4418-a950-1b56deccc300\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"test\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":0}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:06.887Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:06.887Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
Checking home page...
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.211Z","msg":"[BROWSER CONSOLE log]: [Mock MFA] Injected MFA metadata: {type: TOTP, timestamp: 2026-01-08T00:09:01Z, uniqueReference: test-mfa-1770150848206}"}
[Mock MFA] Injected: type=TOTP, timestamp=2026-01-08T00:09:01Z, ref=test-mfa-1770150848206
CloudWatch RUM analytics consent dialog is visible, accepting...
[USER INTERACTION] Clicking: button:has-text("Accept") - Accept CloudWatch RUM consent
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.492Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.494Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.494Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.495Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.526Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.527Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
Navigating to Bundles via main navigation...
[USER INTERACTION] Clicking: nav.main-nav a:has-text('Bundles') - Clicking Bundles in main navigation
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.844Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.844Z\",\"msg\":\"HTTP GET /bundles.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.870Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.856Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.874Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.871Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.872Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.872Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.873Z\",\"msg\":\"HTTP GET /lib/bundle-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.873Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.876Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.874Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.878Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.877Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.879Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.878Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.880Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.880Z\",\"msg\":\"HTTP GET /widgets/loading-spinner.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.882Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.881Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.884Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.883Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.906Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.892Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.893Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.910Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.907Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.908Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.909Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.909Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.910Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.910Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.915Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.913Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.918Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.917Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.922Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:08.918Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:08.919Z\",\"requestId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"correlationId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"authorization\":\"[TOKEN]\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua-mobile\":\"?0\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/bundles.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:08.919Z\",\"requestId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"correlationId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:08.919Z\",\"requestId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"correlationId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:08.919Z\",\"requestId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"correlationId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:08.919Z\",\"requestId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"correlationId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:08.920Z\",\"requestId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"correlationId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:08.920Z\",\"requestId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"correlationId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.923Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.926Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.926Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.926Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.926Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.930Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.930Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.931Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.938Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:08.931Z\",\"requestId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"correlationId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:08.931Z\",\"requestId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"correlationId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:08.931Z\",\"requestId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"correlationId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":0}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:08.933Z\",\"requestId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"correlationId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:08.933Z\",\"requestId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"correlationId\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"x-correlationid\":\"007df026-98dc-4cc3-ab08-2087e95fb086\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"test\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":0}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.942Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.940Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.941Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.941Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:08.941Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:08.942Z\",\"requestId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/bundles.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.946Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:08.942Z\",\"requestId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:08.942Z\",\"requestId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:08.943Z\",\"requestId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:08.943Z\",\"requestId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:08.943Z\",\"requestId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:08.943Z\",\"requestId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.951Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:08.950Z\",\"requestId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.951Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:08.951Z\",\"requestId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.953Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:08.951Z\",\"requestId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.955Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:08.954Z\",\"requestId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:08.955Z\",\"requestId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"ba0da329-583e-4808-bebf-1a618dd89012\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"test\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":0}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.960Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.956Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.966Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.965Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:08.972Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:08.971Z\",\"msg\":\"HTTP GET /submit.environment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:09.695Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
Ensuring Test bundle is present...
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (1/5)
[polling to ensure present]: Test bundle still not present.
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (2/5)
[polling to ensure present]: Test bundle still not present.
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (3/5)
[polling to ensure present]: Test bundle still not present.
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (4/5)
[polling to ensure present]: Test bundle still not present.
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (5/5)
[polling to ensure present]: Test bundle still not present.
"Request Test" button not visible (on-pass bundle), using pass API for fresh grant...
Creating and redeeming pass for bundle test...
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.167Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.167Z\",\"msg\":\"HTTP POST /api/v1/pass/admin\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.169Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/emailHash.js\",\"time\":\"2026-02-03T20:34:16.168Z\",\"message\":\"Using EMAIL_HASH_SECRET from environment (local dev/test)\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.169Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:16.169Z\",\"requestId\":\"853be3f9-c2d9-4c0d-82a8-3c93f327f649\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"853be3f9-c2d9-4c0d-82a8-3c93f327f649\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/pass/admin\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"cognito:username\":\"test\",\"email\":\"[EMAIL]\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/pass/admin\"}},\"path\":\"/api/v1/pass/admin\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"103\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"853be3f9-c2d9-4c0d-82a8-3c93f327f649\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"content-type\":\"application/json\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/bundles.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"passTypeId\\\":\\\"test\\\",\\\"bundleId\\\":\\\"test\\\",\\\"validityPeriod\\\":\\\"P1D\\\",\\\"maxUses\\\":1,\\\"createdBy\\\":\\\"behaviour-test\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.169Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/passAdminPost.js\",\"time\":\"2026-02-03T20:34:16.169Z\",\"requestId\":\"853be3f9-c2d9-4c0d-82a8-3c93f327f649\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"853be3f9-c2d9-4c0d-82a8-3c93f327f649\",\"message\":\"Creating admin pass\",\"passTypeId\":\"test\",\"bundleId\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.170Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbPassRepository.js\",\"time\":\"2026-02-03T20:34:16.170Z\",\"requestId\":\"853be3f9-c2d9-4c0d-82a8-3c93f327f649\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"853be3f9-c2d9-4c0d-82a8-3c93f327f649\",\"message\":\"putPass [table: test-passes-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.170Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbPassRepository.js\",\"time\":\"2026-02-03T20:34:16.170Z\",\"requestId\":\"853be3f9-c2d9-4c0d-82a8-3c93f327f649\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"853be3f9-c2d9-4c0d-82a8-3c93f327f649\",\"message\":\"Storing pass in DynamoDB\",\"passTypeId\":\"test\",\"bundleId\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.178Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbPassRepository.js\",\"time\":\"2026-02-03T20:34:16.178Z\",\"requestId\":\"853be3f9-c2d9-4c0d-82a8-3c93f327f649\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"853be3f9-c2d9-4c0d-82a8-3c93f327f649\",\"message\":\"Pass stored in DynamoDB\",\"pk\":\"pass#gamma-booth-serve-scene\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.178Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/passAdminPost.js\",\"time\":\"2026-02-03T20:34:16.178Z\",\"requestId\":\"853be3f9-c2d9-4c0d-82a8-3c93f327f649\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"853be3f9-c2d9-4c0d-82a8-3c93f327f649\",\"message\":\"Admin pass created\",\"passTypeId\":\"test\",\"bundleId\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.178Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:16.178Z\",\"requestId\":\"853be3f9-c2d9-4c0d-82a8-3c93f327f649\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"853be3f9-c2d9-4c0d-82a8-3c93f327f649\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/pass/admin\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"853be3f9-c2d9-4c0d-82a8-3c93f327f649\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"853be3f9-c2d9-4c0d-82a8-3c93f327f649\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"code\\\":\\\"gamma-booth-serve-scene\\\",\\\"bundleId\\\":\\\"test\\\",\\\"passTypeId\\\":\\\"test\\\",\\\"validFrom\\\":\\\"2026-02-03T20:34:16.169Z\\\",\\\"validUntil\\\":\\\"2026-02-04T20:34:16.169Z\\\",\\\"maxUses\\\":1,\\\"restrictedToEmail\\\":false}\"}}"}
Pass creation result: {"ok":true,"code":"gamma-booth-serve-scene","body":{"code":"gamma-booth-serve-scene","bundleId":"test","passTypeId":"test","validFrom":"2026-02-03T20:34:16.169Z","validUntil":"2026-02-04T20:34:16.169Z","maxUses":1,"restrictedToEmail":false}}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.281Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.281Z\",\"msg\":\"HTTP POST /api/v1/pass\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.282Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:16.282Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.282Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:16.282Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/pass\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/pass\"}},\"path\":\"/api/v1/pass\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"34\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"content-type\":\"application/json\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/bundles.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"code\\\":\\\"gamma-booth-serve-scene\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.283Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:16.282Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.283Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbPassRepository.js\",\"time\":\"2026-02-03T20:34:16.283Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"redeemPass [table: test-passes-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.292Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbPassRepository.js\",\"time\":\"2026-02-03T20:34:16.292Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"Pass redeemed in DynamoDB\",\"pk\":\"pass#gamma-booth-serve-scene\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.292Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T20:34:16.292Z\",\"requestId\":null,\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"grantBundle entry\",\"userId\":\"user\",\"requestedBundle\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.292Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:16.292Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.293Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:16.292Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.296Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:16.296Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.296Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:16.296Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.299Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T20:34:16.299Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"Loaded catalog bundle:\",\"bundleId\":\"test\",\"catalogBundle\":{\"id\":\"test\",\"name\":\"Test\",\"levelName\":\"Test\",\"enable\":\"on-pass\",\"hidden\":true,\"allocation\":\"on-request\",\"timeout\":\"P1D\",\"tokensGranted\":10}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.299Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T20:34:16.299Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"[Catalog bundle] Bundle requires manual allocation, proceeding:\",\"requestedBundle\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.299Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T20:34:16.299Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"[Catalog bundle] No cap defined for bundle:\",\"requestedBundle\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.299Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T20:34:16.299Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"Granting bundle to user:\",\"userId\":\"user\",\"requestedBundle\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.299Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T20:34:16.299Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"New bundle details:\",\"newBundle\":{\"bundleId\":\"test\",\"expiry\":\"2026-02-04\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.299Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T20:34:16.299Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"Updated user bundles:\",\"userId\":\"user\",\"currentBundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.300Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:16.300Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"putBundle [table: test-bundle-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.300Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:16.300Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"Storing bundle\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"userId\":\"user\",\"bundle\":{\"bundleId\":\"test\",\"expiry\":\"2026-02-04\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.300Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:16.300Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"Storing bundle in DynamoDB as item\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"item\":{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T20:34:16.300Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.303Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:16.303Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"Bundle stored in DynamoDB as item\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"item\":{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T20:34:16.300Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.303Z","msg":"[http-stdout]: {\"_aws\":{\"Timestamp\":1770150856303,\"CloudWatchMetrics\":[{\"Namespace\":\"Submit/BundleCapacity\",\"Dimensions\":[[\"bundleId\"]],\"Metrics\":[{\"Name\":\"BundleGranted\",\"Unit\":\"Count\"}]}]},\"bundleId\":\"test\",\"BundleGranted\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.303Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T20:34:16.303Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"Bundle granted to user:\",\"userId\":\"user\",\"newBundle\":{\"bundleId\":\"test\",\"expiry\":\"2026-02-04\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.303Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/passPost.js\",\"time\":\"2026-02-03T20:34:16.303Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"Pass redeemed and bundle granted\",\"code\":\"gamma-booth-serve-scene\",\"bundleId\":\"test\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.304Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:16.304Z\",\"requestId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/pass\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"ff5a50ea-ec68-4e69-a506-40c1534725f4\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"redeemed\\\":true,\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04\\\",\\\"grantStatus\\\":\\\"granted\\\"}\"}}"}
Pass redemption result: {"redeemed":true,"bundleId":"test","expiry":"2026-02-04","grantStatus":"granted"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.398Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.398Z\",\"msg\":\"HTTP GET /bundles.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.425Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.410Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.428Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.426Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.427Z\",\"msg\":\"HTTP GET /developer-mode.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.431Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.428Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.428Z\",\"msg\":\"HTTP GET /lib/bundle-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.430Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.433Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.431Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.432Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.432Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.437Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.436Z\",\"msg\":\"HTTP GET /widgets/loading-spinner.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.437Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.451Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.439Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.457Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.453Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.453Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.454Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.454Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.456Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.456Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.464Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.459Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.462Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.462Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.471Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.466Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.479Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.479Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.479Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.479Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.480Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.482Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.482Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.485Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.490Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.488Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:16.488Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:16.488Z\",\"requestId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/bundles.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:16.488Z\",\"requestId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:16.488Z\",\"requestId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:16.489Z\",\"requestId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:16.489Z\",\"requestId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:16.489Z\",\"requestId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:16.489Z\",\"requestId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.494Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.493Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.493Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.494Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:16.494Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.496Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:16.494Z\",\"requestId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/bundles.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:16.495Z\",\"requestId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:16.495Z\",\"requestId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:16.495Z\",\"requestId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:16.495Z\",\"requestId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:16.495Z\",\"requestId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:16.495Z\",\"requestId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.498Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.498Z\",\"msg\":\"HTTP GET /submit.environment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.501Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:16.501Z\",\"requestId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.502Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:16.501Z\",\"requestId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:16.501Z\",\"requestId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.504Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:16.504Z\",\"requestId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.505Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:16.504Z\",\"requestId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"578fc780-cb16-411f-b11b-2062f2973786\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.510Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:16.509Z\",\"requestId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:16.509Z\",\"requestId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:16.509Z\",\"requestId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.515Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:16.511Z\",\"requestId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:16.512Z\",\"requestId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"ed33b803-3c9a-47b5-9c31-13efd843f4bf\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:16.517Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:16.516Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
Returning to home via home icon...
[USER INTERACTION] Clicking: .home-link - Home icon
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.377Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.377Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.398Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.397Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.398Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.400Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.399Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.399Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.400Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.400Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.400Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.403Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.402Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.404Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.403Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.404Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.421Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.413Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.427Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.429Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.423Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.423Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.424Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.425Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.425Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.425Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.434Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.433Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.433Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.442Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.442Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.442Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.442Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.443Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.444Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.448Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.448Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.452Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.455Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.447Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:17.448Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:17.448Z\",\"requestId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:17.448Z\",\"requestId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:17.448Z\",\"requestId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:17.448Z\",\"requestId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:17.449Z\",\"requestId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:17.449Z\",\"requestId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:17.449Z\",\"requestId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.458Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.458Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.458Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.461Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.458Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:17.459Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:17.460Z\",\"requestId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:17.460Z\",\"requestId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:17.460Z\",\"requestId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:17.461Z\",\"requestId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:17.461Z\",\"requestId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.463Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:17.461Z\",\"requestId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:17.462Z\",\"requestId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.466Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:17.465Z\",\"requestId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:17.465Z\",\"requestId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:17.465Z\",\"requestId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.468Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:17.467Z\",\"requestId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.468Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:17.467Z\",\"requestId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"af72401e-1e14-46c3-a109-bffc774e5713\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.470Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:17.469Z\",\"requestId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.470Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:17.470Z\",\"requestId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:17.470Z\",\"requestId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.473Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:17.472Z\",\"requestId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:17.472Z\",\"requestId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"2a51ca05-b3ca-4d39-9eb5-bf271c1c7dc1\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.479Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.478Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:17.485Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:17.484Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:18.193Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:18.202Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:18.202Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:18.202Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:18.202Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:18.203Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:18.203Z\",\"requestId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:18.203Z\",\"requestId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:18.203Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:18.203Z\",\"requestId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:18.203Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:18.203Z\",\"requestId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:18.203Z\",\"requestId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:18.203Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:18.203Z\",\"requestId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:18.203Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:18.203Z\",\"requestId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:18.206Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:18.206Z\",\"requestId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:18.206Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:18.206Z\",\"requestId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:18.206Z\",\"requestId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:18.207Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:18.207Z\",\"requestId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:18.207Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:18.207Z\",\"requestId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"6c04a871-0cc3-4917-82e3-7e8a596208ce\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
[Token check] Tokens before submission: 10
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:18.212Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: button:has-text('Submit VAT (HMRC Sandbox)') - Starting VAT return submission
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:18.997Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:18.997Z\",\"msg\":\"HTTP GET /hmrc/vat/submitVat.html?hmrcAccount=sandbox\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.021Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.011Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.011Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.011Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.023Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.022Z\",\"msg\":\"HTTP GET /lib/test-data-generator.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.023Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.024Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.023Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.023Z\",\"msg\":\"HTTP GET /lib/utils/obligation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.025Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.024Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.029Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.028Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.029Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.029Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.038Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.034Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.056Z","msg":"[BROWSER CONSOLE log]: JS block finished loading."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.058Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.055Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.055Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.056Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.060Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.059Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.059Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.061Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.060Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.062Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.061Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.061Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.063Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.062Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.064Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.064Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.073Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.074Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.078Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.078Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.083Z","msg":"[BROWSER CONSOLE log]: JS block started loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.084Z","msg":"[BROWSER CONSOLE log]: OAuth callback handler (no action taken)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.084Z","msg":"[BROWSER CONSOLE log]: JS block finished loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.087Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.084Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.084Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:19.085Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:19.085Z\",\"requestId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:19.085Z\",\"requestId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:19.085Z\",\"requestId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:19.086Z\",\"requestId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:19.086Z\",\"requestId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:19.086Z\",\"requestId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:19.086Z\",\"requestId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.088Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.089Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.088Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:19.089Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.091Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:19.089Z\",\"requestId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:19.089Z\",\"requestId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:19.089Z\",\"requestId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:19.089Z\",\"requestId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:19.089Z\",\"requestId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:19.090Z\",\"requestId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:19.090Z\",\"requestId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.093Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:19.091Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:19.092Z\",\"requestId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:19.092Z\",\"requestId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:19.092Z\",\"requestId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.094Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:19.093Z\",\"requestId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:19.093Z\",\"requestId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"e4bb6cce-cb34-4930-abc6-d786d5923585\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.095Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:19.095Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.096Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:19.096Z\",\"requestId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"content-type\":\"application/json\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:19.096Z\",\"requestId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:19.096Z\",\"requestId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:19.096Z\",\"requestId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:19.096Z\",\"requestId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.097Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:19.096Z\",\"requestId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:19.096Z\",\"requestId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.098Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:19.098Z\",\"requestId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:19.098Z\",\"requestId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:19.098Z\",\"requestId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.099Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:19.099Z\",\"requestId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.099Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:19.099Z\",\"requestId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"0892a7f2-b05a-48a4-a0e0-d82fd6a9ea7a\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.100Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:19.100Z\",\"requestId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.101Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:19.100Z\",\"requestId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:19.100Z\",\"requestId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.102Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:19.102Z\",\"requestId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:19.102Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:19.102Z\",\"requestId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"9ab41a8d-7afc-4f49-97cc-2624cda8221f\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:20.280Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Filling: #vatNumber with value: "814376350" - Entering VAT number
Set period dates: 2017-01-01 to 2017-03-31
[USER INTERACTION] Filling: #vatDueSales with value: "1000.00" - Entering VAT due on sales (Box 1)
[USER INTERACTION] Filling: #vatDueAcquisitions with value: "0.00" - Entering VAT due on acquisitions (Box 2)
[USER INTERACTION] Filling: #vatReclaimedCurrPeriod with value: "0.00" - Entering VAT reclaimed (Box 4)
[USER INTERACTION] Filling: #totalValueSalesExVAT with value: "5000" - Entering total sales ex VAT (Box 6)
[USER INTERACTION] Filling: #totalValuePurchasesExVAT with value: "0" - Entering total purchases ex VAT (Box 7)
[USER INTERACTION] Filling: #totalValueGoodsSuppliedExVAT with value: "0" - Entering goods supplied to EU (Box 8)
[USER INTERACTION] Filling: #totalAcquisitionsExVAT with value: "0" - Entering acquisitions from EU (Box 9)
Checked declaration checkbox
Enabled developer mode for test scenario
Developer section visible (controlled by global developer mode)
Checked runFraudPreventionHeaderValidation checkbox
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:23.489Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
Checked allowSandboxObligations checkbox
[USER INTERACTION] Focusing: #submitBtn - the Submit button
[USER INTERACTION] Clicking: #submitBtn - Submitting VAT form
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:24.808Z","msg":"[BROWSER CONSOLE log]: Status message: Initiating HMRC authentication... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:24.809Z","msg":"[BROWSER CONSOLE log]: Stored pending request and current activity: {\"vatNumber\":\"[VRN]\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":5000,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0,\"finalised\":true,\"testScenario\":\"\",\"runFraudPreventionHeaderValidation\":true,\"allowSandboxObligations\":true} /hmrc/vat/submitVat.html sandbox"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:24.810Z","msg":"[BROWSER CONSOLE log]: Using client-side generated HMRC Auth URL: http://localhost:9000/oauth/authorize?response_type=code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Factivities%2FsubmitVatCallback.html&scope=write%3Avat%20read%3Avat&state=3956cad4776548588164ec2a922fb01c"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:24.810Z","msg":"[BROWSER CONSOLE log]: Current activity set to: /hmrc/vat/submitVat.html"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:24.810Z","msg":"[BROWSER CONSOLE log]: Status message: Redirecting to HMRC for authentication at http://localhost:9000/oauth/authorize?response_type=code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Factivities%2FsubmitVatCallback.html&scope=write%3Avat%20read%3Avat&state=3956cad4776548588164ec2a922fb01c... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:24.810Z","msg":"[BROWSER CONSOLE log]: Page transition initiated: Redirecting to HMRC OAuth URL http://localhost:9000/oauth/authorize?response_type=code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Factivities%2FsubmitVatCallback.html&scope=write%3Avat%20read%3Avat&state=3956cad4776548588164ec2a922fb01c"}
[http-simulator] GET /oauth/authorize?response_type=code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Factivities%2FsubmitVatCallback.html&scope=write%3Avat%20read%3Avat&state=3956cad4776548588164ec2a922fb01c
[http-simulator:hmrc-oauth] GET /oauth/authorize for client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV, autoGrant=undefined
[USER INTERACTION] Clicking: Continue button - Continuing with HMRC permission
[USER INTERACTION] Clicking: [Locator] - Continue
[http-simulator] POST /oauth/authorize
[http-simulator:hmrc-oauth] POST /oauth/authorize for client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV, step=sign-in-choice
[http-simulator:hmrc-oauth] Showing sign-in choice page
[USER INTERACTION] Clicking: Sign in to HMRC button - Starting HMRC authentication
[USER INTERACTION] Clicking: [Locator] - Sign in to the HMRC online service
[http-simulator] POST /oauth/authorize
[http-simulator:hmrc-oauth] POST /oauth/authorize for client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV, step=credentials
[http-simulator:hmrc-oauth] Showing credentials page
[USER INTERACTION] Filling: #userId with value: "617432341038" - Entering HMRC user ID
[USER INTERACTION] Filling: #password with value: "2LTsAhcJDZgi" - Entering HMRC password
[USER INTERACTION] Clicking: Sign in button - Submitting HMRC credentials
[USER INTERACTION] Clicking: [Locator] - Sign in
[http-simulator] POST /oauth/authorize
[http-simulator:hmrc-oauth] POST /oauth/authorize for client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV, step=grant-permission
[http-simulator:hmrc-oauth] Showing grant permission page
[USER INTERACTION] Clicking: #givePermission - Give permission
[http-simulator] POST /oauth/authorize
[http-simulator:hmrc-oauth] POST /oauth/authorize for client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV, step=complete
[http-simulator:hmrc-oauth] Grant permission complete, generating code
[http-simulator:hmrc-oauth] Granting access, redirecting to http://localhost:3000/activities/submitVatCallback.html?code=ac6c4f528a2b4ab3a9f1b783c81fe157&state=3956cad4776548588164ec2a922fb01c
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.293Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.293Z\",\"msg\":\"HTTP GET /activities/submitVatCallback.html?code=ac6c4f528a2b4ab3a9f1b783c81fe157&state=3956cad4776548588164ec2a922fb01c\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.373Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.365Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.375Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.375Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.376Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.375Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.377Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.376Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.377Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.377Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.378Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.378Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.378Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.378Z\",\"msg\":\"HTTP GET /widgets/loading-spinner.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.379Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.379Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.402Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.393Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.407Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.404Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.404Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.405Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.405Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.405Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.405Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.411Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.410Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.411Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.416Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.417Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.418Z","msg":"[BROWSER CONSOLE log]: OAuth callback handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.418Z","msg":"[BROWSER CONSOLE log]: Page transition initiated: Clearing URL parameters"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.419Z","msg":"[BROWSER CONSOLE log]: OAuth callback handler (normal completion)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.419Z","msg":"[BROWSER CONSOLE log]: Status message: Exchanging authorization code for access token... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.419Z","msg":"[BROWSER CONSOLE log]: Exchanging token. Remote call initiated: POST /api/v1/hmrc/token ++ Body: {\"code\":\"ac6c4f528a2b4ab3a9f1b783c81fe157\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.427Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.427Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.428Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.430Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.430Z\",\"msg\":\"HTTP POST /api/v1/hmrc/token\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.431Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:31.430Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.431Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:31.431Z\",\"requestId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/token\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/token\"}},\"path\":\"/api/v1/hmrc/token\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"43\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"content-type\":\"application/json\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/activities/submitVatCallback.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"code\\\":\\\"ac6c4f528a2b4ab3a9f1b783c81fe157\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.431Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcTokenPost.js\",\"time\":\"2026-02-03T20:34:31.431Z\",\"requestId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"message\":\"Exchanging authorization code for HMRC access token\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.431Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcTokenPost.js\",\"time\":\"2026-02-03T20:34:31.431Z\",\"requestId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"msg\":\"Retrieving HMRC client secret from arn \"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.432Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcTokenPost.js\",\"time\":\"2026-02-03T20:34:31.431Z\",\"requestId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"msg\":\"Secret retrieved from override and cached\"}"}
{"level":50,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.432Z","msg":"[http-stderr]: {\"level\":50,\"time\":\"2026-02-03T20:34:31.432Z\",\"msg\":\"SENSITIVE DATA DETECTED in log output - credentials were present and have been redacted\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.432Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:31.432Z\",\"requestId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"message\":\"Request to POST http://localhost:9000/oauth/token\",\"url\":\"http://localhost:9000/oauth/token\",\"headers\":{\"Content-Type\":\"application/x-www-form-urlencoded\",\"x-request-id\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"d4b9303d-8ffc-4393-abca-71e0362103db\"},\"body\":\"grant_type=authorization_code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&[SECRET]&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Factivities%2FsubmitVatCallback.html&code=ac6c4f528a2b4ab3a9f1b783c81fe157\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.433Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:31.432Z\",\"requestId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"message\":\"Performing HTTP POST for token exchange\",\"providerUrl\":\"http://localhost:9000/oauth/token\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.435Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.435Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.435Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.435Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.436Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:31.436Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.436Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:31.436Z\",\"requestId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/activities/submitVatCallback.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.436Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:31.436Z\",\"requestId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:31.436Z\",\"requestId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:31.436Z\",\"requestId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.436Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:31.436Z\",\"requestId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.436Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.436Z\",\"requestId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.437Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.436Z\",\"requestId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
[http-simulator] POST /oauth/token
[http-simulator:hmrc-oauth] POST /oauth/token grant_type=authorization_code
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.443Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:31.441Z\",\"requestId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"message\":\"HTTP POST response received with status and duration\",\"status\":200,\"duration\":9}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.444Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:31.443Z\",\"requestId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/oauth/token\",\"method\":\"POST\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.447Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.447Z\",\"requestId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.447Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.447Z\",\"requestId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.448Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:31.447Z\",\"requestId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.449Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:31.449Z\",\"requestId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.449Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:31.449Z\",\"requestId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"334e5ac3-875f-4b20-a337-1e7d0dc34fb0\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.454Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:31.454Z\",\"requestId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/oauth/token\",\"method\":\"POST\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.454Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:31.454Z\",\"requestId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"message\":\"exchangeClientSecretForAccessToken response\",\"responseStatus\":200,\"responseTokens\":{\"access_token\":\"[REDACTED]\",\"refresh_token\":\"[REDACTED]\",\"expires_in\":14400,\"scope\":\"write:vat read:vat\",\"token_type\":\"bearer\"},\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"tokenType\":\"bearer\",\"scope\":\"write:vat read:vat\",\"expiresIn\":14400,\"hasRefreshToken\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.455Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:31.454Z\",\"requestId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"message\":\"Token exchange succeeded\",\"accessTokenLength\":59,\"hasIdToken\":false,\"hasRefreshToken\":true,\"expiresIn\":14400,\"tokenType\":\"bearer\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.455Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:31.455Z\",\"requestId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/token\",\"response\":{\"statusCode\":200,\"headers\":{\"x-request-id\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"d4b9303d-8ffc-4393-abca-71e0362103db\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"accessToken\\\":\\\"mock-hmrc-access-token-0db4cac5-f453-4574-9431-5293086a2604\\\",\\\"hmrcAccessToken\\\":\\\"mock-hmrc-access-token-0db4cac5-f453-4574-9431-5293086a2604\\\",\\\"refreshToken\\\":\\\"mock-hmrc-refresh-token-a314e9c0-5a5a-4d81-bd4d-fafc7b93d02a\\\",\\\"expiresIn\\\":14400,\\\"tokenType\\\":\\\"bearer\\\"}\"}}"}
{"level":50,"time":"2026-02-03T20:34:31.460Z","msg":"SENSITIVE DATA DETECTED in log output - credentials were present and have been redacted"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.460Z","msg":"[BROWSER CONSOLE log]: Exchanged token. Remote call completed successfully: POST /api/v1/hmrc/token {[SECRET], [SECRET], [SECRET], expiresIn: 14400, tokenType: bearer} mock-hmrc-access-token-0db4cac5-f453-4574-9431-5293086a2604"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.461Z","msg":"[BROWSER CONSOLE log]: Status message: Obtained Access Token from HMRC... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.461Z","msg":"[BROWSER CONSOLE log]: Current activity found: /hmrc/vat/submitVat.html"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.466Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.466Z\",\"msg\":\"HTTP GET /hmrc/vat/submitVat.html?hmrcAccount=sandbox\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.505Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.483Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.509Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.506Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.507Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.508Z\",\"msg\":\"HTTP GET /lib/test-data-generator.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.509Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.512Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.510Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.510Z\",\"msg\":\"HTTP GET /lib/utils/obligation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.514Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.514Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.515Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.515Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.520Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.520Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.520Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.520Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.522Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.522Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.556Z","msg":"[BROWSER CONSOLE log]: JS block finished loading."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.560Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.543Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.563Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.561Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.562Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.563Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.564Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.563Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.564Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.565Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.565Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.567Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.567Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.569Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.568Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.571Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.570Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.577Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.578Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.584Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.584Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.589Z","msg":"[BROWSER CONSOLE log]: JS block started loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.589Z","msg":"[BROWSER CONSOLE log]: Restored form draft from 2026-02-03T20:34:22.781Z"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.591Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.589Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.590Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.590Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:31.590Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.591Z","msg":"[BROWSER CONSOLE log]: OAuth callback handler (code present, auto-continue)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.593Z","msg":"[BROWSER CONSOLE log]: Retrieved submission data: {vatNumber: [VRN], periodStart: 2017-01-01, periodEnd: 2017-03-31, vatDueSales: 1000, vatDueAcquisitions: 0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.593Z","msg":"[BROWSER CONSOLE log]: Status message: Submitting VAT return to HMRC... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.593Z","msg":"[BROWSER CONSOLE log]: JS block finished loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.595Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:31.591Z\",\"requestId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:31.591Z\",\"requestId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:31.591Z\",\"requestId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:31.591Z\",\"requestId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:31.591Z\",\"requestId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.591Z\",\"requestId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.591Z\",\"requestId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:31.594Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.597Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:31.595Z\",\"requestId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:31.595Z\",\"requestId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:31.595Z\",\"requestId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:31.595Z\",\"requestId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:31.595Z\",\"requestId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.595Z\",\"requestId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.596Z\",\"requestId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.600Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.598Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.599Z\",\"requestId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.599Z\",\"requestId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:31.599Z\",\"requestId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.602Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:31.601Z\",\"requestId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:31.601Z\",\"requestId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"a267e401-d73e-4898-9a1c-79ca447d7441\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.603Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.604Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:31.603Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:31.604Z\",\"requestId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"content-type\":\"application/json\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.605Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:31.604Z\",\"requestId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:31.604Z\",\"requestId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.606Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:31.604Z\",\"requestId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:31.605Z\",\"requestId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.605Z\",\"requestId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.605Z\",\"requestId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.608Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.607Z\",\"requestId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.607Z\",\"requestId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:31.607Z\",\"requestId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.608Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:31.608Z\",\"requestId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.609Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:31.608Z\",\"requestId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"000d154f-9a4f-41cd-83f3-e63e527c70b1\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.610Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.610Z\",\"requestId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.611Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.610Z\",\"requestId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.611Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:31.610Z\",\"requestId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.612Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:31.612Z\",\"requestId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.612Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:31.612Z\",\"requestId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"9b8047ca-1d56-451b-8b60-bb6e279f7bb7\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.689Z","msg":"[BROWSER CONSOLE log]: Submitting VAT. Remote call initiated: POST /api/v1/hmrc/vat/return ++ Body: {\"vatNumber\":\"[VRN]\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":5000,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0,\"finalised\":true,\"accessToken\":\"mock-hmrc-access-token-0db4cac5-f453-4574-9431-5293086a2604\",\"runFraudPreventionHeaderValidation\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.695Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:31.695Z\",\"msg\":\"HTTP POST /api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.696Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:31.696Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.697Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:31.697Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"434\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:34:31.688Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"4b51562b-9511-4bdb-b30e-fda560b2bb40\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-initial-request\":\"true\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"bad540e7-7c35-4419-9ad2-b4ac486f453a\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"vatNumber\\\":\\\"[VRN]\\\",\\\"periodStart\\\":\\\"2017-01-01\\\",\\\"periodEnd\\\":\\\"2017-03-31\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true,\\\"accessToken\\\":\\\"mock-hmrc-access-token-0db4cac5-f453-4574-9431-5293086a2604\\\",\\\"runFraudPreventionHeaderValidation\\\":true}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.697Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:31.697Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.698Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:31.697Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Extracting user information from event\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.698Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:31.698Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.699Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:31.699Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"434\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:34:31.688Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"4b51562b-9511-4bdb-b30e-fda560b2bb40\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-initial-request\":\"true\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"bad540e7-7c35-4419-9ad2-b4ac486f453a\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"vatNumber\\\":\\\"[VRN]\\\",\\\"periodStart\\\":\\\"2017-01-01\\\",\\\"periodEnd\\\":\\\"2017-03-31\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true,\\\"accessToken\\\":\\\"mock-hmrc-access-token-0db4cac5-f453-4574-9431-5293086a2604\\\",\\\"runFraudPreventionHeaderValidation\\\":true}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.702Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:31.701Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.702Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.702Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.702Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.702Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.706Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.706Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.706Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.706Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:31.706Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T20:34:16.300Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.707Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:31.707Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\",\"requiredBundleIds\":[\"test\",\"day-guest\",\"invited-guest\",\"resident-guest\",\"resident-pro-comp\",\"resident-pro\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.707Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:31.707Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.708Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/lib/buildFraudHeaders.js\",\"time\":\"2026-02-03T20:34:31.708Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"No public client IP detected in X-Forwarded-For\",\"xff\":\"\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.709Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:31.708Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"accessTokenPrefix\":\"mock-hmr...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.709Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:34:31.709Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"Checking for test scenario\":null}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:34:31.709Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Resolving periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vatNumber\":\"[VRN]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.709Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:34:31.709Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"msg\":\"Validating fraud prevention headers for HMRC API request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.709Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:31.709Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Validating fraud prevention headers\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
[http-simulator] GET /test/fraud-prevention-headers/validate
[http-simulator:fraud-headers] GET /test/fraud-prevention-headers/validate
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.713Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:31.713Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"VALID_WITH_WARNINGS\",\"validationMessage\":\"Headers valid with warnings\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.713Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:31.713Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]},{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-client-public-port\"]}]}\n{\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:31.713Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.717Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:31.717Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.718Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:31.718Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Request to GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"Gov-Client-Device-ID\":\"4b51562b-9511-4bdb-b30e-fda560b2bb40\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:34:31.688Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"http://localhost:9000\"}}"}
[http-simulator] GET /organisations/vat/814376350/obligations?from=2017-01-01&to=2017-03-31&status=O
[http-simulator:vat-obligations] GET /organisations/vat/814376350/obligations from=2017-01-01 to=2017-03-31
[http-simulator:scenarios] Using default obligations with random periodKey: 25LZ
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.722Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:31.722Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Response from GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"status\":200,\"hmrcResponseBody\":{\"obligations\":[{\"periodKey\":\"20J7\",\"start\":\"2017-04-01\",\"end\":\"2017-06-30\",\"due\":\"2017-08-07\",\"status\":\"O\"}]}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.723Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:31.722Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.727Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:31.727Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.727Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:34:31.727Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"allowSandboxObligations: Using first available open obligation with the requested year injected\",\"requestedPeriod\":{\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\"},\"rawPeriodKey\":\"20J7\",\"usedObligation\":\"17J7\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.727Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:34:31.727Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Resolved periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"resolvedPeriodKey\":\"17J7\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.730Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.730Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.731Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.730Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.734Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.733Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.734Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.734Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.734Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.734Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"consumeToken [table: test-bundle-table]\",\"bundleId\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.739Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:31.739Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Token consumed\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"bundleId\":\"test\",\"tokensRemaining\":9}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.739Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/tokenEnforcement.js\",\"time\":\"2026-02-03T20:34:31.739Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Token consumption result\",\"userId\":\"user\",\"activityId\":\"submit-vat-sandbox\",\"bundleId\":\"test\",\"consumed\":true,\"tokensRemaining\":9}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.739Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:34:31.739Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Token consumed for submission\",\"activityId\":\"submit-vat-sandbox\",\"tokensRemaining\":9}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.739Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:34:31.739Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.740Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:34:31.739Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Initiating new processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.740Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:31.740Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Marking request as processing in DynamoDB\",\"userId\":\"user\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.740Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:31.740Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-return-post-async-requests-table]\",\"status\":\"processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.740Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:31.740Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Starting async processing locally (no SQS queue URL)\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.741Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:34:31.741Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Validating fraud prevention headers for sandbox account\",\"hmrcAccount\":\"sandbox\",\"runFraudPreventionHeaderValidation\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.741Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:31.741Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Validating fraud prevention headers\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
[http-simulator] GET /test/fraud-prevention-headers/validate
[http-simulator:fraud-headers] GET /test/fraud-prevention-headers/validate
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.744Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:31.743Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Checking persisted request status\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.744Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:31.744Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-return-post-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.750Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:31.749Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"VALID_WITH_WARNINGS\",\"validationMessage\":\"Headers valid with warnings\"}\n{\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:31.749Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]},{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-client-public-port\"]}]}\n{\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:31.749Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.753Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:31.753Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.754Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:31.753Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.754Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:31.754Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Yielding with HTTP 202 Accepted\",\"location\":\"http://localhost:3000/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.754Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:31.754Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"response\":{\"statusCode\":202,\"headers\":{\"Gov-Client-Device-ID\":\"4b51562b-9511-4bdb-b30e-fda560b2bb40\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:34:31.688Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"Retry-After\":\"5\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"Location\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"message\\\":\\\"Request accepted for processing\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.758Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:31.757Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:34:31.757Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Request to POST http://localhost:9000/organisations/vat/[VRN]/returns\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"Gov-Client-Device-ID\":\"4b51562b-9511-4bdb-b30e-fda560b2bb40\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:34:31.688Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"body\":{\"periodKey\":\"17J7\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":5000,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0,\"finalised\":true},\"environment\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.758Z","msg":"[BROWSER CONSOLE log]: waiting async request [POST /api/v1/hmrc/vat/return] (timeout: 1630000ms)..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.758Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:31.758Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Request to POST http://localhost:9000/organisations/vat/[VRN]/returns\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns\",\"method\":\"POST\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"Gov-Client-Device-ID\":\"4b51562b-9511-4bdb-b30e-fda560b2bb40\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:34:31.688Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"body\":\"{\\\"periodKey\\\":\\\"17J7\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true}\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.759Z","msg":"[BROWSER CONSOLE log]: Status message: Still processing... (poll #1) Type: info"}
[http-simulator] POST /organisations/vat/814376350/returns
[http-simulator:vat-returns] POST /organisations/vat/814376350/returns
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.763Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:31.762Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Response from POST http://localhost:9000/organisations/vat/[VRN]/returns\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns\",\"status\":201,\"hmrcResponseBody\":{\"processingDate\":\"2026-02-03T20:34:31.760Z\",\"formBundleNumber\":\"899940427284\",\"paymentIndicator\":\"DD\",\"chargeRefNumber\":\"JKKvlNnXUyI8IJ6r\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.763Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:31.763Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns\",\"method\":\"POST\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.766Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:31.766Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns\",\"method\":\"POST\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.767Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:34:31.766Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Received HMRC response: {}\",\"httpResult\":{\"hmrcResponse\":{},\"hmrcResponseBody\":{\"processingDate\":\"2026-02-03T20:34:31.760Z\",\"formBundleNumber\":\"899940427284\",\"paymentIndicator\":\"DD\",\"chargeRefNumber\":\"JKKvlNnXUyI8IJ6r\"}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.767Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:34:31.767Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"DynamoDB enabled, proceeding with putReceipt [table: test-receipts-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.768Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:34:31.767Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Storing receipt\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"userSub\":\"user\",\"receiptId\":\"2026-02-03T20:34:31.767Z-899940427284\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.768Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:34:31.768Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Storing receipt in DynamoDB as item\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"receiptId\":\"2026-02-03T20:34:31.767Z-899940427284\",\"ttl_datestamp\":\"2033-02-01T20:34:31.768Z\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.772Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:34:31.771Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Receipt stored in DynamoDB as item\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"receiptId\":\"2026-02-03T20:34:31.767Z-899940427284\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.772Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:31.772Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Local async processing completed successfully\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.772Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:31.772Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Marking async request as completed\",\"userSub\":\"user\",\"asyncRequestsTableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.772Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:31.772Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-return-post-async-requests-table]\",\"status\":\"completed\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:31.776Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:31.776Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.759Z","msg":"[BROWSER CONSOLE log]: re-trying async request [POST /api/v1/hmrc/vat/return] (poll #1, elapsed: 1001ms, timeout: 1630000ms, last status: 202)..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.763Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:32.762Z\",\"msg\":\"HTTP POST /api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.763Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:32.763Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.763Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:32.763Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"434\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:34:31.688Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"4b51562b-9511-4bdb-b30e-fda560b2bb40\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"bad540e7-7c35-4419-9ad2-b4ac486f453a\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"vatNumber\\\":\\\"[VRN]\\\",\\\"periodStart\\\":\\\"2017-01-01\\\",\\\"periodEnd\\\":\\\"2017-03-31\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true,\\\"accessToken\\\":\\\"mock-hmrc-access-token-0db4cac5-f453-4574-9431-5293086a2604\\\",\\\"runFraudPreventionHeaderValidation\\\":true}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.764Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:32.763Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:32.763Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Extracting user information from event\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:32.763Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.764Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:32.764Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"434\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:34:31.688Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"4b51562b-9511-4bdb-b30e-fda560b2bb40\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"bad540e7-7c35-4419-9ad2-b4ac486f453a\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"vatNumber\\\":\\\"[VRN]\\\",\\\"periodStart\\\":\\\"2017-01-01\\\",\\\"periodEnd\\\":\\\"2017-03-31\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true,\\\"accessToken\\\":\\\"mock-hmrc-access-token-0db4cac5-f453-4574-9431-5293086a2604\\\",\\\"runFraudPreventionHeaderValidation\\\":true}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.765Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:32.764Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.765Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:32.765Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:32.765Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.767Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:32.767Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.767Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:32.767Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.767Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:32.767Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T20:34:16.300Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.767Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:32.767Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\",\"requiredBundleIds\":[\"test\",\"day-guest\",\"invited-guest\",\"resident-guest\",\"resident-pro-comp\",\"resident-pro\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.767Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:32.767Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.768Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/lib/buildFraudHeaders.js\",\"time\":\"2026-02-03T20:34:32.767Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"No public client IP detected in X-Forwarded-For\",\"xff\":\"\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.768Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:32.768Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"accessTokenPrefix\":\"mock-hmr...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.768Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:34:32.768Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"Checking for test scenario\":null}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.768Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:34:32.768Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Resolving periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vatNumber\":\"[VRN]\"}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:34:32.768Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"msg\":\"Validating fraud prevention headers for HMRC API request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.768Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:32.768Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Validating fraud prevention headers\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
[http-simulator] GET /test/fraud-prevention-headers/validate
[http-simulator:fraud-headers] GET /test/fraud-prevention-headers/validate
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.770Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:32.770Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"VALID_WITH_WARNINGS\",\"validationMessage\":\"Headers valid with warnings\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.770Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:32.770Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]},{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-client-public-port\"]}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.770Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:32.770Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.773Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:32.773Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.773Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:32.773Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Request to GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"Gov-Client-Device-ID\":\"4b51562b-9511-4bdb-b30e-fda560b2bb40\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:34:31.688Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"http://localhost:9000\"}}"}
[http-simulator] GET /organisations/vat/814376350/obligations?from=2017-01-01&to=2017-03-31&status=O
[http-simulator:vat-obligations] GET /organisations/vat/814376350/obligations from=2017-01-01 to=2017-03-31
[http-simulator:scenarios] Using default obligations with random periodKey: 24GY
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.774Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:32.774Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Response from GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"status\":200,\"hmrcResponseBody\":{\"obligations\":[{\"periodKey\":\"22E6\",\"start\":\"2017-04-01\",\"end\":\"2017-06-30\",\"due\":\"2017-08-07\",\"status\":\"O\"}]}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.774Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:32.774Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.777Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:32.777Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.778Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:34:32.777Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"allowSandboxObligations: Using first available open obligation with the requested year injected\",\"requestedPeriod\":{\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\"},\"rawPeriodKey\":\"22E6\",\"usedObligation\":\"17E6\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.778Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:34:32.777Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Resolved periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"resolvedPeriodKey\":\"17E6\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.778Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:32.778Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-return-post-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.780Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:32.780Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.781Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:34:32.780Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":false}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T20:34:32.780Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Found persisted request\",\"status\":\"completed\"}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:32.780Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.781Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:32.781Z\",\"requestId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"response\":{\"statusCode\":200,\"headers\":{\"Gov-Client-Device-ID\":\"4b51562b-9511-4bdb-b30e-fda560b2bb40\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:34:31.688Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"c978a330-782f-4b6c-9b2f-403308229310\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"receipt\\\":{\\\"processingDate\\\":\\\"2026-02-03T20:34:31.760Z\\\",\\\"formBundleNumber\\\":\\\"899940427284\\\",\\\"paymentIndicator\\\":\\\"DD\\\",\\\"chargeRefNumber\\\":\\\"JKKvlNnXUyI8IJ6r\\\"},\\\"hmrcResponse\\\":{\\\"ok\\\":true,\\\"status\\\":201,\\\"statusText\\\":\\\"Created\\\",\\\"headers\\\":{\\\"access-control-allow-headers\\\":\\\"Content-Type, Authorization, Accept\\\",\\\"access-control-allow-methods\\\":\\\"GET, POST, PUT, DELETE, OPTIONS\\\",\\\"access-control-allow-origin\\\":\\\"*\\\",\\\"connection\\\":\\\"keep-alive\\\",\\\"content-length\\\":\\\"140\\\",\\\"content-type\\\":\\\"application/json; charset=utf-8\\\",\\\"date\\\":\\\"Tue, 03 Feb 2026 20:34:31 GMT\\\",\\\"etag\\\":\\\"W/\\\\\\\"8c-+Mr0IoU+D2kYs+yCH04b5JS1yHs\\\\\\\"\\\",\\\"keep-alive\\\":\\\"timeout=5\\\",\\\"receipt-id\\\":\\\"22d0508b-5f1a-48ea-8fa9-bd39370e6547\\\",\\\"receipt-signature\\\":\\\"This has been deprecated - DO NOT USE\\\",\\\"receipt-timestamp\\\":\\\"2026-02-03T20:34:31Z\\\",\\\"x-correlationid\\\":\\\"7fc28a14-9547-405d-a3fa-6d3a382a6170\\\",\\\"x-powered-by\\\":\\\"Express\\\"}},\\\"hmrcResponseBody\\\":{\\\"processingDate\\\":\\\"2026-02-03T20:34:31.760Z\\\",\\\"formBundleNumber\\\":\\\"899940427284\\\",\\\"paymentIndicator\\\":\\\"DD\\\",\\\"chargeRefNumber\\\":\\\"JKKvlNnXUyI8IJ6r\\\"},\\\"periodKey\\\":\\\"17J7\\\",\\\"receiptId\\\":\\\"2026-02-03T20:34:31.767Z-899940427284\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.785Z","msg":"[BROWSER CONSOLE log]: finished async request [POST /api/v1/hmrc/vat/return] (poll #1, elapsed: 1025ms, status: 200)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.785Z","msg":"[BROWSER CONSOLE log]: Status message: VAT return processed Type: success"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.786Z","msg":"[BROWSER CONSOLE log]: Page display transition: Displaying receipt and hiding form {receipt: Object, hmrcResponse: Object, hmrcResponseBody: Object, periodKey: 17J7, receiptId: 2026-02-03T20:34:31.767Z-899940427284}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.786Z","msg":"[BROWSER CONSOLE log]: Continue submission handler (success, session storage cleared)"}
[Test] Captured resolved periodKey from response: 17J7
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.790Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:32.790Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.790Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:32.790Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.790Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:32.790Z\",\"requestId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"content-type\":\"application/json\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.791Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:32.790Z\",\"requestId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:32.791Z\",\"requestId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.791Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:32.791Z\",\"requestId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:32.791Z\",\"requestId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.791Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:32.791Z\",\"requestId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.791Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:32.791Z\",\"requestId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.793Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:32.793Z\",\"requestId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.793Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:32.793Z\",\"requestId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:32.793Z\",\"requestId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.794Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:32.794Z\",\"requestId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:32.794Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:32.794Z\",\"requestId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"ff8030ae-8ca4-4b15-af5e-6a6da3a74bcc\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
Waiting for VAT submission to complete and receipt to be displayed...
Current URL: http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox
Page title: Submit VAT Return - DIY Accounting
Body element exists: true
Main content element exists: true
Receipt element exists: true
Receipt element style: display: block;
Form element exists: true
Form element style: display: none;
Receipt element visible: true
[waitForSuccessOrError] SUCCESS: "VAT submission receipt" detected after 0s (poll #1)
formBundleNumber validated: 899940427284
chargeRefNumber validated: JKKvlNnXUyI8IJ6r
processingDate validated: 3 February 2026 at 21:34 (parsed as 2026-02-03T20:34:00.000Z)
VAT submission flow completed successfully with validated receipt fields
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:35.643Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:35.643Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:35.643Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:35.643Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:35.644Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:35.644Z\",\"requestId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:35.644Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:35.644Z\",\"requestId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:35.644Z\",\"requestId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:35.644Z\",\"requestId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:35.644Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:35.644Z\",\"requestId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:35.644Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:35.644Z\",\"requestId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:35.644Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:35.644Z\",\"requestId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:35.647Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:35.646Z\",\"requestId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:35.647Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:35.646Z\",\"requestId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:35.647Z\",\"requestId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:35.647Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:35.647Z\",\"requestId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:35.647Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:35.647Z\",\"requestId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"ff89cfdf-28e6-4ccf-835e-530d97d68411\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
[Token check] Tokens after submission: 9
Navigating to Receipts via main navigation...
[USER INTERACTION] Clicking: nav.main-nav a:has-text('Receipts') - Clicking Receipts in main navigation
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:35.944Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:35.944Z\",\"msg\":\"HTTP GET /hmrc/receipt/receipts.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:35.965Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:35.957Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:35.957Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:35.957Z\",\"msg\":\"HTTP GET /developer-mode.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:35.970Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:35.967Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:35.967Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:35.968Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:35.968Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:35.968Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:35.968Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:35.987Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:35.984Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:35.984Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:35.984Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:35.985Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:35.985Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:35.985Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:35.989Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:35.988Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:35.988Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:35.989Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.017Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.017Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.017Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.017Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.017Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.024Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.025Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.029Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:36.024Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:36.024Z\",\"msg\":\"HTTP GET /api/v1/hmrc/receipt\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:36.024Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:36.025Z\",\"requestId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/receipt/receipts.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:36.025Z\",\"requestId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:36.025Z\",\"requestId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:36.025Z\",\"requestId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:36.025Z\",\"requestId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:36.025Z\",\"requestId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:36.025Z\",\"requestId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:36.027Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:36.027Z\",\"requestId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/receipt\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/receipt\"}},\"path\":\"/api/v1/hmrc/receipt\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/receipt/receipts.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:36.028Z\",\"requestId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:36.028Z\",\"requestId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"message\":\"Extracting user information from event\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:36.028Z\",\"requestId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:36.028Z\",\"requestId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/receipt\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/receipt\"}},\"path\":\"/api/v1/hmrc/receipt\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/receipt/receipts.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.030Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.032Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:36.029Z\",\"requestId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:36.029Z\",\"requestId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:36.029Z\",\"requestId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:36.031Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:36.031Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.034Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:36.032Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:36.032Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:36.033Z\",\"requestId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/receipt/receipts.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:36.033Z\",\"requestId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:36.033Z\",\"requestId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:36.033Z\",\"requestId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:36.033Z\",\"requestId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:36.033Z\",\"requestId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:36.033Z\",\"requestId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.037Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:36.036Z\",\"requestId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:36.036Z\",\"requestId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:36.036Z\",\"requestId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.037Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:36.037Z\",\"requestId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.037Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:36.037Z\",\"requestId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"86739350-1276-4c8f-b63d-229d2d00c831\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.038Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:36.038Z\",\"requestId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:36.038Z\",\"requestId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.038Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:36.038Z\",\"requestId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T20:34:16.300Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.039Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:36.038Z\",\"requestId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/receipt\",\"requiredBundleIds\":[\"default\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.039Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:36.039Z\",\"requestId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/receipt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.039Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcReceiptGet.js\",\"time\":\"2026-02-03T20:34:36.039Z\",\"requestId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"message\":\"Listing user receipts\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.039Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:34:36.039Z\",\"requestId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"message\":\"DynamoDB enabled, proceeding with listUserReceipts [table: test-receipts-table]\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.040Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:34:36.039Z\",\"requestId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"message\":\"Retrieving receipts from DynamoDB\",\"userSub\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.042Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:36.041Z\",\"requestId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:36.041Z\",\"requestId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:36.041Z\",\"requestId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.042Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:36.042Z\",\"requestId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.042Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:36.042Z\",\"requestId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"5fd7b0b5-79d9-4a82-9e17-f7b13c1a3992\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.044Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:34:36.044Z\",\"requestId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"message\":\"Queried DynamoDB for user receipts\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.044Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:34:36.044Z\",\"requestId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"message\":\"Retrieved receipts from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.044Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:36.044Z\",\"requestId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/receipt\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"f48aecc4-8183-4925-ba3c-5d36937fd7be\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"receipts\\\":[{\\\"receiptId\\\":\\\"2026-02-03T20:34:31.767Z-899940427284\\\",\\\"key\\\":\\\"receipts/user/2026-02-03T20:34:31.767Z-899940427284.json\\\",\\\"name\\\":\\\"2026-02-03T20:34:31.767Z-899940427284.json\\\",\\\"timestamp\\\":\\\"2026-02-03T20:34:31.767Z\\\",\\\"formBundleNumber\\\":\\\"899940427284\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:31.768Z\\\",\\\"lastModified\\\":\\\"2026-02-03T20:34:31.768Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:36.050Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:36.049Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
Checking receipts page...
Found receipts, clicking on first receipt...
[USER INTERACTION] Clicking: [Locator] - Open first receipt
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:37.476Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:37.476Z\",\"msg\":\"HTTP GET /api/v1/hmrc/receipt/2026-02-03T20%3A34%3A31.767Z-899940427284.json\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:37.478Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:37.477Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:37.477Z\",\"requestId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/receipt/2026-02-03T20%3A34%3A31.767Z-899940427284.json\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/receipt/2026-02-03T20%3A34%3A31.767Z-899940427284.json\"}},\"path\":\"/api/v1/hmrc/receipt/2026-02-03T20%3A34%3A31.767Z-899940427284.json\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/receipt/receipts.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{\"name\":\"2026-02-03T20:34:31.767Z-899940427284.json\"}}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:37.477Z\",\"requestId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:37.477Z\",\"requestId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"message\":\"Extracting user information from event\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:37.477Z\",\"requestId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:37.478Z\",\"requestId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/receipt/2026-02-03T20%3A34%3A31.767Z-899940427284.json\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/receipt/2026-02-03T20%3A34%3A31.767Z-899940427284.json\"}},\"path\":\"/api/v1/hmrc/receipt/2026-02-03T20%3A34%3A31.767Z-899940427284.json\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/receipt/receipts.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{\"name\":\"2026-02-03T20:34:31.767Z-899940427284.json\"}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:37.479Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:37.478Z\",\"requestId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:37.479Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:37.479Z\",\"requestId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:37.479Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:37.479Z\",\"requestId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:37.481Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:37.481Z\",\"requestId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:37.482Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:37.481Z\",\"requestId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:37.482Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:37.482Z\",\"requestId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T20:34:16.300Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:37.482Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:37.482Z\",\"requestId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/receipt/2026-02-03T20%3A34%3A31.767Z-899940427284.json\",\"requiredBundleIds\":[\"default\"],\"currentBundleIds\":{}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:37.482Z\",\"requestId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/receipt/2026-02-03T20%3A34%3A31.767Z-899940427284.json\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:37.482Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcReceiptGet.js\",\"time\":\"2026-02-03T20:34:37.482Z\",\"requestId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"message\":\"Retrieving single receipt\",\"receiptId\":\"2026-02-03T20:34:31.767Z-899940427284\",\"key\":\"receipts/user/2026-02-03T20:34:31.767Z-899940427284.json\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:37.482Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:34:37.482Z\",\"requestId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"message\":\"DynamoDB enabled, proceeding with getReceipt [table: test-receipts-table]\",\"userSub\":\"user\",\"receiptId\":\"2026-02-03T20:34:31.767Z-899940427284\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:37.482Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:34:37.482Z\",\"requestId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"message\":\"Retrieving receipt from DynamoDB\",\"userSub\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"receiptId\":\"2026-02-03T20:34:31.767Z-899940427284\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:37.484Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T20:34:37.484Z\",\"requestId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"1dfca3e8-a7d5-4e78-8a0e-2cafe1ef119e\",\"message\":\"Retrieved receipt from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"receiptId\":\"2026-02-03T20:34:31.767Z-899940427284\"}"}
Returning to home via main navigation...
[USER INTERACTION] Clicking: nav.main-nav a:has-text('Activities') - Clicking Activities in main navigation
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.392Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.392Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.412Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.402Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.415Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.413Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.414Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.414Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.415Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.416Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.415Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.415Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.418Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.417Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.418Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.418Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.437Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.428Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.428Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.429Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.438Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.440Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.438Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.439Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.439Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.440Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.441Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.440Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.440Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.448Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.448Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.448Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.449Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.449Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.450Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.455Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.455Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.459Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.454Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:38.455Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:38.455Z\",\"requestId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:38.455Z\",\"requestId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:38.455Z\",\"requestId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:38.455Z\",\"requestId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:38.455Z\",\"requestId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:38.455Z\",\"requestId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:38.455Z\",\"requestId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.460Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.462Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.461Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.461Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.462Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.464Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:38.462Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:38.462Z\",\"requestId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:38.462Z\",\"requestId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:38.462Z\",\"requestId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:38.463Z\",\"requestId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:38.463Z\",\"requestId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:38.463Z\",\"requestId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:38.463Z\",\"requestId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.466Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:38.465Z\",\"requestId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:38.465Z\",\"requestId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:38.465Z\",\"requestId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.466Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:38.466Z\",\"requestId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:38.466Z\",\"requestId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"d11fb907-ce69-4d0c-8e8c-5802c9b9fa2e\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.467Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:38.467Z\",\"requestId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.467Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:38.467Z\",\"requestId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:38.467Z\",\"requestId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.468Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:38.468Z\",\"requestId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.469Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:38.468Z\",\"requestId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"8ffdee9b-ac07-416e-bd79-724d83586d75\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.476Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.474Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.478Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:38.478Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:38.578Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: button:has-text('View VAT Return (HMRC Sandbox)') - Starting View VAT Return
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.343Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.343Z\",\"msg\":\"HTTP GET /hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.366Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.357Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.358Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.358Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.371Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.369Z\",\"msg\":\"HTTP GET /lib/test-data-generator.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.370Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.370Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.371Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.371Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.372Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.371Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.374Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.374Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.377Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.375Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.396Z","msg":"[BROWSER CONSOLE log]: JS block finished loading."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.399Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.399Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.400Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.399Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.400Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.400Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.400Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.400Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.400Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.401Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.401Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.403Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.403Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.404Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.403Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.405Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.405Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.405Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.410Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.412Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.416Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.416Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.418Z","msg":"[BROWSER CONSOLE log]: JS block started loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.418Z","msg":"[BROWSER CONSOLE log]: OAuth callback handler (accessToken found)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.419Z","msg":"[BROWSER CONSOLE log]: No pending return request found"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.420Z","msg":"[BROWSER CONSOLE log]: JS block finished loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.421Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.420Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.420Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.421Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.421Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:39.421Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:39.421Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.422Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:39.421Z\",\"requestId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:39.421Z\",\"requestId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:39.421Z\",\"requestId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.422Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:39.421Z\",\"requestId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:39.422Z\",\"requestId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.422Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:39.422Z\",\"requestId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:39.422Z\",\"requestId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.424Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:39.423Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:39.424Z\",\"requestId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:39.424Z\",\"requestId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:39.424Z\",\"requestId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:39.424Z\",\"requestId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:39.424Z\",\"requestId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.424Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:39.424Z\",\"requestId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:39.424Z\",\"requestId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.425Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:39.425Z\",\"requestId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.426Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:39.425Z\",\"requestId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:39.425Z\",\"requestId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.426Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:39.426Z\",\"requestId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.426Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:39.426Z\",\"requestId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"befd8a90-2cad-4b3d-9738-8a73884a93b5\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.429Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:39.428Z\",\"requestId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:39.428Z\",\"requestId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.429Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:39.428Z\",\"requestId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.430Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:39.429Z\",\"requestId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:39.430Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:39.430Z\",\"requestId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"699d449b-a829-4a76-b9e1-31407b318511\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:40.572Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: #testDataLink a - Clicking add test data link
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:40.908Z","msg":"[BROWSER CONSOLE log]: [Test Data] Populated view VAT return form with test data"}
[USER INTERACTION] Filling: #vrn with value: "814376350" - Entering VAT registration number
Set period dates: 2017-01-01 to 2017-03-31
Enabled developer mode for test scenario
Developer section visible (controlled by global developer mode)
Checked runFraudPreventionHeaderValidation checkbox
[USER INTERACTION] Focusing: #retrieveBtn - Retrieve button
[USER INTERACTION] Clicking: #retrieveBtn - Submitting view VAT return form
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.459Z","msg":"[BROWSER CONSOLE log]: Status message: Retrieving VAT return... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.583Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:43.583Z\",\"msg\":\"HTTP GET /api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.584Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:43.584Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.585Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:43.585Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:34:43.508Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"f1ef9c83-5e7e-4ccc-9786-0dfd4a9ec214\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"x-initial-request\":\"true\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"2be9f958-5bd8-474f-bbae-98765a831f2e\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"runFraudPreventionHeaderValidation\":\"true\",\"allowSandboxObligations\":\"true\"},\"rawQueryString\":\"vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.585Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:43.585Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:43.585Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Extracting user information from event\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:43.585Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.587Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:43.586Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:34:43.508Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"f1ef9c83-5e7e-4ccc-9786-0dfd4a9ec214\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"x-initial-request\":\"true\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"2be9f958-5bd8-474f-bbae-98765a831f2e\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"runFraudPreventionHeaderValidation\":\"true\",\"allowSandboxObligations\":\"true\"},\"rawQueryString\":\"vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:43.587Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:43.587Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:43.587Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.590Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:43.590Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.590Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:43.590Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:43.590Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T20:34:16.300Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.590Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:43.590Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\",\"requiredBundleIds\":[\"test\",\"day-guest\",\"invited-guest\",\"resident-guest\",\"resident-pro-comp\",\"resident-pro\"],\"currentBundleIds\":{}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:43.590Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.591Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/lib/buildFraudHeaders.js\",\"time\":\"2026-02-03T20:34:43.590Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"No public client IP detected in X-Forwarded-For\",\"xff\":\"\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.591Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:43.591Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"accessTokenPrefix\":\"mock-hmr...\",\"isValidFormat\":true}}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:34:43.591Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\"}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:34:43.591Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Resolving periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vrn\":\"[VRN]\"}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:34:43.591Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"msg\":\"Validating fraud prevention headers for HMRC API request\"}\n{\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:43.591Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Validating fraud prevention headers\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
[http-simulator] GET /test/fraud-prevention-headers/validate
[http-simulator:fraud-headers] GET /test/fraud-prevention-headers/validate
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.596Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:43.595Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"VALID_WITH_WARNINGS\",\"validationMessage\":\"Headers valid with warnings\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.596Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:43.595Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]},{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-client-public-port\"]}]}\n{\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:43.596Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.599Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:43.598Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.599Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:43.599Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Request to GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"Gov-Client-Device-ID\":\"f1ef9c83-5e7e-4ccc-9786-0dfd4a9ec214\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:34:43.508Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"http://localhost:9000\"}}"}
[http-simulator] GET /organisations/vat/814376350/obligations?from=2017-01-01&to=2017-03-31&status=F
[http-simulator:vat-obligations] GET /organisations/vat/814376350/obligations from=2017-01-01 to=2017-03-31
[http-simulator:scenarios] Using default obligations with random periodKey: 24GY
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.601Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:43.601Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Response from GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"status\":200,\"hmrcResponseBody\":{\"obligations\":[{\"periodKey\":\"24GY\",\"start\":\"2017-01-01\",\"end\":\"2017-03-31\",\"due\":\"2017-05-07\",\"status\":\"F\",\"received\":\"2017-05-06\"}]}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.601Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:43.601Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.603Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:43.603Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.604Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:34:43.604Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Resolved periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"resolvedPeriodKey\":\"24GY\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.604Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:34:43.604Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.604Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:34:43.604Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Initiating new processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.604Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:43.604Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Marking request as processing in DynamoDB\",\"userId\":\"user\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.604Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:43.604Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-return-get-async-requests-table]\",\"status\":\"processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.604Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:43.604Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Starting async processing locally (no SQS queue URL)\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.604Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:34:43.604Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Validating fraud prevention headers for sandbox account\",\"hmrcAccount\":\"sandbox\",\"runFraudPreventionHeaderValidation\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.604Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:43.604Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Validating fraud prevention headers\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
[http-simulator] GET /test/fraud-prevention-headers/validate
[http-simulator:fraud-headers] GET /test/fraud-prevention-headers/validate
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.605Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:43.605Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Checking persisted request status\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:43.605Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-return-get-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.607Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:43.607Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"VALID_WITH_WARNINGS\",\"validationMessage\":\"Headers valid with warnings\"}\n{\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:43.607Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]},{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-client-public-port\"]}]}\n{\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:43.607Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.609Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:43.609Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.609Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:43.609Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.609Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:43.609Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Yielding with HTTP 202 Accepted\",\"location\":\"http://localhost:3000/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.610Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:43.609Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"response\":{\"statusCode\":202,\"headers\":{\"Gov-Client-Device-ID\":\"f1ef9c83-5e7e-4ccc-9786-0dfd4a9ec214\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:34:43.508Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"Retry-After\":\"5\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"Location\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"message\\\":\\\"Request accepted for processing\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.612Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:43.611Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.612Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:43.612Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Request to GET http://localhost:9000/organisations/vat/[VRN]/returns/24GY\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns/24GY\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"Gov-Client-Device-ID\":\"f1ef9c83-5e7e-4ccc-9786-0dfd4a9ec214\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:34:43.508Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"http://localhost:9000\"}}"}
[http-simulator] GET /organisations/vat/814376350/returns/24GY
[http-simulator:vat-returns] GET /organisations/vat/814376350/returns/24GY
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.613Z","msg":"[BROWSER CONSOLE log]: waiting async request [GET /api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true] (timeout: 730000ms)..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.613Z","msg":"[BROWSER CONSOLE log]: Status message: Still processing... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.614Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:43.613Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Response from GET http://localhost:9000/organisations/vat/[VRN]/returns/24GY\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns/24GY\",\"status\":200,\"hmrcResponseBody\":{\"periodKey\":\"24GY\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":0,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.614Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:43.614Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns/24GY\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.616Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:43.616Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns/24GY\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.616Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:43.616Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Local async processing completed successfully\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.616Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:43.616Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Marking async request as completed\",\"userSub\":\"user\",\"asyncRequestsTableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.617Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:43.616Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-return-get-async-requests-table]\",\"status\":\"completed\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:43.619Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:43.619Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.616Z","msg":"[BROWSER CONSOLE log]: re-trying async request [GET /api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true] (poll #1, elapsed: 1005ms, timeout: 730000ms, last status: 202)..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.620Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:44.620Z\",\"msg\":\"HTTP GET /api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.620Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:44.620Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.621Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:44.621Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:34:43.508Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"f1ef9c83-5e7e-4ccc-9786-0dfd4a9ec214\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"2be9f958-5bd8-474f-bbae-98765a831f2e\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"runFraudPreventionHeaderValidation\":\"true\",\"allowSandboxObligations\":\"true\"},\"rawQueryString\":\"vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.621Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:44.621Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:44.621Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Extracting user information from event\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:44.621Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.621Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:44.621Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:34:43.508Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"f1ef9c83-5e7e-4ccc-9786-0dfd4a9ec214\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"2be9f958-5bd8-474f-bbae-98765a831f2e\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"runFraudPreventionHeaderValidation\":\"true\",\"allowSandboxObligations\":\"true\"},\"rawQueryString\":\"vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.622Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:44.622Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.622Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:44.622Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.622Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:44.622Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.624Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:44.624Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.624Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:44.624Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.624Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:44.624Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T20:34:16.300Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.624Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:44.624Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\",\"requiredBundleIds\":[\"test\",\"day-guest\",\"invited-guest\",\"resident-guest\",\"resident-pro-comp\",\"resident-pro\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.624Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:44.624Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.625Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/lib/buildFraudHeaders.js\",\"time\":\"2026-02-03T20:34:44.624Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"No public client IP detected in X-Forwarded-For\",\"xff\":\"\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.625Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:44.625Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"accessTokenPrefix\":\"mock-hmr...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.625Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:34:44.625Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\"}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:34:44.625Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Resolving periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vrn\":\"[VRN]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.625Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:34:44.625Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"msg\":\"Validating fraud prevention headers for HMRC API request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.625Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:44.625Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Validating fraud prevention headers\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
[http-simulator] GET /test/fraud-prevention-headers/validate
[http-simulator:fraud-headers] GET /test/fraud-prevention-headers/validate
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.626Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:44.626Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"VALID_WITH_WARNINGS\",\"validationMessage\":\"Headers valid with warnings\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.626Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:44.626Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]},{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-client-public-port\"]}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.626Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:44.626Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.629Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:44.629Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.629Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:44.629Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Request to GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"Gov-Client-Device-ID\":\"f1ef9c83-5e7e-4ccc-9786-0dfd4a9ec214\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:34:43.508Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"http://localhost:9000\"}}"}
[http-simulator] GET /organisations/vat/814376350/obligations?from=2017-01-01&to=2017-03-31&status=F
[http-simulator:vat-obligations] GET /organisations/vat/814376350/obligations from=2017-01-01 to=2017-03-31
[http-simulator:scenarios] Using default obligations with random periodKey: 26C1
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.630Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:44.630Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Response from GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"status\":200,\"hmrcResponseBody\":{\"obligations\":[{\"periodKey\":\"26C1\",\"start\":\"2017-01-01\",\"end\":\"2017-03-31\",\"due\":\"2017-05-07\",\"status\":\"F\",\"received\":\"2017-05-06\"}]}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.630Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:44.630Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.633Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:44.633Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.633Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:34:44.633Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Resolved periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"resolvedPeriodKey\":\"26C1\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.633Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:44.633Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-return-get-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.635Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:44.634Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.635Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:34:44.635Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":false}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T20:34:44.635Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Found persisted request\",\"status\":\"completed\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.635Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:44.635Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.635Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:44.635Z\",\"requestId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"response\":{\"statusCode\":200,\"headers\":{\"Gov-Client-Device-ID\":\"f1ef9c83-5e7e-4ccc-9786-0dfd4a9ec214\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:34:43.508Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"8962aab9-65bc-4131-a2e7-19fb3dadbf48\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"periodKey\\\":\\\"24GY\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":0,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.708Z","msg":"[BROWSER CONSOLE log]: finished async request [GET /api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true] (poll #1, elapsed: 1092ms, status: 200)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.708Z","msg":"[BROWSER CONSOLE log]: Status message: VAT return retrieved. Type: success"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:44.711Z","msg":"[BROWSER CONSOLE log]: Hiding all status messages"}
[waitForSuccessOrError] SUCCESS: "VAT return results" detected after 0s (poll #1)
VAT due on sales validated: £1000.00
VAT due on acquisitions validated: £0.00
Total VAT due validated: £1000.00
VAT reclaimed on purchases validated: £0.00
View VAT return completed successfully with validated fields
Returning to home via main navigation...
[USER INTERACTION] Clicking: nav.main-nav a:has-text('Activities') - Clicking Activities in main navigation
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.577Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.577Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.597Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.587Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.600Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.599Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.599Z\",\"msg\":\"HTTP GET /developer-mode.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.600Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.600Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.601Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.601Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.602Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.601Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.603Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.603Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.604Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.603Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.603Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.619Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.609Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.621Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.622Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.622Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.622Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.622Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.622Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.623Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.623Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.623Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.623Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.623Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.623Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.626Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.625Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.626Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.626Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.633Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.633Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.633Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.633Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.633Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.633Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.638Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.639Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.641Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.642Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.638Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:45.638Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:45.638Z\",\"requestId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:45.638Z\",\"requestId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:45.638Z\",\"requestId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:45.638Z\",\"requestId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:45.638Z\",\"requestId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:45.638Z\",\"requestId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:45.639Z\",\"requestId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.645Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.643Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.644Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:45.644Z\",\"requestId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:45.644Z\",\"requestId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:45.644Z\",\"requestId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.646Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:45.645Z\",\"requestId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:45.645Z\",\"requestId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"b18e9827-5a75-40a5-b172-ec977ba6dd25\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.646Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.646Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.647Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:45.647Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.649Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:45.647Z\",\"requestId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:45.648Z\",\"requestId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:45.648Z\",\"requestId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:45.648Z\",\"requestId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:45.648Z\",\"requestId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:45.649Z\",\"requestId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.649Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:45.649Z\",\"requestId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.653Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.653Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.654Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:45.654Z\",\"requestId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:45.654Z\",\"requestId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:45.654Z\",\"requestId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.656Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:45.654Z\",\"requestId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:45.655Z\",\"requestId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"f01f899c-d8da-481f-a25f-76e5ee72e0ea\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.658Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:45.658Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:45.759Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: button:has-text('VAT Obligations (HMRC Sandbox)') - Starting VAT Obligations
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.545Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.545Z\",\"msg\":\"HTTP GET /hmrc/vat/vatObligations.html?hmrcAccount=sandbox\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.583Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.581Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.581Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.582Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.582Z\",\"msg\":\"HTTP GET /lib/test-data-generator.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.583Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.585Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.584Z\",\"msg\":\"HTTP GET /developer-mode.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.588Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.585Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.588Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.592Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.589Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.597Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.592Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.592Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.617Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.608Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.608Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.618Z","msg":"[BROWSER CONSOLE log]: JS block finished loading."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.622Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.618Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.619Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.620Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.621Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.621Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.621Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.626Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.625Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.627Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.627Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.634Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.634Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.640Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.640Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.641Z","msg":"[BROWSER CONSOLE log]: JS block started loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.641Z","msg":"[BROWSER CONSOLE log]: OAuth callback handler (accessToken found)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.642Z","msg":"[BROWSER CONSOLE log]: No pending obligations request found"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.642Z","msg":"[BROWSER CONSOLE log]: JS block finished loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.644Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.639Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:46.639Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:46.639Z\",\"requestId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:46.640Z\",\"requestId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:46.640Z\",\"requestId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:46.640Z\",\"requestId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:46.640Z\",\"requestId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:46.640Z\",\"requestId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:46.640Z\",\"requestId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.646Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.648Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:46.648Z\",\"requestId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:46.648Z\",\"requestId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:46.648Z\",\"requestId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.649Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:46.649Z\",\"requestId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.650Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:46.649Z\",\"requestId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"334b89cf-27cb-4bd9-afe5-5111d4ae3518\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.650Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.650Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.651Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:46.651Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.651Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:46.651Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.652Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:46.652Z\",\"requestId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:46.652Z\",\"requestId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:46.652Z\",\"requestId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.653Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:46.652Z\",\"requestId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:46.652Z\",\"requestId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:46.652Z\",\"requestId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:46.653Z\",\"requestId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.656Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:46.656Z\",\"requestId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.657Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:46.656Z\",\"requestId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.657Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:46.656Z\",\"requestId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:46.658Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:46.658Z\",\"requestId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:46.658Z\",\"requestId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"f7f118f5-d506-4a8b-b0da-c47dafc4bd6f\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:47.951Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: #testDataLink a - Clicking add test data link
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:48.257Z","msg":"[BROWSER CONSOLE log]: [Test Data] Populated VAT obligations form with test data"}
[USER INTERACTION] Filling: #vrn with value: "814376350" - Entering VAT registration number
[USER INTERACTION] Filling: #fromDate with value: "2025-01-01" - Entering from date
[USER INTERACTION] Filling: #toDate with value: "2025-12-01" - Entering to date
[USER INTERACTION] Focusing: #status - the obligations status filter
[USER INTERACTION] Focusing: #retrieveBtn - Retrieve button
[USER INTERACTION] Clicking: #retrieveBtn - Submitting VAT obligations form
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.157Z","msg":"[BROWSER CONSOLE log]: Status message: Retrieving VAT obligations... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.272Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:51.272Z\",\"msg\":\"HTTP GET /api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.273Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:51.273Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.274Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:51.274Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/obligation\"}},\"path\":\"/api/v1/hmrc/vat/obligation\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:34:51.212Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"41cc644a-9a98-4c18-b410-88ddac52e8d8\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"x-initial-request\":\"true\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"3626b8b5-4697-4134-bcb5-f67019112988\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"from\":\"2025-01-01\",\"to\":\"2025-12-01\"},\"rawQueryString\":\"vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.274Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:51.274Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:51.274Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Extracting user information from event\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:51.274Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.275Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:51.275Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/obligation\"}},\"path\":\"/api/v1/hmrc/vat/obligation\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:34:51.212Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"41cc644a-9a98-4c18-b410-88ddac52e8d8\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"x-initial-request\":\"true\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"3626b8b5-4697-4134-bcb5-f67019112988\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"from\":\"2025-01-01\",\"to\":\"2025-12-01\"},\"rawQueryString\":\"vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.276Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:51.275Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.276Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:51.276Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.276Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:51.276Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.280Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:51.280Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.280Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:51.280Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:51.280Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T20:34:16.300Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.280Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:51.280Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/obligation\",\"requiredBundleIds\":[\"test\",\"day-guest\",\"invited-guest\",\"resident-guest\",\"resident-pro-comp\",\"resident-pro\"],\"currentBundleIds\":{}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:51.280Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/obligation\"}\n{\"level\":40,\"source\":\"app/lib/buildFraudHeaders.js\",\"time\":\"2026-02-03T20:34:51.280Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"No public client IP detected in X-Forwarded-For\",\"xff\":\"\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.281Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:51.281Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"accessTokenPrefix\":\"mock-hmr...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.281Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:34:51.281Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\"}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:34:51.281Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":true}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:34:51.281Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Initiating new processing\"}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:51.281Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Marking request as processing in DynamoDB\",\"userId\":\"user\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.281Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:51.281Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-obligation-get-async-requests-table]\",\"status\":\"processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.282Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:51.281Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Starting async processing locally (no SQS queue URL)\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.282Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:34:51.282Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Skipping fraud prevention header validation for HMRC API request\",\"hmrcAccount\":\"sandbox\",\"runFraudPreventionHeaderValidation\":false}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.282Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:51.282Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Request to GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2025-01-01&to=2025-12-01\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2025-01-01&to=2025-12-01\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"Gov-Client-Device-ID\":\"41cc644a-9a98-4c18-b410-88ddac52e8d8\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:34:51.212Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"http://localhost:9000\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.283Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:51.283Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Checking persisted request status\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.283Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:51.283Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-obligation-get-async-requests-table]\"}"}
[http-simulator] GET /organisations/vat/814376350/obligations?from=2025-01-01&to=2025-12-01
[http-simulator:vat-obligations] GET /organisations/vat/814376350/obligations from=2025-01-01 to=2025-12-01
[http-simulator:scenarios] Using default obligations with random periodKey: 20Q6
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.289Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:51.289Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Response from GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2025-01-01&to=2025-12-01\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2025-01-01&to=2025-12-01\",\"status\":200,\"hmrcResponseBody\":{\"obligations\":[{\"periodKey\":\"20Q6\",\"start\":\"2017-01-01\",\"end\":\"2017-03-31\",\"due\":\"2017-05-07\",\"status\":\"F\",\"received\":\"2017-05-06\"},{\"periodKey\":\"26S2\",\"start\":\"2017-04-01\",\"end\":\"2017-06-30\",\"due\":\"2017-08-07\",\"status\":\"O\"}]}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.289Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:51.289Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2025-01-01&to=2025-12-01\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.292Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:51.292Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.293Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:51.293Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.293Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:51.293Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Yielding with HTTP 202 Accepted\",\"location\":\"http://localhost:3000/api/v1/hmrc/vat/obligation\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.293Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:51.293Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"response\":{\"statusCode\":202,\"headers\":{\"Gov-Client-Device-ID\":\"41cc644a-9a98-4c18-b410-88ddac52e8d8\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:34:51.212Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"Retry-After\":\"5\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"Location\":\"http://localhost:3000/api/v1/hmrc/vat/obligation\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"message\\\":\\\"Request accepted for processing\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.296Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T20:34:51.296Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2025-01-01&to=2025-12-01\",\"method\":\"GET\"}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:51.296Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Local async processing completed successfully\"}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:51.296Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Marking async request as completed\",\"userSub\":\"user\",\"asyncRequestsTableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:51.296Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-obligation-get-async-requests-table]\",\"status\":\"completed\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.299Z","msg":"[BROWSER CONSOLE log]: waiting async request [GET /api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01] (timeout: 730000ms)..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.300Z","msg":"[BROWSER CONSOLE log]: Status message: Still processing... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:51.301Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:51.300Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.301Z","msg":"[BROWSER CONSOLE log]: re-trying async request [GET /api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01] (poll #1, elapsed: 1001ms, timeout: 730000ms, last status: 202)..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.306Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:52.306Z\",\"msg\":\"HTTP GET /api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.306Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:52.306Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.307Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:52.307Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/obligation\"}},\"path\":\"/api/v1/hmrc/vat/obligation\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:34:51.212Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"41cc644a-9a98-4c18-b410-88ddac52e8d8\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"3626b8b5-4697-4134-bcb5-f67019112988\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"from\":\"2025-01-01\",\"to\":\"2025-12-01\"},\"rawQueryString\":\"vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.307Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:52.307Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:52.307Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Extracting user information from event\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.307Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:52.307Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.307Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:52.307Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/obligation\"}},\"path\":\"/api/v1/hmrc/vat/obligation\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T20:34:51.212Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"41cc644a-9a98-4c18-b410-88ddac52e8d8\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"gov-client-public-ip\":\"178.227.3.77\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"3626b8b5-4697-4134-bcb5-f67019112988\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"from\":\"2025-01-01\",\"to\":\"2025-12-01\"},\"rawQueryString\":\"vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.308Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:52.308Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.309Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:52.308Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.309Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:52.309Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.311Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:52.311Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.311Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:52.311Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:52.311Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T20:34:16.300Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.311Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:52.311Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/obligation\",\"requiredBundleIds\":[\"test\",\"day-guest\",\"invited-guest\",\"resident-guest\",\"resident-pro-comp\",\"resident-pro\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.312Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T20:34:52.311Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/obligation\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.312Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/lib/buildFraudHeaders.js\",\"time\":\"2026-02-03T20:34:52.312Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"No public client IP detected in X-Forwarded-For\",\"xff\":\"\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.312Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T20:34:52.312Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"accessTokenPrefix\":\"mock-hmr...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.312Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:34:52.312Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:52.312Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-obligation-get-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.314Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T20:34:52.314Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.314Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:34:52.314Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":false}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T20:34:52.314Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Found persisted request\",\"status\":\"completed\"}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:52.314Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.315Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:52.314Z\",\"requestId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"response\":{\"statusCode\":200,\"headers\":{\"Gov-Client-Device-ID\":\"41cc644a-9a98-4c18-b410-88ddac52e8d8\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T20:34:51.212Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"6e182c88-f481-4fd1-bffb-7284aa261e2d\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"obligations\\\":[{\\\"periodKey\\\":\\\"20Q6\\\",\\\"start\\\":\\\"2017-01-01\\\",\\\"end\\\":\\\"2017-03-31\\\",\\\"due\\\":\\\"2017-05-07\\\",\\\"status\\\":\\\"F\\\",\\\"received\\\":\\\"2017-05-06\\\"},{\\\"periodKey\\\":\\\"26S2\\\",\\\"start\\\":\\\"2017-04-01\\\",\\\"end\\\":\\\"2017-06-30\\\",\\\"due\\\":\\\"2017-08-07\\\",\\\"status\\\":\\\"O\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.319Z","msg":"[BROWSER CONSOLE log]: finished async request [GET /api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01] (poll #1, elapsed: 1020ms, status: 200)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.319Z","msg":"[BROWSER CONSOLE log]: Status message: VAT obligations retrieved. Type: success"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:52.320Z","msg":"[BROWSER CONSOLE log]: Hiding all status messages"}
[waitForSuccessOrError] SUCCESS: "VAT obligations results" detected after 0s (poll #1)
[verifyVatObligationsResults] Found 2 obligation(s) - validating shape
VAT Period validated: 1 Jan 2017 to 31 Mar 2017
VAT Period validated: 1 Apr 2017 to 30 Jun 2017
Dates validated for 1 Jan 2017 to 31 Mar 2017: due=7 May 2017, received=6 May 2017
Dates validated for 1 Apr 2017 to 30 Jun 2017: due=7 Aug 2017, received=-
No test scenario 1 fulfilled obligations and 1 open obligations
VAT obligations retrieval completed successfully
Returning to home via main navigation...
[USER INTERACTION] Clicking: nav.main-nav a:has-text('Activities') - Clicking Activities in main navigation
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:53.927Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:53.927Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:53.953Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:53.938Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:53.956Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:53.954Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:53.955Z\",\"msg\":\"HTTP GET /developer-mode.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:53.958Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:53.956Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:53.957Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:53.961Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:53.959Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:53.960Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:53.962Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:53.962Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:53.968Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:53.962Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:53.983Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:53.969Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:53.987Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:53.984Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:53.985Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:53.986Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:53.988Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:53.989Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:53.987Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:53.987Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:53.989Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:53.991Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:53.990Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:53.990Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:53.999Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.000Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.000Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.000Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.000Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.001Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.006Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.005Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:54.005Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:54.005Z\",\"requestId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:54.006Z\",\"requestId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:54.006Z\",\"requestId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:54.006Z\",\"requestId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:54.006Z\",\"requestId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.006Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.006Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.007Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.014Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:54.006Z\",\"requestId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:54.006Z\",\"requestId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.020Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.017Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.018Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.018Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:54.019Z\",\"requestId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:54.019Z\",\"requestId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:54.019Z\",\"requestId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.022Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:54.020Z\",\"requestId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:54.020Z\",\"requestId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"08f341a0-bb48-44a3-867c-15b37e23d079\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:54.021Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.022Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:54.022Z\",\"requestId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:54.022Z\",\"requestId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.023Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T20:34:54.022Z\",\"requestId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"07aac006-7bc8-4c9d-a6f3-ee1e846a7866\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:54.022Z\",\"requestId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:54.022Z\",\"requestId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:54.022Z\",\"requestId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:54.023Z\",\"requestId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.033Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:54.032Z\",\"requestId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T20:34:54.032Z\",\"requestId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T20:34:54.032Z\",\"requestId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.037Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T20:34:54.033Z\",\"requestId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T20:34:54.034Z\",\"requestId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"correlationId\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"traceparent\":\"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01\",\"x-correlationid\":\"72587552-e0f9-4a8d-afee-6e8f9e23c9cd\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T20:34:16.300Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.035Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.039Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.039Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
[test body] Found userInfo in localStorage for test "Click through: Submit a VAT return to HMRC": {"sub":"user","email":"user@example.com"}
[test body] Extracted userSub from localStorage for test "Click through: Submit a VAT return to HMRC": user
Logging out from home page
[USER INTERACTION] Clicking: a:has-text('Logout') - Logout
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.522Z","msg":"[BROWSER CONSOLE log]: Logging out user"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.523Z","msg":"[HTTP REQUEST FAILED] GET http://localhost:3000/index.html - net::ERR_ABORTED"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.528Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.528Z\",\"msg\":\"HTTP GET /auth/login.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.547Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.543Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.543Z\",\"msg\":\"HTTP GET /images/g-logo.png\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.543Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.557Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.548Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.548Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.548Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.562Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.559Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.560Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.560Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.561Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.561Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.561Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.566Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.565Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.568Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.567Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.583Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.574Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.585Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.588Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.584Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.585Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.586Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.586Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.586Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.587Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.591Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.590Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.594Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.592Z\",\"msg\":\"HTTP GET /submit.env\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.593Z\",\"msg\":\"HTTP GET /auth/login-mock-addon.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.598Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.598Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.603Z","msg":"[BROWSER CONSOLE error]: Loading the image 'https://avatars.githubusercontent.com/u/11848947?s=48&v=4' violates the following Content Security Policy directive: \"img-src 'self' data:\". The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.603Z","msg":"[HTTP REQUEST FAILED] GET https://avatars.githubusercontent.com/u/11848947?s=48&v=4 - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.603Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.603Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.603Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.603Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.612Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T20:34:54.612Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.708Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T20:34:54.708Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[Figures]: Selected 5 key screenshots from target/behaviour-test-results/screenshots/submitVat-behaviour-test
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-02-03T20:34:54.713Z","msg":"Copied screenshot: 2026-02-03_20-34-24-836481862-10-fill-in-submission-pagedown.png"}
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-02-03T20:34:54.714Z","msg":"Copied screenshot: 2026-02-03_20-34-33-035437857-02-complete-vat-receipt.png"}
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-02-03T20:34:54.714Z","msg":"Copied screenshot: 2026-02-03_20-34-29-241753964-01-submit-hmrc-auth.png"}
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-02-03T20:34:54.715Z","msg":"Copied screenshot: 2026-02-03_20-34-45-916415629-04-view-vat-return-results.png"}
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-02-03T20:34:54.715Z","msg":"Copied screenshot: 2026-02-03_20-34-06-012477757-00-focus-submitting-sign-in-form.png"}
[Figures]: Copied 5 screenshots to /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-02-03T20:34:54.716Z","msg":"Wrote figures.json with 5 entries to /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/figures.json"}
[Figures]: Generated figures.json in /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour
[DynamoDB Export]: Starting export of all tables...
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:34:54.716Z","msg":"[dynamodb-export]: Starting export of all tables to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:34:54.716Z","msg":"[dynamodb-export]: Exporting table 'test-bundle-table' from endpoint 'http://127.0.0.1:9001' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/bundles.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:34:54.724Z","msg":"[dynamodb-export]: ✅ Exported 1 items from table 'test-bundle-table' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/bundles.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:34:54.724Z","msg":"[dynamodb-export]: ── BEGIN bundles.jsonl ──"}
{"bundleId":"test","expiry":"2026-02-04T00:00:00.000Z","tokensGranted":10,"tokensConsumed":1,"tokenResetAt":null,"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","createdAt":"2026-02-03T20:34:16.300Z","ttl":1772582400,"ttl_datestamp":"2026-03-04T00:00:00.000Z"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:34:54.724Z","msg":"[dynamodb-export]: ── END bundles.jsonl ──"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:34:54.724Z","msg":"[dynamodb-export]: Exporting table 'test-hmrc-api-requests-table' from endpoint 'http://127.0.0.1:9001' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/hmrc-api-requests.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:34:54.732Z","msg":"[dynamodb-export]: ✅ Exported 14 items from table 'test-hmrc-api-requests-table' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/hmrc-api-requests.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:34:54.733Z","msg":"[dynamodb-export]: ── BEGIN hmrc-api-requests.jsonl ──"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-08c9913a-ce8b-49b6-b5b4-5e3e99329b1d","requestId":"8962aab9-65bc-4131-a2e7-19fb3dadbf48","amznTraceId":null,"traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","url":"http://localhost:9000/organisations/vat/814376350/obligations?from=2017-01-01&to=2017-03-31&status=F","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"8962aab9-65bc-4131-a2e7-19fb3dadbf48","traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","x-correlationid":"8962aab9-65bc-4131-a2e7-19fb3dadbf48","Gov-Client-Device-ID":"f1ef9c83-5e7e-4ccc-9786-0dfd4a9ec214","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:34:43.508Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"134","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:34:43 GMT","etag":"W/\"86-8DhLS+CtN5wmRN2e1Xcr65DIEME\"","keep-alive":"timeout=5","x-correlationid":"dcfe0a8a-4875-4bca-9235-f209da2f21d0","x-powered-by":"Express"},"body":{"obligations":[{"periodKey":"24GY","start":"2017-01-01","end":"2017-03-31","due":"2017-05-07","status":"F","received":"2017-05-06"}]}},"duration":1,"createdAt":"2026-02-03T20:34:43.601Z","ttl":1772570083,"ttl_datestamp":"2026-03-03T20:34:43.601Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-14310c1a-f24c-4235-9a7a-31b710288a4f","requestId":"c978a330-782f-4b6c-9b2f-403308229310","amznTraceId":null,"traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","url":"http://localhost:9000/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Device-ID":"4b51562b-9511-4bdb-b30e-fda560b2bb40","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:34:31.688Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"c978a330-782f-4b6c-9b2f-403308229310","traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","x-correlationid":"c978a330-782f-4b6c-9b2f-403308229310"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"297","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:34:31 GMT","etag":"W/\"129-UFxb9UF4LOFfUrBiO2wN6GYy9Fo\"","keep-alive":"timeout=5","x-correlationid":"77eac0f5-5d77-47c1-a6bf-1727d21d5b80","x-powered-by":"Express"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"Headers valid with warnings","errors":[],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]},{"code":"***MASKED***","message":"Header required","headers":["gov-client-public-port"]}]}},"duration":7,"createdAt":"2026-02-03T20:34:31.749Z","ttl":1772570071,"ttl_datestamp":"2026-03-03T20:34:31.749Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-311b3703-a70d-478f-a809-8f0983459b62","requestId":"8962aab9-65bc-4131-a2e7-19fb3dadbf48","amznTraceId":null,"traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","url":"http://localhost:9000/organisations/vat/814376350/returns/24GY","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"8962aab9-65bc-4131-a2e7-19fb3dadbf48","traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","x-correlationid":"8962aab9-65bc-4131-a2e7-19fb3dadbf48","Gov-Client-Device-ID":"f1ef9c83-5e7e-4ccc-9786-0dfd4a9ec214","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:34:43.508Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"239","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:34:43 GMT","etag":"W/\"ef-7Fw/27pKLeTOfl+EqTPQ1Oojyac\"","keep-alive":"timeout=5","x-correlationid":"f3fe5d0d-97fa-42ec-8400-82a276a21ea6","x-powered-by":"Express"},"body":{"periodKey":"24GY","vatDueSales":1000,"vatDueAcquisitions":0,"totalVatDue":1000,"vatReclaimedCurrPeriod":0,"netVatDue":1000,"totalValueSalesExVAT":0,"totalValuePurchasesExVAT":0,"totalValueGoodsSuppliedExVAT":0,"totalAcquisitionsExVAT":0}},"duration":1,"createdAt":"2026-02-03T20:34:43.614Z","ttl":1772570083,"ttl_datestamp":"2026-03-03T20:34:43.614Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-3a47a867-d113-4ff7-b767-ba7da40dc0c5","requestId":"8962aab9-65bc-4131-a2e7-19fb3dadbf48","amznTraceId":null,"traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","url":"http://localhost:9000/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Device-ID":"f1ef9c83-5e7e-4ccc-9786-0dfd4a9ec214","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:34:43.508Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"8962aab9-65bc-4131-a2e7-19fb3dadbf48","traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","x-correlationid":"8962aab9-65bc-4131-a2e7-19fb3dadbf48"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"297","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:34:43 GMT","etag":"W/\"129-UFxb9UF4LOFfUrBiO2wN6GYy9Fo\"","keep-alive":"timeout=5","x-correlationid":"9633a6fb-0a43-46aa-b46c-909a47e540c9","x-powered-by":"Express"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"Headers valid with warnings","errors":[],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]},{"code":"***MASKED***","message":"Header required","headers":["gov-client-public-port"]}]}},"duration":3,"createdAt":"2026-02-03T20:34:43.607Z","ttl":1772570083,"ttl_datestamp":"2026-03-03T20:34:43.607Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-3badcd3a-9bf4-4db8-9564-d4847519c3e4","requestId":"8962aab9-65bc-4131-a2e7-19fb3dadbf48","amznTraceId":null,"traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","url":"http://localhost:9000/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Device-ID":"f1ef9c83-5e7e-4ccc-9786-0dfd4a9ec214","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:34:43.508Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"8962aab9-65bc-4131-a2e7-19fb3dadbf48","traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","x-correlationid":"8962aab9-65bc-4131-a2e7-19fb3dadbf48"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"297","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:34:43 GMT","etag":"W/\"129-UFxb9UF4LOFfUrBiO2wN6GYy9Fo\"","keep-alive":"timeout=5","x-correlationid":"5b8d2da1-c93d-4737-a109-e37e4ddbcc3d","x-powered-by":"Express"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"Headers valid with warnings","errors":[],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]},{"code":"***MASKED***","message":"Header required","headers":["gov-client-public-port"]}]}},"duration":4,"createdAt":"2026-02-03T20:34:43.596Z","ttl":1772570083,"ttl_datestamp":"2026-03-03T20:34:43.596Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-48763d70-941b-414f-b6f5-5a0831780dd5","requestId":"8962aab9-65bc-4131-a2e7-19fb3dadbf48","amznTraceId":null,"traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","url":"http://localhost:9000/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Device-ID":"f1ef9c83-5e7e-4ccc-9786-0dfd4a9ec214","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:34:43.508Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"8962aab9-65bc-4131-a2e7-19fb3dadbf48","traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","x-correlationid":"8962aab9-65bc-4131-a2e7-19fb3dadbf48"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"297","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:34:44 GMT","etag":"W/\"129-UFxb9UF4LOFfUrBiO2wN6GYy9Fo\"","keep-alive":"timeout=5","x-correlationid":"e96aa40b-df02-4794-9a35-6d5bb5d71e3f","x-powered-by":"Express"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"Headers valid with warnings","errors":[],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]},{"code":"***MASKED***","message":"Header required","headers":["gov-client-public-port"]}]}},"duration":1,"createdAt":"2026-02-03T20:34:44.626Z","ttl":1772570084,"ttl_datestamp":"2026-03-03T20:34:44.626Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-59645047-ffcf-458f-aeb9-d775b34533d3","requestId":"c978a330-782f-4b6c-9b2f-403308229310","amznTraceId":null,"traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","url":"http://localhost:9000/organisations/vat/814376350/obligations?from=2017-01-01&to=2017-03-31&status=O","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"c978a330-782f-4b6c-9b2f-403308229310","traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","x-correlationid":"c978a330-782f-4b6c-9b2f-403308229310","Gov-Client-Device-ID":"4b51562b-9511-4bdb-b30e-fda560b2bb40","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:34:31.688Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"110","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:34:32 GMT","etag":"W/\"6e-8DmpRQV6UvodnuqSTpSLyTU0Sg4\"","keep-alive":"timeout=5","x-correlationid":"eaf5c3bd-3b09-4710-875f-14fad0ceefa2","x-powered-by":"Express"},"body":{"obligations":[{"periodKey":"22E6","start":"2017-04-01","end":"2017-06-30","due":"2017-08-07","status":"O"}]}},"duration":1,"createdAt":"2026-02-03T20:34:32.774Z","ttl":1772570072,"ttl_datestamp":"2026-03-03T20:34:32.774Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-9825700e-f4e2-4c6c-a1c8-a34012ee6673","requestId":"8962aab9-65bc-4131-a2e7-19fb3dadbf48","amznTraceId":null,"traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","url":"http://localhost:9000/organisations/vat/814376350/obligations?from=2017-01-01&to=2017-03-31&status=F","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"8962aab9-65bc-4131-a2e7-19fb3dadbf48","traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","x-correlationid":"8962aab9-65bc-4131-a2e7-19fb3dadbf48","Gov-Client-Device-ID":"f1ef9c83-5e7e-4ccc-9786-0dfd4a9ec214","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:34:43.508Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"134","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:34:44 GMT","etag":"W/\"86-WSzUfjmUmX+OZS67dZPU0Of2vx8\"","keep-alive":"timeout=5","x-correlationid":"f82aee6a-5bfc-40f1-ba58-fcabec6b4313","x-powered-by":"Express"},"body":{"obligations":[{"periodKey":"26C1","start":"2017-01-01","end":"2017-03-31","due":"2017-05-07","status":"F","received":"2017-05-06"}]}},"duration":1,"createdAt":"2026-02-03T20:34:44.630Z","ttl":1772570084,"ttl_datestamp":"2026-03-03T20:34:44.630Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-9e4c6872-5926-4e51-99bb-220c6e45ef17","requestId":"c978a330-782f-4b6c-9b2f-403308229310","amznTraceId":null,"traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","url":"http://localhost:9000/organisations/vat/814376350/returns","method":"POST","httpRequest":{"method":"POST","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"c978a330-782f-4b6c-9b2f-403308229310","traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","x-correlationid":"c978a330-782f-4b6c-9b2f-403308229310","Gov-Client-Device-ID":"4b51562b-9511-4bdb-b30e-fda560b2bb40","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:34:31.688Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"},"body":"{\"periodKey\":\"17J7\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":5000,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0,\"finalised\":true}"},"httpResponse":{"statusCode":201,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"140","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:34:31 GMT","etag":"W/\"8c-+Mr0IoU+D2kYs+yCH04b5JS1yHs\"","keep-alive":"timeout=5","receipt-id":"22d0508b-5f1a-48ea-8fa9-bd39370e6547","receipt-signature":"This has been deprecated - DO NOT USE","receipt-timestamp":"2026-02-03T20:34:31Z","x-correlationid":"7fc28a14-9547-405d-a3fa-6d3a382a6170","x-powered-by":"Express"},"body":{"processingDate":"2026-02-03T20:34:31.760Z","formBundleNumber":"899940427284","paymentIndicator":"DD","chargeRefNumber":"JKKvlNnXUyI8IJ6r"}},"duration":4,"createdAt":"2026-02-03T20:34:31.763Z","ttl":1772570071,"ttl_datestamp":"2026-03-03T20:34:31.763Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-a1dda514-e562-4f49-abc8-539ded237571","requestId":"c978a330-782f-4b6c-9b2f-403308229310","amznTraceId":null,"traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","url":"http://localhost:9000/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Device-ID":"4b51562b-9511-4bdb-b30e-fda560b2bb40","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:34:31.688Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"c978a330-782f-4b6c-9b2f-403308229310","traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","x-correlationid":"c978a330-782f-4b6c-9b2f-403308229310"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"297","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:34:32 GMT","etag":"W/\"129-UFxb9UF4LOFfUrBiO2wN6GYy9Fo\"","keep-alive":"timeout=5","x-correlationid":"47bc782b-60fb-4d6e-8d3f-f175d6cff00a","x-powered-by":"Express"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"Headers valid with warnings","errors":[],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]},{"code":"***MASKED***","message":"Header required","headers":["gov-client-public-port"]}]}},"duration":2,"createdAt":"2026-02-03T20:34:32.770Z","ttl":1772570072,"ttl_datestamp":"2026-03-03T20:34:32.770Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-bae9379b-cffc-4f50-a61d-024e216f3a46","requestId":"d4b9303d-8ffc-4393-abca-71e0362103db","amznTraceId":null,"traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","url":"http://localhost:9000/oauth/token","method":"POST","httpRequest":{"method":"POST","headers":{"Content-Type":"application/x-www-form-urlencoded","x-request-id":"d4b9303d-8ffc-4393-abca-71e0362103db","traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","x-correlationid":"d4b9303d-8ffc-4393-abca-71e0362103db"},"body":"grant_type=authorization_code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&client_secret=mock-simulator-client-secret&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Factivities%2FsubmitVatCallback.html&code=***MASKED***"},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"227","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:34:31 GMT","etag":"W/\"e3-V62enGMDa+RouIBPU+03ls4lvd8\"","keep-alive":"timeout=5","x-powered-by":"Express"},"body":{"access_token":"***MASKED***","refresh_token":"***MASKED***","expires_in":14400,"scope":"write:vat read:vat","token_type":"bearer"}},"duration":9,"createdAt":"2026-02-03T20:34:31.443Z","ttl":1772570071,"ttl_datestamp":"2026-03-03T20:34:31.443Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-cae6d299-f1be-4e60-824d-3b2b7c1bba40","requestId":"c978a330-782f-4b6c-9b2f-403308229310","amznTraceId":null,"traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","url":"http://localhost:9000/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Device-ID":"4b51562b-9511-4bdb-b30e-fda560b2bb40","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:34:31.688Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"c978a330-782f-4b6c-9b2f-403308229310","traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","x-correlationid":"c978a330-782f-4b6c-9b2f-403308229310"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"297","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:34:31 GMT","etag":"W/\"129-UFxb9UF4LOFfUrBiO2wN6GYy9Fo\"","keep-alive":"timeout=5","x-correlationid":"6df9a94a-a24d-4c9f-b26f-042181bc30e4","x-powered-by":"Express"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"Headers valid with warnings","errors":[],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]},{"code":"***MASKED***","message":"Header required","headers":["gov-client-public-port"]}]}},"duration":3,"createdAt":"2026-02-03T20:34:31.713Z","ttl":1772570071,"ttl_datestamp":"2026-03-03T20:34:31.713Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-d85bf0c5-0f96-4bf1-8e7d-1408ec1f5b17","requestId":"c978a330-782f-4b6c-9b2f-403308229310","amznTraceId":null,"traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","url":"http://localhost:9000/organisations/vat/814376350/obligations?from=2017-01-01&to=2017-03-31&status=O","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"c978a330-782f-4b6c-9b2f-403308229310","traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","x-correlationid":"c978a330-782f-4b6c-9b2f-403308229310","Gov-Client-Device-ID":"4b51562b-9511-4bdb-b30e-fda560b2bb40","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:34:31.688Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"110","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:34:31 GMT","etag":"W/\"6e-ILxQLKwOcb9I06eclgFlmSyakkM\"","keep-alive":"timeout=5","x-correlationid":"a7c1f9a2-5f09-4335-8bf7-221ae4f2f41b","x-powered-by":"Express"},"body":{"obligations":[{"periodKey":"20J7","start":"2017-04-01","end":"2017-06-30","due":"2017-08-07","status":"O"}]}},"duration":4,"createdAt":"2026-02-03T20:34:31.723Z","ttl":1772570071,"ttl_datestamp":"2026-03-03T20:34:31.723Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-ec61751a-bdb6-4ccb-8ef7-8aa09bcf0116","requestId":"6e182c88-f481-4fd1-bffb-7284aa261e2d","amznTraceId":null,"traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","url":"http://localhost:9000/organisations/vat/814376350/obligations?from=2025-01-01&to=2025-12-01","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"6e182c88-f481-4fd1-bffb-7284aa261e2d","traceparent":"00-e15413f5bd7c6b9ca993245b748914f7-31eedc9bd485190d-01","x-correlationid":"6e182c88-f481-4fd1-bffb-7284aa261e2d","Gov-Client-Device-ID":"41cc644a-9a98-4c18-b410-88ddac52e8d8","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770150848206","Gov-Client-Public-IP-Timestamp":"2026-02-03T20:34:51.212Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"227","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 20:34:51 GMT","etag":"W/\"e3-50cXpZgfMXwSBMyfxoejGPZdkOw\"","keep-alive":"timeout=5","x-correlationid":"097a05e7-513b-4f47-9b02-fd318f5a58e5","x-powered-by":"Express"},"body":{"obligations":[{"periodKey":"20Q6","start":"2017-01-01","end":"2017-03-31","due":"2017-05-07","status":"F","received":"2017-05-06"},{"periodKey":"26S2","start":"2017-04-01","end":"2017-06-30","due":"2017-08-07","status":"O"}]}},"duration":7,"createdAt":"2026-02-03T20:34:51.289Z","ttl":1772570091,"ttl_datestamp":"2026-03-03T20:34:51.289Z"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:34:54.733Z","msg":"[dynamodb-export]: ── END hmrc-api-requests.jsonl ──"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:34:54.733Z","msg":"[dynamodb-export]: Exporting table 'test-receipts-table' from endpoint 'http://127.0.0.1:9001' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/receipts.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:34:54.738Z","msg":"[dynamodb-export]: ✅ Exported 1 items from table 'test-receipts-table' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/receipts.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:34:54.738Z","msg":"[dynamodb-export]: ── BEGIN receipts.jsonl ──"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","receiptId":"2026-02-03T20:34:31.767Z-899940427284","receipt":{"processingDate":"2026-02-03T20:34:31.760Z","formBundleNumber":"899940427284","paymentIndicator":"DD","chargeRefNumber":"JKKvlNnXUyI8IJ6r"},"createdAt":"2026-02-03T20:34:31.768Z","ttl":1990902871,"ttl_datestamp":"2033-02-01T20:34:31.768Z"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:34:54.738Z","msg":"[dynamodb-export]: ── END receipts.jsonl ──"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T20:34:54.738Z","msg":"[dynamodb-export]: ✅ Completed export of all tables"}
[DynamoDB Export]: Export completed: [
  {
    table: [32m'bundles'[39m,
    itemCount: [33m1[39m,
    filePath: [32m'/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/bundles.jsonl'[39m
  },
  {
    table: [32m'hmrc-api-requests'[39m,
    itemCount: [33m14[39m,
    filePath: [32m'/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/hmrc-api-requests.jsonl'[39m
  },
  {
    table: [32m'receipts'[39m,
    itemCount: [33m1[39m,
    filePath: [32m'/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/receipts.jsonl'[39m
  }
]
Asserting HMRC API request exists: POST /oauth/token
[DynamoDB Assertions]: Found 1 OAuth token exchange request(s)
Asserting HMRC API request exists: POST /organisations/vat/814376350/returns
[DynamoDB Assertions]: Found 1 VAT return POST request(s)
Matched all expected values in http://localhost:9000/organisations/vat/814376350/returns: { [32m'httpRequest.method'[39m: [32m'POST'[39m, [32m'httpResponse.statusCode'[39m: [33m201[39m }
[DynamoDB Assertions]: VAT POST request body validated - periodKey format: 17J7
Asserting HMRC API request exists: GET /\/organisations\/vat\/814376350\/returns\/\w+/
[DynamoDB Assertions]: Found 1 VAT return GET request(s)
Matched all expected values in http://localhost:9000/organisations/vat/814376350/returns/24GY: { [32m'httpRequest.method'[39m: [32m'GET'[39m, [32m'httpResponse.statusCode'[39m: [33m200[39m }
[DynamoDB Assertions]: VAT GET response body validated - periodKey format: 24GY
[DynamoDB Assertions]: Found 0 Fraud prevention headers validation feedback GET request(s)
Asserting HMRC API request exists: GET /test/fraud-prevention-headers/validate
[DynamoDB Assertions]: Found 6 Fraud prevention headers validation GET request(s)
[DynamoDB Assertions]: Fraud prevention headers validation GET request #1 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 0
[DynamoDB Assertions]: Warnings: 2
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 0 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 2 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[DynamoDB Assertions]: Fraud prevention headers validation GET request #2 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 0
[DynamoDB Assertions]: Warnings: 2
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 0 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 2 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[DynamoDB Assertions]: Fraud prevention headers validation GET request #3 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 0
[DynamoDB Assertions]: Warnings: 2
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 0 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 2 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[DynamoDB Assertions]: Fraud prevention headers validation GET request #4 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 0
[DynamoDB Assertions]: Warnings: 2
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 0 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 2 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[DynamoDB Assertions]: Fraud prevention headers validation GET request #5 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 0
[DynamoDB Assertions]: Warnings: 2
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 0 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 2 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[DynamoDB Assertions]: Fraud prevention headers validation GET request #6 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 0
[DynamoDB Assertions]: Warnings: 2
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 0 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 2 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
{"level":30,"source":"behaviour-tests/helpers/dynamodb-assertions.js","time":"2026-02-03T20:34:54.778Z","msg":"Found 14 HMRC API requests: OAuth (1) with hashedSub 5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0, authenticated (13) with hashedSub 5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0"}
[DynamoDB Assertions]: Found 1 unique hashedSub value(s): 5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0
[afterEach] Saving /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/userSub.txt for test "Click through: Submit a VAT return to HMRC": user
{"level":30,"source":"app/services/subHasher.js","time":"2026-02-03T20:34:54.881Z","message":"Using USER_SUB_HASH_SALT from environment (local dev/test)"}
[fileHelper] Salt initialized successfully for test diagnostics
[afterEach] Saving /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/hashedUserSub.txt for test "Click through: Submit a VAT return to HMRC": 5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0
Saving /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/traceparent.txt for test "Click through: Submit a VAT return to HMRC": 00-2a618e3d3344678701a47c1ea5d56426-fd72c1431b127a23-01
[http-simulator] Stopped
  ✓  1 [submitVatBehaviour] › behaviour-tests/submitVat.behaviour.test.js:182:1 › Click through: Submit a VAT return to HMRC (54.0s)

  1 passed (1.0m)

To open last HTML report run:
[36m[39m
[36m  npx playwright show-report target/test-reports/html-report[39m
[36m[39m
