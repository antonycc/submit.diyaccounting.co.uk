
> @antonycc/web-submit-diyaccounting-co-uk@1.0.0 test:submitVatBehaviour-simulator
> npx dotenv -e .env.simulator -- npm run test:submitVatBehaviour


> @antonycc/web-submit-diyaccounting-co-uk@1.0.0 test:submitVatBehaviour
> playwright test --project=submitVatBehaviour

dotenvConfigIfNotBlank: Loading environment config from .env
dotenvConfigIfNotBlank: Loading environment config from .env
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:34.705Z","msg":"Reading CDK configuration from /Users/antony/projects/submit.diyaccounting.co.uk/cdk-application/cdk.json"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:34.706Z","msg":"CDK context:"}
dotenvConfigIfNotBlank: Loading environment config from .env
dotenvConfigIfNotBlank: Loading environment config from .env
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:34.713Z","msg":"envFilePath: .env.simulator"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:34.713Z","msg":"envName: simulator"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:34.713Z","msg":"serverPort: 3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:34.713Z","msg":"runTestServer: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:34.714Z","msg":"runProxy: off"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:34.714Z","msg":"runMockOAuth2: off"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:34.714Z","msg":"testAuthProvider: simulator"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:34.714Z","msg":"testAuthUsername: user"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:34.714Z","msg":"testAuthPassword: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:34.714Z","msg":"baseUrl: http://localhost:3000/"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:34.714Z","msg":"hmrcTestUsername: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:34.714Z","msg":"hmrcTestPassword: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:34.714Z","msg":"hmrcTestVatNumber: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:34.714Z","msg":"runDynamoDb: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:34.714Z","msg":"bundleTableName: test-bundle-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:34.714Z","msg":"hmrcApiRequestsTableName: test-hmrc-api-requests-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:34.714Z","msg":"receiptsTableName: test-receipts-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:34.714Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:34.714Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}

Running 1 test using 1 worker

dotenvConfigIfNotBlank: Loading environment config from .env
dotenvConfigIfNotBlank: Loading environment config from .env
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.033Z","msg":"Reading CDK configuration from /Users/antony/projects/submit.diyaccounting.co.uk/cdk-application/cdk.json"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.033Z","msg":"CDK context:"}
dotenvConfigIfNotBlank: Loading environment config from .env
dotenvConfigIfNotBlank: Loading environment config from .env
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.040Z","msg":"envFilePath: .env.simulator"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.040Z","msg":"envName: simulator"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.040Z","msg":"serverPort: 3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.040Z","msg":"runTestServer: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.040Z","msg":"runProxy: off"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.040Z","msg":"runMockOAuth2: off"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.040Z","msg":"testAuthProvider: simulator"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.041Z","msg":"testAuthUsername: user"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.041Z","msg":"testAuthPassword: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.041Z","msg":"baseUrl: http://localhost:3000/"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.041Z","msg":"hmrcTestUsername: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.041Z","msg":"hmrcTestPassword: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.041Z","msg":"hmrcTestVatNumber: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.041Z","msg":"runDynamoDb: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.041Z","msg":"bundleTableName: test-bundle-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.041Z","msg":"hmrcApiRequestsTableName: test-hmrc-api-requests-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.041Z","msg":"receiptsTableName: test-receipts-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.041Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.041Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
Starting beforeAll hook...
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.689Z","msg":"[dynamodb]: runDynamoDb=run, bundleTableName=test-bundle-table, hmrcApiRequestsTableName=test-hmrc-api-requests-table, receiptsTableName=test-receipts-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.689Z","msg":"[dynamodb]: Starting dynalite (local DynamoDB) server..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.698Z","msg":"[dynamodb]: Started at http://127.0.0.1:9001"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.698Z","msg":"[dynamodb]: Ensuring bundle table: 'test-bundle-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.736Z","msg":"[dynamodb]: ℹ️ Table 'test-bundle-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.744Z","msg":"[dynamodb]: ✅ Created table 'test-bundle-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.744Z","msg":"[dynamodb]: Ensuring HMRC API requests table: 'test-hmrc-api-requests-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.754Z","msg":"[dynamodb]: ℹ️ Table 'test-hmrc-api-requests-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.757Z","msg":"[dynamodb]: ✅ Created table 'test-hmrc-api-requests-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.758Z","msg":"[dynamodb]: Ensuring receipts table: 'test-receipts-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.763Z","msg":"[dynamodb]: ℹ️ Table 'test-receipts-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.766Z","msg":"[dynamodb]: ✅ Created table 'test-receipts-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.766Z","msg":"[dynamodb]: Ensuring passes table: 'test-passes-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.773Z","msg":"[dynamodb]: ℹ️ Table 'test-passes-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.776Z","msg":"[dynamodb]: ✅ Created table 'test-passes-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.776Z","msg":"[dynamodb]: Ensuring async requests table: 'test-hmrc-vat-return-post-async-requests-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.782Z","msg":"[dynamodb]: ℹ️ Table 'test-hmrc-vat-return-post-async-requests-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.785Z","msg":"[dynamodb]: ✅ Created table 'test-hmrc-vat-return-post-async-requests-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.785Z","msg":"[dynamodb]: Ensuring async requests table: 'test-hmrc-vat-return-get-async-requests-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.789Z","msg":"[dynamodb]: ℹ️ Table 'test-hmrc-vat-return-get-async-requests-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.791Z","msg":"[dynamodb]: ✅ Created table 'test-hmrc-vat-return-get-async-requests-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.791Z","msg":"[dynamodb]: Ensuring async requests table: 'test-hmrc-vat-obligation-get-async-requests-table' exists on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.795Z","msg":"[dynamodb]: ℹ️ Table 'test-hmrc-vat-obligation-get-async-requests-table' not found on endpoint 'http://127.0.0.1:9001', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-02-03T23:24:36.797Z","msg":"[dynamodb]: ✅ Created table 'test-hmrc-vat-obligation-get-async-requests-table' on endpoint 'http://127.0.0.1:9001'"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.797Z","msg":"[auth]: runMockOAuth2=off"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.797Z","msg":"[auth]: Skipping mock-oauth2-server process as runMockOAuth2 is not set to 'run'"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.797Z","msg":"[auth]: Starting HTTP simulator (replaces mock-oauth2-server and HMRC API)..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.797Z","msg":"[http-simulator]: runSimulator=run, port=9000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.797Z","msg":"[http-simulator]: Starting HTTP simulator..."}
[http-simulator] Started on http://localhost:9000
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.870Z","msg":"[http-simulator]: Started at http://localhost:9000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.870Z","msg":"[http]: runTestServer=run, httpServerPort=3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:36.870Z","msg":"[http]: Starting server process..."}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-02-03T23:24:36.873Z","msg":"[http]: Checking server readiness for... http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-02-03T23:24:36.884Z","msg":"[http]: Starting server at http://127.0.0.1:3000 after error TypeError: fetch failed"}
{"level":50,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-02-03T23:24:36.885Z","msg":"[http]: Server check attempt 1/15 failed: fetch failed from http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:37.057Z","msg":"[http-stdout]: dotenvConfigIfNotBlank: Loading environment config from .env"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:37.069Z","msg":"[http-stdout]: dotenvConfigIfNotBlank: Loading environment config from .env"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:37.072Z","msg":"[http-stdout]: Mock OAuth routes registered (TEST_AUTH_PROVIDER=simulator)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:37.076Z","msg":"[http-stdout]: Listening at http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:37.076Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:37.076Z\",\"msg\":\"Listening at http://127.0.0.1:3000\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:37.893Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:37.893Z\",\"msg\":\"HTTP GET /\"}"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-02-03T23:24:37.906Z","msg":"[http]: Response body"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-02-03T23:24:37.906Z","msg":"[http]: Server is ready! at http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:37.906Z","msg":"[proxy]: runProxy=off, httpServerPort=3000, baseUrl=http://localhost:3000/"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:37.906Z","msg":"[proxy]: Skipping ngrok tunnel as runProxy is not set to 'run'"}
beforeAll hook completed successfully
[HMRC Test User] Sandbox mode detected without full credentials - creating test user
[HMRC Test User] Creating HMRC sandbox test user with VAT enrolment using client credentials
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.441Z","message":"[HMRC Test User Creation] Starting test user creation","url":"http://localhost:9000/create-test-user/organisations","serviceNames":["mtd-vat"],"hmrcClientId":"uqMHA6Rs..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.441Z","message":"[HMRC Test User Creation] Request details (pre-token)","method":"POST","url":"http://localhost:9000/create-test-user/organisations","body":{"serviceNames":["mtd-vat"]}}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.441Z","message":"[HMRC Test User Creation] Requesting OAuth2 access token","tokenUrl":"http://localhost:9000/oauth/token","grantType":"client_credentials"}
[http-simulator] POST /oauth/token
[http-simulator:hmrc-oauth] POST /oauth/token grant_type=client_credentials
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.463Z","message":"[HMRC Test User Creation] Token response received","status":200,"statusText":"OK","hasAccessToken":true}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.463Z","message":"[HMRC Test User Creation] Request details (create-test-user)","method":"POST","url":"http://localhost:9000/create-test-user/organisations","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"[REDACTED]"},"body":{"serviceNames":["mtd-vat"]}}
[http-simulator] POST /create-test-user/organisations
[http-simulator:test-user] POST /create-test-user/organisations
[http-simulator:test-user] Created test user with VAT registration number: 847829176
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.467Z","message":"[HMRC Test User Creation] Response received","status":201,"statusText":"Created","responseBody":{"userId":"359800498957","password":"[REDACTED]","userFullName":"Test User","emailAddress":"[REDACTED]","organisationDetails":{"name":"Test Organisation Ltd","address":{"line1":"123 Test Street","line2":"Test Town","postcode":"TE1 1ST"}},"individualDetails":{"firstName":"Test","lastName":"User","dateOfBirth":"1980-01-01","address":{"line1":"123 Test Street","line2":"Test Town","postcode":"TE1 1ST"}},"vatRegistrationDate":"2026-02-03","groupIdentifier":"701323053034","vrn":"847829176"}}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.468Z","message":"[HMRC Test User Creation] Test user created successfully","userId":"359800498957","userFullName":"Test User","organisationName":"Test Organisation Ltd"}
[HMRC Test User] Successfully created test user:
  User ID: 359800498957
  User Full Name: Test User
  VAT registration number: 847829176
  Organisation: Test Organisation Ltd
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.468Z","message":"[HMRC Test User] Saving test user details to JSON files","outputDir":"/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour","repoRoot":"/Users/antony/projects/submit.diyaccounting.co.uk"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.468Z","message":"[HMRC Test User] Saved test user to artifact directory","path":"/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/hmrc-test-user.json"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.468Z","message":"[HMRC Test User] Saved test user to repository root","path":"/Users/antony/projects/submit.diyaccounting.co.uk/hmrc-test-user.json"}
[HMRC Test User] Updated environment variables with generated credentials
Loading document...
[NAVIGATION] (1/4) Going to: http://127.0.0.1:3000/ - Loading home page
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.690Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.690Z\",\"msg\":\"HTTP GET /\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.782Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.767Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.787Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.783Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.786Z\",\"msg\":\"HTTP GET /developer-mode.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.789Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.789Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.793Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.792Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.812Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.798Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.799Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.801Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.802Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.819Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.814Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.814Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.815Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.815Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.816Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.816Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.819Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.826Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.829Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.820Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.821Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.835Z","msg":"[BROWSER CONSOLE log]: User is not authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.835Z","msg":"[BROWSER CONSOLE log]: User is not authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.845Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.844Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.845Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.848Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.845Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:38.857Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:38.856Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
Checking home page...
✅ [Compliance] Privacy link visible on home page
✅ [Compliance] Terms link visible on home page
[USER INTERACTION] Clicking: a:has-text('Log in') - Clicking login link
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.598Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.598Z\",\"msg\":\"HTTP GET /auth/login.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.621Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.615Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.615Z\",\"msg\":\"HTTP GET /images/g-logo.png\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.632Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.622Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.622Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.622Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.623Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.637Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.634Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.634Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.635Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.636Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.640Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.637Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.637Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.642Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.641Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.643Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.642Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.668Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.691Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.689Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.693Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.693Z\",\"msg\":\"HTTP GET /auth/login-mock-addon.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.695Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.695Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.696Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.695Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.696Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.696Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.697Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.697Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.698Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.698Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.705Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.702Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.703Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.705Z","msg":"[BROWSER CONSOLE error]: Loading the image 'https://avatars.githubusercontent.com/u/11848947?s=48&v=4' violates the following Content Security Policy directive: \"img-src 'self' data:\". The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.706Z","msg":"[HTTP REQUEST FAILED] GET https://avatars.githubusercontent.com/u/11848947?s=48&v=4 - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.708Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.706Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.732Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.731Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.732Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.732Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:39.743Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:39.743Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
Logging in...
[USER INTERACTION] Clicking: button:has-text('Continue with mock-oauth2-server') - Continue with OAuth provider
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:40.461Z","msg":"[BROWSER CONSOLE log]: Initiating navikt/mock-oauth2-server login"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:40.461Z","msg":"[BROWSER CONSOLE log]: Clear stored tokens and user info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:40.464Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:40.464Z\",\"msg\":\"HTTP GET /api/v1/mock/authUrl?state=486e2f4a0f3cc2d8429c6ef8706c5f22\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:40.469Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:40.468Z\",\"requestId\":\"7077f0b2-544a-4ec6-9385-0417da84b43d\",\"traceparent\":\"00-6f9f20fa4643d0d16fc1a0d3489cc919-1d4331fbfd0cbaf7-01\",\"correlationId\":\"7077f0b2-544a-4ec6-9385-0417da84b43d\",\"message\":\"Processing request with event\",\"request\":\"http://127.0.0.1:3000/api/v1/mock/authUrl?state=486e2f4a0f3cc2d8429c6ef8706c5f22\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"cognito:username\":\"test\",\"email\":\"[EMAIL]\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"127.0.0.1:3000\",\"path\":\"/api/v1/mock/authUrl\"}},\"path\":\"/api/v1/mock/authUrl\",\"headers\":{\"host\":\"127.0.0.1:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"7077f0b2-544a-4ec6-9385-0417da84b43d\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-6f9f20fa4643d0d16fc1a0d3489cc919-1d4331fbfd0cbaf7-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://127.0.0.1:3000/auth/login.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"state\":\"486e2f4a0f3cc2d8429c6ef8706c5f22\"},\"rawQueryString\":\"state=486e2f4a0f3cc2d8429c6ef8706c5f22\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/non-lambda-mocks/mockAuthUrlGet.js\",\"time\":\"2026-02-03T23:24:40.468Z\",\"requestId\":\"7077f0b2-544a-4ec6-9385-0417da84b43d\",\"traceparent\":\"00-6f9f20fa4643d0d16fc1a0d3489cc919-1d4331fbfd0cbaf7-01\",\"correlationId\":\"7077f0b2-544a-4ec6-9385-0417da84b43d\",\"message\":\"Generating mock authorization URL\",\"state\":\"486e2f4a0f3cc2d8429c6ef8706c5f22\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:40.468Z\",\"requestId\":\"7077f0b2-544a-4ec6-9385-0417da84b43d\",\"traceparent\":\"00-6f9f20fa4643d0d16fc1a0d3489cc919-1d4331fbfd0cbaf7-01\",\"correlationId\":\"7077f0b2-544a-4ec6-9385-0417da84b43d\",\"message\":\"Responding to request with response\",\"request\":\"http://127.0.0.1:3000/api/v1/mock/authUrl?state=486e2f4a0f3cc2d8429c6ef8706c5f22\",\"response\":{\"statusCode\":200,\"headers\":{\"x-request-id\":\"7077f0b2-544a-4ec6-9385-0417da84b43d\",\"traceparent\":\"00-6f9f20fa4643d0d16fc1a0d3489cc919-1d4331fbfd0cbaf7-01\",\"x-correlationid\":\"7077f0b2-544a-4ec6-9385-0417da84b43d\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"authUrl\\\":\\\"http://localhost:9000/oauth/authorize?response_type=code&client_id=debugger&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Fauth%2FloginWithMockCallback.html&scope=openid%20somescope&state=486e2f4a0f3cc2d8429c6ef8706c5f22&identity_provider=MockOAuth2Server\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:40.474Z","msg":"[BROWSER CONSOLE log]: Status message: Handing off to http://localhost:9000/oauth/authorize?response_type=code&client_id=debugger&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Fauth%2FloginWithMockCallback.html&scope=openid%20somescope&state=486e2f4a0f3cc2d8429c6ef8706c5f22&identity_provider=MockOAuth2Server Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:40.474Z","msg":"[BROWSER CONSOLE log]: Redirecting to navikt/mock-oauth2-server"}
[http-simulator] GET /oauth/authorize?response_type=code&client_id=debugger&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Fauth%2FloginWithMockCallback.html&scope=openid%20somescope&state=486e2f4a0f3cc2d8429c6ef8706c5f22&identity_provider=MockOAuth2Server
[http-simulator:local-oauth] GET /oauth/authorize for client_id=debugger
[USER INTERACTION] Filling: input[name="username"] with value: "user" - Entering username
[USER INTERACTION] Filling: textarea[name="claims"] with value: "{"email":"user@example.com"}" - Entering identity claims
[USER INTERACTION] Clicking: input[type="submit"][value="Sign-in"] - Submitting sign-in form
[http-simulator] POST /oauth/authorize
[http-simulator:local-oauth] POST /oauth/authorize for username=user
[http-simulator:local-oauth] Redirecting to http://localhost:3000/auth/loginWithMockCallback.html?code=2e2e8d92208f450ebc17ffdd5be924ff&state=486e2f4a0f3cc2d8429c6ef8706c5f22
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.399Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.399Z\",\"msg\":\"HTTP GET /auth/loginWithMockCallback.html?code=2e2e8d92208f450ebc17ffdd5be924ff&state=486e2f4a0f3cc2d8429c6ef8706c5f22\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.480Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.479Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.481Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.480Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.482Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.482Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.482Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.482Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.483Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.483Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.484Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.484Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.486Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.485Z\",\"msg\":\"HTTP GET /widgets/loading-spinner.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.485Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.512Z","msg":"[BROWSER CONSOLE log]: Authentication callback received with code: 2e2e8d92208f450ebc17ffdd5be924ff"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.515Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.515Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.515Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.517Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.516Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.516Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.517Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.517Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.517Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.517Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.523Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.522Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.523Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.523Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.523Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.532Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.532Z\",\"msg\":\"HTTP POST /api/v1/mock/token\"}"}
[http-simulator] POST /default/token
[http-simulator:local-oauth] POST /default/token grant_type=authorization_code
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.582Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.582Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.584Z","msg":"[BROWSER CONSOLE log]: Received tokens from mock {\"access_token\":\"eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJzdWIiOiJ1c2VyIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIiwiYXVkIjpbImRlYnVnZ2VyIl0sInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsIm5vbmNlIjoiNTY3OCIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo5MDAwL2RlZmF1bHQiLCJpYXQiOjE3NzAxNjEwODIsIm5iZiI6MTc3MDE2MTA4MiwiZXhwIjoxNzcwMTY0NjgyLCJqdGkiOiJmMDc5ZTk3ZS05N2QyLTQ3NDYtOTExZi1iYTczZTI0NzhiYjAifQ.\",\"id_token\":\"eyJhbGciOiJub25lIiwidHlwIjoiSldUIn0.eyJzdWIiOiJ1c2VyIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIiwiYXVkIjpbImRlYnVnZ2VyIl0sInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsIm5vbmNlIjoiNTY3OCIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo5MDAwL2RlZmF1bHQiLCJpYXQiOjE3NzAxNjEwODIsIm5iZiI6MTc3MDE2MTA4MiwiZXhwIjoxNzcwMTY0NjgyLCJqdGkiOiJmMDc5ZTk3ZS05N2QyLTQ3NDYtOTExZi1iYTczZTI0NzhiYjAifQ.\",\"token_type\":\"Bearer\",\"expires_in\":3600,\"scope\":\"openid somescope\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.584Z","msg":"[BROWSER CONSOLE log]: Received id_token from mock {\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.584Z","msg":"[BROWSER CONSOLE log]: User authenticated successfully using mock: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.586Z","msg":"[BROWSER CONSOLE log]: MFA detected from mock IdP: [mfa, pwd] Stored metadata: {type: OTHER, timestamp: 2026-02-03T23:24:42.582Z, uniqueReference: c11d407d-c3f4-421f-b543-e33b38411924}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.587Z","msg":"[BROWSER CONSOLE log]: Status message: Authenticated successfully. Fetching bundles... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.587Z","msg":"[BROWSER CONSOLE log]: Status message: Authenticated successfully. Redirecting... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.591Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.591Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.614Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.604Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.616Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.615Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.617Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.616Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.616Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.618Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.617Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.617Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.618Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.618Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.621Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.620Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.622Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.621Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.634Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.629Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.644Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.636Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.646Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.647Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.646Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.647Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.647Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.648Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.648Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.648Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.649Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.648Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.652Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.652Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.659Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.659Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.660Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.661Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.667Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.665Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:42.666Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.669Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.669Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.673Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/subHasher.js\",\"time\":\"2026-02-03T23:24:42.667Z\",\"message\":\"Using USER_SUB_HASH_SALT from environment (local dev/test)\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:42.667Z\",\"requestId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:42.667Z\",\"requestId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:42.668Z\",\"requestId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:42.668Z\",\"requestId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:42.668Z\",\"requestId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:42.669Z\",\"requestId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:42.670Z\",\"requestId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.754Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.754Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.754Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.754Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.755Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.754Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.755Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:42.755Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.756Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:42.755Z\",\"requestId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.756Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:42.756Z\",\"requestId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.756Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:42.756Z\",\"requestId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.756Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:42.756Z\",\"requestId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.756Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:42.756Z\",\"requestId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.756Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:42.756Z\",\"requestId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.757Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:42.756Z\",\"requestId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.778Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.778Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.807Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:42.806Z\",\"requestId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.807Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:42.807Z\",\"requestId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:42.807Z\",\"requestId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.812Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:24:42.812Z\",\"requestId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.812Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:42.812Z\",\"requestId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"eb21f759-dd95-481d-a410-b24910ea25d9\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"test\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":0}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.814Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:42.814Z\",\"requestId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.814Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:42.814Z\",\"requestId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:42.814Z\",\"requestId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.817Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:24:42.816Z\",\"requestId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:42.817Z\",\"requestId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"a825cfae-632c-4779-8606-88dffb5f1c4f\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"test\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":0}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:42.819Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:42.818Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
Checking home page...
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.127Z","msg":"[BROWSER CONSOLE log]: [Mock MFA] Injected MFA metadata: {type: TOTP, timestamp: 2026-01-08T00:09:01Z, uniqueReference: test-mfa-1770161084122}"}
[Mock MFA] Injected: type=TOTP, timestamp=2026-01-08T00:09:01Z, ref=test-mfa-1770161084122
CloudWatch RUM analytics consent dialog is visible, accepting...
[USER INTERACTION] Clicking: button:has-text("Accept") - Accept CloudWatch RUM consent
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.378Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.381Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.381Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.382Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.418Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.418Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
Navigating to Bundles via main navigation...
[USER INTERACTION] Clicking: nav.main-nav a:has-text('Bundles') - Clicking Bundles in main navigation
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.796Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.796Z\",\"msg\":\"HTTP GET /bundles.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.824Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.809Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.829Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.826Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.827Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.827Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.828Z\",\"msg\":\"HTTP GET /lib/bundle-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.829Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.833Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.829Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.835Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.833Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.834Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.836Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.835Z\",\"msg\":\"HTTP GET /widgets/loading-spinner.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.837Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.836Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.837Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.867Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.861Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.861Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.862Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.862Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.863Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.863Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.874Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.867Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.869Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.870Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.879Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.877Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:44.878Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:44.878Z\",\"requestId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"correlationId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"authorization\":\"[TOKEN]\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua-mobile\":\"?0\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/bundles.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:44.879Z\",\"requestId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"correlationId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:44.879Z\",\"requestId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"correlationId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:44.879Z\",\"requestId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"correlationId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:44.879Z\",\"requestId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"correlationId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.882Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:44.879Z\",\"requestId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"correlationId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:44.879Z\",\"requestId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"correlationId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.884Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.884Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.884Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.884Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.884Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.891Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.891Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.897Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.899Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:44.889Z\",\"requestId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"correlationId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:44.889Z\",\"requestId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"correlationId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:44.889Z\",\"requestId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"correlationId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":0}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:24:44.891Z\",\"requestId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"correlationId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:44.892Z\",\"requestId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"correlationId\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"x-correlationid\":\"83e2eddc-af12-4917-ad29-41bf70843a7e\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"test\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":0}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.901Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.901Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.905Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.901Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:44.902Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:44.903Z\",\"requestId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/bundles.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:44.903Z\",\"requestId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:44.903Z\",\"requestId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:44.903Z\",\"requestId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:44.903Z\",\"requestId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:44.903Z\",\"requestId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:44.904Z\",\"requestId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.909Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.906Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.914Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.911Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.917Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:44.914Z\",\"requestId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:44.915Z\",\"requestId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:44.915Z\",\"requestId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.921Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:24:44.917Z\",\"requestId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:44.918Z\",\"requestId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"d5d4ad3b-8b3e-4574-bc72-0d57d56ccf15\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"test\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":0}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.923Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.922Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:44.927Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:44.926Z\",\"msg\":\"HTTP GET /submit.environment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:45.631Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
Ensuring Test bundle is present...
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (1/5)
[polling to ensure present]: Test bundle still not present.
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (2/5)
[polling to ensure present]: Test bundle still not present.
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (3/5)
[polling to ensure present]: Test bundle still not present.
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (4/5)
[polling to ensure present]: Test bundle still not present.
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (5/5)
[polling to ensure present]: Test bundle still not present.
"Request Test" button not enabled (on-pass bundle), using pass API for fresh grant...
Creating and redeeming pass for bundle test...
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:51.941Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:51.941Z\",\"msg\":\"HTTP POST /api/v1/pass/admin\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:51.942Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/emailHash.js\",\"time\":\"2026-02-03T23:24:51.942Z\",\"message\":\"Using EMAIL_HASH_SECRET from environment (local dev/test)\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:51.943Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:51.942Z\",\"requestId\":\"02c6e966-60db-487c-a29e-cefcbe986721\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"02c6e966-60db-487c-a29e-cefcbe986721\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/pass/admin\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"cognito:username\":\"test\",\"email\":\"[EMAIL]\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/pass/admin\"}},\"path\":\"/api/v1/pass/admin\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"103\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"02c6e966-60db-487c-a29e-cefcbe986721\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"content-type\":\"application/json\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/bundles.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"passTypeId\\\":\\\"test\\\",\\\"bundleId\\\":\\\"test\\\",\\\"validityPeriod\\\":\\\"P1D\\\",\\\"maxUses\\\":1,\\\"createdBy\\\":\\\"behaviour-test\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:51.943Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/passAdminPost.js\",\"time\":\"2026-02-03T23:24:51.943Z\",\"requestId\":\"02c6e966-60db-487c-a29e-cefcbe986721\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"02c6e966-60db-487c-a29e-cefcbe986721\",\"message\":\"Creating admin pass\",\"passTypeId\":\"test\",\"bundleId\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:51.943Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbPassRepository.js\",\"time\":\"2026-02-03T23:24:51.943Z\",\"requestId\":\"02c6e966-60db-487c-a29e-cefcbe986721\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"02c6e966-60db-487c-a29e-cefcbe986721\",\"message\":\"putPass [table: test-passes-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:51.943Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbPassRepository.js\",\"time\":\"2026-02-03T23:24:51.943Z\",\"requestId\":\"02c6e966-60db-487c-a29e-cefcbe986721\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"02c6e966-60db-487c-a29e-cefcbe986721\",\"message\":\"Storing pass in DynamoDB\",\"passTypeId\":\"test\",\"bundleId\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:51.951Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbPassRepository.js\",\"time\":\"2026-02-03T23:24:51.951Z\",\"requestId\":\"02c6e966-60db-487c-a29e-cefcbe986721\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"02c6e966-60db-487c-a29e-cefcbe986721\",\"message\":\"Pass stored in DynamoDB\",\"pk\":\"pass#truck-gruff-freak-earth\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:51.952Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/passAdminPost.js\",\"time\":\"2026-02-03T23:24:51.951Z\",\"requestId\":\"02c6e966-60db-487c-a29e-cefcbe986721\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"02c6e966-60db-487c-a29e-cefcbe986721\",\"message\":\"Admin pass created\",\"passTypeId\":\"test\",\"bundleId\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:51.952Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:51.951Z\",\"requestId\":\"02c6e966-60db-487c-a29e-cefcbe986721\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"02c6e966-60db-487c-a29e-cefcbe986721\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/pass/admin\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"02c6e966-60db-487c-a29e-cefcbe986721\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"02c6e966-60db-487c-a29e-cefcbe986721\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"code\\\":\\\"truck-gruff-freak-earth\\\",\\\"bundleId\\\":\\\"test\\\",\\\"passTypeId\\\":\\\"test\\\",\\\"validFrom\\\":\\\"2026-02-03T23:24:51.943Z\\\",\\\"validUntil\\\":\\\"2026-02-04T23:24:51.943Z\\\",\\\"maxUses\\\":1,\\\"restrictedToEmail\\\":false}\"}}"}
Pass creation result: {"ok":true,"code":"truck-gruff-freak-earth","body":{"code":"truck-gruff-freak-earth","bundleId":"test","passTypeId":"test","validFrom":"2026-02-03T23:24:51.943Z","validUntil":"2026-02-04T23:24:51.943Z","maxUses":1,"restrictedToEmail":false}}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.055Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.055Z\",\"msg\":\"HTTP POST /api/v1/pass\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.055Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:52.055Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.056Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:52.055Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/pass\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/pass\"}},\"path\":\"/api/v1/pass\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"34\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"content-type\":\"application/json\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/bundles.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"code\\\":\\\"truck-gruff-freak-earth\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.056Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:52.056Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.056Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbPassRepository.js\",\"time\":\"2026-02-03T23:24:52.056Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"redeemPass [table: test-passes-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.065Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbPassRepository.js\",\"time\":\"2026-02-03T23:24:52.065Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"Pass redeemed in DynamoDB\",\"pk\":\"pass#truck-gruff-freak-earth\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.066Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T23:24:52.065Z\",\"requestId\":null,\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"grantBundle entry\",\"userId\":\"user\",\"requestedBundle\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.066Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:52.065Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.066Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:52.066Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.069Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:52.069Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.069Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:52.069Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.072Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T23:24:52.072Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"Loaded catalog bundle:\",\"bundleId\":\"test\",\"catalogBundle\":{\"id\":\"test\",\"name\":\"Test\",\"levelName\":\"Test\",\"enable\":\"on-pass\",\"hidden\":true,\"allocation\":\"on-request\",\"timeout\":\"P1D\",\"tokensGranted\":10}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.072Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T23:24:52.072Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"[Catalog bundle] Bundle requires manual allocation, proceeding:\",\"requestedBundle\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.072Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T23:24:52.072Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"[Catalog bundle] No cap defined for bundle:\",\"requestedBundle\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.072Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T23:24:52.072Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"Granting bundle to user:\",\"userId\":\"user\",\"requestedBundle\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.072Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T23:24:52.072Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"New bundle details:\",\"newBundle\":{\"bundleId\":\"test\",\"expiry\":\"2026-02-04\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.073Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T23:24:52.072Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"Updated user bundles:\",\"userId\":\"user\",\"currentBundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.073Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:52.073Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"putBundle [table: test-bundle-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.073Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:52.073Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"Storing bundle\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"userId\":\"user\",\"bundle\":{\"bundleId\":\"test\",\"expiry\":\"2026-02-04\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.073Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:52.073Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"Storing bundle in DynamoDB as item\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"item\":{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T23:24:52.073Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.076Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:52.076Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"Bundle stored in DynamoDB as item\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"item\":{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T23:24:52.073Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.076Z","msg":"[http-stdout]: {\"_aws\":{\"Timestamp\":1770161092076,\"CloudWatchMetrics\":[{\"Namespace\":\"Submit/BundleCapacity\",\"Dimensions\":[[\"bundleId\"]],\"Metrics\":[{\"Name\":\"BundleGranted\",\"Unit\":\"Count\"}]}]},\"bundleId\":\"test\",\"BundleGranted\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.076Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-02-03T23:24:52.076Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"Bundle granted to user:\",\"userId\":\"user\",\"newBundle\":{\"bundleId\":\"test\",\"expiry\":\"2026-02-04\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.077Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/passPost.js\",\"time\":\"2026-02-03T23:24:52.076Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"Pass redeemed and bundle granted\",\"code\":\"truck-gruff-freak-earth\",\"bundleId\":\"test\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.077Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:52.077Z\",\"requestId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/pass\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"8c754ebf-74a1-454e-bb78-d919576912ca\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"redeemed\\\":true,\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04\\\",\\\"grantStatus\\\":\\\"granted\\\"}\"}}"}
Pass redemption result: {"redeemed":true,"bundleId":"test","expiry":"2026-02-04","grantStatus":"granted"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.172Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.172Z\",\"msg\":\"HTTP GET /bundles.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.196Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.184Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.199Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.198Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.198Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.199Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.201Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.201Z\",\"msg\":\"HTTP GET /lib/bundle-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.202Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.201Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.202Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.204Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.203Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.204Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.211Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.205Z\",\"msg\":\"HTTP GET /widgets/loading-spinner.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.206Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.209Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.223Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.213Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.213Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.228Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.226Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.226Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.226Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.227Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.232Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.228Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.228Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.231Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.237Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.236Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.244Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.244Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.244Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.244Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.244Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.248Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.248Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.253Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.255Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.253Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.254Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.254Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.255Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:52.255Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:52.255Z\",\"requestId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/bundles.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:52.255Z\",\"requestId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.257Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:52.255Z\",\"requestId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:52.256Z\",\"requestId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:52.256Z\",\"requestId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:52.256Z\",\"requestId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:52.256Z\",\"requestId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.260Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:52.259Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:52.259Z\",\"requestId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/bundles.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:52.259Z\",\"requestId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:52.260Z\",\"requestId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:52.260Z\",\"requestId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:52.260Z\",\"requestId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.261Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:52.260Z\",\"requestId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:52.260Z\",\"requestId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.263Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.262Z\",\"msg\":\"HTTP GET /submit.environment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.264Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:52.264Z\",\"requestId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.264Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:52.264Z\",\"requestId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.264Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:52.264Z\",\"requestId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.266Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:24:52.266Z\",\"requestId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.267Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:52.266Z\",\"requestId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"de6b8238-3034-4295-93e5-edf37caa1b8f\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.271Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:52.270Z\",\"requestId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:52.270Z\",\"requestId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:52.270Z\",\"requestId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.274Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:24:52.272Z\",\"requestId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:52.272Z\",\"requestId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"b7110db5-02f4-4c2d-859b-f76f59d32c88\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:52.276Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:52.275Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
Returning to home via home icon...
[USER INTERACTION] Clicking: .home-link - Home icon
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.097Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.097Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.118Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.109Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.109Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.123Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.119Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.120Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.120Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.120Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.121Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.121Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.136Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.124Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.141Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.138Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.138Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.139Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.140Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.140Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.141Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.141Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.143Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.142Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.144Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.144Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.145Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.144Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.153Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.154Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.154Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.154Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.154Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.155Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.158Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.158Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.162Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.163Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.159Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:53.159Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:53.159Z\",\"requestId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:53.159Z\",\"requestId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:53.159Z\",\"requestId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:53.160Z\",\"requestId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:53.160Z\",\"requestId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:53.160Z\",\"requestId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:53.160Z\",\"requestId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.168Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:53.167Z\",\"requestId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:53.167Z\",\"requestId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:53.167Z\",\"requestId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.169Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:24:53.169Z\",\"requestId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.170Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:53.169Z\",\"requestId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"6ada8ec2-7f3b-4b91-b11d-0cd5e7b7b3b9\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.171Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.171Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.171Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.171Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.172Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.172Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.173Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:53.172Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.173Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:53.172Z\",\"requestId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:53.173Z\",\"requestId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:53.173Z\",\"requestId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:53.173Z\",\"requestId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:53.173Z\",\"requestId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:53.173Z\",\"requestId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:53.173Z\",\"requestId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.178Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.178Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.180Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:53.179Z\",\"requestId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:53.179Z\",\"requestId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:53.179Z\",\"requestId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.184Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:24:53.180Z\",\"requestId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:53.181Z\",\"requestId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"842f8ce9-8212-4b37-9f3d-aeb33d003ea2\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.186Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.186Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.891Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.899Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:53.899Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.899Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:53.899Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.900Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:53.900Z\",\"requestId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.900Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:53.900Z\",\"requestId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:53.900Z\",\"requestId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.900Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:53.900Z\",\"requestId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:53.900Z\",\"requestId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.900Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:53.900Z\",\"requestId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.900Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:53.900Z\",\"requestId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.903Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:53.903Z\",\"requestId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.903Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:53.903Z\",\"requestId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:53.903Z\",\"requestId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.904Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:24:53.903Z\",\"requestId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.904Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:53.904Z\",\"requestId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"bae1294b-a560-4524-a9ed-2e0658584054\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
[Token check] Tokens before submission: 10
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:53.908Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: button:has-text('Submit VAT (HMRC Sandbox)') - Starting VAT return submission
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.680Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.680Z\",\"msg\":\"HTTP GET /hmrc/vat/submitVat.html?hmrcAccount=sandbox\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.705Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.695Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.696Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.696Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.697Z\",\"msg\":\"HTTP GET /lib/test-data-generator.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.697Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.706Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.706Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.706Z\",\"msg\":\"HTTP GET /lib/utils/obligation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.707Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.707Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.707Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.708Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.708Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.708Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.708Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.713Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.711Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.735Z","msg":"[BROWSER CONSOLE log]: JS block finished loading."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.737Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.735Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.735Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.736Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.736Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.737Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.737Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.740Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.740Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.742Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.741Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.743Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.742Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.743Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.750Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.750Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.754Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.756Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.758Z","msg":"[BROWSER CONSOLE log]: JS block started loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.760Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.757Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.757Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:54.758Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:54.758Z\",\"requestId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:54.758Z\",\"requestId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:54.758Z\",\"requestId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:54.758Z\",\"requestId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:54.758Z\",\"requestId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:54.758Z\",\"requestId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:54.759Z\",\"requestId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.761Z","msg":"[BROWSER CONSOLE log]: OAuth callback handler (no action taken)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.761Z","msg":"[BROWSER CONSOLE log]: JS block finished loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.763Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.764Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.762Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:54.762Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:54.763Z\",\"requestId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:54.763Z\",\"requestId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:54.763Z\",\"requestId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:54.763Z\",\"requestId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:54.763Z\",\"requestId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:54.763Z\",\"requestId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:54.763Z\",\"requestId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.766Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:24:54.766Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.768Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:54.766Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:54.766Z\",\"requestId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"content-type\":\"application/json\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:54.766Z\",\"requestId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:24:54.766Z\",\"requestId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:54.766Z\",\"requestId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:54.766Z\",\"requestId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:54.767Z\",\"requestId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:54.767Z\",\"requestId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.769Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:54.769Z\",\"requestId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.769Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:54.769Z\",\"requestId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:54.769Z\",\"requestId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.770Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:24:54.770Z\",\"requestId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.770Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:54.770Z\",\"requestId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"d6796095-8680-4367-8b96-72b3db03ae17\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.771Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:54.771Z\",\"requestId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.772Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:54.771Z\",\"requestId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:54.771Z\",\"requestId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.773Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:24:54.773Z\",\"requestId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.773Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:54.773Z\",\"requestId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"28332e4e-987b-4659-a20e-bc990f67338d\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.776Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:54.775Z\",\"requestId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:24:54.775Z\",\"requestId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:24:54.776Z\",\"requestId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.776Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:24:54.776Z\",\"requestId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:54.777Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:24:54.776Z\",\"requestId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"decfc085-eaa8-4581-9569-265b1e874164\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:55.935Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Filling: #vatNumber with value: "847829176" - Entering VAT number
Set period dates: 2017-01-01 to 2017-03-31
[USER INTERACTION] Filling: #vatDueSales with value: "1000.00" - Entering VAT due on sales (Box 1)
[USER INTERACTION] Filling: #vatDueAcquisitions with value: "0.00" - Entering VAT due on acquisitions (Box 2)
[USER INTERACTION] Filling: #vatReclaimedCurrPeriod with value: "0.00" - Entering VAT reclaimed (Box 4)
[USER INTERACTION] Filling: #totalValueSalesExVAT with value: "5000" - Entering total sales ex VAT (Box 6)
[USER INTERACTION] Filling: #totalValuePurchasesExVAT with value: "0" - Entering total purchases ex VAT (Box 7)
[USER INTERACTION] Filling: #totalValueGoodsSuppliedExVAT with value: "0" - Entering goods supplied to EU (Box 8)
[USER INTERACTION] Filling: #totalAcquisitionsExVAT with value: "0" - Entering acquisitions from EU (Box 9)
Checked declaration checkbox
Enabled developer mode for test scenario
Developer section visible (controlled by global developer mode)
Checked runFraudPreventionHeaderValidation checkbox
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:24:58.928Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
Checked allowSandboxObligations checkbox
[USER INTERACTION] Focusing: #submitBtn - the Submit button
[USER INTERACTION] Clicking: #submitBtn - Submitting VAT form
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:00.144Z","msg":"[BROWSER CONSOLE log]: Status message: Initiating HMRC authentication... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:00.145Z","msg":"[BROWSER CONSOLE log]: Stored pending request and current activity: {\"vatNumber\":\"[VRN]\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":5000,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0,\"finalised\":true,\"testScenario\":\"\",\"runFraudPreventionHeaderValidation\":true,\"allowSandboxObligations\":true} /hmrc/vat/submitVat.html sandbox"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:00.146Z","msg":"[BROWSER CONSOLE log]: Using client-side generated HMRC Auth URL: http://localhost:9000/oauth/authorize?response_type=code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Factivities%2FsubmitVatCallback.html&scope=write%3Avat%20read%3Avat&state=5912345fab834ec1832e7156882b6763"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:00.146Z","msg":"[BROWSER CONSOLE log]: Current activity set to: /hmrc/vat/submitVat.html"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:00.146Z","msg":"[BROWSER CONSOLE log]: Status message: Redirecting to HMRC for authentication at http://localhost:9000/oauth/authorize?response_type=code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Factivities%2FsubmitVatCallback.html&scope=write%3Avat%20read%3Avat&state=5912345fab834ec1832e7156882b6763... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:00.146Z","msg":"[BROWSER CONSOLE log]: Page transition initiated: Redirecting to HMRC OAuth URL http://localhost:9000/oauth/authorize?response_type=code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Factivities%2FsubmitVatCallback.html&scope=write%3Avat%20read%3Avat&state=5912345fab834ec1832e7156882b6763"}
[http-simulator] GET /oauth/authorize?response_type=code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Factivities%2FsubmitVatCallback.html&scope=write%3Avat%20read%3Avat&state=5912345fab834ec1832e7156882b6763
[http-simulator:hmrc-oauth] GET /oauth/authorize for client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV, autoGrant=undefined
[USER INTERACTION] Clicking: Continue button - Continuing with HMRC permission
[USER INTERACTION] Clicking: [Locator] - Continue
[http-simulator] POST /oauth/authorize
[http-simulator:hmrc-oauth] POST /oauth/authorize for client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV, step=sign-in-choice
[http-simulator:hmrc-oauth] Showing sign-in choice page
[USER INTERACTION] Clicking: Sign in to HMRC button - Starting HMRC authentication
[USER INTERACTION] Clicking: [Locator] - Sign in to the HMRC online service
[http-simulator] POST /oauth/authorize
[http-simulator:hmrc-oauth] POST /oauth/authorize for client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV, step=credentials
[http-simulator:hmrc-oauth] Showing credentials page
[USER INTERACTION] Filling: #userId with value: "359800498957" - Entering HMRC user ID
[USER INTERACTION] Filling: #password with value: "Clb26157t62X" - Entering HMRC password
[USER INTERACTION] Clicking: Sign in button - Submitting HMRC credentials
[USER INTERACTION] Clicking: [Locator] - Sign in
[http-simulator] POST /oauth/authorize
[http-simulator:hmrc-oauth] POST /oauth/authorize for client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV, step=grant-permission
[http-simulator:hmrc-oauth] Showing grant permission page
[USER INTERACTION] Clicking: #givePermission - Give permission
[http-simulator] POST /oauth/authorize
[http-simulator:hmrc-oauth] POST /oauth/authorize for client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV, step=complete
[http-simulator:hmrc-oauth] Grant permission complete, generating code
[http-simulator:hmrc-oauth] Granting access, redirecting to http://localhost:3000/activities/submitVatCallback.html?code=babc6d30a13a4852aaffdc0f4e34171d&state=5912345fab834ec1832e7156882b6763
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.463Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.463Z\",\"msg\":\"HTTP GET /activities/submitVatCallback.html?code=babc6d30a13a4852aaffdc0f4e34171d&state=5912345fab834ec1832e7156882b6763\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.544Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.534Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.546Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.546Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.547Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.547Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.548Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.548Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.549Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.549Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.550Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.550Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.550Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.550Z\",\"msg\":\"HTTP GET /widgets/loading-spinner.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.551Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.551Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.575Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.574Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.575Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.575Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.575Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.575Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.576Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.576Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.576Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.576Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.577Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.577Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.579Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.578Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.579Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.579Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.581Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.581Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.587Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.588Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.588Z","msg":"[BROWSER CONSOLE log]: OAuth callback handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.588Z","msg":"[BROWSER CONSOLE log]: Page transition initiated: Clearing URL parameters"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.589Z","msg":"[BROWSER CONSOLE log]: OAuth callback handler (normal completion)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.589Z","msg":"[BROWSER CONSOLE log]: Status message: Exchanging authorization code for access token... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.589Z","msg":"[BROWSER CONSOLE log]: Exchanging token. Remote call initiated: POST /api/v1/hmrc/token ++ Body: {\"code\":\"babc6d30a13a4852aaffdc0f4e34171d\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.598Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.598Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.599Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.597Z\",\"msg\":\"HTTP POST /api/v1/hmrc/token\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:06.598Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:06.598Z\",\"requestId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/token\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/token\"}},\"path\":\"/api/v1/hmrc/token\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"43\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"content-type\":\"application/json\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/activities/submitVatCallback.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"code\\\":\\\"babc6d30a13a4852aaffdc0f4e34171d\\\"}\"}}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcTokenPost.js\",\"time\":\"2026-02-03T23:25:06.598Z\",\"requestId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"message\":\"Exchanging authorization code for HMRC access token\"}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcTokenPost.js\",\"time\":\"2026-02-03T23:25:06.598Z\",\"requestId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"msg\":\"Retrieving HMRC client secret from arn \"}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcTokenPost.js\",\"time\":\"2026-02-03T23:25:06.598Z\",\"requestId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"msg\":\"Secret retrieved from override and cached\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.601Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.602Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:06.599Z\",\"requestId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"message\":\"Request to POST http://localhost:9000/oauth/token\",\"url\":\"http://localhost:9000/oauth/token\",\"headers\":{\"Content-Type\":\"application/x-www-form-urlencoded\",\"x-request-id\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"21882ac6-2439-42a2-935e-31827b822a7c\"},\"body\":\"grant_type=authorization_code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&[SECRET]&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Factivities%2FsubmitVatCallback.html&code=babc6d30a13a4852aaffdc0f4e34171d\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:06.600Z\",\"requestId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"message\":\"Performing HTTP POST for token exchange\",\"providerUrl\":\"http://localhost:9000/oauth/token\"}"}
{"level":50,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.602Z","msg":"[http-stderr]: {\"level\":50,\"time\":\"2026-02-03T23:25:06.599Z\",\"msg\":\"SENSITIVE DATA DETECTED in log output - credentials were present and have been redacted\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.603Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.602Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.602Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.603Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:06.603Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:06.603Z\",\"requestId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/activities/submitVatCallback.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:06.603Z\",\"requestId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.603Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:06.603Z\",\"requestId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:06.603Z\",\"requestId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:06.603Z\",\"requestId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.604Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.604Z\",\"requestId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.604Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.604Z\",\"requestId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
[http-simulator] POST /oauth/token
[http-simulator:hmrc-oauth] POST /oauth/token grant_type=authorization_code
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.608Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:06.608Z\",\"requestId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"message\":\"HTTP POST response received with status and duration\",\"status\":200,\"duration\":8}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.609Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:06.609Z\",\"requestId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/oauth/token\",\"method\":\"POST\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.612Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.612Z\",\"requestId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.612Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.612Z\",\"requestId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.613Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:06.612Z\",\"requestId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.614Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:06.614Z\",\"requestId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.614Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:06.614Z\",\"requestId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"23e76a25-f6a3-4ce5-9bc3-85aaa7fa5d45\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.618Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:06.617Z\",\"requestId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/oauth/token\",\"method\":\"POST\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.618Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:06.617Z\",\"requestId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"message\":\"exchangeClientSecretForAccessToken response\",\"responseStatus\":200,\"responseTokens\":{\"access_token\":\"[REDACTED]\",\"refresh_token\":\"[REDACTED]\",\"expires_in\":14400,\"scope\":\"write:vat read:vat\",\"token_type\":\"bearer\"},\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"tokenType\":\"bearer\",\"scope\":\"write:vat read:vat\",\"expiresIn\":14400,\"hasRefreshToken\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.618Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:06.618Z\",\"requestId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"message\":\"Token exchange succeeded\",\"accessTokenLength\":59,\"hasIdToken\":false,\"hasRefreshToken\":true,\"expiresIn\":14400,\"tokenType\":\"bearer\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:06.618Z\",\"requestId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/token\",\"response\":{\"statusCode\":200,\"headers\":{\"x-request-id\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"21882ac6-2439-42a2-935e-31827b822a7c\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"accessToken\\\":\\\"mock-hmrc-access-token-c0187863-aa14-488c-86b1-49d7faacbf19\\\",\\\"hmrcAccessToken\\\":\\\"mock-hmrc-access-token-c0187863-aa14-488c-86b1-49d7faacbf19\\\",\\\"refreshToken\\\":\\\"mock-hmrc-refresh-token-7007699b-d387-4280-a85b-404a9ff4320b\\\",\\\"expiresIn\\\":14400,\\\"tokenType\\\":\\\"bearer\\\"}\"}}"}
{"level":50,"time":"2026-02-03T23:25:06.623Z","msg":"SENSITIVE DATA DETECTED in log output - credentials were present and have been redacted"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.623Z","msg":"[BROWSER CONSOLE log]: Exchanged token. Remote call completed successfully: POST /api/v1/hmrc/token {[SECRET], [SECRET], [SECRET], expiresIn: 14400, tokenType: bearer} mock-hmrc-access-token-c0187863-aa14-488c-86b1-49d7faacbf19"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.623Z","msg":"[BROWSER CONSOLE log]: Status message: Obtained Access Token from HMRC... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.624Z","msg":"[BROWSER CONSOLE log]: Current activity found: /hmrc/vat/submitVat.html"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.627Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.627Z\",\"msg\":\"HTTP GET /hmrc/vat/submitVat.html?hmrcAccount=sandbox\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.656Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.641Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.659Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.657Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.658Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.658Z\",\"msg\":\"HTTP GET /lib/test-data-generator.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.660Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.659Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.659Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.660Z\",\"msg\":\"HTTP GET /lib/utils/obligation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.662Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.661Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.664Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.663Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.664Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.664Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.665Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.665Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.673Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.670Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.692Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.691Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.692Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.692Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.692Z","msg":"[BROWSER CONSOLE log]: JS block finished loading."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.695Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.692Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.693Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.693Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.696Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.696Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.698Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.696Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.697Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.700Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.699Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.704Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.704Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.707Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.708Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.711Z","msg":"[BROWSER CONSOLE log]: JS block started loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.712Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.712Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.712Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.713Z","msg":"[BROWSER CONSOLE log]: Restored form draft from 2026-02-03T23:24:58.385Z"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.713Z","msg":"[BROWSER CONSOLE log]: OAuth callback handler (code present, auto-continue)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.714Z","msg":"[BROWSER CONSOLE log]: Retrieved submission data: {vatNumber: [VRN], periodStart: 2017-01-01, periodEnd: 2017-03-31, vatDueSales: 1000, vatDueAcquisitions: 0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.715Z","msg":"[BROWSER CONSOLE log]: Status message: Submitting VAT return to HMRC... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.716Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.712Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:06.713Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:06.713Z\",\"requestId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:06.713Z\",\"requestId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:06.713Z\",\"requestId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:06.713Z\",\"requestId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:06.713Z\",\"requestId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.713Z\",\"requestId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.714Z\",\"requestId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:06.716Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:06.716Z\",\"requestId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:06.716Z\",\"requestId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.717Z","msg":"[BROWSER CONSOLE log]: JS block finished loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.719Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:06.716Z\",\"requestId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:06.716Z\",\"requestId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:06.716Z\",\"requestId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.716Z\",\"requestId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.716Z\",\"requestId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.718Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.722Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:06.719Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:06.720Z\",\"requestId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"content-type\":\"application/json\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:06.720Z\",\"requestId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:06.720Z\",\"requestId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:06.720Z\",\"requestId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:06.720Z\",\"requestId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.720Z\",\"requestId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.720Z\",\"requestId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.723Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.724Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.724Z\",\"requestId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.724Z\",\"requestId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:06.724Z\",\"requestId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.725Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:06.725Z\",\"requestId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.725Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:06.725Z\",\"requestId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"79934628-52a6-4878-87e8-793223d5bf5c\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.726Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.726Z\",\"requestId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.726Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.726Z\",\"requestId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.726Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:06.726Z\",\"requestId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.728Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:06.727Z\",\"requestId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:06.728Z\",\"requestId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"6b9cba0a-127f-47db-b743-9aa681e6b152\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.730Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.730Z\",\"requestId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.730Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.730Z\",\"requestId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:06.730Z\",\"requestId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.731Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:06.731Z\",\"requestId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.731Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:06.731Z\",\"requestId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"e508c34e-47be-4628-9fd2-2d556bd6fa40\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":0,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":10},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":10}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.798Z","msg":"[BROWSER CONSOLE log]: Submitting VAT. Remote call initiated: POST /api/v1/hmrc/vat/return ++ Body: {\"vatNumber\":\"[VRN]\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":5000,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0,\"finalised\":true,\"accessToken\":\"mock-hmrc-access-token-c0187863-aa14-488c-86b1-49d7faacbf19\",\"runFraudPreventionHeaderValidation\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.804Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:06.804Z\",\"msg\":\"HTTP POST /api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.805Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:06.804Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.805Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:06.805Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"434\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T23:25:06.797Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"daa737f3-9a55-48d5-9560-b5ba7735fb7f\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-initial-request\":\"true\",\"gov-client-public-ip\":\"178.228.163.202\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"237bdac4-af68-46bf-8b74-705571ab8945\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"vatNumber\\\":\\\"[VRN]\\\",\\\"periodStart\\\":\\\"2017-01-01\\\",\\\"periodEnd\\\":\\\"2017-03-31\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true,\\\"accessToken\\\":\\\"mock-hmrc-access-token-c0187863-aa14-488c-86b1-49d7faacbf19\\\",\\\"runFraudPreventionHeaderValidation\\\":true}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.806Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:06.805Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.806Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:06.806Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Extracting user information from event\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.806Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:06.806Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.806Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:06.806Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"434\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T23:25:06.797Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"daa737f3-9a55-48d5-9560-b5ba7735fb7f\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-initial-request\":\"true\",\"gov-client-public-ip\":\"178.228.163.202\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"237bdac4-af68-46bf-8b74-705571ab8945\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"vatNumber\\\":\\\"[VRN]\\\",\\\"periodStart\\\":\\\"2017-01-01\\\",\\\"periodEnd\\\":\\\"2017-03-31\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true,\\\"accessToken\\\":\\\"mock-hmrc-access-token-c0187863-aa14-488c-86b1-49d7faacbf19\\\",\\\"runFraudPreventionHeaderValidation\\\":true}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.807Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:06.807Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.807Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.807Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.807Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.810Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.810Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.810Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.810Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:06.810Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":0,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T23:24:52.073Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.810Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:06.810Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\",\"requiredBundleIds\":[\"test\",\"day-guest\",\"invited-guest\",\"resident-guest\",\"resident-pro-comp\",\"resident-pro\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.810Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:06.810Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.811Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/lib/buildFraudHeaders.js\",\"time\":\"2026-02-03T23:25:06.811Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"No public client IP detected in X-Forwarded-For\",\"xff\":\"\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.812Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:06.811Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"accessTokenPrefix\":\"mock-hmr...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.812Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T23:25:06.812Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"Checking for test scenario\":null}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T23:25:06.812Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Resolving periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vatNumber\":\"[VRN]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.812Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T23:25:06.812Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"msg\":\"Validating fraud prevention headers for HMRC API request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.813Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:06.812Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Validating fraud prevention headers\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
[http-simulator] GET /test/fraud-prevention-headers/validate
[http-simulator:fraud-headers] GET /test/fraud-prevention-headers/validate
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.816Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:06.816Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"VALID_WITH_WARNINGS\",\"validationMessage\":\"Headers valid with warnings\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.816Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:06.816Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]},{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-client-public-port\"]}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.816Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:06.816Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.820Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:06.819Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.820Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:06.820Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Request to GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"Gov-Client-Device-ID\":\"daa737f3-9a55-48d5-9560-b5ba7735fb7f\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T23:25:06.797Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"http://localhost:9000\"}}"}
[http-simulator] GET /organisations/vat/847829176/obligations?from=2017-01-01&to=2017-03-31&status=O
[http-simulator:vat-obligations] GET /organisations/vat/847829176/obligations from=2017-01-01 to=2017-03-31
[http-simulator:scenarios] Using default obligations with random periodKey: 21JH
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.823Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:06.823Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Response from GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"status\":200,\"hmrcResponseBody\":{\"obligations\":[{\"periodKey\":\"21O2\",\"start\":\"2017-04-01\",\"end\":\"2017-06-30\",\"due\":\"2017-08-07\",\"status\":\"O\"}]}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.823Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:06.823Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.827Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:06.827Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.827Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T23:25:06.827Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"allowSandboxObligations: Using first available open obligation with the requested year injected\",\"requestedPeriod\":{\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\"},\"rawPeriodKey\":\"21O2\",\"usedObligation\":\"17O2\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.827Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T23:25:06.827Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Resolved periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"resolvedPeriodKey\":\"17O2\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.830Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.830Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.830Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.830Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.832Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.832Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.832Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.832Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.832Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.832Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"consumeToken [table: test-bundle-table]\",\"bundleId\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.836Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:06.835Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Token consumed\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"bundleId\":\"test\",\"tokensRemaining\":9}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.836Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/tokenEnforcement.js\",\"time\":\"2026-02-03T23:25:06.836Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Token consumption result\",\"userId\":\"user\",\"activityId\":\"submit-vat-sandbox\",\"bundleId\":\"test\",\"consumed\":true,\"tokensRemaining\":9}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.836Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T23:25:06.836Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Token consumed for submission\",\"activityId\":\"submit-vat-sandbox\",\"tokensRemaining\":9}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.836Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T23:25:06.836Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.836Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T23:25:06.836Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Initiating new processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.836Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:06.836Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Marking request as processing in DynamoDB\",\"userId\":\"user\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.836Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:06.836Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-return-post-async-requests-table]\",\"status\":\"processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.836Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:06.836Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Starting async processing locally (no SQS queue URL)\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.837Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T23:25:06.837Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Validating fraud prevention headers for sandbox account\",\"hmrcAccount\":\"sandbox\",\"runFraudPreventionHeaderValidation\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.837Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:06.837Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Validating fraud prevention headers\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
[http-simulator] GET /test/fraud-prevention-headers/validate
[http-simulator:fraud-headers] GET /test/fraud-prevention-headers/validate
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.839Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:06.838Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Checking persisted request status\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.839Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:06.838Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-return-post-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.842Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:06.842Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"VALID_WITH_WARNINGS\",\"validationMessage\":\"Headers valid with warnings\"}\n{\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:06.842Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]},{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-client-public-port\"]}]}\n{\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:06.842Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.844Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:06.844Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.844Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:06.844Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.845Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:06.844Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Yielding with HTTP 202 Accepted\",\"location\":\"http://localhost:3000/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.845Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:06.845Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"response\":{\"statusCode\":202,\"headers\":{\"Gov-Client-Device-ID\":\"daa737f3-9a55-48d5-9560-b5ba7735fb7f\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T23:25:06.797Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"Retry-After\":\"5\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"Location\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"message\\\":\\\"Request accepted for processing\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.846Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:06.845Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.846Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T23:25:06.846Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Request to POST http://localhost:9000/organisations/vat/[VRN]/returns\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"Gov-Client-Device-ID\":\"daa737f3-9a55-48d5-9560-b5ba7735fb7f\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T23:25:06.797Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"body\":{\"periodKey\":\"17O2\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":5000,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0,\"finalised\":true},\"environment\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.846Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:06.846Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Request to POST http://localhost:9000/organisations/vat/[VRN]/returns\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns\",\"method\":\"POST\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"Gov-Client-Device-ID\":\"daa737f3-9a55-48d5-9560-b5ba7735fb7f\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T23:25:06.797Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"body\":\"{\\\"periodKey\\\":\\\"17O2\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true}\"}"}
[http-simulator] POST /organisations/vat/847829176/returns
[http-simulator:vat-returns] POST /organisations/vat/847829176/returns
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.851Z","msg":"[BROWSER CONSOLE log]: waiting async request [POST /api/v1/hmrc/vat/return] (timeout: 1630000ms)..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.851Z","msg":"[BROWSER CONSOLE log]: Status message: Still processing... (poll #1) Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.851Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:06.851Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Response from POST http://localhost:9000/organisations/vat/[VRN]/returns\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns\",\"status\":201,\"hmrcResponseBody\":{\"processingDate\":\"2026-02-03T23:25:06.850Z\",\"formBundleNumber\":\"104445609735\",\"paymentIndicator\":\"DD\",\"chargeRefNumber\":\"fKKlJlgDsbWXkzWH\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.852Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:06.851Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns\",\"method\":\"POST\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.854Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:06.854Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns\",\"method\":\"POST\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.855Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T23:25:06.854Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Received HMRC response: {}\",\"httpResult\":{\"hmrcResponse\":{},\"hmrcResponseBody\":{\"processingDate\":\"2026-02-03T23:25:06.850Z\",\"formBundleNumber\":\"104445609735\",\"paymentIndicator\":\"DD\",\"chargeRefNumber\":\"fKKlJlgDsbWXkzWH\"}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.855Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T23:25:06.855Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"DynamoDB enabled, proceeding with putReceipt [table: test-receipts-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.855Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T23:25:06.855Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Storing receipt\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"userSub\":\"user\",\"receiptId\":\"2026-02-03T23:25:06.855Z-104445609735\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.855Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T23:25:06.855Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Storing receipt in DynamoDB as item\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"receiptId\":\"2026-02-03T23:25:06.855Z-104445609735\",\"ttl_datestamp\":\"2033-02-01T23:25:06.855Z\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.858Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T23:25:06.858Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Receipt stored in DynamoDB as item\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"receiptId\":\"2026-02-03T23:25:06.855Z-104445609735\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.858Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:06.858Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Local async processing completed successfully\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.858Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:06.858Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Marking async request as completed\",\"userSub\":\"user\",\"asyncRequestsTableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.859Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:06.858Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-return-post-async-requests-table]\",\"status\":\"completed\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:06.862Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:06.862Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.849Z","msg":"[BROWSER CONSOLE log]: re-trying async request [POST /api/v1/hmrc/vat/return] (poll #1, elapsed: 1001ms, timeout: 1630000ms, last status: 202)..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.852Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:07.852Z\",\"msg\":\"HTTP POST /api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.852Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:07.852Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.853Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:07.852Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"434\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T23:25:06.797Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"daa737f3-9a55-48d5-9560-b5ba7735fb7f\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"gov-client-public-ip\":\"178.228.163.202\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"237bdac4-af68-46bf-8b74-705571ab8945\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"vatNumber\\\":\\\"[VRN]\\\",\\\"periodStart\\\":\\\"2017-01-01\\\",\\\"periodEnd\\\":\\\"2017-03-31\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true,\\\"accessToken\\\":\\\"mock-hmrc-access-token-c0187863-aa14-488c-86b1-49d7faacbf19\\\",\\\"runFraudPreventionHeaderValidation\\\":true}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.853Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:07.853Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:07.853Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Extracting user information from event\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:07.853Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.853Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:07.853Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"content-length\":\"434\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T23:25:06.797Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"daa737f3-9a55-48d5-9560-b5ba7735fb7f\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"gov-client-public-ip\":\"178.228.163.202\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"237bdac4-af68-46bf-8b74-705571ab8945\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"origin\":\"http://localhost:3000\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"vatNumber\\\":\\\"[VRN]\\\",\\\"periodStart\\\":\\\"2017-01-01\\\",\\\"periodEnd\\\":\\\"2017-03-31\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true,\\\"accessToken\\\":\\\"mock-hmrc-access-token-c0187863-aa14-488c-86b1-49d7faacbf19\\\",\\\"runFraudPreventionHeaderValidation\\\":true}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.854Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:07.854Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.854Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:07.854Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.854Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:07.854Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.856Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:07.856Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.856Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:07.856Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:07.856Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T23:24:52.073Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.856Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:07.856Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\",\"requiredBundleIds\":[\"test\",\"day-guest\",\"invited-guest\",\"resident-guest\",\"resident-pro-comp\",\"resident-pro\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.856Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:07.856Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.857Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/lib/buildFraudHeaders.js\",\"time\":\"2026-02-03T23:25:07.857Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"No public client IP detected in X-Forwarded-For\",\"xff\":\"\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.857Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:07.857Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"accessTokenPrefix\":\"mock-hmr...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.857Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T23:25:07.857Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"Checking for test scenario\":null}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.857Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T23:25:07.857Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Resolving periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vatNumber\":\"[VRN]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.857Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T23:25:07.857Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"msg\":\"Validating fraud prevention headers for HMRC API request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.857Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:07.857Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Validating fraud prevention headers\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
[http-simulator] GET /test/fraud-prevention-headers/validate
[http-simulator:fraud-headers] GET /test/fraud-prevention-headers/validate
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.859Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:07.859Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"VALID_WITH_WARNINGS\",\"validationMessage\":\"Headers valid with warnings\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.859Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:07.859Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]},{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-client-public-port\"]}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.859Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:07.859Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.861Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:07.861Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.862Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:07.861Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Request to GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"Gov-Client-Device-ID\":\"daa737f3-9a55-48d5-9560-b5ba7735fb7f\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T23:25:06.797Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"http://localhost:9000\"}}"}
[http-simulator] GET /organisations/vat/847829176/obligations?from=2017-01-01&to=2017-03-31&status=O
[http-simulator:vat-obligations] GET /organisations/vat/847829176/obligations from=2017-01-01 to=2017-03-31
[http-simulator:scenarios] Using default obligations with random periodKey: 21R2
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.863Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:07.863Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Response from GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"status\":200,\"hmrcResponseBody\":{\"obligations\":[{\"periodKey\":\"26D7\",\"start\":\"2017-04-01\",\"end\":\"2017-06-30\",\"due\":\"2017-08-07\",\"status\":\"O\"}]}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.863Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:07.863Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.866Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:07.865Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.866Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T23:25:07.866Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"allowSandboxObligations: Using first available open obligation with the requested year injected\",\"requestedPeriod\":{\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\"},\"rawPeriodKey\":\"26D7\",\"usedObligation\":\"17D7\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.866Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T23:25:07.866Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Resolved periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"resolvedPeriodKey\":\"17D7\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.866Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:07.866Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-return-post-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.868Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:07.868Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.869Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T23:25:07.868Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":false}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-02-03T23:25:07.868Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Found persisted request\",\"status\":\"completed\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.869Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:07.869Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.869Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:07.869Z\",\"requestId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"response\":{\"statusCode\":200,\"headers\":{\"Gov-Client-Device-ID\":\"daa737f3-9a55-48d5-9560-b5ba7735fb7f\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T23:25:06.797Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"e148c234-dd0f-4388-bc6a-b6bb7098da51\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"receipt\\\":{\\\"processingDate\\\":\\\"2026-02-03T23:25:06.850Z\\\",\\\"formBundleNumber\\\":\\\"104445609735\\\",\\\"paymentIndicator\\\":\\\"DD\\\",\\\"chargeRefNumber\\\":\\\"fKKlJlgDsbWXkzWH\\\"},\\\"hmrcResponse\\\":{\\\"ok\\\":true,\\\"status\\\":201,\\\"statusText\\\":\\\"Created\\\",\\\"headers\\\":{\\\"access-control-allow-headers\\\":\\\"Content-Type, Authorization, Accept\\\",\\\"access-control-allow-methods\\\":\\\"GET, POST, PUT, DELETE, OPTIONS\\\",\\\"access-control-allow-origin\\\":\\\"*\\\",\\\"connection\\\":\\\"keep-alive\\\",\\\"content-length\\\":\\\"140\\\",\\\"content-type\\\":\\\"application/json; charset=utf-8\\\",\\\"date\\\":\\\"Tue, 03 Feb 2026 23:25:06 GMT\\\",\\\"etag\\\":\\\"W/\\\\\\\"8c-RHeXuhqH151WY4s4u/Azoci0xI0\\\\\\\"\\\",\\\"keep-alive\\\":\\\"timeout=5\\\",\\\"receipt-id\\\":\\\"029a214d-1725-4d0d-8159-1b9cdad23539\\\",\\\"receipt-signature\\\":\\\"This has been deprecated - DO NOT USE\\\",\\\"receipt-timestamp\\\":\\\"2026-02-03T23:25:06Z\\\",\\\"x-correlationid\\\":\\\"e60772d7-5a67-4cda-82c5-5a25c3c48d9d\\\",\\\"x-powered-by\\\":\\\"Express\\\"}},\\\"hmrcResponseBody\\\":{\\\"processingDate\\\":\\\"2026-02-03T23:25:06.850Z\\\",\\\"formBundleNumber\\\":\\\"104445609735\\\",\\\"paymentIndicator\\\":\\\"DD\\\",\\\"chargeRefNumber\\\":\\\"fKKlJlgDsbWXkzWH\\\"},\\\"periodKey\\\":\\\"17O2\\\",\\\"receiptId\\\":\\\"2026-02-03T23:25:06.855Z-104445609735\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.873Z","msg":"[BROWSER CONSOLE log]: finished async request [POST /api/v1/hmrc/vat/return] (poll #1, elapsed: 1023ms, status: 200)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.874Z","msg":"[BROWSER CONSOLE log]: Status message: VAT return processed Type: success"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.874Z","msg":"[BROWSER CONSOLE log]: Page display transition: Displaying receipt and hiding form {receipt: Object, hmrcResponse: Object, hmrcResponseBody: Object, periodKey: 17O2, receiptId: 2026-02-03T23:25:06.855Z-104445609735}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.874Z","msg":"[BROWSER CONSOLE log]: Continue submission handler (success, session storage cleared)"}
[Test] Captured resolved periodKey from response: 17O2
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.878Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:07.877Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.878Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:07.878Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.878Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:07.878Z\",\"requestId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"content-type\":\"application/json\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.878Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:07.878Z\",\"requestId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:07.878Z\",\"requestId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.878Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:07.878Z\",\"requestId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:07.878Z\",\"requestId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.878Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:07.878Z\",\"requestId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.879Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:07.878Z\",\"requestId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.881Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:07.881Z\",\"requestId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.881Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:07.881Z\",\"requestId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:07.881Z\",\"requestId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.882Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:07.882Z\",\"requestId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:07.882Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:07.882Z\",\"requestId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"5e138fde-580d-42a5-99c8-91c286229054\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
Waiting for VAT submission to complete and receipt to be displayed...
Current URL: http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox
Page title: Submit VAT Return - DIY Accounting
Body element exists: true
Main content element exists: true
Receipt element exists: true
Receipt element style: display: block;
Form element exists: true
Form element style: display: none;
Receipt element visible: true
[waitForSuccessOrError] SUCCESS: "VAT submission receipt" detected after 0s (poll #1)
formBundleNumber validated: 104445609735
chargeRefNumber validated: fKKlJlgDsbWXkzWH
processingDate validated: 4 February 2026 at 00:25 (parsed as 2026-02-03T23:25:00.000Z)
VAT submission flow completed successfully with validated receipt fields
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:10.715Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:10.715Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:10.715Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:10.715Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:10.715Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:10.715Z\",\"requestId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:10.715Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:10.715Z\",\"requestId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:10.715Z\",\"requestId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:10.716Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:10.715Z\",\"requestId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:10.715Z\",\"requestId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:10.716Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:10.716Z\",\"requestId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:10.716Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:10.716Z\",\"requestId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:10.718Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:10.718Z\",\"requestId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:10.718Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:10.718Z\",\"requestId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:10.718Z\",\"requestId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:10.719Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:10.719Z\",\"requestId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:10.719Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:10.719Z\",\"requestId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"2f78d089-3013-4442-9b48-2f4e5e7ddafd\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
[Token check] Tokens after submission: 9
Navigating to Receipts via main navigation...
[USER INTERACTION] Clicking: nav.main-nav a:has-text('Receipts') - Clicking Receipts in main navigation
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:10.997Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:10.997Z\",\"msg\":\"HTTP GET /hmrc/receipt/receipts.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.017Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.007Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.020Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.018Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.019Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.019Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.020Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.021Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.020Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.020Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.024Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.023Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.024Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.043Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.042Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.042Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.043Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.043Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.044Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.043Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.044Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.048Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.048Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.048Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.048Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.049Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.049Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.073Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.073Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.073Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.073Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.073Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.081Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.082Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.085Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.079Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.079Z\",\"msg\":\"HTTP GET /api/v1/hmrc/receipt\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:11.080Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:11.080Z\",\"requestId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/receipt/receipts.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:11.080Z\",\"requestId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:11.080Z\",\"requestId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:11.080Z\",\"requestId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:11.080Z\",\"requestId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:11.080Z\",\"requestId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:11.080Z\",\"requestId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:11.082Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:11.082Z\",\"requestId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/receipt\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/receipt\"}},\"path\":\"/api/v1/hmrc/receipt\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/receipt/receipts.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:11.083Z\",\"requestId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:11.083Z\",\"requestId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"message\":\"Extracting user information from event\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:11.083Z\",\"requestId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:11.083Z\",\"requestId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/receipt\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/receipt\"}},\"path\":\"/api/v1/hmrc/receipt\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/receipt/receipts.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:11.084Z\",\"requestId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:11.084Z\",\"requestId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:11.084Z\",\"requestId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.086Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.087Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.087Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.087Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.089Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.088Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:11.088Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:11.089Z\",\"requestId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/receipt/receipts.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:11.089Z\",\"requestId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:11.089Z\",\"requestId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:11.089Z\",\"requestId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:11.089Z\",\"requestId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.090Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:11.089Z\",\"requestId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:11.089Z\",\"requestId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.092Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:11.091Z\",\"requestId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:11.091Z\",\"requestId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:11.091Z\",\"requestId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.092Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:11.092Z\",\"requestId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.092Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:11.092Z\",\"requestId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"48011f12-4e7d-4ca0-a740-27afebb40bda\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.093Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:11.093Z\",\"requestId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:11.093Z\",\"requestId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.094Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:11.093Z\",\"requestId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T23:24:52.073Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.094Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:11.093Z\",\"requestId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/receipt\",\"requiredBundleIds\":[\"default\"],\"currentBundleIds\":{}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:11.094Z\",\"requestId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/receipt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.095Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcReceiptGet.js\",\"time\":\"2026-02-03T23:25:11.094Z\",\"requestId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"message\":\"Listing user receipts\",\"userSub\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T23:25:11.095Z\",\"requestId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"message\":\"DynamoDB enabled, proceeding with listUserReceipts [table: test-receipts-table]\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.095Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T23:25:11.095Z\",\"requestId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"message\":\"Retrieving receipts from DynamoDB\",\"userSub\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.097Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:11.096Z\",\"requestId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:11.096Z\",\"requestId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:11.097Z\",\"requestId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.097Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:11.097Z\",\"requestId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.098Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:11.098Z\",\"requestId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"18fdd503-7f58-46c3-9c55-7237bacd8512\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.100Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T23:25:11.100Z\",\"requestId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"message\":\"Queried DynamoDB for user receipts\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T23:25:11.100Z\",\"requestId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"message\":\"Retrieved receipts from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.101Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:11.100Z\",\"requestId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/receipt\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"9b285f7b-5535-4337-9a34-115084531b7c\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"receipts\\\":[{\\\"receiptId\\\":\\\"2026-02-03T23:25:06.855Z-104445609735\\\",\\\"key\\\":\\\"receipts/user/2026-02-03T23:25:06.855Z-104445609735.json\\\",\\\"name\\\":\\\"2026-02-03T23:25:06.855Z-104445609735.json\\\",\\\"timestamp\\\":\\\"2026-02-03T23:25:06.855Z\\\",\\\"formBundleNumber\\\":\\\"104445609735\\\",\\\"createdAt\\\":\\\"2026-02-03T23:25:06.855Z\\\",\\\"lastModified\\\":\\\"2026-02-03T23:25:06.855Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:11.106Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:11.106Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
Checking receipts page...
Found receipts, clicking on first receipt...
[USER INTERACTION] Clicking: [Locator] - Open first receipt
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:12.596Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:12.595Z\",\"msg\":\"HTTP GET /api/v1/hmrc/receipt/2026-02-03T23%3A25%3A06.855Z-104445609735.json\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:12.598Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:12.596Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:12.596Z\",\"requestId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/receipt/2026-02-03T23%3A25%3A06.855Z-104445609735.json\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/receipt/2026-02-03T23%3A25%3A06.855Z-104445609735.json\"}},\"path\":\"/api/v1/hmrc/receipt/2026-02-03T23%3A25%3A06.855Z-104445609735.json\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/receipt/receipts.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{\"name\":\"2026-02-03T23:25:06.855Z-104445609735.json\"}}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:12.597Z\",\"requestId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:12.597Z\",\"requestId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"message\":\"Extracting user information from event\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:12.597Z\",\"requestId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:12.597Z\",\"requestId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/receipt/2026-02-03T23%3A25%3A06.855Z-104445609735.json\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/receipt/2026-02-03T23%3A25%3A06.855Z-104445609735.json\"}},\"path\":\"/api/v1/hmrc/receipt/2026-02-03T23%3A25%3A06.855Z-104445609735.json\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/receipt/receipts.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{\"name\":\"2026-02-03T23:25:06.855Z-104445609735.json\"}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:12.599Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:12.599Z\",\"requestId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:12.599Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:12.599Z\",\"requestId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:12.599Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:12.599Z\",\"requestId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:12.602Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:12.602Z\",\"requestId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:12.603Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:12.602Z\",\"requestId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:12.602Z\",\"requestId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T23:24:52.073Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:12.603Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:12.603Z\",\"requestId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/receipt/2026-02-03T23%3A25%3A06.855Z-104445609735.json\",\"requiredBundleIds\":[\"default\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:12.603Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:12.603Z\",\"requestId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/receipt/2026-02-03T23%3A25%3A06.855Z-104445609735.json\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:12.603Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcReceiptGet.js\",\"time\":\"2026-02-03T23:25:12.603Z\",\"requestId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"message\":\"Retrieving single receipt\",\"receiptId\":\"2026-02-03T23:25:06.855Z-104445609735\",\"key\":\"receipts/user/2026-02-03T23:25:06.855Z-104445609735.json\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:12.603Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T23:25:12.603Z\",\"requestId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"message\":\"DynamoDB enabled, proceeding with getReceipt [table: test-receipts-table]\",\"userSub\":\"user\",\"receiptId\":\"2026-02-03T23:25:06.855Z-104445609735\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:12.603Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T23:25:12.603Z\",\"requestId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"message\":\"Retrieving receipt from DynamoDB\",\"userSub\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"receiptId\":\"2026-02-03T23:25:06.855Z-104445609735\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:12.606Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-02-03T23:25:12.606Z\",\"requestId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"bb3cec83-d2e0-4614-b63c-92ea45b67fe8\",\"message\":\"Retrieved receipt from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"receiptId\":\"2026-02-03T23:25:06.855Z-104445609735\"}"}
Returning to home via main navigation...
[USER INTERACTION] Clicking: nav.main-nav a:has-text('Activities') - Clicking Activities in main navigation
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.579Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.579Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.601Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.591Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.592Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.606Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.603Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.603Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.604Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.604Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.604Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.605Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.620Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.608Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.626Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.622Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.623Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.624Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.624Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.625Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.626Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.628Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.630Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.629Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.629Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.633Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.630Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.642Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.642Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.642Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.642Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.642Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.646Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.650Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.653Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.657Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.665Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.662Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.662Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:13.663Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:13.663Z\",\"requestId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:13.663Z\",\"requestId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:13.664Z\",\"requestId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:13.664Z\",\"requestId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:13.664Z\",\"requestId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:13.664Z\",\"requestId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:13.664Z\",\"requestId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.667Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.667Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.669Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.667Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:13.668Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:13.668Z\",\"requestId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:13.668Z\",\"requestId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:13.668Z\",\"requestId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.670Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:13.669Z\",\"requestId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:13.669Z\",\"requestId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:13.669Z\",\"requestId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:13.669Z\",\"requestId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.672Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:13.671Z\",\"requestId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:13.672Z\",\"requestId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:13.672Z\",\"requestId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.674Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:13.673Z\",\"requestId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:13.673Z\",\"requestId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"ea891087-437f-4d97-bb0a-9f08af329ae3\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.677Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:13.675Z\",\"requestId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:13.675Z\",\"requestId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:13.676Z\",\"requestId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:13.677Z\",\"requestId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:13.677Z\",\"requestId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"6f38c809-be2f-4b75-9053-32d4ca4deacc\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.687Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.684Z\",\"msg\":\"HTTP GET /submit.version.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:13.686Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:13.772Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: button:has-text('View VAT Return (HMRC Sandbox)') - Starting View VAT Return
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.581Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.581Z\",\"msg\":\"HTTP GET /hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.613Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.595Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.617Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.615Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.615Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.616Z\",\"msg\":\"HTTP GET /lib/test-data-generator.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.616Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.617Z\",\"msg\":\"HTTP GET /developer-mode.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.620Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.617Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.625Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.621Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.622Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.624Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.625Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.655Z","msg":"[BROWSER CONSOLE log]: JS block finished loading."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.657Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.654Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.655Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.655Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.656Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.656Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.657Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.661Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.660Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.662Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.661Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.666Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.663Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.665Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.673Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.675Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.678Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.679Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.681Z","msg":"[BROWSER CONSOLE log]: JS block started loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.683Z","msg":"[BROWSER CONSOLE log]: OAuth callback handler (accessToken found)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.683Z","msg":"[BROWSER CONSOLE log]: No pending return request found"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.683Z","msg":"[BROWSER CONSOLE log]: JS block finished loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.686Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.686Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.686Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.686Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.687Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:14.687Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.687Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:14.687Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.688Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:14.688Z\",\"requestId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.688Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:14.688Z\",\"requestId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:14.688Z\",\"requestId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.688Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:14.688Z\",\"requestId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:14.688Z\",\"requestId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.689Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:14.689Z\",\"requestId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.689Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:14.689Z\",\"requestId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.693Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:14.692Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:14.692Z\",\"requestId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:14.692Z\",\"requestId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:14.692Z\",\"requestId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:14.692Z\",\"requestId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:14.692Z\",\"requestId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:14.692Z\",\"requestId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:14.692Z\",\"requestId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.695Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:14.694Z\",\"requestId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:14.694Z\",\"requestId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.695Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:14.695Z\",\"requestId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.696Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:14.696Z\",\"requestId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.696Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:14.696Z\",\"requestId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"d3f99d82-afe8-4cff-aa16-9df8faf662b5\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.700Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:14.699Z\",\"requestId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:14.699Z\",\"requestId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:14.699Z\",\"requestId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:14.701Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:14.700Z\",\"requestId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:14.701Z\",\"requestId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"2fb1a31e-e5e9-46d8-8e99-9ca0bdfeac7c\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:15.836Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: #testDataLink a - Clicking add test data link
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:16.110Z","msg":"[BROWSER CONSOLE log]: [Test Data] Populated view VAT return form with test data"}
[USER INTERACTION] Filling: #vrn with value: "847829176" - Entering VAT registration number
Set period dates: 2017-01-01 to 2017-03-31
Enabled developer mode for test scenario
Developer section visible (controlled by global developer mode)
Checked runFraudPreventionHeaderValidation checkbox
[USER INTERACTION] Focusing: #retrieveBtn - Retrieve button
[USER INTERACTION] Clicking: #retrieveBtn - Submitting view VAT return form
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.627Z","msg":"[BROWSER CONSOLE log]: Status message: Retrieving VAT return... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.731Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:18.731Z\",\"msg\":\"HTTP GET /api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.732Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:18.732Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.734Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:18.733Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T23:25:18.675Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"1c743968-f338-4e6b-b238-81956d8d69da\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"x-initial-request\":\"true\",\"gov-client-public-ip\":\"178.228.163.202\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"e7222a27-ff3a-4891-a700-1fc4a67bbedb\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"runFraudPreventionHeaderValidation\":\"true\",\"allowSandboxObligations\":\"true\"},\"rawQueryString\":\"vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:18.733Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:18.733Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Extracting user information from event\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:18.733Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.734Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:18.734Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T23:25:18.675Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"1c743968-f338-4e6b-b238-81956d8d69da\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"x-initial-request\":\"true\",\"gov-client-public-ip\":\"178.228.163.202\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"e7222a27-ff3a-4891-a700-1fc4a67bbedb\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"runFraudPreventionHeaderValidation\":\"true\",\"allowSandboxObligations\":\"true\"},\"rawQueryString\":\"vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.735Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:18.735Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.735Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:18.735Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.736Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:18.735Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.738Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:18.737Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.738Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:18.738Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.738Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:18.738Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T23:24:52.073Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.738Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:18.738Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\",\"requiredBundleIds\":[\"test\",\"day-guest\",\"invited-guest\",\"resident-guest\",\"resident-pro-comp\",\"resident-pro\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.738Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:18.738Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\"}\n{\"level\":40,\"source\":\"app/lib/buildFraudHeaders.js\",\"time\":\"2026-02-03T23:25:18.738Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"No public client IP detected in X-Forwarded-For\",\"xff\":\"\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.738Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:18.738Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"accessTokenPrefix\":\"mock-hmr...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.738Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T23:25:18.738Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.739Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T23:25:18.738Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Resolving periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vrn\":\"[VRN]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.739Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T23:25:18.739Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"msg\":\"Validating fraud prevention headers for HMRC API request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.739Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:18.739Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Validating fraud prevention headers\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
[http-simulator] GET /test/fraud-prevention-headers/validate
[http-simulator:fraud-headers] GET /test/fraud-prevention-headers/validate
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.743Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:18.743Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"VALID_WITH_WARNINGS\",\"validationMessage\":\"Headers valid with warnings\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.743Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:18.743Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]},{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-client-public-port\"]}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.744Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:18.743Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.747Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:18.747Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.748Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:18.747Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Request to GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"Gov-Client-Device-ID\":\"1c743968-f338-4e6b-b238-81956d8d69da\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T23:25:18.675Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"http://localhost:9000\"}}"}
[http-simulator] GET /organisations/vat/847829176/obligations?from=2017-01-01&to=2017-03-31&status=F
[http-simulator:vat-obligations] GET /organisations/vat/847829176/obligations from=2017-01-01 to=2017-03-31
[http-simulator:scenarios] Using default obligations with random periodKey: 22DV
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.751Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:18.750Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Response from GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"status\":200,\"hmrcResponseBody\":{\"obligations\":[{\"periodKey\":\"22DV\",\"start\":\"2017-01-01\",\"end\":\"2017-03-31\",\"due\":\"2017-05-07\",\"status\":\"F\",\"received\":\"2017-05-06\"}]}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.751Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:18.751Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.754Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:18.754Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.754Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T23:25:18.754Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Resolved periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"resolvedPeriodKey\":\"22DV\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.754Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T23:25:18.754Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.754Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T23:25:18.754Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Initiating new processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.754Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:18.754Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Marking request as processing in DynamoDB\",\"userId\":\"user\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.754Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:18.754Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-return-get-async-requests-table]\",\"status\":\"processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.754Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:18.754Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Starting async processing locally (no SQS queue URL)\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.755Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T23:25:18.755Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Validating fraud prevention headers for sandbox account\",\"hmrcAccount\":\"sandbox\",\"runFraudPreventionHeaderValidation\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.755Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:18.755Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Validating fraud prevention headers\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
[http-simulator] GET /test/fraud-prevention-headers/validate
[http-simulator:fraud-headers] GET /test/fraud-prevention-headers/validate
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.756Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:18.756Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Checking persisted request status\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:18.756Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-return-get-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.759Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:18.758Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"VALID_WITH_WARNINGS\",\"validationMessage\":\"Headers valid with warnings\"}\n{\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:18.758Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]},{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-client-public-port\"]}]}\n{\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:18.758Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.760Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:18.760Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"AsyncRequest not found in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.760Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:18.760Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Yielding with HTTP 202 Accepted\",\"location\":\"http://localhost:3000/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.760Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:18.760Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"response\":{\"statusCode\":202,\"headers\":{\"Gov-Client-Device-ID\":\"1c743968-f338-4e6b-b238-81956d8d69da\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T23:25:18.675Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"Retry-After\":\"5\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"Location\":\"http://localhost:3000/api/v1/hmrc/vat/return\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"message\\\":\\\"Request accepted for processing\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.761Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:18.761Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.763Z","msg":"[BROWSER CONSOLE log]: waiting async request [GET /api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true] (timeout: 730000ms)..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.763Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:18.763Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}\n{\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:18.763Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Request to GET http://localhost:9000/organisations/vat/[VRN]/returns/22DV\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns/22DV\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"Gov-Client-Device-ID\":\"1c743968-f338-4e6b-b238-81956d8d69da\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T23:25:18.675Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"http://localhost:9000\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.763Z","msg":"[BROWSER CONSOLE log]: Status message: Still processing... Type: info"}
[http-simulator] GET /organisations/vat/847829176/returns/22DV
[http-simulator:vat-returns] GET /organisations/vat/847829176/returns/22DV
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.765Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:18.765Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Response from GET http://localhost:9000/organisations/vat/[VRN]/returns/22DV\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns/22DV\",\"status\":200,\"hmrcResponseBody\":{\"periodKey\":\"22DV\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":0,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.765Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:18.765Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns/22DV\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.768Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:18.768Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/returns/22DV\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.768Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:18.768Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Local async processing completed successfully\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.769Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:18.768Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Marking async request as completed\",\"userSub\":\"user\",\"asyncRequestsTableName\":\"test-hmrc-vat-return-get-async-requests-table\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:18.768Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-return-get-async-requests-table]\",\"status\":\"completed\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:18.773Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:18.772Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.764Z","msg":"[BROWSER CONSOLE log]: re-trying async request [GET /api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true] (poll #1, elapsed: 1001ms, timeout: 730000ms, last status: 202)..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.767Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:19.767Z\",\"msg\":\"HTTP GET /api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.768Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:19.767Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.768Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:19.768Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T23:25:18.675Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"1c743968-f338-4e6b-b238-81956d8d69da\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"gov-client-public-ip\":\"178.228.163.202\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"e7222a27-ff3a-4891-a700-1fc4a67bbedb\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"runFraudPreventionHeaderValidation\":\"true\",\"allowSandboxObligations\":\"true\"},\"rawQueryString\":\"vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.768Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:19.768Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:19.768Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Extracting user information from event\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:19.768Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.768Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:19.768Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T23:25:18.675Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"1c743968-f338-4e6b-b238-81956d8d69da\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"gov-client-public-ip\":\"178.228.163.202\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"e7222a27-ff3a-4891-a700-1fc4a67bbedb\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"runFraudPreventionHeaderValidation\":\"true\",\"allowSandboxObligations\":\"true\"},\"rawQueryString\":\"vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.769Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:19.769Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.769Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:19.769Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.769Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:19.769Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.771Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:19.771Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.771Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:19.771Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:19.771Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T23:24:52.073Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.771Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:19.771Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\",\"requiredBundleIds\":[\"test\",\"day-guest\",\"invited-guest\",\"resident-guest\",\"resident-pro-comp\",\"resident-pro\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.771Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:19.771Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.771Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/lib/buildFraudHeaders.js\",\"time\":\"2026-02-03T23:25:19.771Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"No public client IP detected in X-Forwarded-For\",\"xff\":\"\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.772Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:19.772Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"accessTokenPrefix\":\"mock-hmr...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.772Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T23:25:19.772Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\"}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T23:25:19.772Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Resolving periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vrn\":\"[VRN]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.772Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T23:25:19.772Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"msg\":\"Validating fraud prevention headers for HMRC API request\"}\n{\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:19.772Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Validating fraud prevention headers\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
[http-simulator] GET /test/fraud-prevention-headers/validate
[http-simulator:fraud-headers] GET /test/fraud-prevention-headers/validate
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.773Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:19.773Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"VALID_WITH_WARNINGS\",\"validationMessage\":\"Headers valid with warnings\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.773Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:19.773Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]},{\"code\":\"HEADER_MISSING\",\"message\":\"Header required\",\"headers\":[\"gov-client-public-port\"]}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.774Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:19.773Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.776Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:19.776Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.776Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:19.776Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Request to GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"Gov-Client-Device-ID\":\"1c743968-f338-4e6b-b238-81956d8d69da\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T23:25:18.675Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"http://localhost:9000\"}}"}
[http-simulator] GET /organisations/vat/847829176/obligations?from=2017-01-01&to=2017-03-31&status=F
[http-simulator:vat-obligations] GET /organisations/vat/847829176/obligations from=2017-01-01 to=2017-03-31
[http-simulator:scenarios] Using default obligations with random periodKey: 22CF
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.778Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:19.778Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Response from GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"status\":200,\"hmrcResponseBody\":{\"obligations\":[{\"periodKey\":\"22CF\",\"start\":\"2017-01-01\",\"end\":\"2017-03-31\",\"due\":\"2017-05-07\",\"status\":\"F\",\"received\":\"2017-05-06\"}]}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.778Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:19.778Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.781Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:19.781Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.781Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T23:25:19.781Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Resolved periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"resolvedPeriodKey\":\"22CF\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:19.781Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-return-get-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.784Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:19.784Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.784Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T23:25:19.784Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":false}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-02-03T23:25:19.784Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Found persisted request\",\"status\":\"completed\"}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:19.784Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.784Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:19.784Z\",\"requestId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"response\":{\"statusCode\":200,\"headers\":{\"Gov-Client-Device-ID\":\"1c743968-f338-4e6b-b238-81956d8d69da\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T23:25:18.675Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"b910fc1b-cbaa-408c-b55f-5207444ba12c\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"periodKey\\\":\\\"22DV\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":0,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.845Z","msg":"[BROWSER CONSOLE log]: finished async request [GET /api/v1/hmrc/vat/return?vrn=[VRN]&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true] (poll #1, elapsed: 1082ms, status: 200)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.845Z","msg":"[BROWSER CONSOLE log]: Status message: VAT return retrieved. Type: success"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:19.852Z","msg":"[BROWSER CONSOLE log]: Hiding all status messages"}
[waitForSuccessOrError] SUCCESS: "VAT return results" detected after 0s (poll #1)
VAT due on sales validated: £1000.00
VAT due on acquisitions validated: £0.00
Total VAT due validated: £1000.00
VAT reclaimed on purchases validated: £0.00
View VAT return completed successfully with validated fields
Returning to home via main navigation...
[USER INTERACTION] Clicking: nav.main-nav a:has-text('Activities') - Clicking Activities in main navigation
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.779Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.778Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.803Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.791Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.791Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.807Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.804Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.804Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.805Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.806Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.821Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.807Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.808Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.808Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.824Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.822Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.823Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.823Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.824Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.825Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.826Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.824Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.824Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.828Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.828Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.828Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.829Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.829Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.835Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.835Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.836Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.836Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.836Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.837Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.842Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.843Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.845Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.847Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.841Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:20.841Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:20.842Z\",\"requestId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:20.842Z\",\"requestId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:20.842Z\",\"requestId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:20.842Z\",\"requestId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:20.842Z\",\"requestId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:20.842Z\",\"requestId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:20.842Z\",\"requestId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.850Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.850Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.853Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.851Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:20.851Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:20.852Z\",\"requestId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:20.852Z\",\"requestId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:20.852Z\",\"requestId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:20.852Z\",\"requestId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:20.852Z\",\"requestId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:20.852Z\",\"requestId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:20.852Z\",\"requestId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.855Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:20.855Z\",\"requestId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:20.855Z\",\"requestId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:20.855Z\",\"requestId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.856Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:20.855Z\",\"requestId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.856Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:20.856Z\",\"requestId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"ba58402f-2cca-4f89-a376-f304927ba221\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.856Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.856Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.858Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:20.857Z\",\"requestId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:20.857Z\",\"requestId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:20.858Z\",\"requestId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.859Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:20.858Z\",\"requestId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.859Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:20.859Z\",\"requestId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"d719e4bd-f28b-49fa-9640-aa3a06792a79\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.864Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.863Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.868Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:20.868Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:20.978Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: button:has-text('VAT Obligations (HMRC Sandbox)') - Starting VAT Obligations
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.730Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.730Z\",\"msg\":\"HTTP GET /hmrc/vat/vatObligations.html?hmrcAccount=sandbox\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.754Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.740Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.757Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.756Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.756Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.756Z\",\"msg\":\"HTTP GET /lib/test-data-generator.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.758Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.757Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.757Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.757Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.760Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.759Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.764Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.761Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.761Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.762Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.785Z","msg":"[BROWSER CONSOLE log]: JS block finished loading."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.787Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.784Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.784Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.785Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.785Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.786Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.786Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.790Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.789Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.790Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.791Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.791Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.792Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.792Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.797Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.798Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.803Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.805Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.806Z","msg":"[BROWSER CONSOLE log]: JS block started loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.808Z","msg":"[BROWSER CONSOLE log]: OAuth callback handler (accessToken found)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.808Z","msg":"[BROWSER CONSOLE log]: No pending obligations request found"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.808Z","msg":"[BROWSER CONSOLE log]: JS block finished loading: DOMContentLoaded event handler"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.809Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.810Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.810Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.810Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.810Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.810Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:21.810Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.811Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:21.811Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.811Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:21.811Z\",\"requestId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.811Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:21.811Z\",\"requestId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:21.811Z\",\"requestId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.811Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:21.811Z\",\"requestId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:21.811Z\",\"requestId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:21.811Z\",\"requestId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.812Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:21.811Z\",\"requestId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.814Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:21.813Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:21.813Z\",\"requestId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:21.814Z\",\"requestId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:21.814Z\",\"requestId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:21.814Z\",\"requestId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.814Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:21.814Z\",\"requestId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:21.814Z\",\"requestId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.814Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:21.814Z\",\"requestId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.816Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:21.816Z\",\"requestId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.816Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:21.816Z\",\"requestId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:21.816Z\",\"requestId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.817Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:21.817Z\",\"requestId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.818Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:21.817Z\",\"requestId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"032139f6-81fc-410b-9466-37509d7853cd\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.820Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:21.819Z\",\"requestId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.820Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:21.819Z\",\"requestId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:21.820Z\",\"requestId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:21.821Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:21.821Z\",\"requestId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:21.821Z\",\"requestId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"14164c43-7cc1-464d-8a54-e8d2afe33c75\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:23.100Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: #testDataLink a - Clicking add test data link
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:23.460Z","msg":"[BROWSER CONSOLE log]: [Test Data] Populated VAT obligations form with test data"}
[USER INTERACTION] Filling: #vrn with value: "847829176" - Entering VAT registration number
[USER INTERACTION] Filling: #fromDate with value: "2025-01-01" - Entering from date
[USER INTERACTION] Filling: #toDate with value: "2025-12-01" - Entering to date
[USER INTERACTION] Focusing: #status - the obligations status filter
[USER INTERACTION] Focusing: #retrieveBtn - Retrieve button
[USER INTERACTION] Clicking: #retrieveBtn - Submitting VAT obligations form
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.327Z","msg":"[BROWSER CONSOLE log]: Status message: Retrieving VAT obligations... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.438Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:26.438Z\",\"msg\":\"HTTP GET /api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.439Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:26.438Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.439Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:26.439Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/obligation\"}},\"path\":\"/api/v1/hmrc/vat/obligation\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T23:25:26.375Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"3b029d99-1a56-4150-9c7e-cc61b8c96f63\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"x-initial-request\":\"true\",\"gov-client-public-ip\":\"178.228.163.202\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"81faa6ee-1f9d-4f1b-ac9a-b8180ddfb252\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"from\":\"2025-01-01\",\"to\":\"2025-12-01\"},\"rawQueryString\":\"vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.440Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:26.439Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:26.439Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Extracting user information from event\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:26.439Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:26.440Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/obligation\"}},\"path\":\"/api/v1/hmrc/vat/obligation\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T23:25:26.375Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"3b029d99-1a56-4150-9c7e-cc61b8c96f63\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"x-initial-request\":\"true\",\"gov-client-public-ip\":\"178.228.163.202\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"81faa6ee-1f9d-4f1b-ac9a-b8180ddfb252\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"from\":\"2025-01-01\",\"to\":\"2025-12-01\"},\"rawQueryString\":\"vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.441Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:26.441Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:26.441Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.441Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:26.441Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.445Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:26.445Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.446Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:26.445Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:26.445Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T23:24:52.073Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.446Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:26.446Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/obligation\",\"requiredBundleIds\":[\"test\",\"day-guest\",\"invited-guest\",\"resident-guest\",\"resident-pro-comp\",\"resident-pro\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.446Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:26.446Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/obligation\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.446Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/lib/buildFraudHeaders.js\",\"time\":\"2026-02-03T23:25:26.446Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"No public client IP detected in X-Forwarded-For\",\"xff\":\"\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.447Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:26.446Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"accessTokenPrefix\":\"mock-hmr...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.447Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T23:25:26.447Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\"}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T23:25:26.447Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.447Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T23:25:26.447Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Initiating new processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.447Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:26.447Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Marking request as processing in DynamoDB\",\"userId\":\"user\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:26.447Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-obligation-get-async-requests-table]\",\"status\":\"processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.447Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:26.447Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Starting async processing locally (no SQS queue URL)\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.447Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T23:25:26.447Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Skipping fraud prevention header validation for HMRC API request\",\"hmrcAccount\":\"sandbox\",\"runFraudPreventionHeaderValidation\":false}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.447Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:26.447Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Request to GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2025-01-01&to=2025-12-01\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2025-01-01&to=2025-12-01\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"Gov-Client-Device-ID\":\"3b029d99-1a56-4150-9c7e-cc61b8c96f63\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T23:25:26.375Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"http://localhost:9000\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.448Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:26.448Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Checking persisted request status\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.448Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:26.448Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-obligation-get-async-requests-table]\"}"}
[http-simulator] GET /organisations/vat/847829176/obligations?from=2025-01-01&to=2025-12-01
[http-simulator:vat-obligations] GET /organisations/vat/847829176/obligations from=2025-01-01 to=2025-12-01
[http-simulator:scenarios] Using default obligations with random periodKey: 17F9
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.454Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:26.453Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Response from GET http://localhost:9000/organisations/vat/[VRN]/obligations?from=2025-01-01&to=2025-12-01\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2025-01-01&to=2025-12-01\",\"status\":200,\"hmrcResponseBody\":{\"obligations\":[{\"periodKey\":\"17F9\",\"start\":\"2017-01-01\",\"end\":\"2017-03-31\",\"due\":\"2017-05-07\",\"status\":\"F\",\"received\":\"2017-05-06\"},{\"periodKey\":\"23PT\",\"start\":\"2017-04-01\",\"end\":\"2017-06-30\",\"due\":\"2017-08-07\",\"status\":\"O\"}]}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.454Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:26.454Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2025-01-01&to=2025-12-01\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.457Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:26.457Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.458Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:26.458Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.458Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:26.458Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Yielding with HTTP 202 Accepted\",\"location\":\"http://localhost:3000/api/v1/hmrc/vat/obligation\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.458Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:26.458Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"response\":{\"statusCode\":202,\"headers\":{\"Gov-Client-Device-ID\":\"3b029d99-1a56-4150-9c7e-cc61b8c96f63\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T23:25:26.375Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"Retry-After\":\"5\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"Location\":\"http://localhost:3000/api/v1/hmrc/vat/obligation\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"message\\\":\\\"Request accepted for processing\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.463Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-02-03T23:25:26.463Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"http://localhost:9000/organisations/vat/[VRN]/obligations?from=2025-01-01&to=2025-12-01\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.464Z","msg":"[BROWSER CONSOLE log]: waiting async request [GET /api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01] (timeout: 730000ms)..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.464Z","msg":"[BROWSER CONSOLE log]: Status message: Still processing... Type: info"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.464Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:26.463Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Local async processing completed successfully\"}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:26.463Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Marking async request as completed\",\"userSub\":\"user\",\"asyncRequestsTableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:26.463Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-obligation-get-async-requests-table]\",\"status\":\"completed\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:26.468Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:26.468Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.463Z","msg":"[BROWSER CONSOLE log]: re-trying async request [GET /api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01] (poll #1, elapsed: 1002ms, timeout: 730000ms, last status: 202)..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.467Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:27.467Z\",\"msg\":\"HTTP GET /api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.467Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:27.467Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.468Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:27.467Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/obligation\"}},\"path\":\"/api/v1/hmrc/vat/obligation\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T23:25:26.375Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"3b029d99-1a56-4150-9c7e-cc61b8c96f63\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"gov-client-public-ip\":\"178.228.163.202\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"81faa6ee-1f9d-4f1b-ac9a-b8180ddfb252\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"from\":\"2025-01-01\",\"to\":\"2025-12-01\"},\"rawQueryString\":\"vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.468Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:27.467Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"http://localhost:9000\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:27.468Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Extracting user information from event\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:27.468Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.468Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:27.468Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/hmrc/vat/obligation\"}},\"path\":\"/api/v1/hmrc/vat/obligation\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"gov-client-window-size\":\"width=1280&height=1446\",\"x-request-id\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"authorization\":\"[TOKEN]\",\"gov-client-public-ip-timestamp\":\"2026-02-03T23:25:26.375Z\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"x-authorization\":\"[TOKEN]\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"gov-client-device-id\":\"3b029d99-1a56-4150-9c7e-cc61b8c96f63\",\"gov-client-user-ids\":\"browser=user\",\"content-type\":\"application/json\",\"x-wait-time-ms\":\"0\",\"gov-client-public-ip\":\"178.228.163.202\",\"accept-language\":\"en-US\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"ngrok-skip-browser-warning\":\"any value\",\"hmrcaccount\":\"sandbox\",\"x-client-request-id\":\"81faa6ee-1f9d-4f1b-ac9a-b8180ddfb252\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{\"vrn\":\"[VRN]\",\"from\":\"2025-01-01\",\"to\":\"2025-12-01\"},\"rawQueryString\":\"vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.469Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:27.468Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.469Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:27.468Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:27.469Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.471Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:27.471Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.471Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:27.471Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:27.471Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-02-04T00:00:00.000Z\",\"tokensGranted\":10,\"tokensConsumed\":1,\"tokenResetAt\":null,\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-02-03T23:24:52.073Z\",\"ttl\":[UTR],\"ttl_datestamp\":\"2026-03-04T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.471Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:27.471Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/obligation\",\"requiredBundleIds\":[\"test\",\"day-guest\",\"invited-guest\",\"resident-guest\",\"resident-pro-comp\",\"resident-pro\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.471Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-02-03T23:25:27.471Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/obligation\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.471Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/lib/buildFraudHeaders.js\",\"time\":\"2026-02-03T23:25:27.471Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"No public client IP detected in X-Forwarded-For\",\"xff\":\"\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.471Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-02-03T23:25:27.471Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":59,\"accessTokenPrefix\":\"mock-hmr...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.472Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T23:25:27.471Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:27.471Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-obligation-get-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.474Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-02-03T23:25:27.473Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.474Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T23:25:27.474Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":false}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-02-03T23:25:27.474Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Found persisted request\",\"status\":\"completed\"}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:27.474Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.474Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:27.474Z\",\"requestId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01\",\"response\":{\"statusCode\":200,\"headers\":{\"Gov-Client-Device-ID\":\"3b029d99-1a56-4150-9c7e-cc61b8c96f63\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122\",\"Gov-Client-Public-IP-Timestamp\":\"2026-02-03T23:25:26.375Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"000c84e8-80af-4772-bf27-0b03dd78838b\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"obligations\\\":[{\\\"periodKey\\\":\\\"17F9\\\",\\\"start\\\":\\\"2017-01-01\\\",\\\"end\\\":\\\"2017-03-31\\\",\\\"due\\\":\\\"2017-05-07\\\",\\\"status\\\":\\\"F\\\",\\\"received\\\":\\\"2017-05-06\\\"},{\\\"periodKey\\\":\\\"23PT\\\",\\\"start\\\":\\\"2017-04-01\\\",\\\"end\\\":\\\"2017-06-30\\\",\\\"due\\\":\\\"2017-08-07\\\",\\\"status\\\":\\\"O\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.477Z","msg":"[BROWSER CONSOLE log]: finished async request [GET /api/v1/hmrc/vat/obligation?vrn=[VRN]&from=2025-01-01&to=2025-12-01] (poll #1, elapsed: 1016ms, status: 200)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.477Z","msg":"[BROWSER CONSOLE log]: Status message: VAT obligations retrieved. Type: success"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:27.477Z","msg":"[BROWSER CONSOLE log]: Hiding all status messages"}
[waitForSuccessOrError] SUCCESS: "VAT obligations results" detected after 0s (poll #1)
[verifyVatObligationsResults] Found 2 obligation(s) - validating shape
VAT Period validated: 1 Jan 2017 to 31 Mar 2017
VAT Period validated: 1 Apr 2017 to 30 Jun 2017
Dates validated for 1 Jan 2017 to 31 Mar 2017: due=7 May 2017, received=6 May 2017
Dates validated for 1 Apr 2017 to 30 Jun 2017: due=7 Aug 2017, received=-
No test scenario 1 fulfilled obligations and 1 open obligations
VAT obligations retrieval completed successfully
Returning to home via main navigation...
[USER INTERACTION] Clicking: nav.main-nav a:has-text('Activities') - Clicking Activities in main navigation
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.096Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.096Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.121Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.110Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.110Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.124Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.122Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.122Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.123Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.124Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.138Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.125Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.126Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.126Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.143Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.140Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.141Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.142Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.142Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.143Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.143Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.145Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.147Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.146Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.148Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.147Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.150Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.149Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.157Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.157Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.157Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.158Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.158Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.159Z","msg":"[BROWSER CONSOLE log]: User is authenticated"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.162Z","msg":"[BROWSER CONSOLE log]: User info: {sub: user, email: [EMAIL]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.163Z","msg":"[BROWSER CONSOLE log]: User label: [EMAIL]"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.168Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.168Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.168Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.170Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.168Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.169Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.169Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:29.170Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:29.170Z\",\"requestId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"x-initial-request\":\"true\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:29.170Z\",\"requestId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:29.170Z\",\"requestId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:29.170Z\",\"requestId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:29.170Z\",\"requestId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.172Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:29.170Z\",\"requestId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:29.170Z\",\"requestId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.174Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:29.172Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:29.172Z\",\"requestId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"message\":\"Processing request with event\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"email\":\"[EMAIL]\",\"aud\":[\"debugger\"],\"scope\":\"read write\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"localhost:3000\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"localhost:3000\",\"connection\":\"keep-alive\",\"pragma\":\"no-cache\",\"cache-control\":\"no-cache\",\"x-request-id\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"authorization\":\"[TOKEN]\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"accept-language\":\"en-US\",\"sec-ch-ua\":\"\\\"Not:A-Brand\\\";v=\\\"99\\\", \\\"HeadlessChrome\\\";v=\\\"145\\\", \\\"Chromium\\\";v=\\\"145\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"ngrok-skip-browser-warning\":\"any value\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36\",\"accept\":\"*/*\",\"sec-fetch-site\":\"same-origin\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-dest\":\"empty\",\"referer\":\"http://localhost:3000/index.html\",\"accept-encoding\":\"gzip, deflate, br, zstd\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:29.172Z\",\"requestId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-02-03T23:25:29.172Z\",\"requestId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"email\":\"[REDACTED]\",\"aud\":[\"debugger\"],\"scope\":\"openid somescope\",\"nonce\":\"5678\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:9000/default\",\"iat\":[UTR],\"nbf\":[UTR],\"exp\":[UTR],\"jti\":\"f079e97e-97d2-4746-911f-ba73e2478bb0\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:29.172Z\",\"requestId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:29.172Z\",\"requestId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:29.172Z\",\"requestId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:29.173Z\",\"requestId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.175Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:29.174Z\",\"requestId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:29.174Z\",\"requestId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:29.175Z\",\"requestId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.177Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:29.175Z\",\"requestId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:29.175Z\",\"requestId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"14085998-c32b-45e8-945c-1a15dd3ff17b\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.178Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:29.178Z\",\"requestId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-02-03T23:25:29.178Z\",\"requestId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-02-03T23:25:29.178Z\",\"requestId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.179Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-02-03T23:25:29.179Z\",\"requestId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.181Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-02-03T23:25:29.179Z\",\"requestId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"correlationId\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"message\":\"Responding to request with response\",\"request\":\"http://localhost:3000/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"Cache-Control\":\"no-store\",\"x-request-id\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"traceparent\":\"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01\",\"x-correlationid\":\"42bb7947-df61-4ede-ab91-a6e468849ba1\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-02-04T00:00:00.000Z\\\",\\\"tokensGranted\\\":10,\\\"tokensConsumed\\\":1,\\\"tokenResetAt\\\":null,\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-02-03T23:24:52.073Z\\\",\\\"ttl\\\":[UTR],\\\"ttl_datestamp\\\":\\\"2026-03-04T00:00:00.000Z\\\",\\\"allocated\\\":true,\\\"bundleCapacityAvailable\\\":true,\\\"tokensRemaining\\\":9},{\\\"bundleId\\\":\\\"default\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"day-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"invited-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-guest\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro-comp\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true},{\\\"bundleId\\\":\\\"resident-pro\\\",\\\"allocated\\\":false,\\\"bundleCapacityAvailable\\\":true}],\\\"tokensRemaining\\\":9}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.187Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.186Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.190Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.190Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
[test body] Found userInfo in localStorage for test "Click through: Submit a VAT return to HMRC": {"sub":"user","email":"user@example.com"}
[test body] Extracted userSub from localStorage for test "Click through: Submit a VAT return to HMRC": user
Logging out from home page
[USER INTERACTION] Clicking: a:has-text('Logout') - Logout
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.606Z","msg":"[BROWSER CONSOLE log]: Logging out user"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.608Z","msg":"[HTTP REQUEST FAILED] GET http://localhost:3000/index.html - net::ERR_ABORTED"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.611Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.611Z\",\"msg\":\"HTTP GET /auth/login.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.629Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.626Z\",\"msg\":\"HTTP GET /submit.css\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.626Z\",\"msg\":\"HTTP GET /images/g-logo.png\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.626Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.627Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.642Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.632Z\",\"msg\":\"HTTP GET /submit.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.632Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.644Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.644Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.648Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.644Z\",\"msg\":\"HTTP GET /developer-mode.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.645Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.646Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.646Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.646Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.654Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.649Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.652Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.673Z","msg":"[BROWSER CONSOLE log]: Current activity cleared"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.677Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.673Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.673Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.674Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.674Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.674Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.675Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.676Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.682Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.677Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.681Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.687Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.684Z\",\"msg\":\"HTTP GET /auth/login-mock-addon.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.693Z","msg":"[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: \"script-src 'self' 'unsafe-inline'\". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.693Z","msg":"[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.696Z","msg":"[BROWSER CONSOLE warning]: Failed to load RUM client: Event"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.698Z","msg":"[BROWSER CONSOLE error]: Loading the image 'https://avatars.githubusercontent.com/u/11848947?s=48&v=4' violates the following Content Security Policy directive: \"img-src 'self' data:\". The action has been blocked."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.698Z","msg":"[HTTP REQUEST FAILED] GET https://avatars.githubusercontent.com/u/11848947?s=48&v=4 - csp"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.700Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.699Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.699Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.706Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-02-03T23:25:29.706Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.833Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-02-03T23:25:29.833Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[Figures]: Selected 5 key screenshots from target/behaviour-test-results/screenshots/submitVat-behaviour-test
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-02-03T23:25:29.839Z","msg":"Copied screenshot: 2026-02-03_23-24-59-058977869-10-fill-in-submission-pagedown.png"}
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-02-03T23:25:29.839Z","msg":"Copied screenshot: 2026-02-03_23-25-08-979972773-02-complete-vat-receipt.png"}
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-02-03T23:25:29.840Z","msg":"Copied screenshot: 2026-02-03_23-25-04-373473251-01-submit-hmrc-auth.png"}
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-02-03T23:25:29.840Z","msg":"Copied screenshot: 2026-02-03_23-25-20-980488953-04-view-vat-return-results.png"}
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-02-03T23:25:29.841Z","msg":"Copied screenshot: 2026-02-03_23-24-42-690589445-01-submit-mock.png"}
[Figures]: Copied 5 screenshots to /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-02-03T23:25:29.841Z","msg":"Wrote figures.json with 5 entries to /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/figures.json"}
[Figures]: Generated figures.json in /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour
[DynamoDB Export]: Starting export of all tables...
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T23:25:29.842Z","msg":"[dynamodb-export]: Starting export of all tables to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T23:25:29.842Z","msg":"[dynamodb-export]: Exporting table 'test-bundle-table' from endpoint 'http://127.0.0.1:9001' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/bundles.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T23:25:29.854Z","msg":"[dynamodb-export]: ✅ Exported 1 items from table 'test-bundle-table' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/bundles.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T23:25:29.854Z","msg":"[dynamodb-export]: ── BEGIN bundles.jsonl ──"}
{"bundleId":"test","expiry":"2026-02-04T00:00:00.000Z","tokensGranted":10,"tokensConsumed":1,"tokenResetAt":null,"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","createdAt":"2026-02-03T23:24:52.073Z","ttl":1772582400,"ttl_datestamp":"2026-03-04T00:00:00.000Z"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T23:25:29.855Z","msg":"[dynamodb-export]: ── END bundles.jsonl ──"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T23:25:29.855Z","msg":"[dynamodb-export]: Exporting table 'test-hmrc-api-requests-table' from endpoint 'http://127.0.0.1:9001' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/hmrc-api-requests.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T23:25:29.868Z","msg":"[dynamodb-export]: ✅ Exported 14 items from table 'test-hmrc-api-requests-table' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/hmrc-api-requests.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T23:25:29.869Z","msg":"[dynamodb-export]: ── BEGIN hmrc-api-requests.jsonl ──"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-3bc1eaee-1c0b-4f51-ae2f-febd984ed994","requestId":"b910fc1b-cbaa-408c-b55f-5207444ba12c","amznTraceId":null,"traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","url":"http://localhost:9000/organisations/vat/847829176/returns/22DV","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"b910fc1b-cbaa-408c-b55f-5207444ba12c","traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","x-correlationid":"b910fc1b-cbaa-408c-b55f-5207444ba12c","Gov-Client-Device-ID":"1c743968-f338-4e6b-b238-81956d8d69da","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122","Gov-Client-Public-IP-Timestamp":"2026-02-03T23:25:18.675Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"239","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 23:25:18 GMT","etag":"W/\"ef-MZEmPJdCa9ol5kPpl5Sx1IQIZIc\"","keep-alive":"timeout=5","x-correlationid":"87d1ba4e-99b2-497d-9a4a-61bf7def9f44","x-powered-by":"Express"},"body":{"periodKey":"22DV","vatDueSales":1000,"vatDueAcquisitions":0,"totalVatDue":1000,"vatReclaimedCurrPeriod":0,"netVatDue":1000,"totalValueSalesExVAT":0,"totalValuePurchasesExVAT":0,"totalValueGoodsSuppliedExVAT":0,"totalAcquisitionsExVAT":0}},"duration":2,"createdAt":"2026-02-03T23:25:18.765Z","ttl":1772580318,"ttl_datestamp":"2026-03-03T23:25:18.765Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-3d129783-2466-4402-ba7e-eee68cb8f646","requestId":"21882ac6-2439-42a2-935e-31827b822a7c","amznTraceId":null,"traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","url":"http://localhost:9000/oauth/token","method":"POST","httpRequest":{"method":"POST","headers":{"Content-Type":"application/x-www-form-urlencoded","x-request-id":"21882ac6-2439-42a2-935e-31827b822a7c","traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","x-correlationid":"21882ac6-2439-42a2-935e-31827b822a7c"},"body":"grant_type=authorization_code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&client_secret=mock-simulator-client-secret&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Factivities%2FsubmitVatCallback.html&code=***MASKED***"},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"227","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 23:25:06 GMT","etag":"W/\"e3-Rfqq0G7/gIx9Do/uJTzFIdPcJco\"","keep-alive":"timeout=5","x-powered-by":"Express"},"body":{"access_token":"***MASKED***","refresh_token":"***MASKED***","expires_in":14400,"scope":"write:vat read:vat","token_type":"bearer"}},"duration":8,"createdAt":"2026-02-03T23:25:06.609Z","ttl":1772580306,"ttl_datestamp":"2026-03-03T23:25:06.609Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-3e6d66ed-f8d3-4f14-b478-0098caa2a4d0","requestId":"e148c234-dd0f-4388-bc6a-b6bb7098da51","amznTraceId":null,"traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","url":"http://localhost:9000/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Device-ID":"daa737f3-9a55-48d5-9560-b5ba7735fb7f","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122","Gov-Client-Public-IP-Timestamp":"2026-02-03T23:25:06.797Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"e148c234-dd0f-4388-bc6a-b6bb7098da51","traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","x-correlationid":"e148c234-dd0f-4388-bc6a-b6bb7098da51"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"297","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 23:25:06 GMT","etag":"W/\"129-UFxb9UF4LOFfUrBiO2wN6GYy9Fo\"","keep-alive":"timeout=5","x-correlationid":"e8d35128-1449-4931-a61d-c11e61e84555","x-powered-by":"Express"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"Headers valid with warnings","errors":[],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]},{"code":"***MASKED***","message":"Header required","headers":["gov-client-public-port"]}]}},"duration":2,"createdAt":"2026-02-03T23:25:06.816Z","ttl":1772580306,"ttl_datestamp":"2026-03-03T23:25:06.816Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-414029c4-06b7-4f54-8528-0db6dd192435","requestId":"b910fc1b-cbaa-408c-b55f-5207444ba12c","amznTraceId":null,"traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","url":"http://localhost:9000/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Device-ID":"1c743968-f338-4e6b-b238-81956d8d69da","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122","Gov-Client-Public-IP-Timestamp":"2026-02-03T23:25:18.675Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"b910fc1b-cbaa-408c-b55f-5207444ba12c","traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","x-correlationid":"b910fc1b-cbaa-408c-b55f-5207444ba12c"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"297","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 23:25:18 GMT","etag":"W/\"129-UFxb9UF4LOFfUrBiO2wN6GYy9Fo\"","keep-alive":"timeout=5","x-correlationid":"4afc5755-cd6c-4d22-bb19-215bf45a9642","x-powered-by":"Express"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"Headers valid with warnings","errors":[],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]},{"code":"***MASKED***","message":"Header required","headers":["gov-client-public-port"]}]}},"duration":4,"createdAt":"2026-02-03T23:25:18.744Z","ttl":1772580318,"ttl_datestamp":"2026-03-03T23:25:18.744Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-4b6230d4-7c8e-4a55-919a-f1200e7693f4","requestId":"e148c234-dd0f-4388-bc6a-b6bb7098da51","amznTraceId":null,"traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","url":"http://localhost:9000/organisations/vat/847829176/obligations?from=2017-01-01&to=2017-03-31&status=O","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"e148c234-dd0f-4388-bc6a-b6bb7098da51","traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","x-correlationid":"e148c234-dd0f-4388-bc6a-b6bb7098da51","Gov-Client-Device-ID":"daa737f3-9a55-48d5-9560-b5ba7735fb7f","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122","Gov-Client-Public-IP-Timestamp":"2026-02-03T23:25:06.797Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"110","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 23:25:06 GMT","etag":"W/\"6e-jTd0BZ/ikzQGywoHFKpOVMlkleI\"","keep-alive":"timeout=5","x-correlationid":"4794a013-0251-458d-b1c6-080fcba30adb","x-powered-by":"Express"},"body":{"obligations":[{"periodKey":"21O2","start":"2017-04-01","end":"2017-06-30","due":"2017-08-07","status":"O"}]}},"duration":3,"createdAt":"2026-02-03T23:25:06.823Z","ttl":1772580306,"ttl_datestamp":"2026-03-03T23:25:06.823Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-53119190-3f09-4f6b-9d95-a1f1fc381b10","requestId":"b910fc1b-cbaa-408c-b55f-5207444ba12c","amznTraceId":null,"traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","url":"http://localhost:9000/organisations/vat/847829176/obligations?from=2017-01-01&to=2017-03-31&status=F","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"b910fc1b-cbaa-408c-b55f-5207444ba12c","traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","x-correlationid":"b910fc1b-cbaa-408c-b55f-5207444ba12c","Gov-Client-Device-ID":"1c743968-f338-4e6b-b238-81956d8d69da","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122","Gov-Client-Public-IP-Timestamp":"2026-02-03T23:25:18.675Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"134","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 23:25:18 GMT","etag":"W/\"86-mi7ei5dFRABvcQT/y5/M4487Uok\"","keep-alive":"timeout=5","x-correlationid":"44e0cd1d-18c9-4c10-962a-77e0a82903e8","x-powered-by":"Express"},"body":{"obligations":[{"periodKey":"22DV","start":"2017-01-01","end":"2017-03-31","due":"2017-05-07","status":"F","received":"2017-05-06"}]}},"duration":2,"createdAt":"2026-02-03T23:25:18.751Z","ttl":1772580318,"ttl_datestamp":"2026-03-03T23:25:18.751Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-57a086c3-7694-4d81-b607-df828e2400a7","requestId":"000c84e8-80af-4772-bf27-0b03dd78838b","amznTraceId":null,"traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","url":"http://localhost:9000/organisations/vat/847829176/obligations?from=2025-01-01&to=2025-12-01","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"000c84e8-80af-4772-bf27-0b03dd78838b","traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","x-correlationid":"000c84e8-80af-4772-bf27-0b03dd78838b","Gov-Client-Device-ID":"3b029d99-1a56-4150-9c7e-cc61b8c96f63","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122","Gov-Client-Public-IP-Timestamp":"2026-02-03T23:25:26.375Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"227","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 23:25:26 GMT","etag":"W/\"e3-+0MyppEhU7BjAEJN8JWfdWBiBGE\"","keep-alive":"timeout=5","x-correlationid":"6add76e1-dc9a-4786-8e9a-3c349780302a","x-powered-by":"Express"},"body":{"obligations":[{"periodKey":"17F9","start":"2017-01-01","end":"2017-03-31","due":"2017-05-07","status":"F","received":"2017-05-06"},{"periodKey":"23PT","start":"2017-04-01","end":"2017-06-30","due":"2017-08-07","status":"O"}]}},"duration":6,"createdAt":"2026-02-03T23:25:26.454Z","ttl":1772580326,"ttl_datestamp":"2026-03-03T23:25:26.454Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-67cef88e-b5ff-4122-adab-d2587479ddd3","requestId":"b910fc1b-cbaa-408c-b55f-5207444ba12c","amznTraceId":null,"traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","url":"http://localhost:9000/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Device-ID":"1c743968-f338-4e6b-b238-81956d8d69da","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122","Gov-Client-Public-IP-Timestamp":"2026-02-03T23:25:18.675Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"b910fc1b-cbaa-408c-b55f-5207444ba12c","traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","x-correlationid":"b910fc1b-cbaa-408c-b55f-5207444ba12c"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"297","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 23:25:19 GMT","etag":"W/\"129-UFxb9UF4LOFfUrBiO2wN6GYy9Fo\"","keep-alive":"timeout=5","x-correlationid":"74d8c896-9d78-4bb1-bc77-6bbd7bb5b93b","x-powered-by":"Express"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"Headers valid with warnings","errors":[],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]},{"code":"***MASKED***","message":"Header required","headers":["gov-client-public-port"]}]}},"duration":1,"createdAt":"2026-02-03T23:25:19.774Z","ttl":1772580319,"ttl_datestamp":"2026-03-03T23:25:19.774Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-6df6ba97-6f3b-495a-a7b9-b0659f714ac6","requestId":"e148c234-dd0f-4388-bc6a-b6bb7098da51","amznTraceId":null,"traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","url":"http://localhost:9000/organisations/vat/847829176/obligations?from=2017-01-01&to=2017-03-31&status=O","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"e148c234-dd0f-4388-bc6a-b6bb7098da51","traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","x-correlationid":"e148c234-dd0f-4388-bc6a-b6bb7098da51","Gov-Client-Device-ID":"daa737f3-9a55-48d5-9560-b5ba7735fb7f","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122","Gov-Client-Public-IP-Timestamp":"2026-02-03T23:25:06.797Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"110","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 23:25:07 GMT","etag":"W/\"6e-FA3yQfQCt7HK1Aig6ARwNIWpaIc\"","keep-alive":"timeout=5","x-correlationid":"ddaad38c-90d1-484c-8e0c-29340c9f089e","x-powered-by":"Express"},"body":{"obligations":[{"periodKey":"26D7","start":"2017-04-01","end":"2017-06-30","due":"2017-08-07","status":"O"}]}},"duration":1,"createdAt":"2026-02-03T23:25:07.863Z","ttl":1772580307,"ttl_datestamp":"2026-03-03T23:25:07.863Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-86920a72-ff00-414e-acba-c45f236d8846","requestId":"b910fc1b-cbaa-408c-b55f-5207444ba12c","amznTraceId":null,"traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","url":"http://localhost:9000/organisations/vat/847829176/obligations?from=2017-01-01&to=2017-03-31&status=F","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"b910fc1b-cbaa-408c-b55f-5207444ba12c","traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","x-correlationid":"b910fc1b-cbaa-408c-b55f-5207444ba12c","Gov-Client-Device-ID":"1c743968-f338-4e6b-b238-81956d8d69da","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122","Gov-Client-Public-IP-Timestamp":"2026-02-03T23:25:18.675Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"134","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 23:25:19 GMT","etag":"W/\"86-WwoiPYDVMvYycnfwAg5HKnpS46E\"","keep-alive":"timeout=5","x-correlationid":"3c3433aa-cd2a-439d-ab90-e7c58f2ec363","x-powered-by":"Express"},"body":{"obligations":[{"periodKey":"22CF","start":"2017-01-01","end":"2017-03-31","due":"2017-05-07","status":"F","received":"2017-05-06"}]}},"duration":1,"createdAt":"2026-02-03T23:25:19.778Z","ttl":1772580319,"ttl_datestamp":"2026-03-03T23:25:19.778Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-95ef6e57-f41e-4ef4-8246-fb1de2a8fe1b","requestId":"e148c234-dd0f-4388-bc6a-b6bb7098da51","amznTraceId":null,"traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","url":"http://localhost:9000/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Device-ID":"daa737f3-9a55-48d5-9560-b5ba7735fb7f","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122","Gov-Client-Public-IP-Timestamp":"2026-02-03T23:25:06.797Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"e148c234-dd0f-4388-bc6a-b6bb7098da51","traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","x-correlationid":"e148c234-dd0f-4388-bc6a-b6bb7098da51"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"297","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 23:25:06 GMT","etag":"W/\"129-UFxb9UF4LOFfUrBiO2wN6GYy9Fo\"","keep-alive":"timeout=5","x-correlationid":"56682bfa-e34e-4e9f-bacb-f491520efccc","x-powered-by":"Express"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"Headers valid with warnings","errors":[],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]},{"code":"***MASKED***","message":"Header required","headers":["gov-client-public-port"]}]}},"duration":4,"createdAt":"2026-02-03T23:25:06.842Z","ttl":1772580306,"ttl_datestamp":"2026-03-03T23:25:06.842Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-9c17f9ba-eb91-4e68-9abe-09828f484951","requestId":"e148c234-dd0f-4388-bc6a-b6bb7098da51","amznTraceId":null,"traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","url":"http://localhost:9000/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Device-ID":"daa737f3-9a55-48d5-9560-b5ba7735fb7f","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122","Gov-Client-Public-IP-Timestamp":"2026-02-03T23:25:06.797Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"e148c234-dd0f-4388-bc6a-b6bb7098da51","traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","x-correlationid":"e148c234-dd0f-4388-bc6a-b6bb7098da51"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"297","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 23:25:07 GMT","etag":"W/\"129-UFxb9UF4LOFfUrBiO2wN6GYy9Fo\"","keep-alive":"timeout=5","x-correlationid":"88c56ea8-e680-46aa-8235-7e28aa71616d","x-powered-by":"Express"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"Headers valid with warnings","errors":[],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]},{"code":"***MASKED***","message":"Header required","headers":["gov-client-public-port"]}]}},"duration":1,"createdAt":"2026-02-03T23:25:07.859Z","ttl":1772580307,"ttl_datestamp":"2026-03-03T23:25:07.859Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-9e6a7171-609e-415a-98f1-39ea115423e2","requestId":"e148c234-dd0f-4388-bc6a-b6bb7098da51","amznTraceId":null,"traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","url":"http://localhost:9000/organisations/vat/847829176/returns","method":"POST","httpRequest":{"method":"POST","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"e148c234-dd0f-4388-bc6a-b6bb7098da51","traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","x-correlationid":"e148c234-dd0f-4388-bc6a-b6bb7098da51","Gov-Client-Device-ID":"daa737f3-9a55-48d5-9560-b5ba7735fb7f","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122","Gov-Client-Public-IP-Timestamp":"2026-02-03T23:25:06.797Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"},"body":"{\"periodKey\":\"17O2\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":5000,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0,\"finalised\":true}"},"httpResponse":{"statusCode":201,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"140","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 23:25:06 GMT","etag":"W/\"8c-RHeXuhqH151WY4s4u/Azoci0xI0\"","keep-alive":"timeout=5","receipt-id":"029a214d-1725-4d0d-8159-1b9cdad23539","receipt-signature":"This has been deprecated - DO NOT USE","receipt-timestamp":"2026-02-03T23:25:06Z","x-correlationid":"e60772d7-5a67-4cda-82c5-5a25c3c48d9d","x-powered-by":"Express"},"body":{"processingDate":"2026-02-03T23:25:06.850Z","formBundleNumber":"104445609735","paymentIndicator":"DD","chargeRefNumber":"fKKlJlgDsbWXkzWH"}},"duration":5,"createdAt":"2026-02-03T23:25:06.852Z","ttl":1772580306,"ttl_datestamp":"2026-03-03T23:25:06.852Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-b10dc2f5-6fd3-42a5-89a8-2f2ddf0a163f","requestId":"b910fc1b-cbaa-408c-b55f-5207444ba12c","amznTraceId":null,"traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","url":"http://localhost:9000/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Device-ID":"1c743968-f338-4e6b-b238-81956d8d69da","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770161084122","Gov-Client-Public-IP-Timestamp":"2026-02-03T23:25:18.675Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"b910fc1b-cbaa-408c-b55f-5207444ba12c","traceparent":"00-9b3de041ae37e1a68ff06135fb083262-7b8ca4540e3a4dfa-01","x-correlationid":"b910fc1b-cbaa-408c-b55f-5207444ba12c"}},"httpResponse":{"statusCode":200,"headers":{"access-control-allow-headers":"Content-Type, Authorization, Accept","access-control-allow-methods":"GET, POST, PUT, DELETE, OPTIONS","access-control-allow-origin":"*","connection":"keep-alive","content-length":"297","content-type":"application/json; charset=utf-8","date":"Tue, 03 Feb 2026 23:25:18 GMT","etag":"W/\"129-UFxb9UF4LOFfUrBiO2wN6GYy9Fo\"","keep-alive":"timeout=5","x-correlationid":"06fff8dc-6d71-4650-9fdf-0546f0300b0a","x-powered-by":"Express"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"Headers valid with warnings","errors":[],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]},{"code":"***MASKED***","message":"Header required","headers":["gov-client-public-port"]}]}},"duration":3,"createdAt":"2026-02-03T23:25:18.758Z","ttl":1772580318,"ttl_datestamp":"2026-03-03T23:25:18.758Z"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T23:25:29.869Z","msg":"[dynamodb-export]: ── END hmrc-api-requests.jsonl ──"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T23:25:29.869Z","msg":"[dynamodb-export]: Exporting table 'test-receipts-table' from endpoint 'http://127.0.0.1:9001' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/receipts.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T23:25:29.875Z","msg":"[dynamodb-export]: ✅ Exported 1 items from table 'test-receipts-table' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/receipts.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T23:25:29.875Z","msg":"[dynamodb-export]: ── BEGIN receipts.jsonl ──"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","receiptId":"2026-02-03T23:25:06.855Z-104445609735","receipt":{"processingDate":"2026-02-03T23:25:06.850Z","formBundleNumber":"104445609735","paymentIndicator":"DD","chargeRefNumber":"fKKlJlgDsbWXkzWH"},"createdAt":"2026-02-03T23:25:06.855Z","ttl":1990913106,"ttl_datestamp":"2033-02-01T23:25:06.855Z"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T23:25:29.876Z","msg":"[dynamodb-export]: ── END receipts.jsonl ──"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-02-03T23:25:29.876Z","msg":"[dynamodb-export]: ✅ Completed export of all tables"}
[DynamoDB Export]: Export completed: [
  {
    table: [32m'bundles'[39m,
    itemCount: [33m1[39m,
    filePath: [32m'/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/bundles.jsonl'[39m
  },
  {
    table: [32m'hmrc-api-requests'[39m,
    itemCount: [33m14[39m,
    filePath: [32m'/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/hmrc-api-requests.jsonl'[39m
  },
  {
    table: [32m'receipts'[39m,
    itemCount: [33m1[39m,
    filePath: [32m'/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/receipts.jsonl'[39m
  }
]
Asserting HMRC API request exists: POST /oauth/token
[DynamoDB Assertions]: Found 1 OAuth token exchange request(s)
Asserting HMRC API request exists: POST /organisations/vat/847829176/returns
[DynamoDB Assertions]: Found 1 VAT return POST request(s)
Matched all expected values in http://localhost:9000/organisations/vat/847829176/returns: { [32m'httpRequest.method'[39m: [32m'POST'[39m, [32m'httpResponse.statusCode'[39m: [33m201[39m }
[DynamoDB Assertions]: VAT POST request body validated - periodKey format: 17O2
Asserting HMRC API request exists: GET /\/organisations\/vat\/847829176\/returns\/\w+/
[DynamoDB Assertions]: Found 1 VAT return GET request(s)
Matched all expected values in http://localhost:9000/organisations/vat/847829176/returns/22DV: { [32m'httpRequest.method'[39m: [32m'GET'[39m, [32m'httpResponse.statusCode'[39m: [33m200[39m }
[DynamoDB Assertions]: VAT GET response body validated - periodKey format: 22DV
[DynamoDB Assertions]: Found 0 Fraud prevention headers validation feedback GET request(s)
Asserting HMRC API request exists: GET /test/fraud-prevention-headers/validate
[DynamoDB Assertions]: Found 6 Fraud prevention headers validation GET request(s)
[DynamoDB Assertions]: Fraud prevention headers validation GET request #1 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 0
[DynamoDB Assertions]: Warnings: 2
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 0 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 2 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[DynamoDB Assertions]: Fraud prevention headers validation GET request #2 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 0
[DynamoDB Assertions]: Warnings: 2
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 0 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 2 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[DynamoDB Assertions]: Fraud prevention headers validation GET request #3 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 0
[DynamoDB Assertions]: Warnings: 2
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 0 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 2 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[DynamoDB Assertions]: Fraud prevention headers validation GET request #4 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 0
[DynamoDB Assertions]: Warnings: 2
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 0 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 2 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[DynamoDB Assertions]: Fraud prevention headers validation GET request #5 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 0
[DynamoDB Assertions]: Warnings: 2
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 0 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 2 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[DynamoDB Assertions]: Fraud prevention headers validation GET request #6 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 0
[DynamoDB Assertions]: Warnings: 2
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 0 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 2 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
{"level":30,"source":"behaviour-tests/helpers/dynamodb-assertions.js","time":"2026-02-03T23:25:29.941Z","msg":"Found 14 HMRC API requests: OAuth (1) with hashedSub 5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0, authenticated (13) with hashedSub 5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0"}
[DynamoDB Assertions]: Found 1 unique hashedSub value(s): 5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0
[afterEach] Saving /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/userSub.txt for test "Click through: Submit a VAT return to HMRC": user
{"level":30,"source":"app/services/subHasher.js","time":"2026-02-03T23:25:30.045Z","message":"Using USER_SUB_HASH_SALT from environment (local dev/test)"}
[fileHelper] Salt initialized successfully for test diagnostics
[afterEach] Saving /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/hashedUserSub.txt for test "Click through: Submit a VAT return to HMRC": 5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0
Saving /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/traceparent.txt for test "Click through: Submit a VAT return to HMRC": 00-6f9f20fa4643d0d16fc1a0d3489cc919-1d4331fbfd0cbaf7-01
[http-simulator] Stopped
  ✓  1 [submitVatBehaviour] › behaviour-tests/submitVat.behaviour.test.js:182:1 › Click through: Submit a VAT return to HMRC (53.5s)

  1 passed (59.3s)

To open last HTML report run:
[36m[39m
[36m  npx playwright show-report target/test-reports/html-report[39m
[36m[39m
