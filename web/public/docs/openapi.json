{
  "openapi" : "3.0.3",
  "info" : {
    "title" : "DIY Accounting Submit API",
    "description" : "API Gateway v2 endpoints for DIY Accounting Submit application",
    "version" : "1.0.0",
    "x-authentication-guide" : {
      "description" : "This API is protected by Amazon Cognito. To use the API:\n\n1. **Via Website**: If you are logged into the DIY Accounting Submit website, you can access the Swagger UI directly and API calls will use your existing session cookies.\n\n2. **External Access**: \n   - First obtain a Cognito access token by calling `/api/v1/cognito/authUrl` to get the login URL\n   - Complete the OAuth flow to get an access token\n   - Include the token in the `Authorization: Bearer <token>` header\n\n3. **For HMRC Integration**: Some endpoints require HMRC authorization tokens obtained via `/api/v1/hmrc/authUrl` and `/api/v1/hmrc/token`\n\n**Note**: All endpoints require proper CORS headers and are accessible from the same domain as the main application."
    }
  },
  "servers" : [ {
    "url" : "https://{apiId}.execute-api.{region}.amazonaws.com/",
    "description" : "API Gateway v2 endpoint",
    "variables" : {
      "apiId" : {
        "description" : "API Gateway ID",
        "default" : "your-api-id"
      },
      "region" : {
        "description" : "AWS Region",
        "default" : "eu-west-2"
      }
    }
  } ],
  "paths" : {
    "/cognito/authUrl" : {
      "get" : {
        "summary" : "Get Cognito authentication URL",
        "description" : "Returns the Cognito OAuth2 authorization URL for user login",
        "operationId" : "getCognitoAuthUrl",
        "tags" : [ "Authentication" ],
        "responses" : {
          "200" : {
            "description" : "Authentication URL returned successfully"
          }
        }
      }
    },
    "/cognito/token" : {
      "post" : {
        "summary" : "Exchange Cognito authorization code for access token",
        "description" : "Exchanges an authorization code for a Cognito access token",
        "operationId" : "exchangeCognitoToken",
        "tags" : [ "Authentication" ],
        "responses" : {
          "200" : {
            "description" : "Token exchanged successfully"
          }
        }
      }
    },
    "/hmrc/authUrl" : {
      "get" : {
        "summary" : "Get HMRC authentication URL",
        "description" : "Returns the HMRC OAuth2 authorization URL for accessing HMRC APIs",
        "operationId" : "getHmrcAuthUrl",
        "tags" : [ "HMRC" ],
        "security" : [ {
          "CognitoAuth" : [ ]
        } ],
        "responses" : {
          "200" : {
            "description" : "HMRC authentication URL returned successfully"
          }
        }
      }
    },
    "/hmrc/token" : {
      "post" : {
        "summary" : "Exchange HMRC authorization code for access token",
        "description" : "Exchanges an HMRC authorization code for an access token",
        "operationId" : "exchangeHmrcToken",
        "tags" : [ "HMRC" ],
        "security" : [ {
          "CognitoAuth" : [ ]
        } ],
        "responses" : {
          "200" : {
            "description" : "HMRC token exchanged successfully"
          }
        }
      }
    },
    "/hmrc/vat/return" : {
      "post" : {
        "summary" : "Submit VAT return to HMRC",
        "description" : "Submits a VAT return to HMRC on behalf of the authenticated user",
        "operationId" : "submitVatReturn",
        "tags" : [ "HMRC" ],
        "security" : [ {
          "HmrcAuth" : [ ]
        } ],
        "responses" : {
          "200" : {
            "description" : "HMRC token exchanged successfully"
          }
        }
      }
    },
    "/hmrc/receipt" : {
      "post" : {
        "summary" : "Log receipt to storage",
        "description" : "Logs a transaction receipt to secure storage",
        "operationId" : "logReceipt",
        "tags" : [ "HMRC" ],
        "security" : [ {
          "CognitoAuth" : [ ]
        } ],
        "responses" : {
          "200" : {
            "description" : "HMRC token exchanged successfully"
          }
        }
      },
      "get" : {
        "summary" : "Retrieve stored receipts",
        "description" : "Retrieves previously stored receipts for the authenticated user",
        "operationId" : "getReceipts",
        "tags" : [ "HMRC" ],
        "security" : [ {
          "CognitoAuth" : [ ]
        } ],
        "responses" : {
          "200" : {
            "description" : "HMRC authentication URL returned successfully"
          }
        }
      }
    },
    "/catalog" : {
      "get" : {
        "summary" : "Get product catalog",
        "description" : "Retrieves the available product catalog",
        "operationId" : "getCatalog",
        "tags" : [ "Account" ],
        "responses" : {
          "200" : {
            "description" : "Catalog retrieved successfully"
          }
        }
      }
    },
    "/bundle" : {
      "post" : {
        "summary" : "Request new bundle",
        "description" : "Creates a new bundle request for the authenticated user",
        "operationId" : "requestBundle",
        "tags" : [ "Account" ],
        "security" : [ {
          "CognitoAuth" : [ ]
        } ],
        "responses" : {
          "200" : {
            "description" : "Bundle created successfully"
          }
        }
      },
      "get" : {
        "summary" : "Get user bundles",
        "description" : "Retrieves bundles for the authenticated user",
        "operationId" : "getBundles",
        "tags" : [ "Account" ],
        "security" : [ {
          "CognitoAuth" : [ ]
        } ],
        "responses" : {
          "200" : {
            "description" : "Bundles retrieved successfully"
          }
        }
      },
      "delete" : {
        "summary" : "Delete bundle",
        "description" : "Deletes a bundle for the authenticated user",
        "operationId" : "deleteBundle",
        "tags" : [ "Account" ],
        "security" : [ {
          "CognitoAuth" : [ ]
        } ],
        "responses" : {
          "200" : {
            "description" : "Bundle created successfully"
          }
        }
      }
    }
  },
  "components" : {
    "securitySchemes" : {
      "CognitoAuth" : {
        "type" : "http",
        "scheme" : "bearer",
        "bearerFormat" : "JWT",
        "description" : "Cognito JWT token"
      },
      "HmrcAuth" : {
        "type" : "http",
        "scheme" : "bearer",
        "description" : "HMRC OAuth2 token"
      }
    }
  }
}