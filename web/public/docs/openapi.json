{
  "openapi" : "3.0.3",
  "info" : {
    "title" : "DIY Accounting Submit API",
    "description" : "DIY Accounting Submit API documentation",
    "version" : "1.0.0",
    "x-authentication-guide" : {
      "description" : "This API is protected by Amazon Cognito. To use the API:\n\n1. **Via Website**: If you are logged into the DIY Accounting Submit website, you can access the Swagger UI directly and API calls will use your existing session cookies.\n\n2. **External Access**: \n   - First obtain a Cognito access token by calling `/api/v1/cognito/authUrl` to get the login URL\n   - Complete the OAuth flow to get an access token\n   - Include the token in the `Authorization: Bearer <token>` header\n\n3. **For HMRC Integration**: Some endpoints require HMRC authorization tokens obtained via `/api/v1/hmrc/authUrl` and `/api/v1/hmrc/token`\n\n**Note**: All endpoints require proper CORS headers and are accessible from the same domain as the main application."
    }
  },
  "servers" : [ {
    "url" : "${env.DIY_SUBMIT_APEX_URL}api/v1/",
    "description" : "DIY Accounting Submit API documentation"
  } ],
  "paths" : {
    "/hmrc/receipt" : {
      "get" : {
        "summary" : "Retrieve stored receipts",
        "description" : "Retrieves previously stored receipts for the authenticated user",
        "operationId" : "getReceipts",
        "parameters" : [ {
          "name" : "name",
          "in" : "query",
          "required" : false,
          "description" : "Receipt file name including .json",
          "schema" : {
            "type" : "string",
            "example" : "2025-03-31-123456789012.json"
          }
        }, {
          "name" : "key",
          "in" : "query",
          "required" : false,
          "description" : "Full DynamoDB Item key",
          "schema" : {
            "type" : "string",
            "example" : "receipts/00000000-0000-0000-0000-000000000000/2025-03-31-123456789012.json"
          }
        } ],
        "tags" : [ "HMRC" ],
        "security" : [ {
          "CognitoAuth" : [ ]
        } ],
        "responses" : {
          "200" : {
            "description" : "Receipts retrieved successfully"
          }
        }
      }
    },
    "/hmrc/token" : {
      "post" : {
        "summary" : "Exchange HMRC authorization code for access token",
        "description" : "Exchanges an HMRC authorization code for an access token",
        "operationId" : "exchangeHmrcToken",
        "requestBody" : {
          "required" : true,
          "content" : {
            "application/json" : {
              "schema" : {
                "type" : "object",
                "properties" : {
                  "code" : {
                    "type" : "string",
                    "example" : "abc123"
                  }
                }
              },
              "example" : {
                "code" : "abc123"
              }
            }
          }
        },
        "tags" : [ "HMRC" ],
        "security" : [ {
          "CognitoAuth" : [ ]
        } ],
        "responses" : {
          "200" : {
            "description" : "HMRC token exchanged successfully"
          }
        }
      }
    },
    "/support/ticket" : {
      "post" : {
        "summary" : "Submit a support ticket",
        "description" : "Creates a GitHub issue for the authenticated user's support request",
        "operationId" : "submitSupportTicket"
      }
    },
    "/bundle/{id}" : {
      "delete" : {
        "summary" : "Delete bundle by id",
        "description" : "Deletes a bundle for the authenticated user using a path parameter",
        "operationId" : "deleteBundleById",
        "parameters" : [ {
          "name" : "id",
          "in" : "path",
          "required" : true,
          "description" : "The bundle id (or name) to delete",
          "schema" : {
            "type" : "string"
          }
        } ],
        "tags" : [ "Account" ],
        "security" : [ {
          "CognitoAuth" : [ ]
        } ],
        "responses" : {
          "200" : {
            "description" : "Bundle deleted successfully"
          },
          "202" : {
            "description" : "Request accepted for processing (async)"
          }
        }
      }
    },
    "/bundle" : {
      "get" : {
        "summary" : "Get user bundles",
        "description" : "Retrieves all bundles for the authenticated user",
        "operationId" : "getBundles",
        "parameters" : [ {
          "name" : "x-wait-time-ms",
          "in" : "header",
          "required" : false,
          "description" : "Max time to wait for synchronous response (ms)",
          "schema" : {
            "type" : "string"
          }
        } ],
        "tags" : [ "Account" ],
        "security" : [ {
          "CognitoAuth" : [ ]
        } ],
        "responses" : {
          "200" : {
            "description" : "Bundles retrieved successfully"
          },
          "202" : {
            "description" : "Request accepted for processing (async)"
          }
        }
      },
      "post" : {
        "summary" : "Request new bundle",
        "description" : "Creates a new bundle request for the authenticated user",
        "operationId" : "requestBundle",
        "requestBody" : {
          "required" : true,
          "content" : {
            "application/json" : {
              "schema" : {
                "type" : "object",
                "properties" : {
                  "bundleId" : {
                    "type" : "string",
                    "example" : "test"
                  },
                  "qualifiers" : {
                    "type" : "object",
                    "properties" : {
                      "transactionId" : {
                        "type" : "string",
                        "example" : "TX-12345"
                      }
                    }
                  }
                }
              },
              "example" : {
                "bundleId" : "test",
                "qualifiers" : {
                  "transactionId" : "TX-12345"
                }
              }
            }
          }
        },
        "tags" : [ "Account" ],
        "security" : [ {
          "CognitoAuth" : [ ]
        } ],
        "responses" : {
          "200" : {
            "description" : "Bundle created successfully"
          },
          "202" : {
            "description" : "Request accepted for processing (async)"
          }
        }
      },
      "delete" : {
        "summary" : "Delete bundle",
        "description" : "Deletes a bundle for the authenticated user",
        "operationId" : "deleteBundle",
        "parameters" : [ {
          "name" : "bundleId",
          "in" : "query",
          "required" : false,
          "description" : "The bundle id (or name) to delete",
          "schema" : {
            "type" : "string",
            "example" : "test"
          }
        }, {
          "name" : "removeAll",
          "in" : "query",
          "required" : false,
          "description" : "When true, removes all bundles",
          "schema" : {
            "type" : "string",
            "example" : "false"
          }
        } ],
        "tags" : [ "Account" ],
        "security" : [ {
          "CognitoAuth" : [ ]
        } ],
        "responses" : {
          "200" : {
            "description" : "Bundle deleted successfully"
          },
          "202" : {
            "description" : "Request accepted for processing (async)"
          }
        }
      }
    },
    "/hmrc/vat/return" : {
      "post" : {
        "summary" : "Submit VAT return to HMRC",
        "description" : "Submits a 9-box VAT return to HMRC on behalf of the authenticated user.\n\n## Field Format Requirements (per HMRC MTD VAT API 1.0)\n\n### VAT Registration Number\n- Exactly 9 digits, no spaces or letters\n- Example: 123456789 (not GB123456789)\n\n### Period Dates\n- Format: YYYY-MM-DD\n- Period key is resolved server-side from obligations\n\n### VAT Amounts (Boxes 1-5)\n- Up to 2 decimal places\n- Range: -9,999,999,999,999.99 to 9,999,999,999,999.99\n- Box 5 (Net VAT) must be positive: 0 to 99,999,999,999.99\n\n### Whole Pound Amounts (Boxes 6-9)\n- Whole numbers only (no pence)\n- Range: -9,999,999,999,999 to 9,999,999,999,999\n\n### Calculations\n- Box 3 = Box 1 + Box 2 (auto-calculated)\n- Box 5 = |Box 3 - Box 4| (auto-calculated)",
        "operationId" : "submitVatReturn",
        "parameters" : [ {
          "name" : "Gov-Test-Scenario",
          "in" : "header",
          "required" : false,
          "description" : "HMRC sandbox test scenario (sandbox environment only)",
          "schema" : {
            "type" : "string",
            "enum" : ["QUARTERLY_ONE_MET", "DATE_RANGE_TOO_LARGE", "INSOLVENT_TRADER"],
            "example" : "QUARTERLY_ONE_MET"
          }
        }, {
          "name" : "runFraudPreventionHeaderValidation",
          "in" : "query",
          "required" : false,
          "description" : "When true, validates HMRC Fraud Prevention Headers against HMRC's validator API",
          "schema" : {
            "type" : "boolean",
            "default" : false
          }
        }, {
          "name" : "allowSandboxObligations",
          "in" : "query",
          "required" : false,
          "description" : "Sandbox only: When true, uses any available open obligation if dates don't match exactly",
          "schema" : {
            "type" : "boolean",
            "default" : false
          }
        } ],
        "requestBody" : {
          "required" : true,
          "content" : {
            "application/json" : {
              "schema" : {
                "type" : "object",
                "required" : ["vatNumber", "periodStart", "periodEnd", "accessToken", "vatDueSales", "vatDueAcquisitions", "vatReclaimedCurrPeriod", "totalValueSalesExVAT", "totalValuePurchasesExVAT", "totalValueGoodsSuppliedExVAT", "totalAcquisitionsExVAT"],
                "properties" : {
                  "vatNumber" : {
                    "type" : "string",
                    "pattern" : "^\\d{9}$",
                    "description" : "VAT registration number - exactly 9 digits, no spaces or GB prefix",
                    "example" : "176540158"
                  },
                  "periodStart" : {
                    "type" : "string",
                    "format" : "date",
                    "pattern" : "^\\d{4}-\\d{2}-\\d{2}$",
                    "description" : "Start date of VAT period in YYYY-MM-DD format",
                    "example" : "2024-01-01"
                  },
                  "periodEnd" : {
                    "type" : "string",
                    "format" : "date",
                    "pattern" : "^\\d{4}-\\d{2}-\\d{2}$",
                    "description" : "End date of VAT period in YYYY-MM-DD format",
                    "example" : "2024-03-31"
                  },
                  "accessToken" : {
                    "type" : "string",
                    "description" : "HMRC OAuth2 access token obtained via /hmrc/token endpoint",
                    "example" : "HMRC_ACCESS_TOKEN"
                  },
                  "vatDueSales" : {
                    "type" : "number",
                    "format" : "double",
                    "minimum" : -9999999999999.99,
                    "maximum" : 9999999999999.99,
                    "multipleOf" : 0.01,
                    "description" : "Box 1: VAT due on sales and other outputs. Up to 2 decimal places.",
                    "example" : 1500.50
                  },
                  "vatDueAcquisitions" : {
                    "type" : "number",
                    "format" : "double",
                    "minimum" : -9999999999999.99,
                    "maximum" : 9999999999999.99,
                    "multipleOf" : 0.01,
                    "description" : "Box 2: VAT due on acquisitions from EU (usually 0 post-Brexit). Up to 2 decimal places.",
                    "example" : 0.00
                  },
                  "vatReclaimedCurrPeriod" : {
                    "type" : "number",
                    "format" : "double",
                    "minimum" : -9999999999999.99,
                    "maximum" : 9999999999999.99,
                    "multipleOf" : 0.01,
                    "description" : "Box 4: VAT reclaimed on purchases and other inputs. Up to 2 decimal places.",
                    "example" : 300.25
                  },
                  "totalValueSalesExVAT" : {
                    "type" : "integer",
                    "minimum" : -9999999999999,
                    "maximum" : 9999999999999,
                    "description" : "Box 6: Total value of sales excluding VAT. Whole pounds only, no pence.",
                    "example" : 15000
                  },
                  "totalValuePurchasesExVAT" : {
                    "type" : "integer",
                    "minimum" : -9999999999999,
                    "maximum" : 9999999999999,
                    "description" : "Box 7: Total value of purchases excluding VAT. Whole pounds only, no pence.",
                    "example" : 3000
                  },
                  "totalValueGoodsSuppliedExVAT" : {
                    "type" : "integer",
                    "minimum" : -9999999999999,
                    "maximum" : 9999999999999,
                    "description" : "Box 8: Total value of goods supplied to EU excluding VAT (usually 0 post-Brexit). Whole pounds only.",
                    "example" : 0
                  },
                  "totalAcquisitionsExVAT" : {
                    "type" : "integer",
                    "minimum" : -9999999999999,
                    "maximum" : 9999999999999,
                    "description" : "Box 9: Total value of acquisitions from EU excluding VAT (usually 0 post-Brexit). Whole pounds only.",
                    "example" : 0
                  }
                }
              },
              "examples" : {
                "standard-quarterly" : {
                  "summary" : "Standard quarterly VAT return",
                  "description" : "A typical quarterly VAT return for a small business",
                  "value" : {
                    "vatNumber" : "176540158",
                    "periodStart" : "2024-01-01",
                    "periodEnd" : "2024-03-31",
                    "accessToken" : "HMRC_ACCESS_TOKEN",
                    "vatDueSales" : 1500.50,
                    "vatDueAcquisitions" : 0.00,
                    "vatReclaimedCurrPeriod" : 300.25,
                    "totalValueSalesExVAT" : 15000,
                    "totalValuePurchasesExVAT" : 3000,
                    "totalValueGoodsSuppliedExVAT" : 0,
                    "totalAcquisitionsExVAT" : 0
                  }
                },
                "flat-rate-scheme" : {
                  "summary" : "Flat Rate Scheme return",
                  "description" : "VAT return for a business on the Flat Rate Scheme (FRS)",
                  "value" : {
                    "vatNumber" : "176540158",
                    "periodStart" : "2024-01-01",
                    "periodEnd" : "2024-03-31",
                    "accessToken" : "HMRC_ACCESS_TOKEN",
                    "vatDueSales" : 1200.00,
                    "vatDueAcquisitions" : 0.00,
                    "vatReclaimedCurrPeriod" : 0.00,
                    "totalValueSalesExVAT" : 10000,
                    "totalValuePurchasesExVAT" : 0,
                    "totalValueGoodsSuppliedExVAT" : 0,
                    "totalAcquisitionsExVAT" : 0
                  }
                },
                "refund-claim" : {
                  "summary" : "VAT refund claim",
                  "description" : "VAT return where input VAT exceeds output VAT (reclaim scenario)",
                  "value" : {
                    "vatNumber" : "176540158",
                    "periodStart" : "2024-01-01",
                    "periodEnd" : "2024-03-31",
                    "accessToken" : "HMRC_ACCESS_TOKEN",
                    "vatDueSales" : 500.00,
                    "vatDueAcquisitions" : 0.00,
                    "vatReclaimedCurrPeriod" : 1200.00,
                    "totalValueSalesExVAT" : 5000,
                    "totalValuePurchasesExVAT" : 12000,
                    "totalValueGoodsSuppliedExVAT" : 0,
                    "totalAcquisitionsExVAT" : 0
                  }
                }
              }
            }
          }
        },
        "tags" : [ "HMRC" ],
        "security" : [ {
          "HmrcAuth" : [ ]
        } ],
        "responses" : {
          "200" : {
            "description" : "VAT return submitted successfully",
            "content" : {
              "application/json" : {
                "schema" : {
                  "type" : "object",
                  "properties" : {
                    "receipt" : {
                      "type" : "object",
                      "properties" : {
                        "formBundleNumber" : {
                          "type" : "string",
                          "description" : "HMRC bundle reference number",
                          "example" : "119000067890"
                        },
                        "processingDate" : {
                          "type" : "string",
                          "format" : "date-time",
                          "description" : "HMRC processing timestamp",
                          "example" : "2024-03-31T15:30:00Z"
                        },
                        "paymentIndicator" : {
                          "type" : "string",
                          "description" : "DD (Direct Debit) or BANK",
                          "example" : "BANK"
                        },
                        "chargeRefNumber" : {
                          "type" : "string",
                          "description" : "HMRC charge reference number",
                          "example" : "XD002750001234"
                        }
                      }
                    },
                    "periodKey" : {
                      "type" : "string",
                      "description" : "The resolved HMRC period key",
                      "example" : "24A1"
                    }
                  }
                }
              }
            }
          },
          "400" : {
            "description" : "Validation error - invalid field values",
            "content" : {
              "application/json" : {
                "schema" : {
                  "type" : "object",
                  "properties" : {
                    "status" : {
                      "type" : "integer",
                      "example" : 400
                    },
                    "message" : {
                      "type" : "string",
                      "example" : "Validation Error"
                    },
                    "errors" : {
                      "type" : "array",
                      "items" : {
                        "type" : "string"
                      },
                      "example" : ["Invalid vatDueSales (Box 1) - must be a valid monetary amount with max 2 decimal places"]
                    }
                  }
                }
              }
            }
          },
          "401" : {
            "description" : "Authentication required - invalid or expired HMRC access token"
          },
          "403" : {
            "description" : "Forbidden - user does not have required bundle entitlement"
          }
        }
      }
    },
    "/cognito/token" : {
      "post" : {
        "summary" : "Exchange Cognito authorization code for access token",
        "description" : "Exchanges an authorization code for a Cognito access token",
        "operationId" : "exchangeCognitoToken",
        "requestBody" : {
          "required" : true,
          "content" : {
            "application/x-www-form-urlencoded" : {
              "schema" : {
                "type" : "object",
                "properties" : {
                  "code" : {
                    "type" : "string",
                    "example" : "abc123"
                  }
                }
              },
              "example" : {
                "code" : "abc123"
              }
            }
          }
        },
        "tags" : [ "Authentication" ],
        "responses" : {
          "200" : {
            "description" : "Token exchanged successfully"
          }
        }
      }
    },
    "/hmrc/receipt/{name}" : {
      "get" : {
        "summary" : "Retrieve a stored receipt by name",
        "description" : "Retrieves a specific stored receipt for the authenticated user by file name",
        "operationId" : "getReceiptByName",
        "parameters" : [ {
          "name" : "name",
          "in" : "path",
          "required" : true,
          "description" : "The receipt file name including .json",
          "schema" : {
            "type" : "string",
            "example" : "2025-03-31-123456789012.json"
          }
        } ],
        "tags" : [ "HMRC" ],
        "security" : [ {
          "CognitoAuth" : [ ]
        } ],
        "responses" : {
          "200" : {
            "description" : "Request completed successfully"
          }
        }
      }
    },
    "/hmrc/vat/obligation" : {
      "get" : {
        "summary" : "Get VAT obligations from HMRC",
        "description" : "Retrieves VAT obligations from HMRC for the authenticated user.\n\n## Response Fields\n\n| Field | Description |\n|-------|-------------|\n| start | Period start date (YYYY-MM-DD) |\n| end | Period end date (YYYY-MM-DD) |\n| due | Submission deadline (YYYY-MM-DD) |\n| status | O (Open - awaiting submission) or F (Fulfilled - already submitted) |\n| periodKey | HMRC period identifier (e.g., 24A1) |\n| received | Date return was received (fulfilled only) |\n\n## Period Key Formats\n\n- **Quarterly**: YYXN (e.g., 24A1 = Q1 2024, 24B2 = May 2024)\n- **Monthly**: YYAB (e.g., 24AA = Jan 2024)\n- **Annual**: #NNN (e.g., #001)\n\n## Date Range Limit\n\nMaximum 366 days between from and to dates.",
        "operationId" : "getVatObligations",
        "parameters" : [ {
          "name" : "vrn",
          "in" : "query",
          "required" : true,
          "description" : "VAT registration number - exactly 9 digits, no spaces or GB prefix",
          "schema" : {
            "type" : "string",
            "pattern" : "^\\d{9}$",
            "example" : "176540158"
          }
        }, {
          "name" : "from",
          "in" : "query",
          "required" : false,
          "description" : "From date in YYYY-MM-DD format. Defaults to start of current calendar year.",
          "schema" : {
            "type" : "string",
            "format" : "date",
            "pattern" : "^\\d{4}-\\d{2}-\\d{2}$",
            "example" : "2024-01-01"
          }
        }, {
          "name" : "to",
          "in" : "query",
          "required" : false,
          "description" : "To date in YYYY-MM-DD format. Defaults to today. Maximum range is 366 days from 'from' date.",
          "schema" : {
            "type" : "string",
            "format" : "date",
            "pattern" : "^\\d{4}-\\d{2}-\\d{2}$",
            "example" : "2024-12-31"
          }
        }, {
          "name" : "status",
          "in" : "query",
          "required" : false,
          "description" : "Obligation status filter. O = Open (awaiting submission), F = Fulfilled (already submitted)",
          "schema" : {
            "type" : "string",
            "enum" : ["O", "F"],
            "example" : "O"
          }
        }, {
          "name" : "Gov-Test-Scenario",
          "in" : "header",
          "required" : false,
          "description" : "HMRC sandbox test scenario (sandbox environment only)",
          "schema" : {
            "type" : "string",
            "enum" : ["QUARTERLY_ONE_MET", "QUARTERLY_NONE_MET", "MONTHLY_ONE_MET", "DATE_RANGE_TOO_LARGE", "NOT_FOUND"],
            "example" : "QUARTERLY_ONE_MET"
          }
        }, {
          "name" : "runFraudPreventionHeaderValidation",
          "in" : "query",
          "required" : false,
          "description" : "When true, validates HMRC Fraud Prevention Headers against HMRC's validator API",
          "schema" : {
            "type" : "boolean",
            "default" : false
          }
        } ],
        "tags" : [ "HMRC" ],
        "security" : [ {
          "CognitoAuth" : [ ]
        } ],
        "responses" : {
          "200" : {
            "description" : "Obligations retrieved successfully",
            "content" : {
              "application/json" : {
                "schema" : {
                  "type" : "object",
                  "properties" : {
                    "obligations" : {
                      "type" : "array",
                      "items" : {
                        "type" : "object",
                        "properties" : {
                          "start" : {
                            "type" : "string",
                            "format" : "date",
                            "description" : "Period start date",
                            "example" : "2024-01-01"
                          },
                          "end" : {
                            "type" : "string",
                            "format" : "date",
                            "description" : "Period end date",
                            "example" : "2024-03-31"
                          },
                          "due" : {
                            "type" : "string",
                            "format" : "date",
                            "description" : "Submission deadline",
                            "example" : "2024-05-07"
                          },
                          "status" : {
                            "type" : "string",
                            "enum" : ["O", "F"],
                            "description" : "O = Open, F = Fulfilled",
                            "example" : "O"
                          },
                          "periodKey" : {
                            "type" : "string",
                            "description" : "HMRC period identifier",
                            "example" : "24A1"
                          },
                          "received" : {
                            "type" : "string",
                            "format" : "date",
                            "description" : "Date return was received (fulfilled obligations only)",
                            "example" : "2024-04-30"
                          }
                        }
                      }
                    }
                  }
                },
                "examples" : {
                  "quarterly-open" : {
                    "summary" : "Open quarterly obligation",
                    "value" : {
                      "obligations" : [
                        {
                          "start" : "2024-01-01",
                          "end" : "2024-03-31",
                          "due" : "2024-05-07",
                          "status" : "O",
                          "periodKey" : "24A1"
                        }
                      ]
                    }
                  },
                  "quarterly-fulfilled" : {
                    "summary" : "Fulfilled quarterly obligation",
                    "value" : {
                      "obligations" : [
                        {
                          "start" : "2024-01-01",
                          "end" : "2024-03-31",
                          "due" : "2024-05-07",
                          "status" : "F",
                          "periodKey" : "24A1",
                          "received" : "2024-04-30"
                        }
                      ]
                    }
                  }
                }
              }
            }
          },
          "400" : {
            "description" : "Validation error - invalid parameters",
            "content" : {
              "application/json" : {
                "schema" : {
                  "type" : "object",
                  "properties" : {
                    "code" : {
                      "type" : "string",
                      "example" : "DATE_RANGE_TOO_LARGE"
                    },
                    "message" : {
                      "type" : "string",
                      "example" : "The date range is too large"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/hmrc/vat/return/{periodKey}" : {
      "get" : {
        "summary" : "Get submitted VAT return from HMRC",
        "description" : "Retrieves a previously submitted VAT return from HMRC for the authenticated user.\n\n## Response Fields (9-Box VAT Return)\n\n### VAT Amounts (2 decimal places)\n| Box | Field | Description |\n|-----|-------|-------------|\n| 1 | vatDueSales | VAT due on sales and other outputs |\n| 2 | vatDueAcquisitions | VAT due on acquisitions from EU |\n| 3 | totalVatDue | Total VAT due (Box 1 + Box 2) |\n| 4 | vatReclaimedCurrPeriod | VAT reclaimed on purchases and inputs |\n| 5 | netVatDue | Net VAT to pay/reclaim (|Box 3 - Box 4|) |\n\n### Whole Pound Amounts\n| Box | Field | Description |\n|-----|-------|-------------|\n| 6 | totalValueSalesExVAT | Total value of sales excluding VAT |\n| 7 | totalValuePurchasesExVAT | Total value of purchases excluding VAT |\n| 8 | totalValueGoodsSuppliedExVAT | Total value of goods supplied to EU |\n| 9 | totalAcquisitionsExVAT | Total value of acquisitions from EU |",
        "operationId" : "getVatReturn",
        "parameters" : [ {
          "name" : "periodKey",
          "in" : "path",
          "required" : true,
          "description" : "The HMRC period key to retrieve. Formats: YYXN (quarterly), YYAB (monthly), #NNN (annual)",
          "schema" : {
            "type" : "string",
            "pattern" : "^(\\d{2}[A-Z][A-Z0-9]|\\d{4}|#\\d{3})$",
            "example" : "24A1"
          }
        }, {
          "name" : "vrn",
          "in" : "query",
          "required" : true,
          "description" : "VAT registration number - exactly 9 digits, no spaces or GB prefix",
          "schema" : {
            "type" : "string",
            "pattern" : "^\\d{9}$",
            "example" : "176540158"
          }
        }, {
          "name" : "Gov-Test-Scenario",
          "in" : "header",
          "required" : false,
          "description" : "HMRC sandbox test scenario (sandbox environment only)",
          "schema" : {
            "type" : "string",
            "enum" : ["DATE_RANGE_TOO_LARGE", "INSOLVENT_TRADER"],
            "example" : "QUARTERLY_ONE_MET"
          }
        }, {
          "name" : "runFraudPreventionHeaderValidation",
          "in" : "query",
          "required" : false,
          "description" : "When true, validates HMRC Fraud Prevention Headers against HMRC's validator API",
          "schema" : {
            "type" : "boolean",
            "default" : false
          }
        } ],
        "tags" : [ "HMRC" ],
        "security" : [ {
          "CognitoAuth" : [ ]
        } ],
        "responses" : {
          "200" : {
            "description" : "VAT return retrieved successfully",
            "content" : {
              "application/json" : {
                "schema" : {
                  "type" : "object",
                  "properties" : {
                    "periodKey" : {
                      "type" : "string",
                      "description" : "HMRC period identifier",
                      "example" : "24A1"
                    },
                    "vatDueSales" : {
                      "type" : "number",
                      "format" : "double",
                      "description" : "Box 1: VAT due on sales (2 decimal places)",
                      "example" : 1500.50
                    },
                    "vatDueAcquisitions" : {
                      "type" : "number",
                      "format" : "double",
                      "description" : "Box 2: VAT due on acquisitions from EU (2 decimal places)",
                      "example" : 0.00
                    },
                    "totalVatDue" : {
                      "type" : "number",
                      "format" : "double",
                      "description" : "Box 3: Total VAT due = Box 1 + Box 2 (2 decimal places)",
                      "example" : 1500.50
                    },
                    "vatReclaimedCurrPeriod" : {
                      "type" : "number",
                      "format" : "double",
                      "description" : "Box 4: VAT reclaimed on purchases (2 decimal places)",
                      "example" : 300.25
                    },
                    "netVatDue" : {
                      "type" : "number",
                      "format" : "double",
                      "minimum" : 0,
                      "description" : "Box 5: Net VAT to pay or reclaim = |Box 3 - Box 4| (always positive, 2 decimal places)",
                      "example" : 1200.25
                    },
                    "totalValueSalesExVAT" : {
                      "type" : "integer",
                      "description" : "Box 6: Total value of sales excluding VAT (whole pounds)",
                      "example" : 15000
                    },
                    "totalValuePurchasesExVAT" : {
                      "type" : "integer",
                      "description" : "Box 7: Total value of purchases excluding VAT (whole pounds)",
                      "example" : 3000
                    },
                    "totalValueGoodsSuppliedExVAT" : {
                      "type" : "integer",
                      "description" : "Box 8: Total value of goods supplied to EU excluding VAT (whole pounds)",
                      "example" : 0
                    },
                    "totalAcquisitionsExVAT" : {
                      "type" : "integer",
                      "description" : "Box 9: Total value of acquisitions from EU excluding VAT (whole pounds)",
                      "example" : 0
                    },
                    "finalised" : {
                      "type" : "boolean",
                      "description" : "Whether the return has been finalised by HMRC",
                      "example" : true
                    }
                  }
                },
                "examples" : {
                  "standard-return" : {
                    "summary" : "Standard quarterly VAT return",
                    "value" : {
                      "periodKey" : "24A1",
                      "vatDueSales" : 1500.50,
                      "vatDueAcquisitions" : 0.00,
                      "totalVatDue" : 1500.50,
                      "vatReclaimedCurrPeriod" : 300.25,
                      "netVatDue" : 1200.25,
                      "totalValueSalesExVAT" : 15000,
                      "totalValuePurchasesExVAT" : 3000,
                      "totalValueGoodsSuppliedExVAT" : 0,
                      "totalAcquisitionsExVAT" : 0,
                      "finalised" : true
                    }
                  }
                }
              }
            }
          },
          "404" : {
            "description" : "VAT return not found for the specified period"
          }
        }
      }
    }
  },
  "components" : {
    "securitySchemes" : {
      "CognitoAuth" : {
        "type" : "http",
        "scheme" : "bearer",
        "bearerFormat" : "JWT",
        "description" : "Cognito JWT token"
      },
      "HmrcAuth" : {
        "type" : "http",
        "scheme" : "bearer",
        "description" : "HMRC OAuth2 token"
      }
    }
  }
}