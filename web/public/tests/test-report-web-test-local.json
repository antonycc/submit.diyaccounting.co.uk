{
  "testName": "web-test-local",
  "generatedAt": "2026-02-10T02:53:16.494Z",
  "testContext": {
    "testId": "web-test-local",
    "name": "Click through: Submit a VAT return to HMRC",
    "title": "Submit VAT Return (HMRC: VAT Return POST)",
    "description": "Clicks through the app to submit a VAT return to HMRC MTD VAT API, then verifies receipt visibility and navigation.",
    "hmrcApis": [
      {
        "url": "/api/v1/hmrc/vat/return",
        "method": "POST"
      },
      {
        "url": "/api/v1/hmrc/vat/return/:periodKey",
        "method": "GET"
      },
      {
        "url": "/api/v1/hmrc/vat/obligation",
        "method": "GET"
      },
      {
        "url": "/test/fraud-prevention-headers/validate",
        "method": "GET"
      }
    ],
    "env": {
      "envName": "proxy",
      "baseUrl": "https://wanted-finally-anteater.ngrok-free.app/",
      "serverPort": "3000",
      "runTestServer": "run",
      "runProxy": "run",
      "runMockOAuth2": "run",
      "testAuthProvider": "mock",
      "testAuthUsername": "user",
      "bundleTableName": "test-bundle-table",
      "hmrcApiRequestsTableName": "test-hmrc-api-requests-table",
      "receiptsTableName": "test-receipts-table",
      "runDynamoDb": "run"
    },
    "testData": {
      "hmrcTestUsername": "727531132500",
      "hmrcTestPassword": "***MASKED***",
      "hmrcTestVatNumber": "157567529",
      "resolvedPeriodKey": "18A1",
      "hmrcVatDueAmount": "1000.00",
      "testUserGenerated": true,
      "userSub": "user",
      "observedTraceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
      "testUrl": "https://wanted-finally-anteater.ngrok-free.app/",
      "isSandboxMode": true,
      "intentionallyNotSuppliedHeaders": []
    },
    "artefactsDir": "/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-web-test-local",
    "screenshotPath": "target/behaviour-test-results/screenshots/submitVat-behaviour-test",
    "testStartTime": "2026-02-10T02:53:10.866Z"
  },
  "hmrcApiRequests": [
    {
      "hashedSub": "5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0",
      "id": "hmrcreq-1853dc27-e2ec-4d92-9261-825eb5bb6526",
      "requestId": "e1b295f7-246b-4c36-a16b-2bf25c41b013",
      "amznTraceId": null,
      "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
      "url": "https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate",
      "method": "GET",
      "httpRequest": {
        "method": "GET",
        "headers": {
          "Accept": "application/vnd.hmrc.1.0+json",
          "Authorization": "***MASKED***",
          "Gov-Client-Public-IP": "79.127.150.148",
          "Gov-Client-Public-Port": "50244",
          "Gov-Client-Device-ID": "e84c10eb-f10c-454f-b7b0-8b2e079331b7",
          "Gov-Client-User-IDs": "cognito=user",
          "Gov-Client-Connection-Method": "WEB_APP_VIA_SERVER",
          "Gov-Vendor-Public-IP": "79.127.150.148",
          "Gov-Vendor-Forwarded": "by=79.127.150.148&for=79.127.150.148",
          "Gov-Vendor-License-IDs": "diyaccounting=3a093931bec9c77161612725f94afabcdf2c028fa978ef42d9eb6bd443083da5",
          "Gov-Vendor-Product-Name": "web-submit-diyaccounting-co-uk",
          "Gov-Vendor-Version": "web-submit-diyaccounting-co-uk=1.0.0",
          "Gov-Client-Browser-JS-User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36",
          "Gov-Client-Multi-Factor": "type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770691914247",
          "Gov-Client-Public-IP-Timestamp": "2026-02-10T02:52:50.412Z",
          "Gov-Client-Screens": "width=1280&height=1446&colour-depth=24&scaling-factor=1",
          "Gov-Client-Timezone": "UTC+01:00",
          "Gov-Client-Window-Size": "width=1280&height=1446",
          "x-request-id": "e1b295f7-246b-4c36-a16b-2bf25c41b013",
          "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
          "x-correlationid": "e1b295f7-246b-4c36-a16b-2bf25c41b013"
        }
      },
      "httpResponse": {
        "statusCode": 200,
        "headers": {
          "cache-control": "no-cache,no-store,max-age=0",
          "connection": "keep-alive",
          "content-length": "260",
          "content-security-policy": "default-src 'self'",
          "content-type": "application/json",
          "date": "Tue, 10 Feb 2026 02:52:52 GMT",
          "strict-transport-security": "max-age=31536000;",
          "vary": "Origin",
          "via": "1.1 75ea87635ae42d05aa36370295c11dc0.cloudfront.net (CloudFront)",
          "x-amz-cf-id": "lKrKREQHQ6UKZrHMxGpqYqKU1MclWc_2qXOHmDyJxc3C0X8sMktIog==",
          "x-amz-cf-pop": "HEL51-P6",
          "x-cache": "Miss from cloudfront",
          "x-content-type-options": "nosniff",
          "x-envoy-upstream-service-time": "16",
          "x-frame-options": "SAMEORIGIN"
        },
        "body": {
          "specVersion": "3.3",
          "code": "***MASKED***",
          "message": "All headers required for your connection method have been supplied and all appear to be valid. Validation is based on a single request. We have access to all requests and can draw additional conclusions."
        }
      },
      "duration": 171,
      "createdAt": "2026-02-10T02:52:52.645Z",
      "ttl": 1773111172,
      "ttl_datestamp": "2026-03-10T02:52:52.645Z"
    },
    {
      "hashedSub": "5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0",
      "id": "hmrcreq-2de59319-1021-48ba-aeba-186d312d1d4f",
      "requestId": "e1b295f7-246b-4c36-a16b-2bf25c41b013",
      "amznTraceId": null,
      "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
      "url": "https://test-api.service.hmrc.gov.uk/organisations/vat/157567529/obligations?from=2017-01-01&to=2017-03-31&status=F",
      "method": "GET",
      "httpRequest": {
        "method": "GET",
        "headers": {
          "Content-Type": "application/json",
          "Accept": "application/vnd.hmrc.1.0+json",
          "Authorization": "***MASKED***",
          "x-request-id": "e1b295f7-246b-4c36-a16b-2bf25c41b013",
          "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
          "x-correlationid": "e1b295f7-246b-4c36-a16b-2bf25c41b013",
          "Gov-Client-Public-IP": "79.127.150.148",
          "Gov-Client-Public-Port": "50244",
          "Gov-Client-Device-ID": "e84c10eb-f10c-454f-b7b0-8b2e079331b7",
          "Gov-Client-User-IDs": "cognito=user",
          "Gov-Client-Connection-Method": "WEB_APP_VIA_SERVER",
          "Gov-Vendor-Public-IP": "79.127.150.148",
          "Gov-Vendor-Forwarded": "by=79.127.150.148&for=79.127.150.148",
          "Gov-Vendor-License-IDs": "diyaccounting=3a093931bec9c77161612725f94afabcdf2c028fa978ef42d9eb6bd443083da5",
          "Gov-Vendor-Product-Name": "web-submit-diyaccounting-co-uk",
          "Gov-Vendor-Version": "web-submit-diyaccounting-co-uk=1.0.0",
          "Gov-Client-Browser-JS-User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36",
          "Gov-Client-Multi-Factor": "type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770691914247",
          "Gov-Client-Public-IP-Timestamp": "2026-02-10T02:52:50.412Z",
          "Gov-Client-Screens": "width=1280&height=1446&colour-depth=24&scaling-factor=1",
          "Gov-Client-Timezone": "UTC+01:00",
          "Gov-Client-Window-Size": "width=1280&height=1446"
        }
      },
      "httpResponse": {
        "statusCode": 200,
        "headers": {
          "cache-control": "no-cache,no-store,max-age=0",
          "connection": "keep-alive",
          "content-length": "134",
          "content-security-policy": "default-src 'self'",
          "content-type": "application/json",
          "date": "Tue, 10 Feb 2026 02:52:52 GMT",
          "strict-transport-security": "max-age=31536000;",
          "vary": "Origin",
          "via": "1.1 75ea87635ae42d05aa36370295c11dc0.cloudfront.net (CloudFront)",
          "x-amz-cf-id": "gLGxd44xPmoYrISnP9NazZGNdOPj_WxC7GTOgx_XsMD0ShykvSk-AQ==",
          "x-amz-cf-pop": "HEL51-P6",
          "x-cache": "Miss from cloudfront",
          "x-content-type-options": "nosniff, nosniff",
          "x-correlationid": "a2a7e488-e631-4ce4-85fd-dddaf9f320b4",
          "x-envoy-upstream-service-time": "16",
          "x-frame-options": "SAMEORIGIN"
        },
        "body": {
          "obligations": [
            {
              "periodKey": "18A1",
              "start": "2017-01-01",
              "end": "2017-03-31",
              "due": "2017-05-07",
              "status": "F",
              "received": "2017-05-06"
            }
          ]
        }
      },
      "duration": 206,
      "createdAt": "2026-02-10T02:52:52.854Z",
      "ttl": 1773111172,
      "ttl_datestamp": "2026-03-10T02:52:52.854Z"
    },
    {
      "hashedSub": "5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0",
      "id": "hmrcreq-30f91c75-c843-433e-98fc-3075582158b1",
      "requestId": "e1b295f7-246b-4c36-a16b-2bf25c41b013",
      "amznTraceId": null,
      "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
      "url": "https://test-api.service.hmrc.gov.uk/organisations/vat/157567529/returns/18A1",
      "method": "GET",
      "httpRequest": {
        "method": "GET",
        "headers": {
          "Content-Type": "application/json",
          "Accept": "application/vnd.hmrc.1.0+json",
          "Authorization": "***MASKED***",
          "x-request-id": "e1b295f7-246b-4c36-a16b-2bf25c41b013",
          "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
          "x-correlationid": "e1b295f7-246b-4c36-a16b-2bf25c41b013",
          "Gov-Client-Public-IP": "79.127.150.148",
          "Gov-Client-Public-Port": "50244",
          "Gov-Client-Device-ID": "e84c10eb-f10c-454f-b7b0-8b2e079331b7",
          "Gov-Client-User-IDs": "cognito=user",
          "Gov-Client-Connection-Method": "WEB_APP_VIA_SERVER",
          "Gov-Vendor-Public-IP": "79.127.150.148",
          "Gov-Vendor-Forwarded": "by=79.127.150.148&for=79.127.150.148",
          "Gov-Vendor-License-IDs": "diyaccounting=3a093931bec9c77161612725f94afabcdf2c028fa978ef42d9eb6bd443083da5",
          "Gov-Vendor-Product-Name": "web-submit-diyaccounting-co-uk",
          "Gov-Vendor-Version": "web-submit-diyaccounting-co-uk=1.0.0",
          "Gov-Client-Browser-JS-User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36",
          "Gov-Client-Multi-Factor": "type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770691914247",
          "Gov-Client-Public-IP-Timestamp": "2026-02-10T02:52:50.412Z",
          "Gov-Client-Screens": "width=1280&height=1446&colour-depth=24&scaling-factor=1",
          "Gov-Client-Timezone": "UTC+01:00",
          "Gov-Client-Window-Size": "width=1280&height=1446"
        }
      },
      "httpResponse": {
        "statusCode": 200,
        "headers": {
          "cache-control": "no-cache,no-store,max-age=0",
          "connection": "keep-alive",
          "content-length": "242",
          "content-security-policy": "default-src 'self'",
          "content-type": "application/json",
          "date": "Tue, 10 Feb 2026 02:52:51 GMT",
          "strict-transport-security": "max-age=31536000;",
          "vary": "Origin",
          "via": "1.1 75ea87635ae42d05aa36370295c11dc0.cloudfront.net (CloudFront)",
          "x-amz-cf-id": "aKiJXcxrCjyQporZJgByjs6sQ8fltT2CPI2BudLkD-mo0mQTJ522uQ==",
          "x-amz-cf-pop": "HEL51-P6",
          "x-cache": "Miss from cloudfront",
          "x-content-type-options": "nosniff, nosniff",
          "x-correlationid": "eeb99ade-6b30-4109-86dd-ecbbdcc71d28",
          "x-envoy-upstream-service-time": "16",
          "x-frame-options": "SAMEORIGIN"
        },
        "body": {
          "periodKey": "18A1",
          "vatDueSales": 1000,
          "vatDueAcquisitions": 0,
          "totalVatDue": 1000,
          "vatReclaimedCurrPeriod": 0,
          "netVatDue": 1000,
          "totalValueSalesExVAT": 5000,
          "totalValuePurchasesExVAT": 0,
          "totalValueGoodsSuppliedExVAT": 0,
          "totalAcquisitionsExVAT": 0
        }
      },
      "duration": 185,
      "createdAt": "2026-02-10T02:52:51.641Z",
      "ttl": 1773111171,
      "ttl_datestamp": "2026-03-10T02:52:51.641Z"
    },
    {
      "hashedSub": "5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0",
      "id": "hmrcreq-3c7e8451-1726-440b-a4a1-9584af3f5a9c",
      "requestId": "e1b295f7-246b-4c36-a16b-2bf25c41b013",
      "amznTraceId": null,
      "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
      "url": "https://test-api.service.hmrc.gov.uk/organisations/vat/157567529/obligations?from=2017-01-01&to=2017-03-31&status=F",
      "method": "GET",
      "httpRequest": {
        "method": "GET",
        "headers": {
          "Content-Type": "application/json",
          "Accept": "application/vnd.hmrc.1.0+json",
          "Authorization": "***MASKED***",
          "x-request-id": "e1b295f7-246b-4c36-a16b-2bf25c41b013",
          "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
          "x-correlationid": "e1b295f7-246b-4c36-a16b-2bf25c41b013",
          "Gov-Client-Public-IP": "79.127.150.148",
          "Gov-Client-Public-Port": "50244",
          "Gov-Client-Device-ID": "e84c10eb-f10c-454f-b7b0-8b2e079331b7",
          "Gov-Client-User-IDs": "cognito=user",
          "Gov-Client-Connection-Method": "WEB_APP_VIA_SERVER",
          "Gov-Vendor-Public-IP": "79.127.150.148",
          "Gov-Vendor-Forwarded": "by=79.127.150.148&for=79.127.150.148",
          "Gov-Vendor-License-IDs": "diyaccounting=3a093931bec9c77161612725f94afabcdf2c028fa978ef42d9eb6bd443083da5",
          "Gov-Vendor-Product-Name": "web-submit-diyaccounting-co-uk",
          "Gov-Vendor-Version": "web-submit-diyaccounting-co-uk=1.0.0",
          "Gov-Client-Browser-JS-User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36",
          "Gov-Client-Multi-Factor": "type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770691914247",
          "Gov-Client-Public-IP-Timestamp": "2026-02-10T02:52:50.412Z",
          "Gov-Client-Screens": "width=1280&height=1446&colour-depth=24&scaling-factor=1",
          "Gov-Client-Timezone": "UTC+01:00",
          "Gov-Client-Window-Size": "width=1280&height=1446"
        }
      },
      "httpResponse": {
        "statusCode": 200,
        "headers": {
          "cache-control": "no-cache,no-store,max-age=0",
          "connection": "keep-alive",
          "content-length": "134",
          "content-security-policy": "default-src 'self'",
          "content-type": "application/json",
          "date": "Tue, 10 Feb 2026 02:52:51 GMT",
          "strict-transport-security": "max-age=31536000;",
          "vary": "Origin",
          "via": "1.1 75ea87635ae42d05aa36370295c11dc0.cloudfront.net (CloudFront)",
          "x-amz-cf-id": "GsFPbovSO-9_VadM6XYWs7bR7pmoYPEabqd4gFjcmoV2Or4jhWMSRg==",
          "x-amz-cf-pop": "HEL51-P6",
          "x-cache": "Miss from cloudfront",
          "x-content-type-options": "nosniff, nosniff",
          "x-correlationid": "220de72b-8edd-4729-a1ac-a2c5ddd6ea68",
          "x-envoy-upstream-service-time": "16",
          "x-frame-options": "SAMEORIGIN"
        },
        "body": {
          "obligations": [
            {
              "periodKey": "18A1",
              "start": "2017-01-01",
              "end": "2017-03-31",
              "due": "2017-05-07",
              "status": "F",
              "received": "2017-05-06"
            }
          ]
        }
      },
      "duration": 199,
      "createdAt": "2026-02-10T02:52:51.224Z",
      "ttl": 1773111171,
      "ttl_datestamp": "2026-03-10T02:52:51.224Z"
    },
    {
      "hashedSub": "5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0",
      "id": "hmrcreq-5ac5b893-bb43-4a00-b9a7-52eb7291b9ee",
      "requestId": "f0d6aca7-4988-4294-8f87-f6e9ea302f17",
      "amznTraceId": null,
      "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
      "url": "https://test-api.service.hmrc.gov.uk/organisations/vat/157567529/returns",
      "method": "POST",
      "httpRequest": {
        "method": "POST",
        "headers": {
          "Content-Type": "application/json",
          "Accept": "application/vnd.hmrc.1.0+json",
          "Authorization": "***MASKED***",
          "x-request-id": "f0d6aca7-4988-4294-8f87-f6e9ea302f17",
          "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
          "x-correlationid": "f0d6aca7-4988-4294-8f87-f6e9ea302f17",
          "Gov-Client-Public-IP": "79.127.150.148",
          "Gov-Client-Public-Port": "50244",
          "Gov-Client-Device-ID": "b8334b2f-9564-48f1-9daf-75366eb33d42",
          "Gov-Client-User-IDs": "cognito=user",
          "Gov-Client-Connection-Method": "WEB_APP_VIA_SERVER",
          "Gov-Vendor-Public-IP": "79.127.150.148",
          "Gov-Vendor-Forwarded": "by=79.127.150.148&for=79.127.150.148",
          "Gov-Vendor-License-IDs": "diyaccounting=3a093931bec9c77161612725f94afabcdf2c028fa978ef42d9eb6bd443083da5",
          "Gov-Vendor-Product-Name": "web-submit-diyaccounting-co-uk",
          "Gov-Vendor-Version": "web-submit-diyaccounting-co-uk=1.0.0",
          "Gov-Client-Browser-JS-User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36",
          "Gov-Client-Multi-Factor": "type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770691914247",
          "Gov-Client-Public-IP-Timestamp": "2026-02-10T02:52:33.210Z",
          "Gov-Client-Screens": "width=1280&height=1446&colour-depth=24&scaling-factor=1",
          "Gov-Client-Timezone": "UTC+01:00",
          "Gov-Client-Window-Size": "width=1280&height=1446"
        },
        "body": "{\"periodKey\":\"18A1\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":5000,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0,\"finalised\":true}"
      },
      "httpResponse": {
        "statusCode": 201,
        "headers": {
          "cache-control": "no-cache,no-store,max-age=0",
          "connection": "keep-alive",
          "content-length": "140",
          "content-security-policy": "default-src 'self'",
          "content-type": "application/json",
          "date": "Tue, 10 Feb 2026 02:52:34 GMT",
          "receipt-id": "ca6ca17a-56b0-445d-a0fc-986065783166",
          "receipt-signature": "This has been deprecated - DO NOT USE",
          "receipt-timestamp": "2026-02-10T02:52:34Z",
          "strict-transport-security": "max-age=31536000;",
          "vary": "Origin",
          "via": "1.1 5de8e1b8ff157c8e7c046988c3bfc570.cloudfront.net (CloudFront)",
          "x-amz-cf-id": "raiD1rVsU4BWDM4lRjzqIE8AaxUqTQ56ynnQcuH99r3i2bmfNq130g==",
          "x-amz-cf-pop": "HEL51-P6",
          "x-cache": "Miss from cloudfront",
          "x-content-type-options": "nosniff, nosniff",
          "x-correlationid": "ca6ca17a-56b0-445d-a0fc-986065783166",
          "x-envoy-upstream-service-time": "29",
          "x-frame-options": "SAMEORIGIN"
        },
        "body": {
          "processingDate": "2026-02-10T02:52:34.719Z",
          "formBundleNumber": "997426575223",
          "paymentIndicator": "DD",
          "chargeRefNumber": "Whp2ai2FLNGcJtAT"
        }
      },
      "duration": 296,
      "createdAt": "2026-02-10T02:52:34.766Z",
      "ttl": 1773111154,
      "ttl_datestamp": "2026-03-10T02:52:34.766Z"
    },
    {
      "hashedSub": "5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0",
      "id": "hmrcreq-6d1bf58d-0825-4d7b-b9a1-e7365c710fb3",
      "requestId": "f0d6aca7-4988-4294-8f87-f6e9ea302f17",
      "amznTraceId": null,
      "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
      "url": "https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate",
      "method": "GET",
      "httpRequest": {
        "method": "GET",
        "headers": {
          "Accept": "application/vnd.hmrc.1.0+json",
          "Authorization": "***MASKED***",
          "Gov-Client-Public-IP": "79.127.150.148",
          "Gov-Client-Public-Port": "50244",
          "Gov-Client-Device-ID": "b8334b2f-9564-48f1-9daf-75366eb33d42",
          "Gov-Client-User-IDs": "cognito=user",
          "Gov-Client-Connection-Method": "WEB_APP_VIA_SERVER",
          "Gov-Vendor-Public-IP": "79.127.150.148",
          "Gov-Vendor-Forwarded": "by=79.127.150.148&for=79.127.150.148",
          "Gov-Vendor-License-IDs": "diyaccounting=3a093931bec9c77161612725f94afabcdf2c028fa978ef42d9eb6bd443083da5",
          "Gov-Vendor-Product-Name": "web-submit-diyaccounting-co-uk",
          "Gov-Vendor-Version": "web-submit-diyaccounting-co-uk=1.0.0",
          "Gov-Client-Browser-JS-User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36",
          "Gov-Client-Multi-Factor": "type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770691914247",
          "Gov-Client-Public-IP-Timestamp": "2026-02-10T02:52:33.210Z",
          "Gov-Client-Screens": "width=1280&height=1446&colour-depth=24&scaling-factor=1",
          "Gov-Client-Timezone": "UTC+01:00",
          "Gov-Client-Window-Size": "width=1280&height=1446",
          "x-request-id": "f0d6aca7-4988-4294-8f87-f6e9ea302f17",
          "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
          "x-correlationid": "f0d6aca7-4988-4294-8f87-f6e9ea302f17"
        }
      },
      "httpResponse": {
        "statusCode": 200,
        "headers": {
          "cache-control": "no-cache,no-store,max-age=0",
          "connection": "keep-alive",
          "content-length": "260",
          "content-security-policy": "default-src 'self'",
          "content-type": "application/json",
          "date": "Tue, 10 Feb 2026 02:52:34 GMT",
          "strict-transport-security": "max-age=31536000;",
          "vary": "Origin",
          "via": "1.1 5de8e1b8ff157c8e7c046988c3bfc570.cloudfront.net (CloudFront)",
          "x-amz-cf-id": "RClRg0mvhXuN0y0d8ueouNqaipEf3am5c_pg57pFpp_AtHhq4-9NpQ==",
          "x-amz-cf-pop": "HEL51-P6",
          "x-cache": "Miss from cloudfront",
          "x-content-type-options": "nosniff",
          "x-envoy-upstream-service-time": "17",
          "x-frame-options": "SAMEORIGIN"
        },
        "body": {
          "specVersion": "3.3",
          "code": "***MASKED***",
          "message": "All headers required for your connection method have been supplied and all appear to be valid. Validation is based on a single request. We have access to all requests and can draw additional conclusions."
        }
      },
      "duration": 271,
      "createdAt": "2026-02-10T02:52:34.466Z",
      "ttl": 1773111154,
      "ttl_datestamp": "2026-03-10T02:52:34.466Z"
    },
    {
      "hashedSub": "5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0",
      "id": "hmrcreq-7fdfa5e5-8c54-4b13-becb-d587abca3b4d",
      "requestId": "f0d6aca7-4988-4294-8f87-f6e9ea302f17",
      "amznTraceId": null,
      "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
      "url": "https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate",
      "method": "GET",
      "httpRequest": {
        "method": "GET",
        "headers": {
          "Accept": "application/vnd.hmrc.1.0+json",
          "Authorization": "***MASKED***",
          "Gov-Client-Public-IP": "79.127.150.148",
          "Gov-Client-Public-Port": "50244",
          "Gov-Client-Device-ID": "b8334b2f-9564-48f1-9daf-75366eb33d42",
          "Gov-Client-User-IDs": "cognito=user",
          "Gov-Client-Connection-Method": "WEB_APP_VIA_SERVER",
          "Gov-Vendor-Public-IP": "79.127.150.148",
          "Gov-Vendor-Forwarded": "by=79.127.150.148&for=79.127.150.148",
          "Gov-Vendor-License-IDs": "diyaccounting=3a093931bec9c77161612725f94afabcdf2c028fa978ef42d9eb6bd443083da5",
          "Gov-Vendor-Product-Name": "web-submit-diyaccounting-co-uk",
          "Gov-Vendor-Version": "web-submit-diyaccounting-co-uk=1.0.0",
          "Gov-Client-Browser-JS-User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36",
          "Gov-Client-Multi-Factor": "type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770691914247",
          "Gov-Client-Public-IP-Timestamp": "2026-02-10T02:52:33.210Z",
          "Gov-Client-Screens": "width=1280&height=1446&colour-depth=24&scaling-factor=1",
          "Gov-Client-Timezone": "UTC+01:00",
          "Gov-Client-Window-Size": "width=1280&height=1446",
          "x-request-id": "f0d6aca7-4988-4294-8f87-f6e9ea302f17",
          "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
          "x-correlationid": "f0d6aca7-4988-4294-8f87-f6e9ea302f17"
        }
      },
      "httpResponse": {
        "statusCode": 200,
        "headers": {
          "cache-control": "no-cache,no-store,max-age=0",
          "connection": "keep-alive",
          "content-length": "260",
          "content-security-policy": "default-src 'self'",
          "content-type": "application/json",
          "date": "Tue, 10 Feb 2026 02:52:35 GMT",
          "strict-transport-security": "max-age=31536000;",
          "vary": "Origin",
          "via": "1.1 5de8e1b8ff157c8e7c046988c3bfc570.cloudfront.net (CloudFront)",
          "x-amz-cf-id": "RdlFBe5sd1NNPFU4mGFGZ1Zs-5sSngYo1IdGTK1aemsLV3MaBAXj8g==",
          "x-amz-cf-pop": "HEL51-P6",
          "x-cache": "Miss from cloudfront",
          "x-content-type-options": "nosniff",
          "x-envoy-upstream-service-time": "18",
          "x-frame-options": "SAMEORIGIN"
        },
        "body": {
          "specVersion": "3.3",
          "code": "***MASKED***",
          "message": "All headers required for your connection method have been supplied and all appear to be valid. Validation is based on a single request. We have access to all requests and can draw additional conclusions."
        }
      },
      "duration": 249,
      "createdAt": "2026-02-10T02:52:35.679Z",
      "ttl": 1773111155,
      "ttl_datestamp": "2026-03-10T02:52:35.679Z"
    },
    {
      "hashedSub": "5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0",
      "id": "hmrcreq-874cd189-bc6e-410f-b146-0df8350cdec8",
      "requestId": "2df53258-9eae-4ab5-bd42-f7e874903042",
      "amznTraceId": null,
      "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
      "url": "https://test-api.service.hmrc.gov.uk/oauth/token",
      "method": "POST",
      "httpRequest": {
        "method": "POST",
        "headers": {
          "Content-Type": "application/x-www-form-urlencoded",
          "x-request-id": "2df53258-9eae-4ab5-bd42-f7e874903042",
          "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
          "x-correlationid": "2df53258-9eae-4ab5-bd42-f7e874903042"
        },
        "body": "grant_type=authorization_code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&client_secret=***MASKED***&redirect_uri=https%3A%2F%2Fwanted-finally-anteater.ngrok-free.app%2Factivities%2FsubmitVatCallback.html&code=***MASKED***"
      },
      "httpResponse": {
        "statusCode": 200,
        "headers": {
          "cache-control": "no-cache,no-store,max-age=0",
          "connection": "keep-alive",
          "content-length": "172",
          "content-security-policy": "default-src 'self'",
          "content-type": "application/json",
          "date": "Tue, 10 Feb 2026 02:52:32 GMT",
          "strict-transport-security": "max-age=31536000;",
          "via": "1.1 5de8e1b8ff157c8e7c046988c3bfc570.cloudfront.net (CloudFront)",
          "x-amz-cf-id": "kuI0nRG0lc6_CoxTJetA6BLeXyBNMRBOCGtBrsGNyRKM9ROxl51c1w==",
          "x-amz-cf-pop": "HEL51-P6",
          "x-cache": "Miss from cloudfront",
          "x-content-type-options": "nosniff",
          "x-envoy-upstream-service-time": "54",
          "x-frame-options": "SAMEORIGIN"
        },
        "body": {
          "access_token": "***MASKED***",
          "refresh_token": "***MASKED***",
          "expires_in": 14400,
          "scope": "write:vat read:vat",
          "token_type": "bearer"
        }
      },
      "duration": 403,
      "createdAt": "2026-02-10T02:52:32.098Z",
      "ttl": 1773111152,
      "ttl_datestamp": "2026-03-10T02:52:32.098Z"
    },
    {
      "hashedSub": "5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0",
      "id": "hmrcreq-a49fe957-e048-4ef5-bea0-0c6f671fb29a",
      "requestId": "e1b295f7-246b-4c36-a16b-2bf25c41b013",
      "amznTraceId": null,
      "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
      "url": "https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate",
      "method": "GET",
      "httpRequest": {
        "method": "GET",
        "headers": {
          "Accept": "application/vnd.hmrc.1.0+json",
          "Authorization": "***MASKED***",
          "Gov-Client-Public-IP": "79.127.150.148",
          "Gov-Client-Public-Port": "50244",
          "Gov-Client-Device-ID": "e84c10eb-f10c-454f-b7b0-8b2e079331b7",
          "Gov-Client-User-IDs": "cognito=user",
          "Gov-Client-Connection-Method": "WEB_APP_VIA_SERVER",
          "Gov-Vendor-Public-IP": "79.127.150.148",
          "Gov-Vendor-Forwarded": "by=79.127.150.148&for=79.127.150.148",
          "Gov-Vendor-License-IDs": "diyaccounting=3a093931bec9c77161612725f94afabcdf2c028fa978ef42d9eb6bd443083da5",
          "Gov-Vendor-Product-Name": "web-submit-diyaccounting-co-uk",
          "Gov-Vendor-Version": "web-submit-diyaccounting-co-uk=1.0.0",
          "Gov-Client-Browser-JS-User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36",
          "Gov-Client-Multi-Factor": "type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770691914247",
          "Gov-Client-Public-IP-Timestamp": "2026-02-10T02:52:50.412Z",
          "Gov-Client-Screens": "width=1280&height=1446&colour-depth=24&scaling-factor=1",
          "Gov-Client-Timezone": "UTC+01:00",
          "Gov-Client-Window-Size": "width=1280&height=1446",
          "x-request-id": "e1b295f7-246b-4c36-a16b-2bf25c41b013",
          "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
          "x-correlationid": "e1b295f7-246b-4c36-a16b-2bf25c41b013"
        }
      },
      "httpResponse": {
        "statusCode": 200,
        "headers": {
          "cache-control": "no-cache,no-store,max-age=0",
          "connection": "keep-alive",
          "content-length": "260",
          "content-security-policy": "default-src 'self'",
          "content-type": "application/json",
          "date": "Tue, 10 Feb 2026 02:52:51 GMT",
          "strict-transport-security": "max-age=31536000;",
          "vary": "Origin",
          "via": "1.1 75ea87635ae42d05aa36370295c11dc0.cloudfront.net (CloudFront)",
          "x-amz-cf-id": "v_S8bRUYWgSCTEbPSx6EFDojkyCY4p2g6ekMsKLEqa9GOJMYx4Ee0Q==",
          "x-amz-cf-pop": "HEL51-P6",
          "x-cache": "Miss from cloudfront",
          "x-content-type-options": "nosniff",
          "x-envoy-upstream-service-time": "22",
          "x-frame-options": "SAMEORIGIN"
        },
        "body": {
          "specVersion": "3.3",
          "code": "***MASKED***",
          "message": "All headers required for your connection method have been supplied and all appear to be valid. Validation is based on a single request. We have access to all requests and can draw additional conclusions."
        }
      },
      "duration": 223,
      "createdAt": "2026-02-10T02:52:51.452Z",
      "ttl": 1773111171,
      "ttl_datestamp": "2026-03-10T02:52:51.452Z"
    },
    {
      "hashedSub": "5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0",
      "id": "hmrcreq-c0baa664-a9bc-416f-a6a2-614f0ae56820",
      "requestId": "03d138b5-d91a-4b72-8a0a-1b2b4c25b8e1",
      "amznTraceId": null,
      "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
      "url": "https://test-api.service.hmrc.gov.uk/organisations/vat/157567529/obligations?from=2025-01-01&to=2025-12-01",
      "method": "GET",
      "httpRequest": {
        "method": "GET",
        "headers": {
          "Content-Type": "application/json",
          "Accept": "application/vnd.hmrc.1.0+json",
          "Authorization": "***MASKED***",
          "x-request-id": "03d138b5-d91a-4b72-8a0a-1b2b4c25b8e1",
          "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
          "x-correlationid": "03d138b5-d91a-4b72-8a0a-1b2b4c25b8e1",
          "Gov-Client-Public-IP": "79.127.150.148",
          "Gov-Client-Public-Port": "50315",
          "Gov-Client-Device-ID": "1bbdd317-8cd3-4770-8842-9ec5e145e0c5",
          "Gov-Client-User-IDs": "cognito=user",
          "Gov-Client-Connection-Method": "WEB_APP_VIA_SERVER",
          "Gov-Vendor-Public-IP": "79.127.150.148",
          "Gov-Vendor-Forwarded": "by=79.127.150.148&for=79.127.150.148",
          "Gov-Vendor-License-IDs": "diyaccounting=3a093931bec9c77161612725f94afabcdf2c028fa978ef42d9eb6bd443083da5",
          "Gov-Vendor-Product-Name": "web-submit-diyaccounting-co-uk",
          "Gov-Vendor-Version": "web-submit-diyaccounting-co-uk=1.0.0",
          "Gov-Client-Browser-JS-User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36",
          "Gov-Client-Multi-Factor": "type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770691914247",
          "Gov-Client-Public-IP-Timestamp": "2026-02-10T02:53:05.499Z",
          "Gov-Client-Screens": "width=1280&height=1446&colour-depth=24&scaling-factor=1",
          "Gov-Client-Timezone": "UTC+01:00",
          "Gov-Client-Window-Size": "width=1280&height=1446"
        }
      },
      "httpResponse": {
        "statusCode": 200,
        "headers": {
          "cache-control": "no-cache,no-store,max-age=0",
          "connection": "keep-alive",
          "content-length": "227",
          "content-security-policy": "default-src 'self'",
          "content-type": "application/json",
          "date": "Tue, 10 Feb 2026 02:53:06 GMT",
          "strict-transport-security": "max-age=31536000;",
          "vary": "Origin",
          "via": "1.1 e1226569e4a7c4c1eedba106ad846b1c.cloudfront.net (CloudFront)",
          "x-amz-cf-id": "HE9TcHx_PqRZ7VJ_OcYLfs8OiJmIH-AmuOhbvn07hGT0RSq6BAh6fw==",
          "x-amz-cf-pop": "HEL51-P6",
          "x-cache": "Miss from cloudfront",
          "x-content-type-options": "nosniff, nosniff",
          "x-correlationid": "dcc0a4b7-5108-4fb3-aaaa-4754e447f461",
          "x-envoy-upstream-service-time": "21",
          "x-frame-options": "SAMEORIGIN"
        },
        "body": {
          "obligations": [
            {
              "periodKey": "18A1",
              "start": "2017-01-01",
              "end": "2017-03-31",
              "due": "2017-05-07",
              "status": "F",
              "received": "2017-05-06"
            },
            {
              "periodKey": "18A2",
              "start": "2017-04-01",
              "end": "2017-06-30",
              "due": "2017-08-07",
              "status": "O"
            }
          ]
        }
      },
      "duration": 538,
      "createdAt": "2026-02-10T02:53:06.160Z",
      "ttl": 1773111186,
      "ttl_datestamp": "2026-03-10T02:53:06.160Z"
    },
    {
      "hashedSub": "5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0",
      "id": "hmrcreq-c33bb896-41ed-4967-b3d4-4e9a06b6b1e7",
      "requestId": "f0d6aca7-4988-4294-8f87-f6e9ea302f17",
      "amznTraceId": null,
      "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
      "url": "https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate",
      "method": "GET",
      "httpRequest": {
        "method": "GET",
        "headers": {
          "Accept": "application/vnd.hmrc.1.0+json",
          "Authorization": "***MASKED***",
          "Gov-Client-Public-IP": "79.127.150.148",
          "Gov-Client-Public-Port": "50244",
          "Gov-Client-Device-ID": "b8334b2f-9564-48f1-9daf-75366eb33d42",
          "Gov-Client-User-IDs": "cognito=user",
          "Gov-Client-Connection-Method": "WEB_APP_VIA_SERVER",
          "Gov-Vendor-Public-IP": "79.127.150.148",
          "Gov-Vendor-Forwarded": "by=79.127.150.148&for=79.127.150.148",
          "Gov-Vendor-License-IDs": "diyaccounting=3a093931bec9c77161612725f94afabcdf2c028fa978ef42d9eb6bd443083da5",
          "Gov-Vendor-Product-Name": "web-submit-diyaccounting-co-uk",
          "Gov-Vendor-Version": "web-submit-diyaccounting-co-uk=1.0.0",
          "Gov-Client-Browser-JS-User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36",
          "Gov-Client-Multi-Factor": "type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770691914247",
          "Gov-Client-Public-IP-Timestamp": "2026-02-10T02:52:33.210Z",
          "Gov-Client-Screens": "width=1280&height=1446&colour-depth=24&scaling-factor=1",
          "Gov-Client-Timezone": "UTC+01:00",
          "Gov-Client-Window-Size": "width=1280&height=1446",
          "x-request-id": "f0d6aca7-4988-4294-8f87-f6e9ea302f17",
          "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
          "x-correlationid": "f0d6aca7-4988-4294-8f87-f6e9ea302f17"
        }
      },
      "httpResponse": {
        "statusCode": 200,
        "headers": {
          "cache-control": "no-cache,no-store,max-age=0",
          "connection": "keep-alive",
          "content-length": "260",
          "content-security-policy": "default-src 'self'",
          "content-type": "application/json",
          "date": "Tue, 10 Feb 2026 02:52:33 GMT",
          "strict-transport-security": "max-age=31536000;",
          "vary": "Origin",
          "via": "1.1 5de8e1b8ff157c8e7c046988c3bfc570.cloudfront.net (CloudFront)",
          "x-amz-cf-id": "mg2BGGD-kLiQ0EBiQWq58UZh1EXb07HwJEO5-j6xF8-iWa-cyAiqaA==",
          "x-amz-cf-pop": "HEL51-P6",
          "x-cache": "Miss from cloudfront",
          "x-content-type-options": "nosniff",
          "x-envoy-upstream-service-time": "20",
          "x-frame-options": "SAMEORIGIN"
        },
        "body": {
          "specVersion": "3.3",
          "code": "***MASKED***",
          "message": "All headers required for your connection method have been supplied and all appear to be valid. Validation is based on a single request. We have access to all requests and can draw additional conclusions."
        }
      },
      "duration": 199,
      "createdAt": "2026-02-10T02:52:33.982Z",
      "ttl": 1773111153,
      "ttl_datestamp": "2026-03-10T02:52:33.982Z"
    },
    {
      "hashedSub": "5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0",
      "id": "hmrcreq-d69cf203-6f3d-4193-993c-328716a9735e",
      "requestId": "f0d6aca7-4988-4294-8f87-f6e9ea302f17",
      "amznTraceId": null,
      "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
      "url": "https://test-api.service.hmrc.gov.uk/organisations/vat/157567529/obligations?from=2017-01-01&to=2017-03-31&status=O",
      "method": "GET",
      "httpRequest": {
        "method": "GET",
        "headers": {
          "Content-Type": "application/json",
          "Accept": "application/vnd.hmrc.1.0+json",
          "Authorization": "***MASKED***",
          "x-request-id": "f0d6aca7-4988-4294-8f87-f6e9ea302f17",
          "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
          "x-correlationid": "f0d6aca7-4988-4294-8f87-f6e9ea302f17",
          "Gov-Client-Public-IP": "79.127.150.148",
          "Gov-Client-Public-Port": "50244",
          "Gov-Client-Device-ID": "b8334b2f-9564-48f1-9daf-75366eb33d42",
          "Gov-Client-User-IDs": "cognito=user",
          "Gov-Client-Connection-Method": "WEB_APP_VIA_SERVER",
          "Gov-Vendor-Public-IP": "79.127.150.148",
          "Gov-Vendor-Forwarded": "by=79.127.150.148&for=79.127.150.148",
          "Gov-Vendor-License-IDs": "diyaccounting=3a093931bec9c77161612725f94afabcdf2c028fa978ef42d9eb6bd443083da5",
          "Gov-Vendor-Product-Name": "web-submit-diyaccounting-co-uk",
          "Gov-Vendor-Version": "web-submit-diyaccounting-co-uk=1.0.0",
          "Gov-Client-Browser-JS-User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36",
          "Gov-Client-Multi-Factor": "type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770691914247",
          "Gov-Client-Public-IP-Timestamp": "2026-02-10T02:52:33.210Z",
          "Gov-Client-Screens": "width=1280&height=1446&colour-depth=24&scaling-factor=1",
          "Gov-Client-Timezone": "UTC+01:00",
          "Gov-Client-Window-Size": "width=1280&height=1446"
        }
      },
      "httpResponse": {
        "statusCode": 200,
        "headers": {
          "cache-control": "no-cache,no-store,max-age=0",
          "connection": "keep-alive",
          "content-length": "110",
          "content-security-policy": "default-src 'self'",
          "content-type": "application/json",
          "date": "Tue, 10 Feb 2026 02:52:34 GMT",
          "strict-transport-security": "max-age=31536000;",
          "vary": "Origin",
          "via": "1.1 5de8e1b8ff157c8e7c046988c3bfc570.cloudfront.net (CloudFront)",
          "x-amz-cf-id": "gIFWsNfZDO8hWYoZQsaHXG-LhLRn3wXuvw3unvl7p1cqLSb_EFtU-w==",
          "x-amz-cf-pop": "HEL51-P6",
          "x-cache": "Miss from cloudfront",
          "x-content-type-options": "nosniff, nosniff",
          "x-correlationid": "c82aa0f1-69a8-4767-b505-28d7ef6f2367",
          "x-envoy-upstream-service-time": "17",
          "x-frame-options": "SAMEORIGIN"
        },
        "body": {
          "obligations": [
            {
              "periodKey": "18A1",
              "start": "2017-01-01",
              "end": "2017-03-31",
              "due": "2017-05-07",
              "status": "O"
            }
          ]
        }
      },
      "duration": 196,
      "createdAt": "2026-02-10T02:52:34.183Z",
      "ttl": 1773111154,
      "ttl_datestamp": "2026-03-10T02:52:34.183Z"
    },
    {
      "hashedSub": "5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0",
      "id": "hmrcreq-e9440f4b-9147-4b53-87d7-b0265790dc64",
      "requestId": "f0d6aca7-4988-4294-8f87-f6e9ea302f17",
      "amznTraceId": null,
      "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
      "url": "https://test-api.service.hmrc.gov.uk/organisations/vat/157567529/obligations?from=2017-01-01&to=2017-03-31&status=O",
      "method": "GET",
      "httpRequest": {
        "method": "GET",
        "headers": {
          "Content-Type": "application/json",
          "Accept": "application/vnd.hmrc.1.0+json",
          "Authorization": "***MASKED***",
          "x-request-id": "f0d6aca7-4988-4294-8f87-f6e9ea302f17",
          "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
          "x-correlationid": "f0d6aca7-4988-4294-8f87-f6e9ea302f17",
          "Gov-Client-Public-IP": "79.127.150.148",
          "Gov-Client-Public-Port": "50244",
          "Gov-Client-Device-ID": "b8334b2f-9564-48f1-9daf-75366eb33d42",
          "Gov-Client-User-IDs": "cognito=user",
          "Gov-Client-Connection-Method": "WEB_APP_VIA_SERVER",
          "Gov-Vendor-Public-IP": "79.127.150.148",
          "Gov-Vendor-Forwarded": "by=79.127.150.148&for=79.127.150.148",
          "Gov-Vendor-License-IDs": "diyaccounting=3a093931bec9c77161612725f94afabcdf2c028fa978ef42d9eb6bd443083da5",
          "Gov-Vendor-Product-Name": "web-submit-diyaccounting-co-uk",
          "Gov-Vendor-Version": "web-submit-diyaccounting-co-uk=1.0.0",
          "Gov-Client-Browser-JS-User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36",
          "Gov-Client-Multi-Factor": "type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770691914247",
          "Gov-Client-Public-IP-Timestamp": "2026-02-10T02:52:33.210Z",
          "Gov-Client-Screens": "width=1280&height=1446&colour-depth=24&scaling-factor=1",
          "Gov-Client-Timezone": "UTC+01:00",
          "Gov-Client-Window-Size": "width=1280&height=1446"
        }
      },
      "httpResponse": {
        "statusCode": 200,
        "headers": {
          "cache-control": "no-cache,no-store,max-age=0",
          "connection": "keep-alive",
          "content-length": "110",
          "content-security-policy": "default-src 'self'",
          "content-type": "application/json",
          "date": "Tue, 10 Feb 2026 02:52:35 GMT",
          "strict-transport-security": "max-age=31536000;",
          "vary": "Origin",
          "via": "1.1 5de8e1b8ff157c8e7c046988c3bfc570.cloudfront.net (CloudFront)",
          "x-amz-cf-id": "fMvgR0xJdczLDcf8M5hlLONmRLKSW43kyywXUTBs6fA1O-scziO-BA==",
          "x-amz-cf-pop": "HEL51-P6",
          "x-cache": "Miss from cloudfront",
          "x-content-type-options": "nosniff, nosniff",
          "x-correlationid": "cb7cf821-a3bc-408e-bb52-c5e07c048f2a",
          "x-envoy-upstream-service-time": "16",
          "x-frame-options": "SAMEORIGIN"
        },
        "body": {
          "obligations": [
            {
              "periodKey": "18A1",
              "start": "2017-01-01",
              "end": "2017-03-31",
              "due": "2017-05-07",
              "status": "O"
            }
          ]
        }
      },
      "duration": 265,
      "createdAt": "2026-02-10T02:52:35.948Z",
      "ttl": 1773111155,
      "ttl_datestamp": "2026-03-10T02:52:35.948Z"
    },
    {
      "hashedSub": "5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0",
      "id": "hmrcreq-efdaf98f-bd63-4521-a5b5-a4842ed34b84",
      "requestId": "e1b295f7-246b-4c36-a16b-2bf25c41b013",
      "amznTraceId": null,
      "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
      "url": "https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate",
      "method": "GET",
      "httpRequest": {
        "method": "GET",
        "headers": {
          "Accept": "application/vnd.hmrc.1.0+json",
          "Authorization": "***MASKED***",
          "Gov-Client-Public-IP": "79.127.150.148",
          "Gov-Client-Public-Port": "50244",
          "Gov-Client-Device-ID": "e84c10eb-f10c-454f-b7b0-8b2e079331b7",
          "Gov-Client-User-IDs": "cognito=user",
          "Gov-Client-Connection-Method": "WEB_APP_VIA_SERVER",
          "Gov-Vendor-Public-IP": "79.127.150.148",
          "Gov-Vendor-Forwarded": "by=79.127.150.148&for=79.127.150.148",
          "Gov-Vendor-License-IDs": "diyaccounting=3a093931bec9c77161612725f94afabcdf2c028fa978ef42d9eb6bd443083da5",
          "Gov-Vendor-Product-Name": "web-submit-diyaccounting-co-uk",
          "Gov-Vendor-Version": "web-submit-diyaccounting-co-uk=1.0.0",
          "Gov-Client-Browser-JS-User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/145.0.7632.6 Safari/537.36",
          "Gov-Client-Multi-Factor": "type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1770691914247",
          "Gov-Client-Public-IP-Timestamp": "2026-02-10T02:52:50.412Z",
          "Gov-Client-Screens": "width=1280&height=1446&colour-depth=24&scaling-factor=1",
          "Gov-Client-Timezone": "UTC+01:00",
          "Gov-Client-Window-Size": "width=1280&height=1446",
          "x-request-id": "e1b295f7-246b-4c36-a16b-2bf25c41b013",
          "traceparent": "00-f3ab53edcef9d91c29f71765e06d00a5-aef9c44fb0d56760-01",
          "x-correlationid": "e1b295f7-246b-4c36-a16b-2bf25c41b013"
        }
      },
      "httpResponse": {
        "statusCode": 200,
        "headers": {
          "cache-control": "no-cache,no-store,max-age=0",
          "connection": "keep-alive",
          "content-length": "260",
          "content-security-policy": "default-src 'self'",
          "content-type": "application/json",
          "date": "Tue, 10 Feb 2026 02:52:51 GMT",
          "strict-transport-security": "max-age=31536000;",
          "vary": "Origin",
          "via": "1.1 75ea87635ae42d05aa36370295c11dc0.cloudfront.net (CloudFront)",
          "x-amz-cf-id": "XISfY5bUFoi6WZ_B0IxpZ6i8KKhN4F2kP5S2zOg_YKsMbhpd-dWbuQ==",
          "x-amz-cf-pop": "HEL51-P6",
          "x-cache": "Miss from cloudfront",
          "x-content-type-options": "nosniff",
          "x-envoy-upstream-service-time": "17",
          "x-frame-options": "SAMEORIGIN"
        },
        "body": {
          "specVersion": "3.3",
          "code": "***MASKED***",
          "message": "All headers required for your connection method have been supplied and all appear to be valid. Validation is based on a single request. We have access to all requests and can draw additional conclusions."
        }
      },
      "duration": 454,
      "createdAt": "2026-02-10T02:52:51.022Z",
      "ttl": 1773111171,
      "ttl_datestamp": "2026-03-10T02:52:51.022Z"
    }
  ],
  "playwrightReport": {
    "exists": true,
    "status": "passed",
    "failedTests": []
  },
  "testSourceFile": {
    "filename": "behaviour-tests/submitVat.behaviour.test.js",
    "content": "// SPDX-License-Identifier: AGPL-3.0-only\n// Copyright (C) 2025-2026 DIY Accounting Ltd\n\n// behaviour-tests/submitVat.behaviour.test.js\n\nimport { test } from \"./helpers/playwrightTestWithout.js\";\nimport { expect } from \"@playwright/test\";\nimport fs from \"node:fs\";\nimport path from \"node:path\";\nimport { dotenvConfigIfNotBlank } from \"@app/lib/env.js\";\nimport {\n  addOnPageLogging,\n  createHmrcTestUser,\n  getEnvVarAndLog,\n  injectMockMfa,\n  isSandboxMode,\n  runLocalHttpServer,\n  runLocalOAuth2Server,\n  runLocalDynamoDb,\n  runLocalSslProxy,\n  saveHmrcTestUserToFiles,\n} from \"./helpers/behaviour-helpers.js\";\nimport { consentToDataCollection, goToHomePage, goToHomePageExpectNotLoggedIn, goToHomePageUsingMainNav } from \"./steps/behaviour-steps.js\";\nimport {\n  clickLogIn,\n  loginWithCognitoOrMockAuth,\n  logOutAndExpectToBeLoggedOut,\n  verifyLoggedInStatus,\n} from \"./steps/behaviour-login-steps.js\";\nimport { ensureBundlePresent, getTokensRemaining, goToBundlesPage } from \"./steps/behaviour-bundle-steps.js\";\nimport { goToReceiptsPageUsingMainNav, verifyAtLeastOneClickableReceipt } from \"./steps/behaviour-hmrc-receipts-steps.js\";\nimport { exportAllTables } from \"./helpers/dynamodb-export.js\";\nimport {\n  assertHmrcApiRequestExists,\n  assertHmrcApiRequestValues,\n  assertConsistentHashedSub,\n  readDynamoDbExport,\n  countHmrcApiRequestValues,\n  assertFraudPreventionHeaders,\n  intentionallyNotSuppliedHeaders,\n} from \"./helpers/dynamodb-assertions.js\";\nimport {\n  completeVat,\n  fillInVat,\n  fillInVatObligations,\n  fillInViewVatReturn,\n  initSubmitVat,\n  initVatObligations,\n  initViewVatReturn,\n  submitFormVat,\n  submitVatObligationsForm,\n  submitViewVatReturnForm,\n  verifyVatObligationsResults,\n  verifyVatSubmission,\n  verifyViewVatReturnResults,\n} from \"./steps/behaviour-hmrc-vat-steps.js\";\nimport {\n  acceptCookiesHmrc,\n  fillInHmrcAuth,\n  goToHmrcAuth,\n  grantPermissionHmrcAuth,\n  initHmrcAuth,\n  submitHmrcAuth,\n} from \"./steps/behaviour-hmrc-steps.js\";\nimport {\n  appendTraceparentTxt,\n  appendUserSubTxt,\n  appendHashedUserSubTxt,\n  deleteTraceparentTxt,\n  deleteUserSubTxt,\n  deleteHashedUserSubTxt,\n  extractUserSubFromLocalStorage,\n} from \"./helpers/fileHelper.js\";\n// if (!process.env.DIY_SUBMIT_ENV_FILEPATH) {\n//   dotenvConfigIfNotBlank({ path: \".env.test\" });\n// } else {\n//   console.log(`Already loaded environment from custom path: ${process.env.DIY_SUBMIT_ENV_FILEPATH}`);\n// }\ndotenvConfigIfNotBlank({ path: \".env\" }); // Not checked in, HMRC API credentials\n\nconst screenshotPath = \"target/behaviour-test-results/screenshots/submitVat-behaviour-test\";\n\nconst originalEnv = { ...process.env };\n\nconst envFilePath = getEnvVarAndLog(\"envFilePath\", \"DIY_SUBMIT_ENV_FILEPATH\", null);\nconst envName = getEnvVarAndLog(\"envName\", \"ENVIRONMENT_NAME\", \"local\");\nconst httpServerPort = getEnvVarAndLog(\"serverPort\", \"TEST_SERVER_HTTP_PORT\", 3000);\nconst runTestServer = getEnvVarAndLog(\"runTestServer\", \"TEST_SERVER_HTTP\", null);\nconst runProxy = getEnvVarAndLog(\"runProxy\", \"TEST_PROXY\", null);\nconst runMockOAuth2 = getEnvVarAndLog(\"runMockOAuth2\", \"TEST_MOCK_OAUTH2\", null);\nconst testAuthProvider = getEnvVarAndLog(\"testAuthProvider\", \"TEST_AUTH_PROVIDER\", null);\nconst testAuthUsername = getEnvVarAndLog(\"testAuthUsername\", \"TEST_AUTH_USERNAME\", null);\nconst testAuthPassword = getEnvVarAndLog(\"testAuthPassword\", \"TEST_AUTH_PASSWORD\", null);\nconst baseUrl = getEnvVarAndLog(\"baseUrl\", \"DIY_SUBMIT_BASE_URL\", null);\nconst hmrcTestUsername = getEnvVarAndLog(\"hmrcTestUsername\", \"TEST_HMRC_USERNAME\", null);\nconst hmrcTestPassword = getEnvVarAndLog(\"hmrcTestPassword\", \"TEST_HMRC_PASSWORD\", null);\nconst hmrcTestVatNumber = getEnvVarAndLog(\"hmrcTestVatNumber\", \"TEST_HMRC_VAT_NUMBER\", null);\nconst hmrcVatPeriodFromDate = \"2025-01-01\";\nconst hmrcVatPeriodToDate = \"2025-12-01\";\nconst runDynamoDb = getEnvVarAndLog(\"runDynamoDb\", \"TEST_DYNAMODB\", null);\nconst bundleTableName = getEnvVarAndLog(\"bundleTableName\", \"BUNDLE_DYNAMODB_TABLE_NAME\", null);\nconst hmrcApiRequestsTableName = getEnvVarAndLog(\"hmrcApiRequestsTableName\", \"HMRC_API_REQUESTS_DYNAMODB_TABLE_NAME\", null);\nconst receiptsTableName = getEnvVarAndLog(\"receiptsTableName\", \"RECEIPTS_DYNAMODB_TABLE_NAME\", null);\n// Enable fraud prevention header validation in sandbox mode (required for HMRC API compliance testing)\nconst runFraudPreventionHeaderValidation = isSandboxMode();\n// Enable sandbox obligation fallback - allows test to use any available open obligation if dates don't match\nconst allowSandboxObligations = isSandboxMode();\n\nconst hmrcVatDueAmount = \"1000.00\";\n// Period keys are unpredictable per HMRC documentation - they cannot be calculated, only validated.\n// Tests should capture the actual periodKey from the response and use that for subsequent calls.\n// Format validation: /^[0-9]{2}[A-Z][0-9A-Z]$/ (e.g., 18A1, 24B3, 17AC)\nconst periodKeyFormatRegex = /^[0-9]{2}[A-Z][0-9A-Z]$/;\n\nlet mockOAuth2Process;\nlet s3Endpoint;\nlet serverProcess;\nlet ngrokProcess;\nlet dynamoControl;\nlet userSub = null;\nlet observedTraceparent = null;\n// Capture the actual resolved period key from the submission response\nlet resolvedPeriodKey = null;\n\ntest.setTimeout(300_000);\n\ntest.beforeEach(async ({}, testInfo) => {\n  testInfo.annotations.push({ type: \"test-id\", description: \"web-test-local\" });\n});\n\ntest.beforeAll(async ({ page }, testInfo) => {\n  console.log(\"Starting beforeAll hook...\");\n\n  if (!envFilePath) {\n    throw new Error(\"Environment variable DIY_SUBMIT_ENV_FILEPATH is not set, assuming no environment; not attempting tests.\");\n  }\n\n  process.env = {\n    ...originalEnv,\n  };\n\n  // Run servers needed for the test\n  dynamoControl = await runLocalDynamoDb(runDynamoDb, bundleTableName, hmrcApiRequestsTableName, receiptsTableName);\n  mockOAuth2Process = await runLocalOAuth2Server(runMockOAuth2);\n  serverProcess = await runLocalHttpServer(runTestServer, httpServerPort);\n  ngrokProcess = await runLocalSslProxy(runProxy, httpServerPort, baseUrl);\n\n  // Clean up any existing artefacts from previous test runs\n  const outputDir = testInfo.outputPath(\"\");\n  fs.mkdirSync(outputDir, { recursive: true });\n  deleteUserSubTxt(outputDir);\n  deleteHashedUserSubTxt(outputDir);\n  deleteTraceparentTxt(outputDir);\n\n  console.log(\"beforeAll hook completed successfully\");\n});\n\ntest.afterAll(async () => {\n  // Shutdown local servers at end of test\n  if (ngrokProcess) {\n    ngrokProcess.kill();\n  }\n  if (serverProcess) {\n    serverProcess.kill();\n  }\n  if (mockOAuth2Process) {\n    mockOAuth2Process.kill();\n  }\n  try {\n    await dynamoControl?.stop?.();\n  } catch {}\n});\n\ntest.afterEach(async ({ page }, testInfo) => {\n  const outputDir = testInfo.outputPath(\"\");\n  fs.mkdirSync(outputDir, { recursive: true });\n  appendUserSubTxt(outputDir, testInfo, userSub);\n  await appendHashedUserSubTxt(outputDir, testInfo, userSub);\n  appendTraceparentTxt(outputDir, testInfo, observedTraceparent);\n});\n\ntest(\"Click through: Submit a VAT return to HMRC\", async ({ page }, testInfo) => {\n  // Compute test URL based on which servers are running\n  const testUrl =\n    (runTestServer === \"run\" || runTestServer === \"useExisting\") && runProxy !== \"run\" && runProxy !== \"useExisting\"\n      ? `http://127.0.0.1:${httpServerPort}/`\n      : baseUrl;\n\n  // Add console logging to capture browser messages\n  addOnPageLogging(page);\n\n  // ---------- Test artefacts (video-adjacent) ----------\n  const outputDir = testInfo.outputPath(\"\");\n  fs.mkdirSync(outputDir, { recursive: true });\n\n  // Capture the first traceparent header observed in any API response\n  // Also capture the resolved periodKey from the VAT return submission response\n  page.on(\"response\", async (response) => {\n    try {\n      const url = response.url();\n\n      // Capture traceparent header\n      if (!observedTraceparent) {\n        const headers = response.headers?.() ?? {};\n        const h = typeof headers === \"function\" ? headers() : headers;\n        const tp = (h && (h[\"traceparent\"] || h[\"Traceparent\"])) || null;\n        if (tp) {\n          observedTraceparent = tp;\n        }\n      }\n\n      // Capture periodKey from VAT return submission response\n      // The backend returns the resolved periodKey at data.periodKey level\n      if (!resolvedPeriodKey && url.includes(\"/api/v1/hmrc/vat/return\") && response.status() === 200) {\n        try {\n          const body = await response.json();\n          // The periodKey is returned at data.periodKey (resolved from obligations by the backend)\n          const pk = body?.data?.periodKey || body?.periodKey;\n          if (pk && periodKeyFormatRegex.test(pk)) {\n            resolvedPeriodKey = pk;\n            console.log(`[Test] Captured resolved periodKey from response: ${resolvedPeriodKey}`);\n          }\n        } catch (_jsonErr) {\n          // Response may not be JSON or may have been consumed\n        }\n      }\n    } catch (_e) {\n      // ignore header/body parsing errors\n    }\n  });\n\n  /* ************************* */\n  /* HMRC TEST USER CREATION   */\n  /* ************************* */\n\n  // Variables to hold test credentials (either from env or generated)\n  let testUsername = hmrcTestUsername;\n  let testPassword = hmrcTestPassword;\n  let testVatNumber = hmrcTestVatNumber;\n\n  // If in sandbox mode and credentials are not provided, create a test user\n  if (!hmrcTestUsername) {\n    console.log(\"[HMRC Test User] Sandbox mode detected without full credentials - creating test user\");\n\n    const hmrcClientId = process.env.HMRC_SANDBOX_CLIENT_ID || process.env.HMRC_CLIENT_ID;\n    const hmrcClientSecret = process.env.HMRC_SANDBOX_CLIENT_SECRET || process.env.HMRC_CLIENT_SECRET;\n\n    if (!hmrcClientId) {\n      console.error(\"[HMRC Test User] No HMRC client ID found in environment. Cannot create test user.\");\n      throw new Error(\"HMRC_SANDBOX_CLIENT_ID or HMRC_CLIENT_ID is required to create test users\");\n    }\n\n    if (!hmrcClientSecret) {\n      console.error(\"[HMRC Test User] No HMRC client secret found in environment. Cannot create test user.\");\n      throw new Error(\"HMRC_SANDBOX_CLIENT_SECRET or HMRC_CLIENT_SECRET is required to create test users\");\n    }\n\n    console.log(\"[HMRC Test User] Creating HMRC sandbox test user with VAT enrolment using client credentials\");\n\n    const testUser = await createHmrcTestUser(hmrcClientId, hmrcClientSecret, {\n      serviceNames: [\"mtd-vat\"],\n    });\n\n    // Extract credentials from the created test user\n    testUsername = testUser.userId;\n    testPassword = testUser.password;\n    testVatNumber = testUser.vrn;\n\n    console.log(\"[HMRC Test User] Successfully created test user:\");\n    console.log(`  User ID: ${testUser.userId}`);\n    console.log(`  User Full Name: ${testUser.userFullName}`);\n    console.log(`  VAT registration number: ${testUser.vrn}`);\n    console.log(`  Organisation: ${testUser.organisationDetails?.name || \"N/A\"}`);\n\n    // Save test user details to files\n    const repoRoot = path.resolve(process.cwd());\n\n    saveHmrcTestUserToFiles(testUser, outputDir, repoRoot);\n\n    // Update environment variables for this test run\n    process.env.TEST_HMRC_USERNAME = testUsername;\n    process.env.TEST_HMRC_PASSWORD = testPassword;\n    process.env.TEST_HMRC_VAT_NUMBER = testVatNumber;\n\n    console.log(\"[HMRC Test User] Updated environment variables with generated credentials\");\n  }\n\n  /* ****** */\n  /*  HOME  */\n  /* ****** */\n\n  await goToHomePageExpectNotLoggedIn(page, testUrl, screenshotPath);\n\n  /* ************************ */\n  /*  PRIVACY & TERMS CHECKS  */\n  /* ************************ */\n\n  // Verify privacy and terms links are present on home page\n  const privacyLink = page.locator('footer a[href=\"privacy.html\"]');\n  await expect(privacyLink).toBeVisible();\n  console.log(\" [Compliance] Privacy link visible on home page\");\n\n  const termsLink = page.locator('footer a[href=\"terms.html\"]');\n  await expect(termsLink).toBeVisible();\n  console.log(\" [Compliance] Terms link visible on home page\");\n\n  /* ******* */\n  /*  LOGIN  */\n  /* ******* */\n\n  await clickLogIn(page, screenshotPath);\n  await loginWithCognitoOrMockAuth(page, testAuthProvider, testAuthUsername, screenshotPath, testAuthPassword);\n  await verifyLoggedInStatus(page, screenshotPath);\n\n  // Inject mock MFA metadata for testing Gov-Client-Multi-Factor header\n  // This simulates MFA detection from federated IdP (Google 2FA, etc.)\n  await injectMockMfa(page);\n\n  await consentToDataCollection(page, screenshotPath);\n\n  /* ********* */\n  /*  BUNDLES  */\n  /* ********* */\n\n  await goToBundlesPage(page, screenshotPath);\n  if (isSandboxMode()) {\n    await ensureBundlePresent(page, \"Test\", screenshotPath);\n  }\n  // TODO: Support testing in non-sandbox mode with production credentials\n  // if (envName !== \"prod\") {\n  //   await ensureBundlePresent(page, \"Guest\", screenshotPath);\n  //   await goToHomePage(page, screenshotPath);\n  //   await goToBundlesPage(page, screenshotPath);\n  // }\n  await goToHomePage(page, screenshotPath);\n\n  /* ************************ */\n  /*  TOKEN BALANCE (BEFORE)  */\n  /* ************************ */\n\n  const tokensBefore = isSandboxMode() ? await getTokensRemaining(page, \"test\") : null;\n  if (tokensBefore !== null) {\n    console.log(`[Token check] Tokens before submission: ${tokensBefore}`);\n    expect(tokensBefore).toBeGreaterThan(0);\n  }\n\n  /* *********** */\n  /* `SUBMIT VAT */\n  /* *********** */\n\n  await initSubmitVat(page, screenshotPath);\n  await fillInVat(\n    page,\n    testVatNumber,\n    undefined,\n    hmrcVatDueAmount,\n    null,\n    runFraudPreventionHeaderValidation,\n    screenshotPath,\n    allowSandboxObligations,\n  );\n  await submitFormVat(page, screenshotPath);\n\n  /* ************ */\n  /* `HMRC AUTH   */\n  /* ************ */\n\n  //await acceptCookiesHmrc(page, screenshotPath);\n  await goToHmrcAuth(page, screenshotPath);\n  await initHmrcAuth(page, screenshotPath);\n  await fillInHmrcAuth(page, testUsername, testPassword, screenshotPath);\n  await submitHmrcAuth(page, screenshotPath);\n  await grantPermissionHmrcAuth(page, screenshotPath);\n\n  /* ******************* */\n  /* `SUBMIT VAT RESULTS */\n  /* ******************* */\n\n  await completeVat(page, baseUrl, null, screenshotPath);\n  await verifyVatSubmission(page, null, screenshotPath);\n\n  /* *********************** */\n  /*  TOKEN BALANCE (AFTER)  */\n  /* *********************** */\n\n  if (tokensBefore !== null) {\n    const tokensAfter = await getTokensRemaining(page, \"test\");\n    console.log(`[Token check] Tokens after submission: ${tokensAfter}`);\n    expect(tokensAfter).toBe(tokensBefore - 1);\n  }\n\n  /* ********** */\n  /*  RECEIPTS  */\n  /* ********** */\n\n  await goToReceiptsPageUsingMainNav(page, screenshotPath);\n  await verifyAtLeastOneClickableReceipt(page, screenshotPath);\n  await goToHomePageUsingMainNav(page, screenshotPath);\n\n  /* ******************* */\n  /*  VIEW VAT RETURN    */\n  /* ******************* */\n\n  // View a VAT return using default dates\n  // BE FLEXIBLE: Don't rely on specific periodKeys - server resolves periodKey from dates\n  await initViewVatReturn(page, screenshotPath);\n  await fillInViewVatReturn(page, testVatNumber, undefined, null, runFraudPreventionHeaderValidation, screenshotPath);\n  await submitViewVatReturnForm(page, screenshotPath);\n\n  /* ******************* */\n  /*  VIEW VAT RESULTS   */\n  /* ******************* */\n\n  await verifyViewVatReturnResults(page, null, screenshotPath);\n  await goToHomePageUsingMainNav(page, screenshotPath);\n\n  /* ******************* */\n  /*  VIEW OBLIGATIONS   */\n  /* ******************* */\n\n  await initVatObligations(page, screenshotPath);\n  await fillInVatObligations(page, { hmrcVatNumber: testVatNumber, hmrcVatPeriodFromDate, hmrcVatPeriodToDate }, screenshotPath);\n  await submitVatObligationsForm(page, screenshotPath);\n\n  /* ************ */\n  /* `HMRC AUTH   */\n  /* ************ */\n\n  // await acceptCookiesHmrc(page, screenshotPath);\n  // await goToHmrcAuth(page, screenshotPath);\n  // await initHmrcAuth(page, screenshotPath);\n  // await fillInHmrcAuth(page, testUsername, testPassword, screenshotPath);\n  // await submitHmrcAuth(page, screenshotPath);\n  // await grantPermissionHmrcAuth(page, screenshotPath);\n\n  /* ************************** */\n  /*  VIEW OBLIGATIONS RESULTS  */\n  /* ************************** */\n\n  await verifyVatObligationsResults(page, screenshotPath);\n  await goToHomePageUsingMainNav(page, screenshotPath);\n\n  /* ****************** */\n  /*  Extract user sub  */\n  /* ****************** */\n\n  userSub = await extractUserSubFromLocalStorage(page, testInfo);\n\n  /* ********* */\n  /*  LOG OUT  */\n  /* ********* */\n\n  await logOutAndExpectToBeLoggedOut(page, screenshotPath);\n\n  /* ****************** */\n  /*  TEST CONTEXT JSON */\n  /* ****************** */\n\n  // Build test context metadata and write testContext.json next to the video\n  const testContext = {\n    testId: \"web-test-local\",\n    name: testInfo.title,\n    title: \"Submit VAT Return (HMRC: VAT Return POST)\",\n    description: \"Clicks through the app to submit a VAT return to HMRC MTD VAT API, then verifies receipt visibility and navigation.\",\n    hmrcApis: [\n      { url: \"/api/v1/hmrc/vat/return\", method: \"POST\" },\n      { url: \"/api/v1/hmrc/vat/return/:periodKey\", method: \"GET\" },\n      {\n        url: \"/api/v1/hmrc/vat/obligation\",\n        method: \"GET\",\n      },\n      { url: \"/test/fraud-prevention-headers/validate\", method: \"GET\" },\n    ],\n    env: {\n      envName,\n      baseUrl,\n      serverPort: httpServerPort,\n      runTestServer,\n      runProxy,\n      runMockOAuth2,\n      testAuthProvider,\n      testAuthUsername,\n      bundleTableName,\n      hmrcApiRequestsTableName,\n      receiptsTableName,\n      runDynamoDb,\n    },\n    testData: {\n      hmrcTestUsername: testUsername,\n      hmrcTestPassword: testPassword ? \"***MASKED***\" : \"<not provided>\", // Mask password in test context\n      hmrcTestVatNumber: testVatNumber,\n      resolvedPeriodKey, // Actual periodKey resolved from HMRC obligations\n      hmrcVatDueAmount,\n      s3Endpoint,\n      testUserGenerated: isSandboxMode() && (!hmrcTestUsername || !hmrcTestPassword || !hmrcTestVatNumber),\n      userSub,\n      observedTraceparent,\n      testUrl,\n      isSandboxMode: isSandboxMode(),\n      intentionallyNotSuppliedHeaders,\n    },\n    artefactsDir: outputDir,\n    screenshotPath,\n    testStartTime: new Date().toISOString(),\n  };\n  try {\n    fs.writeFileSync(path.join(outputDir, \"testContext.json\"), JSON.stringify(testContext, null, 2), \"utf-8\");\n  } catch (_e) {}\n\n  /* ****************** */\n  /*  FIGURES (SCREENSHOTS) */\n  /* ****************** */\n\n  // Select and copy key screenshots, then generate figures.json\n  const { selectKeyScreenshots, copyScreenshots, generateFiguresMetadata, writeFiguresJson } = await import(\"./helpers/figures-helper.js\");\n\n  const keyScreenshotPatterns = [\n    \"10.*fill.*in.*submission.*pagedown\",\n    \"02.*complete.*vat.*receipt\",\n    \"01.*submit.*hmrc.*auth\",\n    \"06.*view.*vat.*fill.*in.*filled\",\n    \"04.*view.*vat.*return.*results\",\n  ];\n\n  const screenshotDescriptions = {\n    \"10.*fill.*in.*submission.*pagedown\": \"VAT return form filled out with test data including VAT number, period key, and amount due\",\n    \"02.*complete.*vat.*receipt\": \"Successful VAT return submission confirmation showing receipt details from HMRC\",\n    \"01.*submit.*hmrc.*auth\": \"HMRC authorization page where user authenticates with HMRC\",\n    \"06.*view.*vat.*fill.*in.*filled\": \"VAT query form filled out with test data including VAT number and period key\",\n    \"04.*view.*vat.*return.*results\": \"Retrieved VAT return data showing previously submitted values\",\n  };\n\n  const selectedScreenshots = selectKeyScreenshots(screenshotPath, keyScreenshotPatterns, 5);\n  console.log(`[Figures]: Selected ${selectedScreenshots.length} key screenshots from ${screenshotPath}`);\n\n  const copiedScreenshots = copyScreenshots(screenshotPath, outputDir, selectedScreenshots);\n  console.log(`[Figures]: Copied ${copiedScreenshots.length} screenshots to ${outputDir}`);\n\n  const figures = generateFiguresMetadata(copiedScreenshots, screenshotDescriptions);\n  writeFiguresJson(outputDir, figures);\n  console.log(`[Figures]: Generated figures.json in ${outputDir}`);\n\n  /* **************** */\n  /*  EXPORT DYNAMODB */\n  /* **************** */\n\n  // Export DynamoDB tables if dynalite was used\n  if (runDynamoDb === \"run\" || runDynamoDb === \"useExisting\") {\n    console.log(\"[DynamoDB Export]: Starting export of all tables...\");\n    try {\n      const exportResults = await exportAllTables(outputDir, dynamoControl.endpoint, {\n        bundleTableName,\n        hmrcApiRequestsTableName,\n        receiptsTableName,\n      });\n      console.log(\"[DynamoDB Export]: Export completed:\", exportResults);\n    } catch (error) {\n      console.error(\"[DynamoDB Export]: Failed to export tables:\", error);\n    }\n  }\n\n  /* ********************************** */\n  /*  ASSERT DYNAMODB HMRC API REQUESTS */\n  /* ********************************** */\n\n  // Assert that HMRC API requests were logged correctly\n  if (runDynamoDb === \"run\" || runDynamoDb === \"useExisting\") {\n    const hmrcApiRequestsFile = path.join(outputDir, \"hmrc-api-requests.jsonl\");\n\n    // Assert OAuth token exchange request exists\n    const oauthRequests = assertHmrcApiRequestExists(hmrcApiRequestsFile, \"POST\", \"/oauth/token\", \"OAuth token exchange\");\n    console.log(`[DynamoDB Assertions]: Found ${oauthRequests.length} OAuth token exchange request(s)`);\n\n    // Assert VAT return POST request exists and validate key fields\n    const vatPostRequests = assertHmrcApiRequestExists(\n      hmrcApiRequestsFile,\n      \"POST\",\n      `/organisations/vat/${testVatNumber}/returns`,\n      \"VAT return submission\",\n    );\n    console.log(`[DynamoDB Assertions]: Found ${vatPostRequests.length} VAT return POST request(s)`);\n    //let http201CreatedResults = 0;\n    expect(vatPostRequests.length).toBeGreaterThan(0);\n    vatPostRequests.forEach((vatPostRequest) => {\n      const thisRequestHttp201CreatedResults = countHmrcApiRequestValues(vatPostRequest, {\n        \"httpRequest.method\": \"POST\",\n        \"httpResponse.statusCode\": 201,\n      });\n      if (thisRequestHttp201CreatedResults === 1) {\n        // Check that request body contains a valid period key format and VAT due amount\n        // periodKey is unpredictable per HMRC - only validate format, not specific value\n        const requestBody = JSON.parse(vatPostRequest.httpRequest.body);\n        expect(requestBody.periodKey, \"periodKey should match HMRC format\").toMatch(periodKeyFormatRegex);\n        expect(requestBody.vatDueSales).toBe(parseFloat(hmrcVatDueAmount));\n        console.log(`[DynamoDB Assertions]: VAT POST request body validated - periodKey format: ${requestBody.periodKey}`);\n      }\n      // Assert that the request body contains the submitted data\n      // assertHmrcApiRequestValues(vatPostRequest, {\n      //   \"httpRequest.method\": \"POST\",\n      //   \"httpResponse.statusCode\": 201,\n      // });\n      // TODO: Response code counts based on getVatObligations.behaviour.test.js\n    });\n\n    // Assert VAT return GET request exists and validate key fields\n    // BE FLEXIBLE: periodKey may differ between submission and viewing due to sandbox obligation fallback\n    // Always use regex pattern to match any valid periodKey format\n    const vatGetUrlPattern = new RegExp(`/organisations/vat/${testVatNumber}/returns/\\\\w+`);\n\n    const vatGetRequests = assertHmrcApiRequestExists(hmrcApiRequestsFile, \"GET\", vatGetUrlPattern, \"VAT return retrieval\");\n    console.log(`[DynamoDB Assertions]: Found ${vatGetRequests.length} VAT return GET request(s)`);\n\n    expect(vatGetRequests.length).toBeGreaterThan(0);\n    vatGetRequests.forEach((vatGetRequest) => {\n      const thisRequestHttp200OkResults = countHmrcApiRequestValues(vatGetRequest, {\n        \"httpRequest.method\": \"GET\",\n        \"httpResponse.statusCode\": 200,\n      });\n      if (thisRequestHttp200OkResults === 1) {\n        // Check that response body contains valid data with correct periodKey format\n        const responseBody = vatGetRequest.httpResponse.body;\n        expect(responseBody.periodKey, \"periodKey should match HMRC format\").toMatch(periodKeyFormatRegex);\n        expect(responseBody.vatDueSales).toBe(parseFloat(hmrcVatDueAmount));\n        console.log(`[DynamoDB Assertions]: VAT GET response body validated - periodKey format: ${responseBody.periodKey}`);\n      }\n      // Assert that the response contains the submitted data\n      // assertHmrcApiRequestValues(vatGetRequest, {\n      //   \"httpRequest.method\": \"GET\",\n      //   \"httpResponse.statusCode\": 200,\n      // });\n      // TODO: Response code counts based on getVatObligations.behaviour.test.js\n    });\n\n    // Assert Fraud prevention headers validation feedback GET request exists and validate key fields\n    assertFraudPreventionHeaders(hmrcApiRequestsFile, true, true, false);\n\n    // Assert consistent hashedSub across authenticated requests\n    const hashedSubs = assertConsistentHashedSub(hmrcApiRequestsFile, \"Submit VAT test\");\n    console.log(`[DynamoDB Assertions]: Found ${hashedSubs.length} unique hashedSub value(s): ${hashedSubs.join(\", \")}`);\n  }\n});\n"
  },
  "envConfig": {
    "filename": ".env.proxy",
    "content": "# .env.proxy\n#\n# Features:\n#   Proxy configuration which uses ngrok (and expects to be authenticated).\n#   HMRC Test API.\n#   DynamoDB (like) storage.\n#   Mock OAuth2 server.\nDIY_SUBMIT_ENV_FILEPATH=.env.proxy\nDOTENV_CONFIG_QUIET=true\nENVIRONMENT_NAME=proxy\nDEPLOYMENT_NAME=proxy\nDIY_SUBMIT_BASE_URL=https://wanted-finally-anteater.ngrok-free.app/\n\nLOG_TO_CONSOLE=true\nLOG_TO_FILE=true\nCLOUD_TRAIL_ENABLED=\n\n# TODO: Find a way to have a local ssl termination for proxy host\n# TODO: Switch to this to avoid the 301 redirects during testing: https://test-www.tax.service.gov.uk/oauth/authorize?response_type=code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&redirect_uri=https%3A%2F%2Fwanted-finally-anteater.ngrok-free.app%2Factivities%2FsubmitVatCallback.html&scope=read%3Avat&state=91b3946b6b544ec682b7b48dda3bb935\n# TODO: Replace usages of HMRC_BASE_URI with either the mapped or egress URL as appropriate\nHMRC_BASE_URI=https://test-api.service.hmrc.gov.uk\n# NOTE: HMRC_CLIENT_ID below is a test application credential for HMRC Sandbox API - not a production secret\nHMRC_CLIENT_ID=uqMHA6RsDGGa7h8EG2VqfqAmv4tV\nHMRC_SANDBOX_BASE_URI=https://test-api.service.hmrc.gov.uk\n# NOTE: HMRC_SANDBOX_CLIENT_ID is a test application credential for HMRC Sandbox API - not a production secret\nHMRC_SANDBOX_CLIENT_ID=uqMHA6RsDGGa7h8EG2VqfqAmv4tV\nGOOGLE_CLIENT_SECRET_ARN=\nHMRC_CLIENT_SECRET_ARN=\nHMRC_SANDBOX_CLIENT_SECRET_ARN=\nCOGNITO_USER_POOL_ID=\nCOGNITO_CLIENT_ID=\nCOGNITO_BASE_URI=\nUSER_SUB_HASH_SALT=local-development-salt-not-for-production\nBUNDLE_DYNAMODB_TABLE_NAME=test-bundle-table\nRECEIPTS_DYNAMODB_TABLE_NAME=test-receipts-table\nHMRC_API_REQUESTS_DYNAMODB_TABLE_NAME=test-hmrc-api-requests-table\nPASSES_DYNAMODB_TABLE_NAME=test-passes-table\nBUNDLE_CAPACITY_DYNAMODB_TABLE_NAME=test-bundle-capacity-table\nEMAIL_HASH_SECRET=local-development-email-hash-secret-not-for-production\nHMRC_VAT_RETURN_POST_ASYNC_REQUESTS_TABLE_NAME=test-hmrc-vat-return-post-async-requests-table\nHMRC_VAT_RETURN_GET_ASYNC_REQUESTS_TABLE_NAME=test-hmrc-vat-return-get-async-requests-table\nHMRC_VAT_OBLIGATION_GET_ASYNC_REQUESTS_TABLE_NAME=test-hmrc-vat-obligation-get-async-requests-table\nSQS_QUEUE_URL=none\n# Local DynamoDB endpoint - set by behaviour tests dynamically via AWS_ENDPOINT_URL_DYNAMODB env var\n# This value is a fallback; tests set the real ephemeral port value\nAWS_ENDPOINT_URL_DYNAMODB=\nACCESS_LOG_GROUP_RETENTION_PERIOD_DAYS=\nS3_RETAIN_RECEIPTS_BUCKET=\n\nTEST_SERVER_HTTP_PORT=3000\nTEST_SERVER_HTTP=run\nTEST_PROXY=run\nTEST_MOCK_OAUTH2=run\nTEST_AUTH_PROVIDER=mock\nTEST_AUTH_USERNAME=user\nTEST_AUTH_PASSWORD=\nTEST_DYNAMODB=run\n\nTEST_MFA_ENABLED=true\nTEST_MFA_TYPE=TOTP\nTEST_MFA_TIMESTAMP=2026-01-08T00:09:01Z\n\nTEST_BUNDLE_EXPIRY_DATE=2025-12-31\nTEST_BUNDLE_USER_LIMIT=1000\nTEST_BUNDLE_MOCK=true\nTEST_VAT_OBLIGATIONS={}\nTEST_VAT_RETURN={}\n"
  },
  "artifacts": {
    "screenshots": [
      "fill-in-submission-pagedown.png",
      "complete-vat-receipt.png",
      "submit-hmrc-auth.png",
      "view-vat-return-results.png",
      "submit-mock.png"
    ],
    "videos": [
      "video.webm"
    ],
    "figures": [
      {
        "filename": "fill-in-submission-pagedown.png",
        "order": 1,
        "description": "VAT return form filled out with test data including VAT number, period key, and amount due",
        "caption": "10 02 52 16 641791996 10 Fill In Submission Pagedown"
      },
      {
        "filename": "complete-vat-receipt.png",
        "order": 2,
        "description": "Successful VAT return submission confirmation showing receipt details from HMRC",
        "caption": "10 02 52 35 052539453 02 Complete Vat Receipt"
      },
      {
        "filename": "submit-hmrc-auth.png",
        "order": 3,
        "description": "HMRC authorization page where user authenticates with HMRC",
        "caption": "10 02 52 25 970280437 01 Submit Hmrc Auth"
      },
      {
        "filename": "view-vat-return-results.png",
        "order": 4,
        "description": "Retrieved VAT return data showing previously submitted values",
        "caption": "10 02 52 56 766204685 02 View Vat Return Results"
      },
      {
        "filename": "submit-mock.png",
        "order": 5,
        "description": "Screenshot captured during test execution",
        "caption": "10 02 51 50 631239059 01 Submit Mock"
      }
    ]
  }
}