name: set origins

on:
  workflow_call:
    inputs:
      environment:
        description: 'Target environment (binds to GitHub Environment)'
        required: true
        type: string
      originsCsv:
        description: 'Comma-separated list of app origins to serve from apex (e.g. ci-123.example.com,ci-124.example.com). Leave blank to display maintenance page.'
        required: false
        type: string
  workflow_dispatch:
    inputs:
      environment:
        description: 'Target environment (binds to GitHub Environment)'
        required: true
        type: choice
        options:
          - prod
          - ci
        default: ci
      originsCsv:
        description: 'Comma-separated list of app origins to serve from apex (e.g. ci-123.example.com,ci-124.example.com). Leave blank to display maintenance page.'
        required: false

permissions:
  id-token: write
  contents: read

env:
  ACTIONS_ROLE_ARN: 'arn:aws:iam::887764105431:role/submit-github-actions-role'
  DEPLOY_ROLE_ARN:  'arn:aws:iam::887764105431:role/submit-deployment-role'
  AWS_REGION: 'eu-west-2'

jobs:

  update-apex-origins:
    name: update apex origins
    runs-on: ubuntu-24.04
    environment: ${{ inputs.environment }}
    permissions:
      id-token: write
      contents: read
    env:
      ENVIRONMENT_NAME: ${{ inputs.environment }}
    steps:
      - name: Checkout
        uses: actions/checkout@v5

      - name: Set origins using local composite action
        uses: ./.github/actions/set-origins
        with:
          originsCsv: ${{ inputs.originsCsv }}
