
> @antonycc/web-submit-diyaccounting-co-uk@1.0.0 test:submitVatBehaviour-proxy
> npx dotenv -e .env.proxy -- npm run test:submitVatBehaviour


> @antonycc/web-submit-diyaccounting-co-uk@1.0.0 test:submitVatBehaviour
> playwright test --project=submitVatBehaviour

dotenvConfigIfNotBlank: Loading environment config from .env
dotenvConfigIfNotBlank: Loading environment config from .env
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:45.327Z","msg":"Reading CDK configuration from /Users/antony/projects/submit.diyaccounting.co.uk/cdk-application/cdk.json"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:45.328Z","msg":"CDK context:"}
dotenvConfigIfNotBlank: Loading environment config from .env
dotenvConfigIfNotBlank: Loading environment config from .env
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:45.335Z","msg":"envFilePath: .env.proxy"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:45.335Z","msg":"envName: proxy"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:45.335Z","msg":"serverPort: 3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:45.335Z","msg":"runTestServer: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:45.335Z","msg":"runProxy: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:45.335Z","msg":"runMockOAuth2: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:45.335Z","msg":"testAuthProvider: mock"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:45.336Z","msg":"testAuthUsername: user"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:45.336Z","msg":"testAuthPassword: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:45.336Z","msg":"baseUrl: https://wanted-finally-anteater.ngrok-free.app/"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:45.336Z","msg":"hmrcTestUsername: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:45.336Z","msg":"hmrcTestPassword: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:45.336Z","msg":"hmrcTestVatNumber: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:45.336Z","msg":"runDynamoDb: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:45.336Z","msg":"bundleTableName: test-bundle-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:45.336Z","msg":"hmrcApiRequestsTableName: test-hmrc-api-requests-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:45.336Z","msg":"receiptsTableName: test-receipts-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:45.336Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:45.336Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}

Running 1 test using 1 worker

dotenvConfigIfNotBlank: Loading environment config from .env
dotenvConfigIfNotBlank: Loading environment config from .env
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:46.278Z","msg":"Reading CDK configuration from /Users/antony/projects/submit.diyaccounting.co.uk/cdk-application/cdk.json"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:46.278Z","msg":"CDK context:"}
dotenvConfigIfNotBlank: Loading environment config from .env
dotenvConfigIfNotBlank: Loading environment config from .env
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.285Z","msg":"envFilePath: .env.proxy"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.285Z","msg":"envName: proxy"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.285Z","msg":"serverPort: 3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.285Z","msg":"runTestServer: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.285Z","msg":"runProxy: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.285Z","msg":"runMockOAuth2: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.285Z","msg":"testAuthProvider: mock"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.286Z","msg":"testAuthUsername: user"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.288Z","msg":"testAuthPassword: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.288Z","msg":"baseUrl: https://wanted-finally-anteater.ngrok-free.app/"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.288Z","msg":"hmrcTestUsername: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.288Z","msg":"hmrcTestPassword: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.288Z","msg":"hmrcTestVatNumber: null"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.288Z","msg":"runDynamoDb: run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.288Z","msg":"bundleTableName: test-bundle-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.288Z","msg":"hmrcApiRequestsTableName: test-hmrc-api-requests-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.288Z","msg":"receiptsTableName: test-receipts-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.288Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.288Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
Starting beforeAll hook...
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.950Z","msg":"[dynamodb]: runDynamoDb=run, bundleTableName=test-bundle-table, hmrcApiRequestsTableName=test-hmrc-api-requests-table, receiptsTableName=test-receipts-table"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.950Z","msg":"[dynamodb]: DYNAMODB_PORT not set; using ephemeral port (0)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.950Z","msg":"[dynamodb]: Starting dynalite (local DynamoDB) server..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:46.957Z","msg":"[dynamodb]: Started at http://127.0.0.1:56953"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:46.957Z","msg":"[dynamodb]: Ensuring bundle table: 'test-bundle-table' exists on endpoint 'http://127.0.0.1:56953'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:46.996Z","msg":"[dynamodb]: ℹ️ Table 'test-bundle-table' not found on endpoint 'http://127.0.0.1:56953', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:47.003Z","msg":"[dynamodb]: ✅ Created table 'test-bundle-table' on endpoint 'http://127.0.0.1:56953'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:47.003Z","msg":"[dynamodb]: Ensuring HMRC API requests table: 'test-hmrc-api-requests-table' exists on endpoint 'http://127.0.0.1:56953'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:47.010Z","msg":"[dynamodb]: ℹ️ Table 'test-hmrc-api-requests-table' not found on endpoint 'http://127.0.0.1:56953', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:47.013Z","msg":"[dynamodb]: ✅ Created table 'test-hmrc-api-requests-table' on endpoint 'http://127.0.0.1:56953'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:47.013Z","msg":"[dynamodb]: Ensuring receipts table: 'test-receipts-table' exists on endpoint 'http://127.0.0.1:56953'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:47.019Z","msg":"[dynamodb]: ℹ️ Table 'test-receipts-table' not found on endpoint 'http://127.0.0.1:56953', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:47.022Z","msg":"[dynamodb]: ✅ Created table 'test-receipts-table' on endpoint 'http://127.0.0.1:56953'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:47.022Z","msg":"[dynamodb]: Ensuring async requests table: 'test-hmrc-vat-return-post-async-requests-table' exists on endpoint 'http://127.0.0.1:56953'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:47.026Z","msg":"[dynamodb]: ℹ️ Table 'test-hmrc-vat-return-post-async-requests-table' not found on endpoint 'http://127.0.0.1:56953', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:47.028Z","msg":"[dynamodb]: ✅ Created table 'test-hmrc-vat-return-post-async-requests-table' on endpoint 'http://127.0.0.1:56953'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:47.028Z","msg":"[dynamodb]: Ensuring async requests table: 'test-hmrc-vat-return-get-async-requests-table' exists on endpoint 'http://127.0.0.1:56953'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:47.037Z","msg":"[dynamodb]: ℹ️ Table 'test-hmrc-vat-return-get-async-requests-table' not found on endpoint 'http://127.0.0.1:56953', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:47.040Z","msg":"[dynamodb]: ✅ Created table 'test-hmrc-vat-return-get-async-requests-table' on endpoint 'http://127.0.0.1:56953'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:47.040Z","msg":"[dynamodb]: Ensuring async requests table: 'test-hmrc-vat-obligation-get-async-requests-table' exists on endpoint 'http://127.0.0.1:56953'"}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:47.044Z","msg":"[dynamodb]: ℹ️ Table 'test-hmrc-vat-obligation-get-async-requests-table' not found on endpoint 'http://127.0.0.1:56953', creating..."}
{"level":30,"source":"app/bin/dynamodb.js","time":"2026-01-28T22:26:47.046Z","msg":"[dynamodb]: ✅ Created table 'test-hmrc-vat-obligation-get-async-requests-table' on endpoint 'http://127.0.0.1:56953'"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:47.047Z","msg":"[auth]: runMockOAuth2=run"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:47.047Z","msg":"[auth]: Starting mock-oauth2-server process..."}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-28T22:26:47.049Z","msg":"[auth]: Checking server readiness for... http://localhost:8080/default/debugger"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-28T22:26:47.060Z","msg":"[auth]: Starting server at http://localhost:8080/default/debugger after error TypeError: fetch failed"}
{"level":50,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-28T22:26:47.061Z","msg":"[auth]: Server check attempt 1/15 failed: fetch failed from http://localhost:8080/default/debugger"}
{"level":50,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-28T22:26:49.063Z","msg":"[auth]: Server check attempt 2/15 failed: fetch failed from http://localhost:8080/default/debugger"}
{"level":50,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-28T22:26:51.066Z","msg":"[auth]: Server check attempt 3/15 failed: fetch failed from http://localhost:8080/default/debugger"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-28T22:26:53.247Z","msg":"[auth]: Response body"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-28T22:26:53.247Z","msg":"[auth]: Server is ready! at http://localhost:8080/default/debugger"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:53.247Z","msg":"[http]: runTestServer=run, httpServerPort=3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:53.247Z","msg":"[http]: Starting server process..."}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-28T22:26:53.249Z","msg":"[http]: Checking server readiness for... http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-28T22:26:53.251Z","msg":"[http]: Starting server at http://127.0.0.1:3000 after error TypeError: fetch failed"}
{"level":50,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-28T22:26:53.251Z","msg":"[http]: Server check attempt 1/15 failed: fetch failed from http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:53.450Z","msg":"[http-stdout]: dotenvConfigIfNotBlank: Loading environment config from .env"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:53.460Z","msg":"[http-stdout]: dotenvConfigIfNotBlank: Loading environment config from .env"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:53.464Z","msg":"[http-stdout]: Mock OAuth routes registered (TEST_AUTH_PROVIDER=mock)"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:53.468Z","msg":"[http-stdout]: Listening at http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:53.468Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:53.468Z\",\"msg\":\"Listening at http://127.0.0.1:3000\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:54.257Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:54.257Z\",\"msg\":\"HTTP GET /\"}"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-28T22:26:54.264Z","msg":"[http]: Response body"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-28T22:26:54.264Z","msg":"[http]: Server is ready! at http://127.0.0.1:3000"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:54.264Z","msg":"[proxy]: runProxy=run, httpServerPort=3000, baseUrl=https://wanted-finally-anteater.ngrok-free.app/"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:54.264Z","msg":"[proxy]: Starting ngrok tunnel using @ngrok/ngrok..."}
{"level":30,"source":"app/bin/ngrok.js","time":"2026-01-28T22:26:54.264Z","msg":"[ngrok]: Starting ngrok tunnel for address: 3000, domain: wanted-finally-anteater.ngrok-free.app, pooling: true"}
{"level":30,"source":"app/bin/ngrok.js","time":"2026-01-28T22:26:54.789Z","msg":"[ngrok]: ✅ Tunnel established at https://wanted-finally-anteater.ngrok-free.app"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:54.789Z","msg":"[proxy]: Started at https://wanted-finally-anteater.ngrok-free.app"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-28T22:26:54.789Z","msg":"[proxy]: Checking server readiness for... https://wanted-finally-anteater.ngrok-free.app"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:54.982Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:54.981Z\",\"msg\":\"HTTP GET /\"}"}
{"level":30,"source":"behaviour-tests/helpers/serverHelper.js","time":"2026-01-28T22:26:55.036Z","msg":"[proxy]: Server is ready! at https://wanted-finally-anteater.ngrok-free.app"}
beforeAll hook completed successfully
[HMRC Test User] Sandbox mode detected without full credentials - creating test user
[HMRC Test User] Creating HMRC sandbox test user with VAT enrolment using client credentials
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:57.524Z","message":"[HMRC Test User Creation] Starting test user creation","url":"https://test-api.service.hmrc.gov.uk/create-test-user/organisations","serviceNames":["mtd-vat"],"hmrcClientId":"uqMHA6Rs..."}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:57.524Z","message":"[HMRC Test User Creation] Request details (pre-token)","method":"POST","url":"https://test-api.service.hmrc.gov.uk/create-test-user/organisations","body":{"serviceNames":["mtd-vat"]}}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:57.524Z","message":"[HMRC Test User Creation] Requesting OAuth2 access token","tokenUrl":"https://test-api.service.hmrc.gov.uk/oauth/token","grantType":"client_credentials"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:57.799Z","message":"[HMRC Test User Creation] Token response received","status":200,"statusText":"OK","hasAccessToken":true}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:57.799Z","message":"[HMRC Test User Creation] Request details (create-test-user)","method":"POST","url":"https://test-api.service.hmrc.gov.uk/create-test-user/organisations","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"[REDACTED]"},"body":{"serviceNames":["mtd-vat"]}}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:58.353Z","message":"[HMRC Test User Creation] Response received","status":201,"statusText":"Created","responseBody":{"userId":"413984641731","password":"[REDACTED]","userFullName":"Sidney Upton","emailAddress":"[REDACTED]","organisationDetails":{"name":"Company NFWRYB","address":{"line1":"9 Islington High Street","line2":"Oakham","postcode":"TS24 1PA"}},"individualDetails":{"firstName":"Sidney","lastName":"Upton","dateOfBirth":"1978-05-28","address":{"line1":"18 Regent Street","line2":"Thatcham","postcode":"TS2 1PA"}},"vatRegistrationDate":"2020-01-28","groupIdentifier":"229464887127","vrn":"793211922"}}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:58.354Z","message":"[HMRC Test User Creation] Test user created successfully","userId":"413984641731","userFullName":"Sidney Upton","organisationName":"Company NFWRYB"}
[HMRC Test User] Successfully created test user:
  User ID: 413984641731
  User Full Name: Sidney Upton
  VAT registration number: 793211922
  Organisation: Company NFWRYB
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:58.354Z","message":"[HMRC Test User] Saving test user details to JSON files","outputDir":"/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour","repoRoot":"/Users/antony/projects/submit.diyaccounting.co.uk"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:58.355Z","message":"[HMRC Test User] Saved test user to artifact directory","path":"/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/hmrc-test-user.json"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:58.355Z","message":"[HMRC Test User] Saved test user to repository root","path":"/Users/antony/projects/submit.diyaccounting.co.uk/hmrc-test-user.json"}
[HMRC Test User] Updated environment variables with generated credentials
Loading document...
[NAVIGATION] (1/4) Going to: https://wanted-finally-anteater.ngrok-free.app/ - Loading home page
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:58.758Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:58.758Z\",\"msg\":\"HTTP GET /\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:58.958Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:58.958Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:58.994Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:58.994Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:58.995Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:58.995Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:58.996Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:58.996Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:58.997Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:58.997Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:58.998Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:58.998Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.009Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.009Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.010Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.010Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
[BROWSER CONSOLE log]: Current activity cleared
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.121Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.121Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.122Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.121Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.124Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.124Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.125Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.124Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.125Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.125Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.126Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.126Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.153Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.153Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.154Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.154Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.154Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.154Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
[BROWSER CONSOLE log]: User is not authenticated
[BROWSER CONSOLE log]: User is not authenticated
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.247Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.247Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.248Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.248Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.249Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.249Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.341Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.341Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
Checking home page...
✅ [Compliance] Privacy link visible on home page
✅ [Compliance] Terms link visible on home page
[USER INTERACTION] Clicking: a:has-text('Log in') - Clicking login link
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.894Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.894Z\",\"msg\":\"HTTP GET /auth/login.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.981Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.981Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.981Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.981Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.986Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.986Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.986Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.986Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.987Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.987Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.988Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.988Z\",\"msg\":\"HTTP GET /images/g-logo.png\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:26:59.996Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:26:59.996Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.001Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:00.000Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.003Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:00.003Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.004Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:00.004Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.004Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:00.004Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.005Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:00.005Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.006Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:00.006Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
[BROWSER CONSOLE log]: Current activity cleared
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.124Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:00.124Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.128Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:00.127Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.129Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:00.129Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.130Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:00.130Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.131Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:00.131Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.132Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:00.132Z\",\"msg\":\"HTTP GET /auth/login-mock-addon.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.133Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:00.133Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.134Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:00.134Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.135Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:00.135Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.136Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:00.136Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
[BROWSER CONSOLE error]: Loading the image 'https://avatars.githubusercontent.com/u/11848947?s=48&v=4' violates the following Content Security Policy directive: "img-src 'self' data:". The action has been blocked.
[HTTP REQUEST FAILED] GET https://avatars.githubusercontent.com/u/11848947?s=48&v=4 - csp
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.254Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:00.254Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.258Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:00.258Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
Logging in...
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.375Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:00.374Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
[USER INTERACTION] Clicking: button:has-text('Continue with mock-oauth2-server') - Continue with OAuth provider
[BROWSER CONSOLE log]: Initiating navikt/mock-oauth2-server login
[BROWSER CONSOLE log]: Clear stored tokens and user info
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.899Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:00.899Z\",\"msg\":\"HTTP GET /api/v1/mock/authUrl?state=47b8708f454f3120ad35e3c68d5b53db\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.901Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:00.901Z\",\"requestId\":\"9ae66ed5-855f-4ac9-80f4-f7003adad426\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"9ae66ed5-855f-4ac9-80f4-f7003adad426\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/mock/authUrl?state=47b8708f454f3120ad35e3c68d5b53db\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"cognito:username\":\"test\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"scope\":\"read write\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/mock/authUrl\"}},\"path\":\"/api/v1/mock/authUrl\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/auth/login.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-request-id\":\"9ae66ed5-855f-4ac9-80f4-f7003adad426\"},\"queryStringParameters\":{\"state\":\"47b8708f454f3120ad35e3c68d5b53db\"},\"rawQueryString\":\"state=47b8708f454f3120ad35e3c68d5b53db\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.902Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/non-lambda-mocks/mockAuthUrlGet.js\",\"time\":\"2026-01-28T22:27:00.901Z\",\"requestId\":\"9ae66ed5-855f-4ac9-80f4-f7003adad426\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"9ae66ed5-855f-4ac9-80f4-f7003adad426\",\"message\":\"Generating mock authorization URL\",\"state\":\"47b8708f454f3120ad35e3c68d5b53db\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:00.902Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:00.902Z\",\"requestId\":\"9ae66ed5-855f-4ac9-80f4-f7003adad426\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"9ae66ed5-855f-4ac9-80f4-f7003adad426\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/mock/authUrl?state=47b8708f454f3120ad35e3c68d5b53db\",\"response\":{\"statusCode\":200,\"headers\":{\"x-request-id\":\"9ae66ed5-855f-4ac9-80f4-f7003adad426\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"9ae66ed5-855f-4ac9-80f4-f7003adad426\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"authUrl\\\":\\\"http://localhost:8080/oauth/authorize?response_type=code&client_id=debugger&redirect_uri=https%3A%2F%2Fwanted-finally-anteater.ngrok-free.app%2Fauth%2FloginWithMockCallback.html&scope=openid%20somescope&state=47b8708f454f3120ad35e3c68d5b53db&identity_provider=MockOAuth2Server\\\"}\"}}"}
[BROWSER CONSOLE log]: Status message: Handing off to http://localhost:8080/oauth/authorize?response_type=code&client_id=debugger&redirect_uri=https%3A%2F%2Fwanted-finally-anteater.ngrok-free.app%2Fauth%2FloginWithMockCallback.html&scope=openid%20somescope&state=47b8708f454f3120ad35e3c68d5b53db&identity_provider=MockOAuth2Server Type: info
[BROWSER CONSOLE log]: Redirecting to navikt/mock-oauth2-server
[USER INTERACTION] Filling: input[name="username"] with value: "user" - Entering username
[USER INTERACTION] Filling: textarea[name="claims"] with value: "{"email":"user@example.com"}" - Entering identity claims
[USER INTERACTION] Clicking: input[type="submit"][value="Sign-in"] - Submitting sign-in form
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:03.845Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:03.845Z\",\"msg\":\"HTTP GET /auth/loginWithMockCallback.html?code=X2nuq3HZjI9GQFTYfx6BxTpCKP2ZR1ANqieJIITg1DY&state=47b8708f454f3120ad35e3c68d5b53db\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.037Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.037Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.039Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.039Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.074Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.074Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.075Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.075Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.076Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.076Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.077Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.077Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.078Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.078Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.079Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.079Z\",\"msg\":\"HTTP GET /widgets/loading-spinner.js\"}"}
[BROWSER CONSOLE log]: Authentication callback received with code: X2nuq3HZjI9GQFTYfx6BxTpCKP2ZR1ANqieJIITg1DY
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.168Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.168Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.172Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.172Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.173Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.173Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.179Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.179Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.180Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.180Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.180Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.180Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.183Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.183Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.183Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.183Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.184Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.184Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.202Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.202Z\",\"msg\":\"HTTP POST /api/v1/mock/token\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.295Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.294Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
[BROWSER CONSOLE log]: Received tokens from mock {"token_type":"Bearer","id_token":"eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA","access_token":"eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiMjVlM2QwNGQtNjBiZC00NmEwLTliNWUtOWM3NDYzZmFhYmQ1IiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.lA64kP5VGyYIAm8D_-O7Zs2U2_i5ERfYvCWoT9L_oa0YrpCSeAKjJZwHI-caqsmlVNhfZDNsJJACzNNKEFeCU8PG21vWz8DB2EkUyNqWbk05k-3UVlab_aazMYOWuW5km2koSzcZnAtPUThf3yLtCCxxyyHy-Xug9mmNJ-mHcGE6NfWlw4KOXjGYDcB0v65NoAIdbMKB0ul0Obi_fYXgS8TtkQiIMit5pzgzQZhogzz_zwiEYTK4AKQoGIakEDAllmX4Z_htR1D4Ub225Tdp_WUg-Reh6MUDOFKeASE_adJ46840Q73eL09yIIXccs8cjVMVLqAf_6tsxezUTdADIQ","refresh_token":"97ca565c-051b-4bed-b952-dfc37bfeac60","expires_in":3599}
[BROWSER CONSOLE log]: Received id_token from mock {"sub":"user","aud":"debugger","nbf":1769639224,"scope":"openid somescope","amr":["mfa","pwd"],"iss":"http://localhost:8080/default","exp":1769642824,"iat":1769639224,"nonce":"5678","jti":"8ed1fa05-f283-4c88-9ba8-ba765513a7ba","email":"user@example.com"}
[BROWSER CONSOLE log]: User authenticated successfully using mock: user@example.com
[BROWSER CONSOLE log]: MFA detected from mock IdP: [mfa, pwd] Stored metadata: {type: OTHER, timestamp: 2026-01-28T22:27:04.463Z, uniqueReference: 35332b2f-7ecb-4df4-b786-345b02940fa9}
[BROWSER CONSOLE log]: Status message: Authenticated successfully. Fetching bundles... Type: info
[BROWSER CONSOLE log]: Status message: Authenticated successfully. Redirecting... Type: info
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.501Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.501Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.612Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.612Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.613Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.613Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.614Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.614Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.616Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.615Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.616Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.616Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.617Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.617Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.618Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.618Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.619Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.619Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
[BROWSER CONSOLE log]: Current activity cleared
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.715Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.714Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.737Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.737Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.743Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.743Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.744Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.744Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.744Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.744Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.745Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.745Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.746Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.746Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.747Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.746Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.747Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.747Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
[BROWSER CONSOLE log]: User is authenticated
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE log]: User is authenticated
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.860Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.860Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.860Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.860Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.861Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:04.860Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.861Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/subHasher.js\",\"time\":\"2026-01-28T22:27:04.861Z\",\"message\":\"Using USER_SUB_HASH_SALT from environment (local dev/test)\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.861Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:04.861Z\",\"requestId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/index.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.861Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:04.861Z\",\"requestId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.861Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:04.861Z\",\"requestId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.862Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:04.861Z\",\"requestId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.862Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:04.862Z\",\"requestId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.862Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:04.862Z\",\"requestId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.862Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:04.862Z\",\"requestId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.865Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.865Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.942Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:04.942Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.943Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:04.942Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.943Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:04.943Z\",\"requestId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/index.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"984f5933-36b3-4276-a03b-14071be5c646\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.943Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:04.943Z\",\"requestId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.943Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:04.943Z\",\"requestId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.943Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:04.943Z\",\"requestId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.943Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:04.943Z\",\"requestId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.943Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:04.943Z\",\"requestId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.943Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:04.943Z\",\"requestId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.988Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:04.987Z\",\"requestId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:04.987Z\",\"requestId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:04.987Z\",\"requestId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.988Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:04.988Z\",\"requestId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.988Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:04.988Z\",\"requestId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"3b5fa921-7a93-4f59-9dde-e4753947a29f\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.989Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:04.989Z\",\"requestId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.989Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:04.989Z\",\"requestId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:04.989Z\",\"requestId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.989Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:04.989Z\",\"requestId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:04.989Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:04.989Z\",\"requestId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"984f5933-36b3-4276-a03b-14071be5c646\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:05.022Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:05.022Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:05.079Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:05.079Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
Checking home page...
[BROWSER CONSOLE log]: [Mock MFA] Injected MFA metadata: {type: TOTP, timestamp: 2026-01-08T00:09:01Z, uniqueReference: test-mfa-1769639226392}
[Mock MFA] Injected: type=TOTP, timestamp=2026-01-08T00:09:01Z, ref=test-mfa-1769639226392
CloudWatch RUM analytics consent dialog is visible, accepting...
[USER INTERACTION] Clicking: button:has-text("Accept") - Accept CloudWatch RUM consent
[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: "script-src 'self' 'unsafe-inline'". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked.
[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp
[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: "script-src 'self' 'unsafe-inline'". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked.
[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp
[BROWSER CONSOLE warning]: Failed to load RUM client: Event
[BROWSER CONSOLE warning]: Failed to load RUM client: Event
Navigating to Bundles via main navigation...
[USER INTERACTION] Clicking: nav.main-nav a:has-text('Bundles') - Clicking Bundles in main navigation
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.015Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.015Z\",\"msg\":\"HTTP GET /account/bundles.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.124Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.124Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.125Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.125Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.154Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.154Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.155Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.155Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.156Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.155Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.157Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.157Z\",\"msg\":\"HTTP GET /lib/bundle-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.158Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.158Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.159Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.159Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.160Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.160Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.161Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.160Z\",\"msg\":\"HTTP GET /widgets/loading-spinner.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.161Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.161Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.255Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.255Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.259Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.259Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.262Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.262Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.264Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.264Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.265Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.265Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.266Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.266Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.266Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.266Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.267Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.267Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.268Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.268Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.268Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.268Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.269Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:07.269Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.269Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:07.269Z\",\"requestId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"correlationId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/account/bundles.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.270Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:07.269Z\",\"requestId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"correlationId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.270Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:07.269Z\",\"requestId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"correlationId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.270Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:07.270Z\",\"requestId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"correlationId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:07.270Z\",\"requestId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"correlationId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.270Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:07.270Z\",\"requestId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"correlationId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.270Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:07.270Z\",\"requestId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"correlationId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.275Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:07.275Z\",\"requestId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"correlationId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.275Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:07.275Z\",\"requestId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"correlationId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:07.275Z\",\"requestId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"correlationId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.275Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:07.275Z\",\"requestId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"correlationId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.275Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:07.275Z\",\"requestId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"correlationId\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"x-correlationid\":\"995fec28-c353-4764-b385-06d31e6507ef\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[]}\"}}"}
[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: "script-src 'self' 'unsafe-inline'". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked.
[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp
[BROWSER CONSOLE log]: User is authenticated
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE warning]: Failed to load RUM client: Event
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.362Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.362Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.362Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:07.362Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.362Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:07.362Z\",\"requestId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/account/bundles.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.363Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:07.362Z\",\"requestId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:07.362Z\",\"requestId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.363Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:07.362Z\",\"requestId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.363Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:07.363Z\",\"requestId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.363Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:07.363Z\",\"requestId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.363Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:07.363Z\",\"requestId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.367Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:07.366Z\",\"requestId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.367Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:07.367Z\",\"requestId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.367Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:07.367Z\",\"requestId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.367Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:07.367Z\",\"requestId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.367Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:07.367Z\",\"requestId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"8180ce6a-0ba2-4506-8e28-10c4c7d52daf\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.368Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.368Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.369Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.369Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.379Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.378Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.494Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.494Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:07.499Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:07.499Z\",\"msg\":\"HTTP GET /submit.environment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:08.033Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
Ensuring Test bundle is present...
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (1/5)
[polling to ensure present]: Test bundle still not present.
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (2/5)
[polling to ensure present]: Test bundle still not present.
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (3/5)
[polling to ensure present]: Test bundle still not present.
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (4/5)
[polling to ensure present]: Test bundle still not present.
[polling to ensure present]: "Added ✓ Test" button not visible, waiting 1000ms and trying again (5/5)
[polling to ensure present]: Test bundle still not present.
Test bundle not present, requesting...
Requesting Test bundle...
[polling be ready to request]: Test bundle request button already visible.
[USER INTERACTION] Clicking: button:has-text('Request Test') - Request Test
[BROWSER CONSOLE log]: Status message: Requesting bundle "Test"... Type: info
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.401Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:14.401Z\",\"msg\":\"HTTP POST /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.402Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:14.402Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.402Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:14.402Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"content-length\":\"35\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"content-type\":\"application/json\",\"ngrok-skip-browser-warning\":\"any value\",\"origin\":\"https://wanted-finally-anteater.ngrok-free.app\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/account/bundles.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"x-wait-time-ms\":\"0\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"bundleId\\\":\\\"test\\\",\\\"qualifiers\\\":{}}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.402Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-01-28T22:27:14.402Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Processing bundle request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.402Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:14.402Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.403Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-01-28T22:27:14.403Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Processing bundle request for user\",\"userId\":\"user\",\"bundleId\":\"test\",\"waitTimeMs\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.403Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:14.403Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Executing synchronous processing\",\"userId\":\"user\",\"waitTimeMs\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.403Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-01-28T22:27:14.403Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"grantBundle entry\",\"userId\":\"user\",\"requestedBundle\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.403Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:14.403Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.404Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:14.403Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.407Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:14.407Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.407Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:14.407Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.412Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-01-28T22:27:14.411Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Loaded catalog bundle:\",\"bundleId\":\"test\",\"catalogBundle\":{\"id\":\"test\",\"name\":\"Test\",\"allocation\":\"on-request\",\"cap\":10,\"timeout\":\"P1D\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.412Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-01-28T22:27:14.412Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"[Catalog bundle] Bundle requires manual allocation, proceeding:\",\"requestedBundle\":\"test\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.413Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-01-28T22:27:14.412Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"[Catalog bundle] Bundle cap not yet reached:\",\"requestedBundle\":\"test\",\"currentCount\":0,\"cap\":10}\n{\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-01-28T22:27:14.412Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Granting bundle to user:\",\"userId\":\"user\",\"requestedBundle\":\"test\"}\n{\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-01-28T22:27:14.412Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"New bundle details:\",\"newBundle\":{\"bundleId\":\"test\",\"expiry\":\"2026-01-29\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.413Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-01-28T22:27:14.413Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Updated user bundles:\",\"userId\":\"user\",\"currentBundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-01-29\"}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.413Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:14.413Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Updating bundles for user user with 1\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-01-29\"}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.413Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:14.413Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:14.413Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.418Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:14.417Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.418Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:14.417Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":0}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.418Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:14.418Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Current bundles for user user in DynamoDB count: 0\",\"currentBundles\":[]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.418Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:14.418Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Current bundle IDs for user user in DynamoDB count: undefined\",\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.418Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:14.418Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"New bundle IDs for user user count: undefined\",\"newBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.418Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:14.418Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Bundles to remove for user user in DynamoDB\",\"bundlesToRemove\":[]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.418Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:14.418Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Checking if bundle test needs adding for user user in DynamoDB\",\"bundle\":{\"bundleId\":\"test\",\"expiry\":\"2026-01-29\"}}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:14.418Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Adding new bundle test for user user in DynamoDB\",\"bundle\":{\"bundleId\":\"test\",\"expiry\":\"2026-01-29\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.419Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:14.418Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"putBundle [table: test-bundle-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.419Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:14.419Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Storing bundle\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"userId\":\"user\",\"bundle\":{\"bundleId\":\"test\",\"expiry\":\"2026-01-29\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.419Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:14.419Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Storing bundle in DynamoDB as item\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"item\":{\"bundleId\":\"test\",\"expiry\":\"2026-01-29T00:00:00.000Z\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-01-28T22:27:14.419Z\",\"ttl\":1772323200,\"ttl_datestamp\":\"2026-03-01T00:00:00.000Z\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.426Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:14.426Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Bundle stored in DynamoDB as item\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"item\":{\"bundleId\":\"test\",\"expiry\":\"2026-01-29T00:00:00.000Z\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-01-28T22:27:14.419Z\",\"ttl\":1772323200,\"ttl_datestamp\":\"2026-03-01T00:00:00.000Z\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.426Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:14.426Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Updated bundles for user user in DynamoDB\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-01-29\"}]}\n{\"level\":30,\"source\":\"app/functions/account/bundlePost.js\",\"time\":\"2026-01-28T22:27:14.426Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Bundle granted to user:\",\"userId\":\"user\",\"newBundle\":{\"bundleId\":\"test\",\"expiry\":\"2026-01-29\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:14.426Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:14.426Z\",\"requestId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d94929ba-a354-4462-b0ac-7306e12228e4\",\"message\":\"Returning result with status 201\"}"}
[BROWSER CONSOLE log]: Status message: Bundle "Test" added successfully. Type: success
[polling to ensure request completed]: Test bundle already present.
[USER INTERACTION] Clicking: button:has-text('Back to Home') - Back to Home
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.045Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.045Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.121Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.120Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.125Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.125Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.159Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.158Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.160Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.160Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.161Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.161Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.162Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.162Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.162Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.162Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.163Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.163Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
[BROWSER CONSOLE log]: Current activity cleared
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.250Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.250Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.255Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.255Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.256Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.256Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.256Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.256Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.261Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.261Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.262Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.262Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.262Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.262Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.267Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.267Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.267Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.267Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: "script-src 'self' 'unsafe-inline'". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked.
[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp
[BROWSER CONSOLE log]: User is authenticated
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE log]: User is authenticated
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE warning]: Failed to load RUM client: Event
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.350Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.350Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.350Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:15.350Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.350Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:15.350Z\",\"requestId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/index.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.350Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:15.350Z\",\"requestId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:15.350Z\",\"requestId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.350Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:15.350Z\",\"requestId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.350Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:15.350Z\",\"requestId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.351Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:15.350Z\",\"requestId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.351Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:15.351Z\",\"requestId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.355Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:15.354Z\",\"requestId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.355Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:15.354Z\",\"requestId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:15.355Z\",\"requestId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:15.355Z\",\"requestId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.355Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:15.355Z\",\"requestId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"f8f22681-fa12-47fa-9b8b-29b5da9dd0e5\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-29T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:14.419Z\\\",\\\"ttl\\\":1772323200,\\\"ttl_datestamp\\\":\\\"2026-03-01T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.356Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.355Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.356Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:15.356Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.356Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:15.356Z\",\"requestId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/index.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.356Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:15.356Z\",\"requestId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.356Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:15.356Z\",\"requestId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:15.356Z\",\"requestId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.356Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:15.356Z\",\"requestId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.357Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:15.356Z\",\"requestId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.357Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:15.357Z\",\"requestId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.360Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.360Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.362Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:15.361Z\",\"requestId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.362Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:15.362Z\",\"requestId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.362Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:15.362Z\",\"requestId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.362Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:15.362Z\",\"requestId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.362Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:15.362Z\",\"requestId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"19e4cdb4-5d0f-4917-8a51-d1867ec16bc6\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-29T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:14.419Z\\\",\\\"ttl\\\":1772323200,\\\"ttl_datestamp\\\":\\\"2026-03-01T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.363Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.363Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.445Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.444Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.445Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:15.445Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:15.993Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: button:has-text('Submit VAT (HMRC Sandbox)') - Starting VAT return submission
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:16.810Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:16.810Z\",\"msg\":\"HTTP GET /hmrc/vat/submitVat.html?hmrcAccount=sandbox\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:16.909Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:16.904Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:16.927Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:16.927Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:16.940Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:16.939Z\",\"msg\":\"HTTP GET /lib/test-data-generator.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:16.965Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:16.965Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:16.968Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:16.968Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:16.971Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:16.971Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:16.973Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:16.973Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:16.974Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:16.974Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:16.974Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:16.974Z\",\"msg\":\"HTTP GET /lib/utils/obligation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:16.975Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:16.975Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:16.976Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:16.976Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
[BROWSER CONSOLE log]: JS block finished loading.
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.079Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:17.079Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.080Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:17.079Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.099Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:17.098Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.101Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:17.101Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.104Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:17.104Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.105Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:17.104Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.105Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:17.105Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.106Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:17.106Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.107Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:17.106Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.107Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:17.107Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: "script-src 'self' 'unsafe-inline'". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked.
[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE log]: JS block started loading: DOMContentLoaded event handler
[BROWSER CONSOLE log]: OAuth callback handler (no action taken)
[BROWSER CONSOLE log]: JS block finished loading: DOMContentLoaded event handler
[BROWSER CONSOLE warning]: Failed to load RUM client: Event
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.194Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:17.194Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.195Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:17.194Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:17.195Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.195Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:17.195Z\",\"requestId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"09b93724-0a93-474d-a994-13b29502bb14\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.195Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:17.195Z\",\"requestId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.195Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:17.195Z\",\"requestId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.195Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:17.195Z\",\"requestId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:17.195Z\",\"requestId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.195Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:17.195Z\",\"requestId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:17.195Z\",\"requestId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.199Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:17.197Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:17.197Z\",\"requestId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"04adc64b-0532-4f52-82e3-e767d7e593df\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:17.197Z\",\"requestId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:17.197Z\",\"requestId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:17.197Z\",\"requestId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:17.197Z\",\"requestId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:17.197Z\",\"requestId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:17.197Z\",\"requestId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.200Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:17.200Z\",\"requestId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.200Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:17.200Z\",\"requestId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:17.200Z\",\"requestId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.200Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:17.200Z\",\"requestId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"message\":\"Returning HTTP 200 OK with result\"}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:17.200Z\",\"requestId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"09b93724-0a93-474d-a994-13b29502bb14\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-29T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:14.419Z\\\",\\\"ttl\\\":1772323200,\\\"ttl_datestamp\\\":\\\"2026-03-01T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.202Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:17.201Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.203Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:17.203Z\",\"requestId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.203Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:17.203Z\",\"requestId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:17.203Z\",\"requestId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.203Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:17.203Z\",\"requestId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:17.203Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:17.203Z\",\"requestId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"04adc64b-0532-4f52-82e3-e767d7e593df\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-29T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:14.419Z\\\",\\\"ttl\\\":1772323200,\\\"ttl_datestamp\\\":\\\"2026-03-01T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:18.430Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: #testDataLink a - Clicking add test data link
[BROWSER CONSOLE log]: [Test Data] Populated 9-box VAT submission form with test data: {vatDueSales: 5176.00, vatDueAcquisitions: 11.00, totalVatDue: 5187.00, vatReclaimedCurrPeriod: 2517.00, netVatDue: 2670.00}
[BROWSER CONSOLE log]: [Test Data] Auto-checked allowSandboxObligations for sandbox testing
[USER INTERACTION] Filling: #vatNumber with value: "793211922" - Entering VAT number
Set period dates: 2017-01-01 to 2017-03-31
[USER INTERACTION] Filling: #vatDueSales with value: "1000.00" - Entering VAT due on sales (Box 1)
[USER INTERACTION] Filling: #vatDueAcquisitions with value: "0.00" - Entering VAT due on acquisitions (Box 2)
[USER INTERACTION] Filling: #vatReclaimedCurrPeriod with value: "0.00" - Entering VAT reclaimed (Box 4)
[USER INTERACTION] Filling: #totalValueSalesExVAT with value: "5000" - Entering total sales ex VAT (Box 6)
[USER INTERACTION] Filling: #totalValuePurchasesExVAT with value: "0" - Entering total purchases ex VAT (Box 7)
[USER INTERACTION] Filling: #totalValueGoodsSuppliedExVAT with value: "0" - Entering goods supplied to EU (Box 8)
[USER INTERACTION] Filling: #totalAcquisitionsExVAT with value: "0" - Entering acquisitions from EU (Box 9)
Developer options already visible, skipping click
Checked runFraudPreventionHeaderValidation checkbox
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:22.029Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
allowSandboxObligations checkbox already checked
[USER INTERACTION] Focusing: #submitBtn - the Submit button
[USER INTERACTION] Clicking: #submitBtn - Submitting VAT form
[BROWSER CONSOLE log]: Status message: Initiating HMRC authentication... Type: info
[BROWSER CONSOLE log]: Stored pending request and current activity: {"vatNumber":"793211922","periodStart":"2017-01-01","periodEnd":"2017-03-31","vatDueSales":1000,"vatDueAcquisitions":0,"totalVatDue":1000,"vatReclaimedCurrPeriod":0,"netVatDue":1000,"totalValueSalesExVAT":5000,"totalValuePurchasesExVAT":0,"totalValueGoodsSuppliedExVAT":0,"totalAcquisitionsExVAT":0,"finalised":true,"testScenario":"","runFraudPreventionHeaderValidation":true,"allowSandboxObligations":true} /hmrc/vat/submitVat.html sandbox
[BROWSER CONSOLE log]: Using client-side generated HMRC Auth URL: https://test-api.service.hmrc.gov.uk/oauth/authorize?response_type=code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&redirect_uri=https%3A%2F%2Fwanted-finally-anteater.ngrok-free.app%2Factivities%2FsubmitVatCallback.html&scope=write%3Avat%20read%3Avat&state=deee3edbdc0744e2a0b1d6759b3f633e
[BROWSER CONSOLE log]: Current activity set to: /hmrc/vat/submitVat.html
[BROWSER CONSOLE log]: Status message: Redirecting to HMRC for authentication at https://test-api.service.hmrc.gov.uk/oauth/authorize?response_type=code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&redirect_uri=https%3A%2F%2Fwanted-finally-anteater.ngrok-free.app%2Factivities%2FsubmitVatCallback.html&scope=write%3Avat%20read%3Avat&state=deee3edbdc0744e2a0b1d6759b3f633e... Type: info
[BROWSER CONSOLE log]: Page transition initiated: Redirecting to HMRC OAuth URL https://test-api.service.hmrc.gov.uk/oauth/authorize?response_type=code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&redirect_uri=https%3A%2F%2Fwanted-finally-anteater.ngrok-free.app%2Factivities%2FsubmitVatCallback.html&scope=write%3Avat%20read%3Avat&state=deee3edbdc0744e2a0b1d6759b3f633e
[USER INTERACTION] Clicking: Continue button - Continuing with HMRC permission
[USER INTERACTION] Clicking: [Locator] - Continue
[USER INTERACTION] Clicking: Sign in to HMRC button - Starting HMRC authentication
[USER INTERACTION] Clicking: [Locator] - Sign in to the HMRC online service
[BROWSER ERROR]: Cannot read properties of null (reading 'addEventListener')
[BROWSER ERROR]: Cannot read properties of undefined (reading 'initAll')
[USER INTERACTION] Filling: #userId with value: "413984641731" - Entering HMRC user ID
[USER INTERACTION] Filling: #password with value: "p1IemJncxqZm" - Entering HMRC password
[USER INTERACTION] Clicking: Sign in button - Submitting HMRC credentials
[USER INTERACTION] Clicking: [Locator] - Sign in
[USER INTERACTION] Clicking: #givePermission - Give permission
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.010Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.010Z\",\"msg\":\"HTTP GET /activities/submitVatCallback.html?code=34d0b8a8bc2640a8b7dae0be789ee571&state=deee3edbdc0744e2a0b1d6759b3f633e\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.201Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.200Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.215Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.215Z\",\"msg\":\"HTTP GET /widgets/loading-spinner.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.215Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.215Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.222Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.222Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.223Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.223Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.265Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.265Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.266Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.265Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.266Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.266Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.365Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.365Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.366Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.366Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.369Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.369Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.370Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.370Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.370Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.370Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.371Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.371Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.371Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.371Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.372Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.372Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.372Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.372Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: "script-src 'self' 'unsafe-inline'". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked.
[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp
[BROWSER CONSOLE log]: OAuth callback handler
[BROWSER CONSOLE log]: Page transition initiated: Clearing URL parameters
[BROWSER CONSOLE log]: OAuth callback handler (normal completion)
[BROWSER CONSOLE log]: Status message: Exchanging authorization code for access token... Type: info
[BROWSER CONSOLE log]: Exchanging token. Remote call initiated: POST /api/v1/hmrc/token ++ Body: {"code":"34d0b8a8bc2640a8b7dae0be789ee571"}
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE warning]: Failed to load RUM client: Event
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.495Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.495Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.495Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:33.495Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.496Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:33.495Z\",\"requestId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/activities/submitVatCallback.html?code=34d0b8a8bc2640a8b7dae0be789ee571&state=deee3edbdc0744e2a0b1d6759b3f633e\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.496Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:33.496Z\",\"requestId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.496Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:33.496Z\",\"requestId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:33.496Z\",\"requestId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:33.496Z\",\"requestId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:33.496Z\",\"requestId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.496Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:33.496Z\",\"requestId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.499Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:33.499Z\",\"requestId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.499Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:33.499Z\",\"requestId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.500Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:33.499Z\",\"requestId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.500Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:33.500Z\",\"requestId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.500Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:33.500Z\",\"requestId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"d6522a4c-8b14-48e3-9a38-b82f76cba038\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-29T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:14.419Z\\\",\\\"ttl\\\":1772323200,\\\"ttl_datestamp\\\":\\\"2026-03-01T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.500Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.500Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.505Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.505Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.506Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:33.505Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.506Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:33.506Z\",\"requestId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/activities/submitVatCallback.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.506Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:33.506Z\",\"requestId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:33.506Z\",\"requestId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.506Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:33.506Z\",\"requestId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:33.506Z\",\"requestId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.506Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:33.506Z\",\"requestId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.506Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:33.506Z\",\"requestId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.509Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:33.509Z\",\"requestId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.509Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:33.509Z\",\"requestId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:33.509Z\",\"requestId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.509Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:33.509Z\",\"requestId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.510Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:33.509Z\",\"requestId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"f13f9ab5-3121-49ef-8eaa-1856dcc41ef3\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-29T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:14.419Z\\\",\\\"ttl\\\":1772323200,\\\"ttl_datestamp\\\":\\\"2026-03-01T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.512Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.512Z\",\"msg\":\"HTTP POST /api/v1/hmrc/token\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.512Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:33.512Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.512Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:33.512Z\",\"requestId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/token\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/token\"}},\"path\":\"/api/v1/hmrc/token\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"content-length\":\"43\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"content-type\":\"application/json\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"origin\":\"https://wanted-finally-anteater.ngrok-free.app\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/activities/submitVatCallback.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"code\\\":\\\"34d0b8a8bc2640a8b7dae0be789ee571\\\"}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.513Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcTokenPost.js\",\"time\":\"2026-01-28T22:27:33.512Z\",\"requestId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"message\":\"Exchanging authorization code for HMRC access token\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.513Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcTokenPost.js\",\"time\":\"2026-01-28T22:27:33.513Z\",\"requestId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"msg\":\"Retrieving HMRC client secret from arn \"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.513Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcTokenPost.js\",\"time\":\"2026-01-28T22:27:33.513Z\",\"requestId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"msg\":\"Secret retrieved from override and cached\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.513Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:33.513Z\",\"requestId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"message\":\"Request to POST https://test-api.service.hmrc.gov.uk/oauth/token\",\"url\":\"https://test-api.service.hmrc.gov.uk/oauth/token\",\"headers\":{\"Content-Type\":\"application/x-www-form-urlencoded\",\"x-request-id\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\"},\"body\":\"grant_type=authorization_code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&client_secret=a2dd6f2e-c7e0-4d3c-aeb2-0506b9c35f56&redirect_uri=https%3A%2F%2Fwanted-finally-anteater.ngrok-free.app%2Factivities%2FsubmitVatCallback.html&code=34d0b8a8bc2640a8b7dae0be789ee571\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.513Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:33.513Z\",\"requestId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"message\":\"Performing HTTP POST for token exchange\",\"providerUrl\":\"https://test-api.service.hmrc.gov.uk/oauth/token\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.732Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:33.732Z\",\"requestId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"message\":\"HTTP POST response received with status and duration\",\"status\":200,\"duration\":219}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.734Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:33.733Z\",\"requestId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/oauth/token\",\"method\":\"POST\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.739Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:33.739Z\",\"requestId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/oauth/token\",\"method\":\"POST\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.739Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:33.739Z\",\"requestId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"message\":\"exchangeClientSecretForAccessToken response\",\"responseStatus\":200,\"responseTokens\":{\"access_token\":\"[REDACTED]\",\"refresh_token\":\"[REDACTED]\",\"expires_in\":14400,\"scope\":\"write:vat read:vat\",\"token_type\":\"bearer\"},\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":32,\"tokenType\":\"bearer\",\"scope\":\"write:vat read:vat\",\"expiresIn\":14400,\"hasRefreshToken\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.739Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:33.739Z\",\"requestId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"message\":\"Token exchange succeeded\",\"accessTokenLength\":32,\"hasIdToken\":false,\"hasRefreshToken\":true,\"expiresIn\":14400,\"tokenType\":\"bearer\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.739Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:33.739Z\",\"requestId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/token\",\"response\":{\"statusCode\":200,\"headers\":{\"x-request-id\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"43290fcb-809c-4e70-bf6d-7d5edf427b42\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"accessToken\\\":\\\"7df1b969f13835c1544ca07899f70b90\\\",\\\"hmrcAccessToken\\\":\\\"7df1b969f13835c1544ca07899f70b90\\\",\\\"refreshToken\\\":\\\"4783b3e0d84f5ca68a061da65c736d57\\\",\\\"expiresIn\\\":14400,\\\"tokenType\\\":\\\"bearer\\\"}\"}}"}
[BROWSER CONSOLE log]: Exchanged token. Remote call completed successfully: POST /api/v1/hmrc/token {accessToken: 7df1b969f13835c1544ca07899f70b90, hmrcAccessToken: 7df1b969f13835c1544ca07899f70b90, refreshToken: 4783b3e0d84f5ca68a061da65c736d57, expiresIn: 14400, tokenType: bearer} 7df1b969f13835c1544ca07899f70b90
[BROWSER CONSOLE log]: Status message: Obtained Access Token from HMRC... Type: info
[BROWSER CONSOLE log]: Current activity found: /hmrc/vat/submitVat.html
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.820Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.820Z\",\"msg\":\"HTTP GET /hmrc/vat/submitVat.html?hmrcAccount=sandbox\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.900Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.900Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.915Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.914Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.930Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.930Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.933Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.932Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.933Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.933Z\",\"msg\":\"HTTP GET /lib/utils/obligation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.934Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.934Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.934Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.934Z\",\"msg\":\"HTTP GET /lib/test-data-generator.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.935Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.935Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.936Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.936Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.937Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.937Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:33.938Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:33.938Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
[BROWSER CONSOLE log]: JS block finished loading.
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.020Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:34.020Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.021Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:34.020Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.024Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:34.023Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.024Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:34.024Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.024Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:34.024Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.025Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:34.025Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.026Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:34.026Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.027Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:34.027Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.027Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:34.027Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.032Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:34.032Z\",\"msg\":\"HTTP GET /submit.env\"}"}
[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: "script-src 'self' 'unsafe-inline'". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked.
[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE log]: JS block started loading: DOMContentLoaded event handler
[BROWSER CONSOLE log]: Restored form draft from 2026-01-28T22:27:22.026Z
[BROWSER CONSOLE log]: OAuth callback handler (code present, auto-continue)
[BROWSER CONSOLE log]: Retrieved submission data: {vatNumber: 793211922, periodStart: 2017-01-01, periodEnd: 2017-03-31, vatDueSales: 1000, vatDueAcquisitions: 0}
[BROWSER CONSOLE log]: Status message: Submitting VAT return to HMRC... Type: info
[BROWSER CONSOLE log]: JS block finished loading: DOMContentLoaded event handler
[BROWSER CONSOLE warning]: Failed to load RUM client: Event
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.126Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:34.126Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.127Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:34.127Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.127Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:34.127Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.127Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:34.127Z\",\"requestId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.127Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:34.127Z\",\"requestId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.127Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:34.127Z\",\"requestId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.127Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:34.127Z\",\"requestId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.128Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:34.127Z\",\"requestId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:34.127Z\",\"requestId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.128Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:34.128Z\",\"requestId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.130Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:34.129Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:34.130Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.130Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:34.130Z\",\"requestId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"04f90317-1ff3-44a9-99bc-363c317289b6\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.130Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:34.130Z\",\"requestId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:34.130Z\",\"requestId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.130Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:34.130Z\",\"requestId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.130Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:34.130Z\",\"requestId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:34.130Z\",\"requestId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.130Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:34.130Z\",\"requestId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.132Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:34.132Z\",\"requestId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.132Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:34.132Z\",\"requestId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.132Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:34.132Z\",\"requestId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:34.132Z\",\"requestId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.132Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:34.132Z\",\"requestId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"53dc2d24-733d-4538-93d2-b1e4a89577fe\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-29T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:14.419Z\\\",\\\"ttl\\\":1772323200,\\\"ttl_datestamp\\\":\\\"2026-03-01T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.134Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:34.134Z\",\"requestId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.134Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:34.134Z\",\"requestId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.134Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:34.134Z\",\"requestId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.134Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:34.134Z\",\"requestId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.134Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:34.134Z\",\"requestId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"04f90317-1ff3-44a9-99bc-363c317289b6\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-29T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:14.419Z\\\",\\\"ttl\\\":1772323200,\\\"ttl_datestamp\\\":\\\"2026-03-01T00:00:00.000Z\\\"}]}\"}}"}
[BROWSER CONSOLE log]: Submitting VAT. Remote call initiated: POST /api/v1/hmrc/vat/return ++ Body: {"vatNumber":"793211922","periodStart":"2017-01-01","periodEnd":"2017-03-31","vatDueSales":1000,"vatDueAcquisitions":0,"totalVatDue":1000,"vatReclaimedCurrPeriod":0,"netVatDue":1000,"totalValueSalesExVAT":5000,"totalValuePurchasesExVAT":0,"totalValueGoodsSuppliedExVAT":0,"totalAcquisitionsExVAT":0,"finalised":true,"accessToken":"7df1b969f13835c1544ca07899f70b90","runFraudPreventionHeaderValidation":true}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.200Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:34.200Z\",\"msg\":\"HTTP POST /api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.201Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:34.201Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"25e3d04d-60bd-46a0-9b5e-9c7463faabd5\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.201Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:34.201Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"25e3d04d-60bd-46a0-9b5e-9c7463faabd5\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"content-length\":\"407\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer 7df1b969f13835c1544ca07899f70b90\",\"cache-control\":\"no-cache\",\"content-type\":\"application/json\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"gov-client-device-id\":\"bb3fbc56-9ec5-4136-98fe-7d71fe43c24a\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"gov-client-public-ip\":\"178.231.187.149\",\"gov-client-public-ip-timestamp\":\"2026-01-28T22:27:34.160Z\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"gov-client-user-ids\":\"browser=user\",\"gov-client-window-size\":\"width=1280&height=1446\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"origin\":\"https://wanted-finally-anteater.ngrok-free.app\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiMjVlM2QwNGQtNjBiZC00NmEwLTliNWUtOWM3NDYzZmFhYmQ1IiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.lA64kP5VGyYIAm8D_-O7Zs2U2_i5ERfYvCWoT9L_oa0YrpCSeAKjJZwHI-caqsmlVNhfZDNsJJACzNNKEFeCU8PG21vWz8DB2EkUyNqWbk05k-3UVlab_aazMYOWuW5km2koSzcZnAtPUThf3yLtCCxxyyHy-Xug9mmNJ-mHcGE6NfWlw4KOXjGYDcB0v65NoAIdbMKB0ul0Obi_fYXgS8TtkQiIMit5pzgzQZhogzz_zwiEYTK4AKQoGIakEDAllmX4Z_htR1D4Ub225Tdp_WUg-Reh6MUDOFKeASE_adJ46840Q73eL09yIIXccs8cjVMVLqAf_6tsxezUTdADIQ\",\"x-client-request-id\":\"aef46fbf-d89b-44ba-9373-8f37560af45b\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"vatNumber\\\":\\\"793211922\\\",\\\"periodStart\\\":\\\"2017-01-01\\\",\\\"periodEnd\\\":\\\"2017-03-31\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true,\\\"accessToken\\\":\\\"7df1b969f13835c1544ca07899f70b90\\\",\\\"runFraudPreventionHeaderValidation\\\":true}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.202Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:34.202Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"https://test-api.service.hmrc.gov.uk\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.202Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:34.202Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Extracting user information from event\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.202Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:34.202Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.202Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:34.202Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"25e3d04d-60bd-46a0-9b5e-9c7463faabd5\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"content-length\":\"407\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer 7df1b969f13835c1544ca07899f70b90\",\"cache-control\":\"no-cache\",\"content-type\":\"application/json\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"gov-client-device-id\":\"bb3fbc56-9ec5-4136-98fe-7d71fe43c24a\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"gov-client-public-ip\":\"178.231.187.149\",\"gov-client-public-ip-timestamp\":\"2026-01-28T22:27:34.160Z\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"gov-client-user-ids\":\"browser=user\",\"gov-client-window-size\":\"width=1280&height=1446\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"origin\":\"https://wanted-finally-anteater.ngrok-free.app\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiMjVlM2QwNGQtNjBiZC00NmEwLTliNWUtOWM3NDYzZmFhYmQ1IiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.lA64kP5VGyYIAm8D_-O7Zs2U2_i5ERfYvCWoT9L_oa0YrpCSeAKjJZwHI-caqsmlVNhfZDNsJJACzNNKEFeCU8PG21vWz8DB2EkUyNqWbk05k-3UVlab_aazMYOWuW5km2koSzcZnAtPUThf3yLtCCxxyyHy-Xug9mmNJ-mHcGE6NfWlw4KOXjGYDcB0v65NoAIdbMKB0ul0Obi_fYXgS8TtkQiIMit5pzgzQZhogzz_zwiEYTK4AKQoGIakEDAllmX4Z_htR1D4Ub225Tdp_WUg-Reh6MUDOFKeASE_adJ46840Q73eL09yIIXccs8cjVMVLqAf_6tsxezUTdADIQ\",\"x-client-request-id\":\"aef46fbf-d89b-44ba-9373-8f37560af45b\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"vatNumber\\\":\\\"793211922\\\",\\\"periodStart\\\":\\\"2017-01-01\\\",\\\"periodEnd\\\":\\\"2017-03-31\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true,\\\"accessToken\\\":\\\"7df1b969f13835c1544ca07899f70b90\\\",\\\"runFraudPreventionHeaderValidation\\\":true}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.204Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:34.204Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.204Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:34.204Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.204Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:34.204Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.207Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:34.207Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.207Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:34.207Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.207Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:34.207Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-01-29T00:00:00.000Z\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-01-28T22:27:14.419Z\",\"ttl\":1772323200,\"ttl_datestamp\":\"2026-03-01T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.207Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:34.207Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\",\"requiredBundleIds\":[\"test\",\"guest\",\"business\",\"diylegacy\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.207Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:34.207Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.208Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:34.208Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":32,\"accessTokenPrefix\":\"7df1b969...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.209Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-28T22:27:34.208Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"Checking for test scenario\":null}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-28T22:27:34.208Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Resolving periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vatNumber\":\"793211922\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.209Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-01-28T22:27:34.209Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"msg\":\"Validating fraud prevention headers for HMRC API request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.210Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:34.209Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Validating fraud prevention headers\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Public-IP\",\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Public-IP\",\"Gov-Vendor-Forwarded\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.362Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:34.362Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"INVALID_HEADERS\",\"validationMessage\":\"At least 1 header is invalid\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.362Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:34.362Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Fraud prevention header validation errors\",\"errors\":[{\"code\":\"MISSING_HEADER\",\"message\":\"Header missing. You will not be able to submit a header if the connection is between client and server in a private network. If this is the case, you must contact us explaining why you cannot submit this header.\",\"headers\":[\"gov-client-public-port\"]}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.362Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:34.362Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"MISSING_HEADER\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.362Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:34.362Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.365Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:34.365Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.366Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:34.366Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Request to GET https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"Gov-Client-Public-IP\":\"178.231.187.149\",\"Gov-Client-Device-ID\":\"bb3fbc56-9ec5-4136-98fe-7d71fe43c24a\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Public-IP\":\"178.231.187.149\",\"Gov-Vendor-Forwarded\":\"by=178.231.187.149&for=178.231.187.149\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"Gov-Client-Public-IP-Timestamp\":\"2026-01-28T22:27:34.160Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"https://test-api.service.hmrc.gov.uk\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.511Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:34.511Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Response from GET https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"status\":200,\"hmrcResponseBody\":{\"obligations\":[{\"periodKey\":\"18A1\",\"start\":\"2017-01-01\",\"end\":\"2017-03-31\",\"due\":\"2017-05-07\",\"status\":\"O\"}]}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.512Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:34.511Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.514Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:34.514Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.514Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-28T22:27:34.514Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Resolved periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"resolvedPeriodKey\":\"18A1\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.514Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-28T22:27:34.514Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.515Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-28T22:27:34.514Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Initiating new processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.515Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:34.515Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Marking request as processing in DynamoDB\",\"userId\":\"user\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.515Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:34.515Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-return-post-async-requests-table]\",\"status\":\"processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.515Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:34.515Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Starting async processing locally (no SQS queue URL)\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.516Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-28T22:27:34.516Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Validating fraud prevention headers for sandbox account\",\"hmrcAccount\":\"sandbox\",\"runFraudPreventionHeaderValidation\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.516Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:34.516Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Validating fraud prevention headers\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Public-IP\",\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Public-IP\",\"Gov-Vendor-Forwarded\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.517Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:34.517Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Checking persisted request status\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.517Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:34.517Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-return-post-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.524Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:34.524Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.525Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:34.525Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.525Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:34.525Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Yielding with HTTP 202 Accepted\",\"location\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.525Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:34.525Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return\",\"response\":{\"statusCode\":202,\"headers\":{\"Gov-Client-Public-IP\":\"178.231.187.149\",\"Gov-Client-Device-ID\":\"bb3fbc56-9ec5-4136-98fe-7d71fe43c24a\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Public-IP\":\"178.231.187.149\",\"Gov-Vendor-Forwarded\":\"by=178.231.187.149&for=178.231.187.149\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"Gov-Client-Public-IP-Timestamp\":\"2026-01-28T22:27:34.160Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"Retry-After\":\"5\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"Location\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"message\\\":\\\"Request accepted for processing\\\"}\"}}"}
[BROWSER CONSOLE log]: waiting async request [POST /api/v1/hmrc/vat/return] (timeout: 1630000ms)...
[BROWSER CONSOLE log]: Status message: Still processing... (poll #1) Type: info
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.713Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:34.713Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"INVALID_HEADERS\",\"validationMessage\":\"At least 1 header is invalid\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.714Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:34.713Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Fraud prevention header validation errors\",\"errors\":[{\"code\":\"MISSING_HEADER\",\"message\":\"Header missing. You will not be able to submit a header if the connection is between client and server in a private network. If this is the case, you must contact us explaining why you cannot submit this header.\",\"headers\":[\"gov-client-public-port\"]}]}\n{\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:34.713Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"MISSING_HEADER\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.715Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:34.714Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.717Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:34.717Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.717Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-28T22:27:34.717Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Request to POST https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/returns\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/returns\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"Gov-Client-Public-IP\":\"178.231.187.149\",\"Gov-Client-Device-ID\":\"bb3fbc56-9ec5-4136-98fe-7d71fe43c24a\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Public-IP\":\"178.231.187.149\",\"Gov-Vendor-Forwarded\":\"by=178.231.187.149&for=178.231.187.149\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"Gov-Client-Public-IP-Timestamp\":\"2026-01-28T22:27:34.160Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"body\":{\"periodKey\":\"18A1\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":5000,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0,\"finalised\":true},\"environment\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.717Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:34.717Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Request to POST https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/returns\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/returns\",\"method\":\"POST\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"Gov-Client-Public-IP\":\"178.231.187.149\",\"Gov-Client-Device-ID\":\"bb3fbc56-9ec5-4136-98fe-7d71fe43c24a\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Public-IP\":\"178.231.187.149\",\"Gov-Vendor-Forwarded\":\"by=178.231.187.149&for=178.231.187.149\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"Gov-Client-Public-IP-Timestamp\":\"2026-01-28T22:27:34.160Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"body\":\"{\\\"periodKey\\\":\\\"18A1\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true}\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.857Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:34.856Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Response from POST https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/returns\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/returns\",\"status\":201,\"hmrcResponseBody\":{\"processingDate\":\"2026-01-28T22:27:34.850Z\",\"formBundleNumber\":\"824422898682\",\"paymentIndicator\":\"DD\",\"chargeRefNumber\":\"1IwLyFgkLFpSxwmh\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.857Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:34.857Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/returns\",\"method\":\"POST\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.859Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:34.859Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/returns\",\"method\":\"POST\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.860Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-28T22:27:34.859Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Received HMRC response: {}\",\"httpResult\":{\"hmrcResponse\":{},\"hmrcResponseBody\":{\"processingDate\":\"2026-01-28T22:27:34.850Z\",\"formBundleNumber\":\"824422898682\",\"paymentIndicator\":\"DD\",\"chargeRefNumber\":\"1IwLyFgkLFpSxwmh\"}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.860Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-01-28T22:27:34.860Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"DynamoDB enabled, proceeding with putReceipt [table: test-receipts-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.860Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-01-28T22:27:34.860Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Storing receipt\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"userSub\":\"user\",\"receiptId\":\"2026-01-28T22:27:34.860Z-824422898682\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.860Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-01-28T22:27:34.860Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Storing receipt in DynamoDB as item\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"receiptId\":\"2026-01-28T22:27:34.860Z-824422898682\",\"ttl_datestamp\":\"2033-01-26T22:27:34.860Z\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.862Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-01-28T22:27:34.862Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Receipt stored in DynamoDB as item\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"receiptId\":\"2026-01-28T22:27:34.860Z-824422898682\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.862Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:34.862Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Local async processing completed successfully\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.862Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:34.862Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Marking async request as completed\",\"userSub\":\"user\",\"asyncRequestsTableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.862Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:34.862Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-return-post-async-requests-table]\",\"status\":\"completed\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:34.865Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:34.865Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
[BROWSER CONSOLE log]: re-trying async request [POST /api/v1/hmrc/vat/return] (poll #1, elapsed: 1002ms, timeout: 1630000ms, last status: 202)...
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.621Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:35.620Z\",\"msg\":\"HTTP POST /api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.621Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:35.621Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"25e3d04d-60bd-46a0-9b5e-9c7463faabd5\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.621Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:35.621Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"25e3d04d-60bd-46a0-9b5e-9c7463faabd5\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"content-length\":\"407\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer 7df1b969f13835c1544ca07899f70b90\",\"cache-control\":\"no-cache\",\"content-type\":\"application/json\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"gov-client-device-id\":\"bb3fbc56-9ec5-4136-98fe-7d71fe43c24a\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"gov-client-public-ip\":\"178.231.187.149\",\"gov-client-public-ip-timestamp\":\"2026-01-28T22:27:34.160Z\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"gov-client-user-ids\":\"browser=user\",\"gov-client-window-size\":\"width=1280&height=1446\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"origin\":\"https://wanted-finally-anteater.ngrok-free.app\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiMjVlM2QwNGQtNjBiZC00NmEwLTliNWUtOWM3NDYzZmFhYmQ1IiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.lA64kP5VGyYIAm8D_-O7Zs2U2_i5ERfYvCWoT9L_oa0YrpCSeAKjJZwHI-caqsmlVNhfZDNsJJACzNNKEFeCU8PG21vWz8DB2EkUyNqWbk05k-3UVlab_aazMYOWuW5km2koSzcZnAtPUThf3yLtCCxxyyHy-Xug9mmNJ-mHcGE6NfWlw4KOXjGYDcB0v65NoAIdbMKB0ul0Obi_fYXgS8TtkQiIMit5pzgzQZhogzz_zwiEYTK4AKQoGIakEDAllmX4Z_htR1D4Ub225Tdp_WUg-Reh6MUDOFKeASE_adJ46840Q73eL09yIIXccs8cjVMVLqAf_6tsxezUTdADIQ\",\"x-client-request-id\":\"aef46fbf-d89b-44ba-9373-8f37560af45b\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-request-id\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"vatNumber\\\":\\\"793211922\\\",\\\"periodStart\\\":\\\"2017-01-01\\\",\\\"periodEnd\\\":\\\"2017-03-31\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true,\\\"accessToken\\\":\\\"7df1b969f13835c1544ca07899f70b90\\\",\\\"runFraudPreventionHeaderValidation\\\":true}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.621Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:35.621Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"https://test-api.service.hmrc.gov.uk\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:35.621Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Extracting user information from event\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.621Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:35.621Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.621Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:35.621Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"25e3d04d-60bd-46a0-9b5e-9c7463faabd5\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"POST\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"content-length\":\"407\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer 7df1b969f13835c1544ca07899f70b90\",\"cache-control\":\"no-cache\",\"content-type\":\"application/json\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"gov-client-device-id\":\"bb3fbc56-9ec5-4136-98fe-7d71fe43c24a\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"gov-client-public-ip\":\"178.231.187.149\",\"gov-client-public-ip-timestamp\":\"2026-01-28T22:27:34.160Z\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"gov-client-user-ids\":\"browser=user\",\"gov-client-window-size\":\"width=1280&height=1446\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"origin\":\"https://wanted-finally-anteater.ngrok-free.app\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/submitVat.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiMjVlM2QwNGQtNjBiZC00NmEwLTliNWUtOWM3NDYzZmFhYmQ1IiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.lA64kP5VGyYIAm8D_-O7Zs2U2_i5ERfYvCWoT9L_oa0YrpCSeAKjJZwHI-caqsmlVNhfZDNsJJACzNNKEFeCU8PG21vWz8DB2EkUyNqWbk05k-3UVlab_aazMYOWuW5km2koSzcZnAtPUThf3yLtCCxxyyHy-Xug9mmNJ-mHcGE6NfWlw4KOXjGYDcB0v65NoAIdbMKB0ul0Obi_fYXgS8TtkQiIMit5pzgzQZhogzz_zwiEYTK4AKQoGIakEDAllmX4Z_htR1D4Ub225Tdp_WUg-Reh6MUDOFKeASE_adJ46840Q73eL09yIIXccs8cjVMVLqAf_6tsxezUTdADIQ\",\"x-client-request-id\":\"aef46fbf-d89b-44ba-9373-8f37560af45b\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-request-id\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{},\"body\":\"{\\\"vatNumber\\\":\\\"793211922\\\",\\\"periodStart\\\":\\\"2017-01-01\\\",\\\"periodEnd\\\":\\\"2017-03-31\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0,\\\"finalised\\\":true,\\\"accessToken\\\":\\\"7df1b969f13835c1544ca07899f70b90\\\",\\\"runFraudPreventionHeaderValidation\\\":true}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.623Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:35.623Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.624Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:35.623Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:35.623Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.626Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:35.626Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:35.626Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:35.626Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-01-29T00:00:00.000Z\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-01-28T22:27:14.419Z\",\"ttl\":1772323200,\"ttl_datestamp\":\"2026-03-01T00:00:00.000Z\"}],\"bundleCount\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:35.626Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\",\"requiredBundleIds\":[\"test\",\"guest\",\"business\",\"diylegacy\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.627Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:35.626Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\"}\n{\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:35.627Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":32,\"accessTokenPrefix\":\"7df1b969...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.627Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-28T22:27:35.627Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"Checking for test scenario\":null}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.627Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-28T22:27:35.627Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Resolving periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vatNumber\":\"793211922\"}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-01-28T22:27:35.627Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"msg\":\"Validating fraud prevention headers for HMRC API request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.627Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:35.627Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Validating fraud prevention headers\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Public-IP\",\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Public-IP\",\"Gov-Vendor-Forwarded\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.766Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:35.766Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"INVALID_HEADERS\",\"validationMessage\":\"At least 1 header is invalid\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.767Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:35.766Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Fraud prevention header validation errors\",\"errors\":[{\"code\":\"MISSING_HEADER\",\"message\":\"Header missing. You will not be able to submit a header if the connection is between client and server in a private network. If this is the case, you must contact us explaining why you cannot submit this header.\",\"headers\":[\"gov-client-public-port\"]}]}\n{\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:35.766Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"MISSING_HEADER\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.767Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:35.767Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.770Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:35.770Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.770Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:35.770Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Request to GET https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"Gov-Client-Public-IP\":\"178.231.187.149\",\"Gov-Client-Device-ID\":\"bb3fbc56-9ec5-4136-98fe-7d71fe43c24a\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Public-IP\":\"178.231.187.149\",\"Gov-Vendor-Forwarded\":\"by=178.231.187.149&for=178.231.187.149\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"Gov-Client-Public-IP-Timestamp\":\"2026-01-28T22:27:34.160Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"https://test-api.service.hmrc.gov.uk\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.921Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:35.921Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Response from GET https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"status\":200,\"hmrcResponseBody\":{\"obligations\":[{\"periodKey\":\"18A1\",\"start\":\"2017-01-01\",\"end\":\"2017-03-31\",\"due\":\"2017-05-07\",\"status\":\"O\"}]}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.922Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:35.922Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.924Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:35.924Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=O\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.925Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-28T22:27:35.924Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Resolved periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"resolvedPeriodKey\":\"18A1\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.925Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:35.925Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-return-post-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.927Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:35.927Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-return-post-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.927Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-28T22:27:35.927Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":false}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnPost.js\",\"time\":\"2026-01-28T22:27:35.927Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Found persisted request\",\"status\":\"completed\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.927Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:35.927Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:35.927Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:35.927Z\",\"requestId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return\",\"response\":{\"statusCode\":200,\"headers\":{\"Gov-Client-Public-IP\":\"178.231.187.149\",\"Gov-Client-Device-ID\":\"bb3fbc56-9ec5-4136-98fe-7d71fe43c24a\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Public-IP\":\"178.231.187.149\",\"Gov-Vendor-Forwarded\":\"by=178.231.187.149&for=178.231.187.149\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"Gov-Client-Public-IP-Timestamp\":\"2026-01-28T22:27:34.160Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"056ae9d8-0370-4952-bd9c-74e24aaf4f78\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"receipt\\\":{\\\"processingDate\\\":\\\"2026-01-28T22:27:34.850Z\\\",\\\"formBundleNumber\\\":\\\"824422898682\\\",\\\"paymentIndicator\\\":\\\"DD\\\",\\\"chargeRefNumber\\\":\\\"1IwLyFgkLFpSxwmh\\\"},\\\"hmrcResponse\\\":{\\\"ok\\\":true,\\\"status\\\":201,\\\"statusText\\\":\\\"Created\\\",\\\"headers\\\":{\\\"cache-control\\\":\\\"no-cache,no-store,max-age=0\\\",\\\"connection\\\":\\\"keep-alive\\\",\\\"content-length\\\":\\\"140\\\",\\\"content-security-policy\\\":\\\"default-src 'self'\\\",\\\"content-type\\\":\\\"application/json\\\",\\\"date\\\":\\\"Wed, 28 Jan 2026 22:27:34 GMT\\\",\\\"receipt-id\\\":\\\"613cc208-6c20-42a9-aead-fb5cef56a05a\\\",\\\"receipt-signature\\\":\\\"This has been deprecated - DO NOT USE\\\",\\\"receipt-timestamp\\\":\\\"2026-01-28T22:27:34Z\\\",\\\"strict-transport-security\\\":\\\"max-age=31536000;\\\",\\\"vary\\\":\\\"Origin\\\",\\\"via\\\":\\\"1.1 5de5e66003332bec09dff893114ac06c.cloudfront.net (CloudFront)\\\",\\\"x-amz-cf-id\\\":\\\"DtF15HzbRmDX4eGx9bpqu-fc_Fki4sABSs-NE4UIsMjbpRX2nEDBSQ==\\\",\\\"x-amz-cf-pop\\\":\\\"AMS1-P1\\\",\\\"x-cache\\\":\\\"Miss from cloudfront\\\",\\\"x-content-type-options\\\":\\\"nosniff, nosniff\\\",\\\"x-correlationid\\\":\\\"613cc208-6c20-42a9-aead-fb5cef56a05a\\\",\\\"x-envoy-upstream-service-time\\\":\\\"31\\\",\\\"x-frame-options\\\":\\\"SAMEORIGIN\\\"}},\\\"hmrcResponseBody\\\":{\\\"processingDate\\\":\\\"2026-01-28T22:27:34.850Z\\\",\\\"formBundleNumber\\\":\\\"824422898682\\\",\\\"paymentIndicator\\\":\\\"DD\\\",\\\"chargeRefNumber\\\":\\\"1IwLyFgkLFpSxwmh\\\"},\\\"periodKey\\\":\\\"18A1\\\",\\\"receiptId\\\":\\\"2026-01-28T22:27:34.860Z-824422898682\\\"}\"}}"}
[BROWSER CONSOLE log]: finished async request [POST /api/v1/hmrc/vat/return] (poll #1, elapsed: 1400ms, status: 200)
[BROWSER CONSOLE log]: Status message: VAT return processed Type: success
[BROWSER CONSOLE log]: Page display transition: Displaying receipt and hiding form {receipt: Object, hmrcResponse: Object, hmrcResponseBody: Object, periodKey: 18A1, receiptId: 2026-01-28T22:27:34.860Z-824422898682}
[BROWSER CONSOLE log]: Continue submission handler (success, session storage cleared)
[Test] Captured resolved periodKey from response: 18A1
Waiting for VAT submission to complete and receipt to be displayed...
Current URL: https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/submitVat.html?hmrcAccount=sandbox
Page title: Submit VAT Return - DIY Accounting
Body element exists: true
Main content element exists: true
Receipt element exists: true
Receipt element style: display: block;
Form element exists: true
Form element style: display: none;
Receipt element visible: true
formBundleNumber validated: 824422898682
chargeRefNumber validated: 1IwLyFgkLFpSxwmh
processingDate validated: 28 January 2026 at 23:27 (parsed as 2026-01-28T22:27:00.000Z)
VAT submission flow completed successfully with validated receipt fields
Navigating to Receipts via main navigation...
[USER INTERACTION] Clicking: nav.main-nav a:has-text('Receipts') - Clicking Receipts in main navigation
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:38.660Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:38.660Z\",\"msg\":\"HTTP GET /hmrc/receipt/receipts.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:38.781Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:38.780Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:38.820Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:38.820Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:38.836Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:38.836Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:38.856Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:38.856Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:38.856Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:38.856Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:38.857Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:38.857Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:38.858Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:38.858Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:38.858Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:38.858Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:38.930Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:38.930Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:38.930Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:38.930Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:38.948Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:38.948Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:38.949Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:38.948Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:38.950Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:38.950Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:38.950Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:38.950Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:38.951Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:38.951Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:38.951Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:38.951Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:38.952Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:38.952Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: "script-src 'self' 'unsafe-inline'". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked.
[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp
[BROWSER CONSOLE log]: User is authenticated
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE warning]: Failed to load RUM client: Event
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.047Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:39.047Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.048Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:39.047Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.048Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:39.048Z\",\"requestId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/receipt/receipts.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.048Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:39.048Z\",\"requestId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.048Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:39.048Z\",\"requestId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.048Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:39.048Z\",\"requestId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.049Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:39.048Z\",\"requestId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:39.048Z\",\"requestId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.049Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:39.049Z\",\"requestId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.053Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:39.053Z\",\"requestId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.053Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:39.053Z\",\"requestId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:39.053Z\",\"requestId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:39.053Z\",\"requestId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.053Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:39.053Z\",\"requestId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"6c5c5e90-06e1-4d4d-9c06-575643ae3ae9\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-29T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:14.419Z\\\",\\\"ttl\\\":1772323200,\\\"ttl_datestamp\\\":\\\"2026-03-01T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.055Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:39.055Z\",\"msg\":\"HTTP GET /api/v1/hmrc/receipt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.056Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:39.056Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.056Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:39.056Z\",\"requestId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/receipt\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/receipt\"}},\"path\":\"/api/v1/hmrc/receipt\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/receipt/receipts.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.056Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:39.056Z\",\"requestId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"https://test-api.service.hmrc.gov.uk\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:39.056Z\",\"requestId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"message\":\"Extracting user information from event\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.057Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:39.056Z\",\"requestId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.057Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:39.057Z\",\"requestId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/receipt\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/receipt\"}},\"path\":\"/api/v1/hmrc/receipt\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/receipt/receipts.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.058Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:39.057Z\",\"requestId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.058Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:39.058Z\",\"requestId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.058Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:39.058Z\",\"requestId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.060Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:39.060Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.061Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:39.061Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.061Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:39.061Z\",\"requestId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/receipt/receipts.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:39.061Z\",\"requestId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.061Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:39.061Z\",\"requestId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:39.061Z\",\"requestId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.061Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:39.061Z\",\"requestId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.061Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:39.061Z\",\"requestId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.061Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:39.061Z\",\"requestId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.063Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:39.063Z\",\"requestId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:39.063Z\",\"requestId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:39.063Z\",\"requestId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-01-29T00:00:00.000Z\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-01-28T22:27:14.419Z\",\"ttl\":1772323200,\"ttl_datestamp\":\"2026-03-01T00:00:00.000Z\"}],\"bundleCount\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:39.063Z\",\"requestId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/receipt\",\"requiredBundleIds\":[\"default\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.064Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:39.063Z\",\"requestId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/receipt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.064Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcReceiptGet.js\",\"time\":\"2026-01-28T22:27:39.064Z\",\"requestId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"message\":\"Listing user receipts\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.064Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-01-28T22:27:39.064Z\",\"requestId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"message\":\"DynamoDB enabled, proceeding with listUserReceipts [table: test-receipts-table]\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.064Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-01-28T22:27:39.064Z\",\"requestId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"message\":\"Retrieving receipts from DynamoDB\",\"userSub\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.066Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:39.065Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.066Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:39.065Z\",\"requestId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:39.066Z\",\"requestId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.066Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:39.066Z\",\"requestId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.066Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:39.066Z\",\"requestId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.066Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:39.066Z\",\"requestId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"b0f22d41-14fe-452e-9ad4-b9b4f3548691\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-29T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:14.419Z\\\",\\\"ttl\\\":1772323200,\\\"ttl_datestamp\\\":\\\"2026-03-01T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.066Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:39.066Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.067Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-01-28T22:27:39.067Z\",\"requestId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"message\":\"Queried DynamoDB for user receipts\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.068Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-01-28T22:27:39.067Z\",\"requestId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"message\":\"Retrieved receipts from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.068Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:39.068Z\",\"requestId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/receipt\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"ccd9da3e-29d1-4b65-b206-61e1db11093f\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"receipts\\\":[{\\\"receiptId\\\":\\\"2026-01-28T22:27:34.860Z-824422898682\\\",\\\"key\\\":\\\"receipts/user/2026-01-28T22:27:34.860Z-824422898682.json\\\",\\\"name\\\":\\\"2026-01-28T22:27:34.860Z-824422898682.json\\\",\\\"timestamp\\\":\\\"2026-01-28T22:27:34.860Z\\\",\\\"formBundleNumber\\\":\\\"824422898682\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:34.860Z\\\",\\\"lastModified\\\":\\\"2026-01-28T22:27:34.860Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:39.160Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:39.160Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
Checking receipts page...
Found receipts, clicking on first receipt...
[USER INTERACTION] Clicking: [Locator] - Open first receipt
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:40.742Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:40.742Z\",\"msg\":\"HTTP GET /api/v1/hmrc/receipt/2026-01-28T22%3A27%3A34.860Z-824422898682.json\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:40.743Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:40.743Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:40.743Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:40.743Z\",\"requestId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/receipt/2026-01-28T22%3A27%3A34.860Z-824422898682.json\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/receipt/2026-01-28T22%3A27%3A34.860Z-824422898682.json\"}},\"path\":\"/api/v1/hmrc/receipt/2026-01-28T22%3A27%3A34.860Z-824422898682.json\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/receipt/receipts.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{\"name\":\"2026-01-28T22:27:34.860Z-824422898682.json\"}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:40.743Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:40.743Z\",\"requestId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"https://test-api.service.hmrc.gov.uk\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:40.743Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:40.743Z\",\"requestId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"message\":\"Extracting user information from event\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:40.743Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:40.743Z\",\"requestId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:40.744Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:40.743Z\",\"requestId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/receipt/2026-01-28T22%3A27%3A34.860Z-824422898682.json\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/receipt/2026-01-28T22%3A27%3A34.860Z-824422898682.json\"}},\"path\":\"/api/v1/hmrc/receipt/2026-01-28T22%3A27%3A34.860Z-824422898682.json\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/receipt/receipts.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{\"name\":\"2026-01-28T22:27:34.860Z-824422898682.json\"}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:40.744Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:40.744Z\",\"requestId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:40.744Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:40.744Z\",\"requestId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:40.744Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:40.744Z\",\"requestId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:40.747Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:40.747Z\",\"requestId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:40.747Z\",\"requestId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:40.747Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:40.747Z\",\"requestId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-01-29T00:00:00.000Z\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-01-28T22:27:14.419Z\",\"ttl\":1772323200,\"ttl_datestamp\":\"2026-03-01T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:40.747Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:40.747Z\",\"requestId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/receipt/2026-01-28T22%3A27%3A34.860Z-824422898682.json\",\"requiredBundleIds\":[\"default\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:40.747Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:40.747Z\",\"requestId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/receipt/2026-01-28T22%3A27%3A34.860Z-824422898682.json\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:40.747Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcReceiptGet.js\",\"time\":\"2026-01-28T22:27:40.747Z\",\"requestId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"message\":\"Retrieving single receipt\",\"receiptId\":\"2026-01-28T22:27:34.860Z-824422898682\",\"key\":\"receipts/user/2026-01-28T22:27:34.860Z-824422898682.json\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:40.747Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-01-28T22:27:40.747Z\",\"requestId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"message\":\"DynamoDB enabled, proceeding with getReceipt [table: test-receipts-table]\",\"userSub\":\"user\",\"receiptId\":\"2026-01-28T22:27:34.860Z-824422898682\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:40.748Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-01-28T22:27:40.747Z\",\"requestId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"message\":\"Retrieving receipt from DynamoDB\",\"userSub\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"receiptId\":\"2026-01-28T22:27:34.860Z-824422898682\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:40.750Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbReceiptRepository.js\",\"time\":\"2026-01-28T22:27:40.750Z\",\"requestId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"4ceb9495-4ae3-4e5c-a565-8f27001766d1\",\"message\":\"Retrieved receipt from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"receiptId\":\"2026-01-28T22:27:34.860Z-824422898682\"}"}
Returning to home via main navigation...
[USER INTERACTION] Clicking: nav.main-nav a:has-text('Activities') - Clicking Activities in main navigation
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.625Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:41.625Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.730Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:41.730Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.730Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:41.730Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.780Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:41.780Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.781Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:41.781Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.781Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:41.781Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.782Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:41.782Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.783Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:41.783Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.784Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:41.783Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
[BROWSER CONSOLE log]: Current activity cleared
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.868Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:41.867Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.871Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:41.871Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.899Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:41.899Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.900Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:41.900Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.901Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:41.901Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.902Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:41.902Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.903Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:41.903Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.904Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:41.904Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.905Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:41.904Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: "script-src 'self' 'unsafe-inline'". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked.
[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp
[BROWSER CONSOLE log]: User is authenticated
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE log]: User is authenticated
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE warning]: Failed to load RUM client: Event
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.995Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:41.995Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.995Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:41.995Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.995Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:41.995Z\",\"requestId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/index.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.995Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:41.995Z\",\"requestId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:41.995Z\",\"requestId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:41.995Z\",\"requestId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.995Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:41.995Z\",\"requestId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:41.995Z\",\"requestId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.996Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:41.996Z\",\"requestId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.999Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:41.999Z\",\"requestId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.999Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:41.999Z\",\"requestId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:41.999Z\",\"requestId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.999Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:41.999Z\",\"requestId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:41.999Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:41.999Z\",\"requestId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"908e8c3b-6cee-4d64-9ec3-f5a889deee4f\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-29T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:14.419Z\\\",\\\"ttl\\\":1772323200,\\\"ttl_datestamp\\\":\\\"2026-03-01T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.001Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:42.001Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.001Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:42.001Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.002Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:42.001Z\",\"requestId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/index.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.002Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:42.002Z\",\"requestId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.002Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:42.002Z\",\"requestId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.002Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:42.002Z\",\"requestId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.002Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:42.002Z\",\"requestId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.003Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:42.002Z\",\"requestId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.003Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:42.003Z\",\"requestId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.004Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:42.004Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:42.004Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.005Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:42.005Z\",\"requestId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.005Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:42.005Z\",\"requestId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:42.005Z\",\"requestId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.005Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:42.005Z\",\"requestId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.005Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:42.005Z\",\"requestId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"f904a1b5-9f9d-4783-a4b2-2536b709cd25\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-29T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:14.419Z\\\",\\\"ttl\\\":1772323200,\\\"ttl_datestamp\\\":\\\"2026-03-01T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.061Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.100Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:42.100Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.100Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:42.100Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
[USER INTERACTION] Clicking: button:has-text('View VAT Return (HMRC Sandbox)') - Starting View VAT Return
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.855Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:42.855Z\",\"msg\":\"HTTP GET /hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.955Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:42.953Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.981Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:42.981Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:42.982Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:42.982Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.011Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:43.011Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.012Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:43.012Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.014Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:43.013Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:43.014Z\",\"msg\":\"HTTP GET /lib/test-data-generator.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.014Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:43.014Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.014Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:43.014Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.014Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:43.014Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
[BROWSER CONSOLE log]: JS block finished loading.
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.095Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:43.094Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.116Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:43.115Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.122Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:43.122Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.123Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:43.123Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.123Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:43.123Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.124Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:43.124Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.125Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:43.125Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.126Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:43.126Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.127Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:43.127Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.128Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:43.128Z\",\"msg\":\"HTTP GET /submit.env\"}"}
[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: "script-src 'self' 'unsafe-inline'". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked.
[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE log]: JS block started loading: DOMContentLoaded event handler
[BROWSER CONSOLE log]: OAuth callback handler (accessToken found)
[BROWSER CONSOLE log]: No pending return request found
[BROWSER CONSOLE log]: JS block finished loading: DOMContentLoaded event handler
[BROWSER CONSOLE warning]: Failed to load RUM client: Event
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.218Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:43.218Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.218Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:43.218Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.218Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:43.218Z\",\"requestId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"46a067a6-aedf-4998-b868-f7501c9e6646\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.218Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:43.218Z\",\"requestId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:43.218Z\",\"requestId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.218Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:43.218Z\",\"requestId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.218Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:43.218Z\",\"requestId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.219Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:43.218Z\",\"requestId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.219Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:43.219Z\",\"requestId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.221Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:43.221Z\",\"requestId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.221Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:43.221Z\",\"requestId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:43.221Z\",\"requestId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.221Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:43.221Z\",\"requestId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.221Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:43.221Z\",\"requestId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"46a067a6-aedf-4998-b868-f7501c9e6646\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-29T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:14.419Z\\\",\\\"ttl\\\":1772323200,\\\"ttl_datestamp\\\":\\\"2026-03-01T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.222Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:43.222Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.234Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:43.234Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.234Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:43.234Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.235Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:43.235Z\",\"requestId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.235Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:43.235Z\",\"requestId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.236Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:43.235Z\",\"requestId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:43.235Z\",\"requestId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:43.235Z\",\"requestId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:43.235Z\",\"requestId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:43.235Z\",\"requestId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.238Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:43.238Z\",\"requestId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.238Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:43.238Z\",\"requestId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.239Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:43.238Z\",\"requestId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:43.238Z\",\"requestId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:43.239Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:43.238Z\",\"requestId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"f0112c4b-1efe-435b-ac18-6435de4c6ffa\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-29T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:14.419Z\\\",\\\"ttl\\\":1772323200,\\\"ttl_datestamp\\\":\\\"2026-03-01T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:44.433Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: #testDataLink a - Clicking add test data link
[BROWSER CONSOLE log]: [Test Data] Populated view VAT return form with test data
[USER INTERACTION] Filling: #vrn with value: "793211922" - Entering VAT registration number
Set period dates: 2017-01-01 to 2017-03-31
[USER INTERACTION] Clicking: button:has-text('Show Developer Options') - Show Developer Options
Checked runFraudPreventionHeaderValidation checkbox
[USER INTERACTION] Focusing: #retrieveBtn - Retrieve button
[USER INTERACTION] Clicking: #retrieveBtn - Submitting view VAT return form
[BROWSER CONSOLE log]: Status message: Retrieving VAT return... Type: info
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.449Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:47.448Z\",\"msg\":\"HTTP GET /api/v1/hmrc/vat/return?vrn=793211922&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.449Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:47.449Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"25e3d04d-60bd-46a0-9b5e-9c7463faabd5\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.450Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:47.450Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return?vrn=793211922&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"25e3d04d-60bd-46a0-9b5e-9c7463faabd5\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer 7df1b969f13835c1544ca07899f70b90\",\"cache-control\":\"no-cache\",\"content-type\":\"application/json\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"gov-client-device-id\":\"b02a18d2-a464-4c1f-9c2b-47c9a65110a0\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"gov-client-public-ip\":\"178.231.187.149\",\"gov-client-public-ip-timestamp\":\"2026-01-28T22:27:47.366Z\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"gov-client-user-ids\":\"browser=user\",\"gov-client-window-size\":\"width=1280&height=1446\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiMjVlM2QwNGQtNjBiZC00NmEwLTliNWUtOWM3NDYzZmFhYmQ1IiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.lA64kP5VGyYIAm8D_-O7Zs2U2_i5ERfYvCWoT9L_oa0YrpCSeAKjJZwHI-caqsmlVNhfZDNsJJACzNNKEFeCU8PG21vWz8DB2EkUyNqWbk05k-3UVlab_aazMYOWuW5km2koSzcZnAtPUThf3yLtCCxxyyHy-Xug9mmNJ-mHcGE6NfWlw4KOXjGYDcB0v65NoAIdbMKB0ul0Obi_fYXgS8TtkQiIMit5pzgzQZhogzz_zwiEYTK4AKQoGIakEDAllmX4Z_htR1D4Ub225Tdp_WUg-Reh6MUDOFKeASE_adJ46840Q73eL09yIIXccs8cjVMVLqAf_6tsxezUTdADIQ\",\"x-client-request-id\":\"bc16e866-4d57-4d4b-96e2-830dab437df8\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"x-wait-time-ms\":\"0\"},\"queryStringParameters\":{\"vrn\":\"793211922\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"runFraudPreventionHeaderValidation\":\"true\",\"allowSandboxObligations\":\"true\"},\"rawQueryString\":\"vrn=793211922&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.450Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:47.450Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"https://test-api.service.hmrc.gov.uk\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:47.450Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Extracting user information from event\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.450Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:47.450Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.450Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:47.450Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return?vrn=793211922&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"25e3d04d-60bd-46a0-9b5e-9c7463faabd5\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer 7df1b969f13835c1544ca07899f70b90\",\"cache-control\":\"no-cache\",\"content-type\":\"application/json\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"gov-client-device-id\":\"b02a18d2-a464-4c1f-9c2b-47c9a65110a0\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"gov-client-public-ip\":\"178.231.187.149\",\"gov-client-public-ip-timestamp\":\"2026-01-28T22:27:47.366Z\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"gov-client-user-ids\":\"browser=user\",\"gov-client-window-size\":\"width=1280&height=1446\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiMjVlM2QwNGQtNjBiZC00NmEwLTliNWUtOWM3NDYzZmFhYmQ1IiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.lA64kP5VGyYIAm8D_-O7Zs2U2_i5ERfYvCWoT9L_oa0YrpCSeAKjJZwHI-caqsmlVNhfZDNsJJACzNNKEFeCU8PG21vWz8DB2EkUyNqWbk05k-3UVlab_aazMYOWuW5km2koSzcZnAtPUThf3yLtCCxxyyHy-Xug9mmNJ-mHcGE6NfWlw4KOXjGYDcB0v65NoAIdbMKB0ul0Obi_fYXgS8TtkQiIMit5pzgzQZhogzz_zwiEYTK4AKQoGIakEDAllmX4Z_htR1D4Ub225Tdp_WUg-Reh6MUDOFKeASE_adJ46840Q73eL09yIIXccs8cjVMVLqAf_6tsxezUTdADIQ\",\"x-client-request-id\":\"bc16e866-4d57-4d4b-96e2-830dab437df8\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"x-wait-time-ms\":\"0\"},\"queryStringParameters\":{\"vrn\":\"793211922\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"runFraudPreventionHeaderValidation\":\"true\",\"allowSandboxObligations\":\"true\"},\"rawQueryString\":\"vrn=793211922&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.451Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:47.451Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.451Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:47.451Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.451Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:47.451Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.454Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:47.454Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.454Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:47.454Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.454Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:47.454Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-01-29T00:00:00.000Z\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-01-28T22:27:14.419Z\",\"ttl\":1772323200,\"ttl_datestamp\":\"2026-03-01T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.454Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:47.454Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\",\"requiredBundleIds\":[\"test\",\"guest\",\"business\",\"diylegacy\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.454Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:47.454Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.455Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:47.455Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":32,\"accessTokenPrefix\":\"7df1b969...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.455Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-01-28T22:27:47.455Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.455Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-01-28T22:27:47.455Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Resolving periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vrn\":\"793211922\"}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-01-28T22:27:47.455Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"msg\":\"Validating fraud prevention headers for HMRC API request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.455Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:47.455Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Validating fraud prevention headers\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Public-IP\",\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Public-IP\",\"Gov-Vendor-Forwarded\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.696Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:47.695Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"INVALID_HEADERS\",\"validationMessage\":\"At least 1 header is invalid\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.696Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:47.696Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Fraud prevention header validation errors\",\"errors\":[{\"code\":\"MISSING_HEADER\",\"message\":\"Header missing. You will not be able to submit a header if the connection is between client and server in a private network. If this is the case, you must contact us explaining why you cannot submit this header.\",\"headers\":[\"gov-client-public-port\"]}]}\n{\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:47.696Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"MISSING_HEADER\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.696Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:47.696Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.698Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:47.698Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.699Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:47.698Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Request to GET https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"Gov-Client-Public-IP\":\"178.231.187.149\",\"Gov-Client-Device-ID\":\"b02a18d2-a464-4c1f-9c2b-47c9a65110a0\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Public-IP\":\"178.231.187.149\",\"Gov-Vendor-Forwarded\":\"by=178.231.187.149&for=178.231.187.149\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"Gov-Client-Public-IP-Timestamp\":\"2026-01-28T22:27:47.366Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"https://test-api.service.hmrc.gov.uk\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.815Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:47.815Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Response from GET https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"status\":200,\"hmrcResponseBody\":{\"obligations\":[{\"periodKey\":\"18A1\",\"start\":\"2017-01-01\",\"end\":\"2017-03-31\",\"due\":\"2017-05-07\",\"status\":\"F\",\"received\":\"2017-05-06\"}]}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.815Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:47.815Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.817Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:47.817Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.818Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-01-28T22:27:47.818Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Resolved periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"resolvedPeriodKey\":\"18A1\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.818Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-01-28T22:27:47.818Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.818Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-01-28T22:27:47.818Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Initiating new processing\"}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:47.818Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Marking request as processing in DynamoDB\",\"userId\":\"user\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.818Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:47.818Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-return-get-async-requests-table]\",\"status\":\"processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.818Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:47.818Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Starting async processing locally (no SQS queue URL)\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.818Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-01-28T22:27:47.818Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Validating fraud prevention headers for sandbox account\",\"hmrcAccount\":\"sandbox\",\"runFraudPreventionHeaderValidation\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.819Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:47.818Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Validating fraud prevention headers\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Public-IP\",\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Public-IP\",\"Gov-Vendor-Forwarded\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.819Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:47.819Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Checking persisted request status\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:47.819Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-return-get-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.823Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:47.823Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.823Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:47.823Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.823Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:47.823Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Yielding with HTTP 202 Accepted\",\"location\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.824Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:47.823Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return?vrn=793211922&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"response\":{\"statusCode\":202,\"headers\":{\"Gov-Client-Public-IP\":\"178.231.187.149\",\"Gov-Client-Device-ID\":\"b02a18d2-a464-4c1f-9c2b-47c9a65110a0\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Public-IP\":\"178.231.187.149\",\"Gov-Vendor-Forwarded\":\"by=178.231.187.149&for=178.231.187.149\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"Gov-Client-Public-IP-Timestamp\":\"2026-01-28T22:27:47.366Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"Retry-After\":\"5\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"Location\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"message\\\":\\\"Request accepted for processing\\\"}\"}}"}
[BROWSER CONSOLE log]: waiting async request [GET /api/v1/hmrc/vat/return?vrn=793211922&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true] (timeout: 730000ms)...
[BROWSER CONSOLE log]: Status message: Still processing... Type: info
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.943Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:47.943Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"INVALID_HEADERS\",\"validationMessage\":\"At least 1 header is invalid\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.943Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:47.943Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Fraud prevention header validation errors\",\"errors\":[{\"code\":\"MISSING_HEADER\",\"message\":\"Header missing. You will not be able to submit a header if the connection is between client and server in a private network. If this is the case, you must contact us explaining why you cannot submit this header.\",\"headers\":[\"gov-client-public-port\"]}]}\n{\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:47.943Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"MISSING_HEADER\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.944Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:47.943Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.946Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:47.946Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:47.946Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:47.946Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Request to GET https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/returns/18A1\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/returns/18A1\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"Gov-Client-Public-IP\":\"178.231.187.149\",\"Gov-Client-Device-ID\":\"b02a18d2-a464-4c1f-9c2b-47c9a65110a0\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Public-IP\":\"178.231.187.149\",\"Gov-Vendor-Forwarded\":\"by=178.231.187.149&for=178.231.187.149\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"Gov-Client-Public-IP-Timestamp\":\"2026-01-28T22:27:47.366Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"https://test-api.service.hmrc.gov.uk\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.047Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:48.046Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Response from GET https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/returns/18A1\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/returns/18A1\",\"status\":200,\"hmrcResponseBody\":{\"periodKey\":\"18A1\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":5000,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.047Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:48.047Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/returns/18A1\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.049Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:48.049Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/returns/18A1\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.049Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:48.049Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Local async processing completed successfully\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.050Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:48.049Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Marking async request as completed\",\"userSub\":\"user\",\"asyncRequestsTableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.050Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:48.050Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-return-get-async-requests-table]\",\"status\":\"completed\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.052Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:48.052Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
[BROWSER CONSOLE log]: re-trying async request [GET /api/v1/hmrc/vat/return?vrn=793211922&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true] (poll #1, elapsed: 1001ms, timeout: 730000ms, last status: 202)...
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.908Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:48.908Z\",\"msg\":\"HTTP GET /api/v1/hmrc/vat/return?vrn=793211922&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.908Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:48.908Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"25e3d04d-60bd-46a0-9b5e-9c7463faabd5\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.909Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:48.909Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return?vrn=793211922&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"25e3d04d-60bd-46a0-9b5e-9c7463faabd5\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer 7df1b969f13835c1544ca07899f70b90\",\"cache-control\":\"no-cache\",\"content-type\":\"application/json\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"gov-client-device-id\":\"b02a18d2-a464-4c1f-9c2b-47c9a65110a0\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"gov-client-public-ip\":\"178.231.187.149\",\"gov-client-public-ip-timestamp\":\"2026-01-28T22:27:47.366Z\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"gov-client-user-ids\":\"browser=user\",\"gov-client-window-size\":\"width=1280&height=1446\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiMjVlM2QwNGQtNjBiZC00NmEwLTliNWUtOWM3NDYzZmFhYmQ1IiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.lA64kP5VGyYIAm8D_-O7Zs2U2_i5ERfYvCWoT9L_oa0YrpCSeAKjJZwHI-caqsmlVNhfZDNsJJACzNNKEFeCU8PG21vWz8DB2EkUyNqWbk05k-3UVlab_aazMYOWuW5km2koSzcZnAtPUThf3yLtCCxxyyHy-Xug9mmNJ-mHcGE6NfWlw4KOXjGYDcB0v65NoAIdbMKB0ul0Obi_fYXgS8TtkQiIMit5pzgzQZhogzz_zwiEYTK4AKQoGIakEDAllmX4Z_htR1D4Ub225Tdp_WUg-Reh6MUDOFKeASE_adJ46840Q73eL09yIIXccs8cjVMVLqAf_6tsxezUTdADIQ\",\"x-client-request-id\":\"bc16e866-4d57-4d4b-96e2-830dab437df8\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-request-id\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"x-wait-time-ms\":\"0\"},\"queryStringParameters\":{\"vrn\":\"793211922\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"runFraudPreventionHeaderValidation\":\"true\",\"allowSandboxObligations\":\"true\"},\"rawQueryString\":\"vrn=793211922&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.909Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:48.909Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"https://test-api.service.hmrc.gov.uk\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:48.909Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Extracting user information from event\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.909Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:48.909Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.909Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:48.909Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return?vrn=793211922&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"25e3d04d-60bd-46a0-9b5e-9c7463faabd5\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/vat/return\"}},\"path\":\"/api/v1/hmrc/vat/return\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer 7df1b969f13835c1544ca07899f70b90\",\"cache-control\":\"no-cache\",\"content-type\":\"application/json\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"gov-client-device-id\":\"b02a18d2-a464-4c1f-9c2b-47c9a65110a0\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"gov-client-public-ip\":\"178.231.187.149\",\"gov-client-public-ip-timestamp\":\"2026-01-28T22:27:47.366Z\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"gov-client-user-ids\":\"browser=user\",\"gov-client-window-size\":\"width=1280&height=1446\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/viewVatReturn.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiMjVlM2QwNGQtNjBiZC00NmEwLTliNWUtOWM3NDYzZmFhYmQ1IiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.lA64kP5VGyYIAm8D_-O7Zs2U2_i5ERfYvCWoT9L_oa0YrpCSeAKjJZwHI-caqsmlVNhfZDNsJJACzNNKEFeCU8PG21vWz8DB2EkUyNqWbk05k-3UVlab_aazMYOWuW5km2koSzcZnAtPUThf3yLtCCxxyyHy-Xug9mmNJ-mHcGE6NfWlw4KOXjGYDcB0v65NoAIdbMKB0ul0Obi_fYXgS8TtkQiIMit5pzgzQZhogzz_zwiEYTK4AKQoGIakEDAllmX4Z_htR1D4Ub225Tdp_WUg-Reh6MUDOFKeASE_adJ46840Q73eL09yIIXccs8cjVMVLqAf_6tsxezUTdADIQ\",\"x-client-request-id\":\"bc16e866-4d57-4d4b-96e2-830dab437df8\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-request-id\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"x-wait-time-ms\":\"0\"},\"queryStringParameters\":{\"vrn\":\"793211922\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"runFraudPreventionHeaderValidation\":\"true\",\"allowSandboxObligations\":\"true\"},\"rawQueryString\":\"vrn=793211922&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.910Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:48.910Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.910Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:48.910Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.911Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:48.910Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.913Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:48.913Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.913Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:48.913Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:48.913Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-01-29T00:00:00.000Z\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-01-28T22:27:14.419Z\",\"ttl\":1772323200,\"ttl_datestamp\":\"2026-03-01T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.914Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:48.913Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\",\"requiredBundleIds\":[\"test\",\"guest\",\"business\",\"diylegacy\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.914Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:48.914Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/return\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.914Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:48.914Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":32,\"accessTokenPrefix\":\"7df1b969...\",\"isValidFormat\":true}}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-01-28T22:27:48.914Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.914Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-01-28T22:27:48.914Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Resolving periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"vrn\":\"793211922\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.914Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-01-28T22:27:48.914Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"msg\":\"Validating fraud prevention headers for HMRC API request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:48.914Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:48.914Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Validating fraud prevention headers\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"headers\":[\"Gov-Client-Public-IP\",\"Gov-Client-Device-ID\",\"Gov-Client-User-IDs\",\"Gov-Client-Connection-Method\",\"Gov-Vendor-Public-IP\",\"Gov-Vendor-Forwarded\",\"Gov-Vendor-Product-Name\",\"Gov-Vendor-Version\",\"Gov-Client-Browser-JS-User-Agent\",\"Gov-Client-Multi-Factor\",\"Gov-Client-Public-IP-Timestamp\",\"Gov-Client-Screens\",\"Gov-Client-Timezone\",\"Gov-Client-Window-Size\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:49.074Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:49.073Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Fraud prevention header validation response\",\"status\":200,\"code\":\"INVALID_HEADERS\",\"validationMessage\":\"At least 1 header is invalid\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:49.074Z","msg":"[http-stdout]: {\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:49.074Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Fraud prevention header validation errors\",\"errors\":[{\"code\":\"MISSING_HEADER\",\"message\":\"Header missing. You will not be able to submit a header if the connection is between client and server in a private network. If this is the case, you must contact us explaining why you cannot submit this header.\",\"headers\":[\"gov-client-public-port\"]}]}\n{\"level\":40,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:49.074Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Fraud prevention header validation warnings\",\"warnings\":[{\"code\":\"MISSING_HEADER\",\"message\":\"Header required\",\"headers\":[\"gov-vendor-license-ids\"]}]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:49.074Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:49.074Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:49.076Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:49.076Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:49.077Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:49.076Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Request to GET https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"Gov-Client-Public-IP\":\"178.231.187.149\",\"Gov-Client-Device-ID\":\"b02a18d2-a464-4c1f-9c2b-47c9a65110a0\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Public-IP\":\"178.231.187.149\",\"Gov-Vendor-Forwarded\":\"by=178.231.187.149&for=178.231.187.149\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"Gov-Client-Public-IP-Timestamp\":\"2026-01-28T22:27:47.366Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"https://test-api.service.hmrc.gov.uk\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:49.221Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:49.221Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Response from GET https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"status\":200,\"hmrcResponseBody\":{\"obligations\":[{\"periodKey\":\"18A1\",\"start\":\"2017-01-01\",\"end\":\"2017-03-31\",\"due\":\"2017-05-07\",\"status\":\"F\",\"received\":\"2017-05-06\"}]}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:49.221Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:49.221Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:49.224Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:49.224Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=F\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:49.224Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-01-28T22:27:49.224Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Resolved periodKey from date range\",\"periodStart\":\"2017-01-01\",\"periodEnd\":\"2017-03-31\",\"resolvedPeriodKey\":\"18A1\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:49.224Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:49.224Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-return-get-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:49.226Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:49.226Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-return-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:49.226Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-01-28T22:27:49.226Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":false}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatReturnGet.js\",\"time\":\"2026-01-28T22:27:49.226Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Found persisted request\",\"status\":\"completed\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:49.226Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:49.226Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:49.226Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:49.226Z\",\"requestId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/return?vrn=793211922&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true\",\"response\":{\"statusCode\":200,\"headers\":{\"Gov-Client-Public-IP\":\"178.231.187.149\",\"Gov-Client-Device-ID\":\"b02a18d2-a464-4c1f-9c2b-47c9a65110a0\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Public-IP\":\"178.231.187.149\",\"Gov-Vendor-Forwarded\":\"by=178.231.187.149&for=178.231.187.149\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"Gov-Client-Public-IP-Timestamp\":\"2026-01-28T22:27:47.366Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"8de749a1-4d65-4987-b304-5def0d56631e\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"periodKey\\\":\\\"18A1\\\",\\\"vatDueSales\\\":1000,\\\"vatDueAcquisitions\\\":0,\\\"totalVatDue\\\":1000,\\\"vatReclaimedCurrPeriod\\\":0,\\\"netVatDue\\\":1000,\\\"totalValueSalesExVAT\\\":5000,\\\"totalValuePurchasesExVAT\\\":0,\\\"totalValueGoodsSuppliedExVAT\\\":0,\\\"totalAcquisitionsExVAT\\\":0}\"}}"}
[BROWSER CONSOLE log]: finished async request [GET /api/v1/hmrc/vat/return?vrn=793211922&periodStart=2017-01-01&periodEnd=2017-03-31&runFraudPreventionHeaderValidation=true&allowSandboxObligations=true] (poll #1, elapsed: 1396ms, status: 200)
[BROWSER CONSOLE log]: Status message: VAT return retrieved. Type: success
[BROWSER CONSOLE log]: Hiding all status messages
VAT due on sales validated: £1000.00
VAT due on acquisitions validated: £0.00
Total VAT due validated: £1000.00
VAT reclaimed on purchases validated: £0.00
View VAT return completed successfully with validated fields
Returning to home via main navigation...
[USER INTERACTION] Clicking: nav.main-nav a:has-text('Activities') - Clicking Activities in main navigation
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.208Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.208Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.305Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.302Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.348Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.348Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.349Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.349Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.350Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.349Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.350Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.350Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.350Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.350Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.380Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.380Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.381Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.381Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
[BROWSER CONSOLE log]: Current activity cleared
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.462Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.462Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.462Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.462Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.463Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.463Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.464Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.464Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.465Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.465Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.466Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.466Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.467Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.467Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.467Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.467Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.468Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.468Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: "script-src 'self' 'unsafe-inline'". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked.
[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp
[BROWSER CONSOLE log]: User is authenticated
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE log]: User is authenticated
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE warning]: Failed to load RUM client: Event
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.580Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.580Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.581Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.581Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.581Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:50.581Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.582Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:50.581Z\",\"requestId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/index.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.582Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:50.582Z\",\"requestId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.582Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:50.582Z\",\"requestId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:50.582Z\",\"requestId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"message\":\"Retrieving bundles for request\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.582Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:50.582Z\",\"requestId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.582Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:50.582Z\",\"requestId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.582Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:50.582Z\",\"requestId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.584Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.584Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}\n{\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.584Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.585Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:50.585Z\",\"requestId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.585Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:50.585Z\",\"requestId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:50.585Z\",\"requestId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.585Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:50.585Z\",\"requestId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.585Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:50.585Z\",\"requestId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"ca02db69-ea27-45fa-b288-ae113c3aa876\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-29T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:14.419Z\\\",\\\"ttl\\\":1772323200,\\\"ttl_datestamp\\\":\\\"2026-03-01T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.586Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:50.586Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.586Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:50.586Z\",\"requestId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/index.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.586Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:50.586Z\",\"requestId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:50.586Z\",\"requestId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.586Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:50.586Z\",\"requestId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:50.586Z\",\"requestId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.587Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:50.586Z\",\"requestId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.587Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:50.587Z\",\"requestId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.589Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:50.589Z\",\"requestId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.589Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:50.589Z\",\"requestId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:50.589Z\",\"requestId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:50.589Z\",\"requestId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.589Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:50.589Z\",\"requestId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"00b1b5d5-09cf-406d-a656-806c05f5f3fe\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-29T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:14.419Z\\\",\\\"ttl\\\":1772323200,\\\"ttl_datestamp\\\":\\\"2026-03-01T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.648Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.675Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.675Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:50.680Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:50.680Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
[USER INTERACTION] Clicking: button:has-text('VAT Obligations (HMRC Sandbox)') - Starting VAT Obligations
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.435Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.435Z\",\"msg\":\"HTTP GET /hmrc/vat/vatObligations.html?hmrcAccount=sandbox\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.518Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.518Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.535Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.535Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.538Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.538Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.554Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.554Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.556Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.556Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.556Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.556Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.564Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.564Z\",\"msg\":\"HTTP GET /lib/test-data-generator.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.564Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.564Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.565Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.565Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.565Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.565Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
[BROWSER CONSOLE log]: JS block finished loading.
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.668Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.668Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.669Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.669Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.669Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.669Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.670Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.670Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.670Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.670Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.671Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.671Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.672Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.672Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.672Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.672Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.673Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.673Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.673Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.673Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: "script-src 'self' 'unsafe-inline'". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked.
[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE log]: JS block started loading: DOMContentLoaded event handler
[BROWSER CONSOLE log]: OAuth callback handler (accessToken found)
[BROWSER CONSOLE log]: No pending obligations request found
[BROWSER CONSOLE log]: JS block finished loading: DOMContentLoaded event handler
[BROWSER CONSOLE warning]: Failed to load RUM client: Event
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.773Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.773Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.773Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.773Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.774Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:51.774Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.774Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:51.774Z\",\"requestId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.774Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:51.774Z\",\"requestId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:51.774Z\",\"requestId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.774Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:51.774Z\",\"requestId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:51.774Z\",\"requestId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.774Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:51.774Z\",\"requestId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.774Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:51.774Z\",\"requestId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.776Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:51.775Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:51.775Z\",\"requestId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:51.775Z\",\"requestId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:51.775Z\",\"requestId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:51.776Z\",\"requestId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:51.776Z\",\"requestId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:51.776Z\",\"requestId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:51.776Z\",\"requestId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.777Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:51.777Z\",\"requestId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.778Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:51.777Z\",\"requestId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:51.777Z\",\"requestId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.778Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:51.778Z\",\"requestId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.778Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:51.778Z\",\"requestId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"b86b06cb-631a-4459-a598-ca3c259b7d80\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-29T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:14.419Z\\\",\\\"ttl\\\":1772323200,\\\"ttl_datestamp\\\":\\\"2026-03-01T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.778Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:51.778Z\",\"requestId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.779Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:51.778Z\",\"requestId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:51.778Z\",\"requestId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:51.778Z\",\"requestId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.779Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:51.778Z\",\"requestId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"9238e37b-28c7-4d1e-b3d7-9d43f24b4032\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-29T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:14.419Z\\\",\\\"ttl\\\":1772323200,\\\"ttl_datestamp\\\":\\\"2026-03-01T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:51.779Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:51.779Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:53.074Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[USER INTERACTION] Clicking: #testDataLink a - Clicking add test data link
[BROWSER CONSOLE log]: [Test Data] Populated VAT obligations form with test data
[USER INTERACTION] Filling: #vrn with value: "793211922" - Entering VAT registration number
[USER INTERACTION] Filling: #fromDate with value: "2025-01-01" - Entering from date
[USER INTERACTION] Filling: #toDate with value: "2025-12-01" - Entering to date
[USER INTERACTION] Focusing: #status - the obligations status filter
[USER INTERACTION] Focusing: #retrieveBtn - Retrieve button
[USER INTERACTION] Clicking: #retrieveBtn - Submitting VAT obligations form
[BROWSER CONSOLE log]: Status message: Retrieving VAT obligations... Type: info
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.323Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:56.323Z\",\"msg\":\"HTTP GET /api/v1/hmrc/vat/obligation?vrn=793211922&from=2025-01-01&to=2025-12-01\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.323Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:56.323Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"25e3d04d-60bd-46a0-9b5e-9c7463faabd5\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.324Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:56.324Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/obligation?vrn=793211922&from=2025-01-01&to=2025-12-01\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"25e3d04d-60bd-46a0-9b5e-9c7463faabd5\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/vat/obligation\"}},\"path\":\"/api/v1/hmrc/vat/obligation\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer 7df1b969f13835c1544ca07899f70b90\",\"cache-control\":\"no-cache\",\"content-type\":\"application/json\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"gov-client-device-id\":\"49b124eb-c333-4f74-9bd1-9adff9655300\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"gov-client-public-ip\":\"178.231.187.149\",\"gov-client-public-ip-timestamp\":\"2026-01-28T22:27:56.229Z\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"gov-client-user-ids\":\"browser=user\",\"gov-client-window-size\":\"width=1280&height=1446\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiMjVlM2QwNGQtNjBiZC00NmEwLTliNWUtOWM3NDYzZmFhYmQ1IiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.lA64kP5VGyYIAm8D_-O7Zs2U2_i5ERfYvCWoT9L_oa0YrpCSeAKjJZwHI-caqsmlVNhfZDNsJJACzNNKEFeCU8PG21vWz8DB2EkUyNqWbk05k-3UVlab_aazMYOWuW5km2koSzcZnAtPUThf3yLtCCxxyyHy-Xug9mmNJ-mHcGE6NfWlw4KOXjGYDcB0v65NoAIdbMKB0ul0Obi_fYXgS8TtkQiIMit5pzgzQZhogzz_zwiEYTK4AKQoGIakEDAllmX4Z_htR1D4Ub225Tdp_WUg-Reh6MUDOFKeASE_adJ46840Q73eL09yIIXccs8cjVMVLqAf_6tsxezUTdADIQ\",\"x-client-request-id\":\"9b8c4a44-58e7-4ebc-8013-04972c6d15cc\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"x-wait-time-ms\":\"0\"},\"queryStringParameters\":{\"vrn\":\"793211922\",\"from\":\"2025-01-01\",\"to\":\"2025-12-01\"},\"rawQueryString\":\"vrn=793211922&from=2025-01-01&to=2025-12-01\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.324Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:56.324Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"https://test-api.service.hmrc.gov.uk\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:56.324Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Extracting user information from event\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.324Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:56.324Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.324Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:56.324Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/obligation?vrn=793211922&from=2025-01-01&to=2025-12-01\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"25e3d04d-60bd-46a0-9b5e-9c7463faabd5\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/vat/obligation\"}},\"path\":\"/api/v1/hmrc/vat/obligation\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer 7df1b969f13835c1544ca07899f70b90\",\"cache-control\":\"no-cache\",\"content-type\":\"application/json\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"gov-client-device-id\":\"49b124eb-c333-4f74-9bd1-9adff9655300\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"gov-client-public-ip\":\"178.231.187.149\",\"gov-client-public-ip-timestamp\":\"2026-01-28T22:27:56.229Z\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"gov-client-user-ids\":\"browser=user\",\"gov-client-window-size\":\"width=1280&height=1446\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiMjVlM2QwNGQtNjBiZC00NmEwLTliNWUtOWM3NDYzZmFhYmQ1IiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.lA64kP5VGyYIAm8D_-O7Zs2U2_i5ERfYvCWoT9L_oa0YrpCSeAKjJZwHI-caqsmlVNhfZDNsJJACzNNKEFeCU8PG21vWz8DB2EkUyNqWbk05k-3UVlab_aazMYOWuW5km2koSzcZnAtPUThf3yLtCCxxyyHy-Xug9mmNJ-mHcGE6NfWlw4KOXjGYDcB0v65NoAIdbMKB0ul0Obi_fYXgS8TtkQiIMit5pzgzQZhogzz_zwiEYTK4AKQoGIakEDAllmX4Z_htR1D4Ub225Tdp_WUg-Reh6MUDOFKeASE_adJ46840Q73eL09yIIXccs8cjVMVLqAf_6tsxezUTdADIQ\",\"x-client-request-id\":\"9b8c4a44-58e7-4ebc-8013-04972c6d15cc\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"x-wait-time-ms\":\"0\"},\"queryStringParameters\":{\"vrn\":\"793211922\",\"from\":\"2025-01-01\",\"to\":\"2025-12-01\"},\"rawQueryString\":\"vrn=793211922&from=2025-01-01&to=2025-12-01\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.325Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:56.325Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.325Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:56.325Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.325Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:56.325Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.328Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:56.328Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.328Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:56.328Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:56.328Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-01-29T00:00:00.000Z\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-01-28T22:27:14.419Z\",\"ttl\":1772323200,\"ttl_datestamp\":\"2026-03-01T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.328Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:56.328Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/obligation\",\"requiredBundleIds\":[\"test\",\"guest\",\"business\",\"diylegacy\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.328Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:56.328Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/obligation\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.329Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:56.329Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":32,\"accessTokenPrefix\":\"7df1b969...\",\"isValidFormat\":true}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.329Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-01-28T22:27:56.329Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\"}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-01-28T22:27:56.329Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":true}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.329Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-01-28T22:27:56.329Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Initiating new processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.329Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:56.329Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Marking request as processing in DynamoDB\",\"userId\":\"user\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.329Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:56.329Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-obligation-get-async-requests-table]\",\"status\":\"processing\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.329Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:56.329Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Starting async processing locally (no SQS queue URL)\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.329Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-01-28T22:27:56.329Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Skipping fraud prevention header validation for HMRC API request\",\"hmrcAccount\":\"sandbox\",\"runFraudPreventionHeaderValidation\":false}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.329Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:56.329Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Request to GET https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2025-01-01&to=2025-12-01\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2025-01-01&to=2025-12-01\",\"method\":\"GET\",\"headers\":{\"Content-Type\":\"application/json\",\"Accept\":\"application/vnd.hmrc.1.0+json\",\"Authorization\":\"[REDACTED]\",\"x-request-id\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"Gov-Client-Public-IP\":\"178.231.187.149\",\"Gov-Client-Device-ID\":\"49b124eb-c333-4f74-9bd1-9adff9655300\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Public-IP\":\"178.231.187.149\",\"Gov-Vendor-Forwarded\":\"by=178.231.187.149&for=178.231.187.149\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"Gov-Client-Public-IP-Timestamp\":\"2026-01-28T22:27:56.229Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\"},\"testScenario\":null,\"environment\":{\"hmrcBase\":\"https://test-api.service.hmrc.gov.uk\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.331Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:56.331Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Checking persisted request status\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.331Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:56.331Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-obligation-get-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.334Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:56.334Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.334Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:56.334Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"processing\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.335Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:56.334Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Yielding with HTTP 202 Accepted\",\"location\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/obligation\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.335Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:56.335Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/obligation?vrn=793211922&from=2025-01-01&to=2025-12-01\",\"response\":{\"statusCode\":202,\"headers\":{\"Gov-Client-Public-IP\":\"178.231.187.149\",\"Gov-Client-Device-ID\":\"49b124eb-c333-4f74-9bd1-9adff9655300\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Public-IP\":\"178.231.187.149\",\"Gov-Vendor-Forwarded\":\"by=178.231.187.149&for=178.231.187.149\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"Gov-Client-Public-IP-Timestamp\":\"2026-01-28T22:27:56.229Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"Retry-After\":\"5\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"Location\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/obligation\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"message\\\":\\\"Request accepted for processing\\\"}\"}}"}
[BROWSER CONSOLE log]: waiting async request [GET /api/v1/hmrc/vat/obligation?vrn=793211922&from=2025-01-01&to=2025-12-01] (timeout: 730000ms)...
[BROWSER CONSOLE log]: Status message: Still processing... Type: info
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.547Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:56.547Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Response from GET https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2025-01-01&to=2025-12-01\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2025-01-01&to=2025-12-01\",\"status\":200,\"hmrcResponseBody\":{\"obligations\":[{\"periodKey\":\"18A1\",\"start\":\"2017-01-01\",\"end\":\"2017-03-31\",\"due\":\"2017-05-07\",\"status\":\"F\",\"received\":\"2017-05-06\"},{\"periodKey\":\"18A2\",\"start\":\"2017-04-01\",\"end\":\"2017-06-30\",\"due\":\"2017-08-07\",\"status\":\"O\"}]}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.547Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:56.547Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"DynamoDB enabled, proceeding with putHmrcApiRequest [table: test-hmrc-api-requests-table]\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2025-01-01&to=2025-12-01\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.550Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbHmrcApiRequestRepository.js\",\"time\":\"2026-01-28T22:27:56.550Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"HmrcApiRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"url\":\"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2025-01-01&to=2025-12-01\",\"method\":\"GET\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.550Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:56.550Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Local async processing completed successfully\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.550Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:56.550Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Marking async request as completed\",\"userSub\":\"user\",\"asyncRequestsTableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.550Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:56.550Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"putAsyncRequest [table: test-hmrc-vat-obligation-get-async-requests-table]\",\"status\":\"completed\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:56.553Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:56.553Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"AsyncRequest stored in DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
[BROWSER CONSOLE log]: re-trying async request [GET /api/v1/hmrc/vat/obligation?vrn=793211922&from=2025-01-01&to=2025-12-01] (poll #1, elapsed: 1001ms, timeout: 730000ms, last status: 202)...
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:57.460Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:57.460Z\",\"msg\":\"HTTP GET /api/v1/hmrc/vat/obligation?vrn=793211922&from=2025-01-01&to=2025-12-01\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:57.461Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:57.461Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"25e3d04d-60bd-46a0-9b5e-9c7463faabd5\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:57.461Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:57.461Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/obligation?vrn=793211922&from=2025-01-01&to=2025-12-01\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"25e3d04d-60bd-46a0-9b5e-9c7463faabd5\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/vat/obligation\"}},\"path\":\"/api/v1/hmrc/vat/obligation\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer 7df1b969f13835c1544ca07899f70b90\",\"cache-control\":\"no-cache\",\"content-type\":\"application/json\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"gov-client-device-id\":\"49b124eb-c333-4f74-9bd1-9adff9655300\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"gov-client-public-ip\":\"178.231.187.149\",\"gov-client-public-ip-timestamp\":\"2026-01-28T22:27:56.229Z\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"gov-client-user-ids\":\"browser=user\",\"gov-client-window-size\":\"width=1280&height=1446\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiMjVlM2QwNGQtNjBiZC00NmEwLTliNWUtOWM3NDYzZmFhYmQ1IiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.lA64kP5VGyYIAm8D_-O7Zs2U2_i5ERfYvCWoT9L_oa0YrpCSeAKjJZwHI-caqsmlVNhfZDNsJJACzNNKEFeCU8PG21vWz8DB2EkUyNqWbk05k-3UVlab_aazMYOWuW5km2koSzcZnAtPUThf3yLtCCxxyyHy-Xug9mmNJ-mHcGE6NfWlw4KOXjGYDcB0v65NoAIdbMKB0ul0Obi_fYXgS8TtkQiIMit5pzgzQZhogzz_zwiEYTK4AKQoGIakEDAllmX4Z_htR1D4Ub225Tdp_WUg-Reh6MUDOFKeASE_adJ46840Q73eL09yIIXccs8cjVMVLqAf_6tsxezUTdADIQ\",\"x-client-request-id\":\"9b8c4a44-58e7-4ebc-8013-04972c6d15cc\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-request-id\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"x-wait-time-ms\":\"0\"},\"queryStringParameters\":{\"vrn\":\"793211922\",\"from\":\"2025-01-01\",\"to\":\"2025-12-01\"},\"rawQueryString\":\"vrn=793211922&from=2025-01-01&to=2025-12-01\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:57.461Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:57.461Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"enforceBundles called\",\"hmrcBase\":\"https://test-api.service.hmrc.gov.uk\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:57.461Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Extracting user information from event\"}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:57.461Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"User info extracted from authorizer context\",\"sub\":\"user\",\"username\":\"test\",\"claims\":[\"sub\",\"username\",\"email\",\"scope\"]}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:57.462Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:57.461Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/obligation?vrn=793211922&from=2025-01-01&to=2025-12-01\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"25e3d04d-60bd-46a0-9b5e-9c7463faabd5\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/hmrc/vat/obligation\"}},\"path\":\"/api/v1/hmrc/vat/obligation\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer 7df1b969f13835c1544ca07899f70b90\",\"cache-control\":\"no-cache\",\"content-type\":\"application/json\",\"gov-client-browser-js-user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"gov-client-device-id\":\"49b124eb-c333-4f74-9bd1-9adff9655300\",\"gov-client-multi-factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"gov-client-public-ip\":\"178.231.187.149\",\"gov-client-public-ip-timestamp\":\"2026-01-28T22:27:56.229Z\",\"gov-client-screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"gov-client-timezone\":\"UTC+01:00\",\"gov-client-user-ids\":\"browser=user\",\"gov-client-window-size\":\"width=1280&height=1446\",\"hmrcaccount\":\"sandbox\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/hmrc/vat/vatObligations.html?hmrcAccount=sandbox\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiMjVlM2QwNGQtNjBiZC00NmEwLTliNWUtOWM3NDYzZmFhYmQ1IiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.lA64kP5VGyYIAm8D_-O7Zs2U2_i5ERfYvCWoT9L_oa0YrpCSeAKjJZwHI-caqsmlVNhfZDNsJJACzNNKEFeCU8PG21vWz8DB2EkUyNqWbk05k-3UVlab_aazMYOWuW5km2koSzcZnAtPUThf3yLtCCxxyyHy-Xug9mmNJ-mHcGE6NfWlw4KOXjGYDcB0v65NoAIdbMKB0ul0Obi_fYXgS8TtkQiIMit5pzgzQZhogzz_zwiEYTK4AKQoGIakEDAllmX4Z_htR1D4Ub225Tdp_WUg-Reh6MUDOFKeASE_adJ46840Q73eL09yIIXccs8cjVMVLqAf_6tsxezUTdADIQ\",\"x-client-request-id\":\"9b8c4a44-58e7-4ebc-8013-04972c6d15cc\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-request-id\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"x-wait-time-ms\":\"0\"},\"queryStringParameters\":{\"vrn\":\"793211922\",\"from\":\"2025-01-01\",\"to\":\"2025-12-01\"},\"rawQueryString\":\"vrn=793211922&from=2025-01-01&to=2025-12-01\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:57.462Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:57.462Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Fetching user bundles from storage\",\"userSub\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:57.463Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:57.462Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:57.463Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:57.462Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:57.465Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:57.465Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:57.465Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:57.465Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:57.465Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"User bundles retrieved\",\"userSub\":\"user\",\"bundles\":[{\"bundleId\":\"test\",\"expiry\":\"2026-01-29T00:00:00.000Z\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"createdAt\":\"2026-01-28T22:27:14.419Z\",\"ttl\":1772323200,\"ttl_datestamp\":\"2026-03-01T00:00:00.000Z\"}],\"bundleCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:57.465Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:57.465Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Checking bundle entitlements\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/obligation\",\"requiredBundleIds\":[\"test\",\"guest\",\"business\",\"diylegacy\"],\"currentBundleIds\":{}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:57.465Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/bundleEnforcement.js\",\"time\":\"2026-01-28T22:27:57.465Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Bundle entitlement check passed\",\"userSub\":\"user\",\"path\":\"/api/v1/hmrc/vat/obligation\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:57.466Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/hmrcApi.js\",\"time\":\"2026-01-28T22:27:57.466Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Validating access token\",\"tokenValidation\":{\"hasAccessToken\":true,\"accessTokenLength\":32,\"accessTokenPrefix\":\"7df1b969...\",\"isValidFormat\":true}}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-01-28T22:27:57.466Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:57.466Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:57.466Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"getAsyncRequest [table: test-hmrc-vat-obligation-get-async-requests-table]\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:57.469Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbAsyncRequestRepository.js\",\"time\":\"2026-01-28T22:27:57.468Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"AsyncRequest retrieved from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"status\":\"completed\",\"tableName\":\"test-hmrc-vat-obligation-get-async-requests-table\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:57.469Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-01-28T22:27:57.469Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Handler entry\",\"waitTimeMs\":0,\"isInitialRequest\":false}\n{\"level\":30,\"source\":\"app/functions/hmrc/hmrcVatObligationGet.js\",\"time\":\"2026-01-28T22:27:57.469Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Found persisted request\",\"status\":\"completed\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:57.469Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:57.469Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:57.469Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:57.469Z\",\"requestId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/hmrc/vat/obligation?vrn=793211922&from=2025-01-01&to=2025-12-01\",\"response\":{\"statusCode\":200,\"headers\":{\"Gov-Client-Public-IP\":\"178.231.187.149\",\"Gov-Client-Device-ID\":\"49b124eb-c333-4f74-9bd1-9adff9655300\",\"Gov-Client-User-IDs\":\"server=anonymous\",\"Gov-Client-Connection-Method\":\"WEB_APP_VIA_SERVER\",\"Gov-Vendor-Public-IP\":\"178.231.187.149\",\"Gov-Vendor-Forwarded\":\"by=178.231.187.149&for=178.231.187.149\",\"Gov-Vendor-Product-Name\":\"web-submit-diyaccounting-co-uk\",\"Gov-Vendor-Version\":\"web-submit-diyaccounting-co-uk=1.0.0\",\"Gov-Client-Browser-JS-User-Agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"Gov-Client-Multi-Factor\":\"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392\",\"Gov-Client-Public-IP-Timestamp\":\"2026-01-28T22:27:56.229Z\",\"Gov-Client-Screens\":\"width=1280&height=1446&colour-depth=24&scaling-factor=1\",\"Gov-Client-Timezone\":\"UTC+01:00\",\"Gov-Client-Window-Size\":\"width=1280&height=1446\",\"x-request-id\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"7d496ca3-98d2-48a0-8974-1402840556f3\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"obligations\\\":[{\\\"periodKey\\\":\\\"18A1\\\",\\\"start\\\":\\\"2017-01-01\\\",\\\"end\\\":\\\"2017-03-31\\\",\\\"due\\\":\\\"2017-05-07\\\",\\\"status\\\":\\\"F\\\",\\\"received\\\":\\\"2017-05-06\\\"},{\\\"periodKey\\\":\\\"18A2\\\",\\\"start\\\":\\\"2017-04-01\\\",\\\"end\\\":\\\"2017-06-30\\\",\\\"due\\\":\\\"2017-08-07\\\",\\\"status\\\":\\\"O\\\"}]}\"}}"}
[BROWSER CONSOLE log]: finished async request [GET /api/v1/hmrc/vat/obligation?vrn=793211922&from=2025-01-01&to=2025-12-01] (poll #1, elapsed: 1144ms, status: 200)
[BROWSER CONSOLE log]: Status message: VAT obligations retrieved. Type: success
[BROWSER CONSOLE log]: Hiding all status messages
[verifyVatObligationsResults] Found 2 obligation(s) - validating shape
VAT Period validated: 1 Jan 2017 to 31 Mar 2017
VAT Period validated: 1 Apr 2017 to 30 Jun 2017
Dates validated for 1 Jan 2017 to 31 Mar 2017: due=7 May 2017, received=6 May 2017
Dates validated for 1 Apr 2017 to 30 Jun 2017: due=7 Aug 2017, received=-
No test scenario 1 fulfilled obligations and 1 open obligations
VAT obligations retrieval completed successfully
Returning to home via main navigation...
[USER INTERACTION] Clicking: nav.main-nav a:has-text('Activities') - Clicking Activities in main navigation
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:58.801Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:58.800Z\",\"msg\":\"HTTP GET /index.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:58.912Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:58.910Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:58.944Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:58.943Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:58.967Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:58.967Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:58.968Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:58.968Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:58.975Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:58.975Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:58.976Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:58.976Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:58.976Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:58.976Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:58.977Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:58.977Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
[BROWSER CONSOLE log]: Current activity cleared
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.081Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.080Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.082Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.082Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.084Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.083Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.084Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.084Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.085Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.085Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.085Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.085Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.086Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.086Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.087Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.086Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.087Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.087Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: "script-src 'self' 'unsafe-inline'". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked.
[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp
[BROWSER CONSOLE log]: User is authenticated
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE log]: User is authenticated
[BROWSER CONSOLE log]: User info: {sub: user, email: user@example.com}
[BROWSER CONSOLE log]: User label: user@example.com
[BROWSER CONSOLE warning]: Failed to load RUM client: Event
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.202Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.202Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.203Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:59.203Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.203Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:59.203Z\",\"requestId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/index.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"d858355d-802c-4bc5-83c2-df3477350d83\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.204Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:59.203Z\",\"requestId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"message\":\"Retrieving user bundles\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.204Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:59.204Z\",\"requestId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.204Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:59.204Z\",\"requestId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:59.204Z\",\"requestId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.204Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:59.204Z\",\"requestId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.204Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:59.204Z\",\"requestId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.207Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.205Z\",\"msg\":\"HTTP GET /api/v1/bundle\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:59.206Z\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}\n{\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:59.206Z\",\"requestId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"message\":\"Processing request with event\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"event\":{\"requestContext\":{\"authorizer\":{\"lambda\":{\"jwt\":{\"claims\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"read write\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"test@test.submit.diyaccunting.co.uk\",\"cognito:username\":\"test\"}}}},\"http\":{\"method\":\"GET\",\"protocol\":\"http\",\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"path\":\"/api/v1/bundle\"}},\"path\":\"/api/v1/bundle\",\"headers\":{\"host\":\"wanted-finally-anteater.ngrok-free.app\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36\",\"accept\":\"*/*\",\"accept-encoding\":\"gzip, deflate, br, zstd\",\"accept-language\":\"en-US\",\"authorization\":\"Bearer eyJraWQiOiJkZWZhdWx0IiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiJ1c2VyIiwiYXVkIjoiZGVidWdnZXIiLCJuYmYiOjE3Njk2MzkyMjQsInNjb3BlIjoib3BlbmlkIHNvbWVzY29wZSIsImFtciI6WyJtZmEiLCJwd2QiXSwiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo4MDgwL2RlZmF1bHQiLCJleHAiOjE3Njk2NDI4MjQsImlhdCI6MTc2OTYzOTIyNCwibm9uY2UiOiI1Njc4IiwianRpIjoiOGVkMWZhMDUtZjI4My00Yzg4LTliYTgtYmE3NjU1MTNhN2JhIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIn0.h46g5YcI682XXjExrQ2dwI3wShgX5p_Tvw7poEObS09ogDOumcZakVrJOpBp6loLAlt5JL18_R7Dh-eq-p7Bg85nPdEPM0JNXQmNu-K01jwmNHXfkfAJnH6Nw8IzP6XMPlczP5ehM_JbzWxd6eNO9LvwwBMyO_IHW1xVY96SnLYVAeW5YFkTnOlS3P85hXmSZLTnY2deyk6yFEJ3t3EhLHa_Ah6tHrQQjlGIn8RV0JLoAbV8zJd7t7JnZkxMjRZlgaIr6ilKrdBgPM6I7-KZdnhVRX77op2rm2mh6AeAjrOT3DNJgqy-tNcnYxYx4i-KzDcNX_3MlRSgfwNOOtctGA\",\"cache-control\":\"no-cache\",\"ngrok-skip-browser-warning\":\"any value\",\"pragma\":\"no-cache\",\"priority\":\"u=1, i\",\"referer\":\"https://wanted-finally-anteater.ngrok-free.app/index.html\",\"sec-ch-ua\":\"\\\"HeadlessChrome\\\";v=\\\"143\\\", \\\"Chromium\\\";v=\\\"143\\\", \\\"Not A(Brand\\\";v=\\\"24\\\"\",\"sec-ch-ua-mobile\":\"?0\",\"sec-ch-ua-platform\":\"\\\"macOS\\\"\",\"sec-fetch-dest\":\"empty\",\"sec-fetch-mode\":\"cors\",\"sec-fetch-site\":\"same-origin\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-forwarded-for\":\"178.231.187.149\",\"x-forwarded-host\":\"wanted-finally-anteater.ngrok-free.app\",\"x-forwarded-proto\":\"https\",\"x-initial-request\":\"true\",\"x-request-id\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\"},\"queryStringParameters\":{},\"rawQueryString\":\"\",\"pathParameters\":{}}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:59.206Z\",\"requestId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"message\":\"Retrieving user bundles\"}\n{\"level\":30,\"source\":\"app/lib/jwtHelper.js\",\"time\":\"2026-01-28T22:27:59.206Z\",\"requestId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"message\":\"Decoded JWT payload\",\"payload\":{\"sub\":\"user\",\"aud\":\"debugger\",\"nbf\":1769639224,\"scope\":\"openid somescope\",\"amr\":[\"mfa\",\"pwd\"],\"iss\":\"http://localhost:8080/default\",\"exp\":1769642824,\"iat\":1769639224,\"nonce\":\"5678\",\"jti\":\"8ed1fa05-f283-4c88-9ba8-ba765513a7ba\",\"email\":\"[REDACTED]\"}}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:59.206Z\",\"requestId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"message\":\"Retrieving bundles for request\"}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:59.206Z\",\"requestId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"message\":\"retrieveUserBundles entry\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:59.206Z\",\"requestId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"message\":\"getUserBundles [table: test-bundle-table]\",\"userId\":\"user\"}\n{\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:59.206Z\",\"requestId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"message\":\"Retrieving bundles from DynamoDB\",\"userId\":\"user\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.209Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:59.209Z\",\"requestId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.209Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:59.209Z\",\"requestId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}\n{\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:59.209Z\",\"requestId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.209Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:59.209Z\",\"requestId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.209Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:59.209Z\",\"requestId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"d858355d-802c-4bc5-83c2-df3477350d83\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-29T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:14.419Z\\\",\\\"ttl\\\":1772323200,\\\"ttl_datestamp\\\":\\\"2026-03-01T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.210Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:59.210Z\",\"requestId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"message\":\"Queried DynamoDB for user bundles\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"itemCount\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.210Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/data/dynamoDbBundleRepository.js\",\"time\":\"2026-01-28T22:27:59.210Z\",\"requestId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"message\":\"Retrieved bundles from DynamoDB\",\"hashedSub\":\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.210Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/functions/account/bundleGet.js\",\"time\":\"2026-01-28T22:27:59.210Z\",\"requestId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"message\":\"Successfully retrieved bundles from repository\",\"userId\":\"user\",\"count\":1}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.211Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/services/asyncApiServices.js\",\"time\":\"2026-01-28T22:27:59.210Z\",\"requestId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"message\":\"Returning HTTP 200 OK with result\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.211Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/lib/httpResponseHelper.js\",\"time\":\"2026-01-28T22:27:59.211Z\",\"requestId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"correlationId\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"message\":\"Responding to request with response\",\"request\":\"https://wanted-finally-anteater.ngrok-free.app/api/v1/bundle\",\"response\":{\"statusCode\":200,\"headers\":{\"Content-Type\":\"application/json\",\"Access-Control-Allow-Origin\":\"*\",\"x-request-id\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"traceparent\":\"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01\",\"x-correlationid\":\"884a0827-19e8-49fb-b6b8-b2ca155fda79\",\"Access-Control-Expose-Headers\":\"x-request-id,x-correlationid,Location,Retry-After\"},\"body\":\"{\\\"bundles\\\":[{\\\"bundleId\\\":\\\"test\\\",\\\"expiry\\\":\\\"2026-01-29T00:00:00.000Z\\\",\\\"hashedSub\\\":\\\"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0\\\",\\\"createdAt\\\":\\\"2026-01-28T22:27:14.419Z\\\",\\\"ttl\\\":1772323200,\\\"ttl_datestamp\\\":\\\"2026-03-01T00:00:00.000Z\\\"}]}\"}}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.211Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.211Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.213Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.213Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
[test body] Found userInfo in localStorage for test "Click through: Submit a VAT return to HMRC": {"sub":"user","email":"user@example.com"}
[test body] Extracted userSub from localStorage for test "Click through: Submit a VAT return to HMRC": user
Logging out from home page
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.303Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.303Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
[USER INTERACTION] Clicking: a:has-text('Logout') - Logout
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.355Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.355Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
[BROWSER CONSOLE log]: Logging out user
[HTTP REQUEST FAILED] GET https://wanted-finally-anteater.ngrok-free.app/index.html - net::ERR_ABORTED
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.535Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.535Z\",\"msg\":\"HTTP GET /auth/login.html\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.636Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.636Z\",\"msg\":\"HTTP GET /lib/env-loader.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.636Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.636Z\",\"msg\":\"HTTP GET /submit.css\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.637Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.637Z\",\"msg\":\"HTTP GET /submit.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.638Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.638Z\",\"msg\":\"HTTP GET /images/g-logo.png\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.638Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.638Z\",\"msg\":\"HTTP GET /lib/utils/crypto-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.643Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.643Z\",\"msg\":\"HTTP GET /lib/toml-parser.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.644Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.644Z\",\"msg\":\"HTTP GET /lib/auth-url-builder.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.645Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.645Z\",\"msg\":\"HTTP GET /lib/request-cache.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.645Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.645Z\",\"msg\":\"HTTP GET /widgets/localstorage-viewer.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.646Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.646Z\",\"msg\":\"HTTP GET /widgets/auth-status.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.646Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.646Z\",\"msg\":\"HTTP GET /widgets/view-source-link.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.647Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.647Z\",\"msg\":\"HTTP GET /widgets/status-messages.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.647Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.647Z\",\"msg\":\"HTTP GET /widgets/entitlement-status.js\"}"}
[BROWSER CONSOLE log]: Current activity cleared
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.741Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.741Z\",\"msg\":\"HTTP GET /lib/utils/jwt-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.747Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.747Z\",\"msg\":\"HTTP GET /lib/utils/storage-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.750Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.750Z\",\"msg\":\"HTTP GET /lib/utils/dom-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.752Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.752Z\",\"msg\":\"HTTP GET /lib/services/auth-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.752Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.752Z\",\"msg\":\"HTTP GET /lib/utils/correlation-utils.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.753Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.753Z\",\"msg\":\"HTTP GET /submit.env\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.754Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.754Z\",\"msg\":\"HTTP GET /lib/services/catalog-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.754Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.754Z\",\"msg\":\"HTTP GET /auth/login-mock-addon.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.755Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.755Z\",\"msg\":\"HTTP GET /lib/services/hmrc-service.js\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.755Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.755Z\",\"msg\":\"HTTP GET /lib/services/api-client.js\"}"}
[BROWSER CONSOLE error]: Loading the image 'https://avatars.githubusercontent.com/u/11848947?s=48&v=4' violates the following Content Security Policy directive: "img-src 'self' data:". The action has been blocked.
[HTTP REQUEST FAILED] GET https://avatars.githubusercontent.com/u/11848947?s=48&v=4 - csp
[BROWSER CONSOLE error]: Loading the script 'https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js' violates the following Content Security Policy directive: "script-src 'self' 'unsafe-inline'". Note that 'script-src-elem' was not explicitly set, so 'script-src' is used as a fallback. The action has been blocked.
[HTTP REQUEST FAILED] GET https://client.rum.us-east-1.amazonaws.com/1.25.0/cwr.js - csp
[BROWSER CONSOLE warning]: Failed to load RUM client: Event
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.835Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.835Z\",\"msg\":\"HTTP GET /submit.deployment-name.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.840Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.840Z\",\"msg\":\"HTTP GET /submit.catalogue.toml\"}"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.902Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.902Z","msg":"Sandbox mode detection: HMRC_ACCOUNT=sandbox => sandbox=true"}
[Figures]: Selected 5 key screenshots from target/behaviour-test-results/screenshots/submitVat-behaviour-test
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-01-28T22:27:59.908Z","msg":"Copied screenshot: 2026-01-28_22-27-22-138750200-10-fill-in-submission-pagedown.png"}
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-01-28T22:27:59.909Z","msg":"Copied screenshot: 2026-01-28_22-27-36-698478226-02-complete-vat-receipt.png"}
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-01-28T22:27:59.909Z","msg":"Copied screenshot: 2026-01-28_22-27-29-500138633-01-submit-hmrc-auth.png"}
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-01-28T22:27:59.910Z","msg":"Copied screenshot: 2026-01-28_22-27-49-371345441-04-view-vat-return-results.png"}
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-01-28T22:27:59.910Z","msg":"Copied screenshot: 2026-01-28_22-27-03-007189181-01-submit-mock.png"}
[Figures]: Copied 5 screenshots to /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour
{"level":30,"source":"behaviour-tests/helpers/figures-helper.js","time":"2026-01-28T22:27:59.911Z","msg":"Wrote figures.json with 5 entries to /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/figures.json"}
[Figures]: Generated figures.json in /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour
[DynamoDB Export]: Starting export of all tables...
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-28T22:27:59.911Z","msg":"[dynamodb-export]: Starting export of all tables to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-28T22:27:59.911Z","msg":"[dynamodb-export]: Exporting table 'test-bundle-table' from endpoint 'http://127.0.0.1:56953' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/bundles.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:27:59.921Z","msg":"[http-stdout]: {\"level\":30,\"source\":\"app/bin/server.js\",\"time\":\"2026-01-28T22:27:59.920Z\",\"msg\":\"HTTP GET /submit.version.txt\"}"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-28T22:27:59.922Z","msg":"[dynamodb-export]: ✅ Exported 1 items from table 'test-bundle-table' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/bundles.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-28T22:27:59.923Z","msg":"[dynamodb-export]: ── BEGIN bundles.jsonl ──"}
{"bundleId":"test","expiry":"2026-01-29T00:00:00.000Z","hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","createdAt":"2026-01-28T22:27:14.419Z","ttl":1772323200,"ttl_datestamp":"2026-03-01T00:00:00.000Z"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-28T22:27:59.923Z","msg":"[dynamodb-export]: ── END bundles.jsonl ──"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-28T22:27:59.923Z","msg":"[dynamodb-export]: Exporting table 'test-hmrc-api-requests-table' from endpoint 'http://127.0.0.1:56953' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/hmrc-api-requests.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-28T22:27:59.931Z","msg":"[dynamodb-export]: ✅ Exported 14 items from table 'test-hmrc-api-requests-table' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/hmrc-api-requests.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-28T22:27:59.931Z","msg":"[dynamodb-export]: ── BEGIN hmrc-api-requests.jsonl ──"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-022fce74-c567-469a-8f60-2115a3518052","requestId":"056ae9d8-0370-4952-bd9c-74e24aaf4f78","amznTraceId":null,"traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","url":"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Public-IP":"178.231.187.149","Gov-Client-Device-ID":"bb3fbc56-9ec5-4136-98fe-7d71fe43c24a","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Public-IP":"178.231.187.149","Gov-Vendor-Forwarded":"by=178.231.187.149&for=178.231.187.149","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392","Gov-Client-Public-IP-Timestamp":"2026-01-28T22:27:34.160Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"056ae9d8-0370-4952-bd9c-74e24aaf4f78","traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","x-correlationid":"056ae9d8-0370-4952-bd9c-74e24aaf4f78"}},"httpResponse":{"statusCode":200,"headers":{"cache-control":"no-cache,no-store,max-age=0","connection":"keep-alive","content-length":"489","content-security-policy":"default-src 'self'","content-type":"application/json","date":"Wed, 28 Jan 2026 22:27:34 GMT","strict-transport-security":"max-age=31536000;","vary":"Origin","via":"1.1 5de5e66003332bec09dff893114ac06c.cloudfront.net (CloudFront)","x-amz-cf-id":"CGw-IixBeMkUaHpW4Qm3GvI8FBXZ9DMKh1FhocUW5ZnNPlfhBdegMQ==","x-amz-cf-pop":"AMS1-P1","x-cache":"Miss from cloudfront","x-content-type-options":"nosniff","x-envoy-upstream-service-time":"34","x-frame-options":"SAMEORIGIN"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"At least 1 header is invalid","errors":[{"code":"***MASKED***","message":"Header missing. You will not be able to submit a header if the connection is between client and server in a private network. If this is the case, you must contact us explaining why you cannot submit this header.","headers":["gov-client-public-port"]}],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]}]}},"duration":152,"createdAt":"2026-01-28T22:27:34.362Z","ttl":1772317654,"ttl_datestamp":"2026-02-28T22:27:34.362Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-28f79e29-1585-46cb-85f8-34e0a12fdb80","requestId":"7d496ca3-98d2-48a0-8974-1402840556f3","amznTraceId":null,"traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","url":"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2025-01-01&to=2025-12-01","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"7d496ca3-98d2-48a0-8974-1402840556f3","traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","x-correlationid":"7d496ca3-98d2-48a0-8974-1402840556f3","Gov-Client-Public-IP":"178.231.187.149","Gov-Client-Device-ID":"49b124eb-c333-4f74-9bd1-9adff9655300","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Public-IP":"178.231.187.149","Gov-Vendor-Forwarded":"by=178.231.187.149&for=178.231.187.149","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392","Gov-Client-Public-IP-Timestamp":"2026-01-28T22:27:56.229Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"cache-control":"no-cache,no-store,max-age=0","connection":"keep-alive","content-length":"227","content-security-policy":"default-src 'self'","content-type":"application/json","date":"Wed, 28 Jan 2026 22:27:56 GMT","strict-transport-security":"max-age=31536000;","vary":"Origin","via":"1.1 a4583a5b47f0a64ec35be32f95ac1b46.cloudfront.net (CloudFront)","x-amz-cf-id":"7c8iR3pUupa6GpSBkcHy2GE7cBUxrvCSRnWKt2en9WfKSv90IgJ8Pw==","x-amz-cf-pop":"AMS1-P1","x-cache":"Miss from cloudfront","x-content-type-options":"nosniff, nosniff","x-correlationid":"63c9ad94-6ec1-4b36-9e4d-0693251a5699","x-envoy-upstream-service-time":"18","x-frame-options":"SAMEORIGIN"},"body":{"obligations":[{"periodKey":"18A1","start":"2017-01-01","end":"2017-03-31","due":"2017-05-07","status":"F","received":"2017-05-06"},{"periodKey":"18A2","start":"2017-04-01","end":"2017-06-30","due":"2017-08-07","status":"O"}]}},"duration":218,"createdAt":"2026-01-28T22:27:56.547Z","ttl":1772317676,"ttl_datestamp":"2026-02-28T22:27:56.547Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-3957dc8f-b7fb-40a7-ba4d-d3bc455ce436","requestId":"8de749a1-4d65-4987-b304-5def0d56631e","amznTraceId":null,"traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","url":"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=F","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"8de749a1-4d65-4987-b304-5def0d56631e","traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","x-correlationid":"8de749a1-4d65-4987-b304-5def0d56631e","Gov-Client-Public-IP":"178.231.187.149","Gov-Client-Device-ID":"b02a18d2-a464-4c1f-9c2b-47c9a65110a0","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Public-IP":"178.231.187.149","Gov-Vendor-Forwarded":"by=178.231.187.149&for=178.231.187.149","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392","Gov-Client-Public-IP-Timestamp":"2026-01-28T22:27:47.366Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"cache-control":"no-cache,no-store,max-age=0","connection":"keep-alive","content-length":"134","content-security-policy":"default-src 'self'","content-type":"application/json","date":"Wed, 28 Jan 2026 22:27:49 GMT","strict-transport-security":"max-age=31536000;","vary":"Origin","via":"1.1 0e12b175c31e0e750266df78bf0e1068.cloudfront.net (CloudFront)","x-amz-cf-id":"I0knpHfT5RSZeioLM0jfFJ-7Bv8EjgRTXSJd9_eZ6W0mG0XbMNeegQ==","x-amz-cf-pop":"AMS1-P1","x-cache":"Miss from cloudfront","x-content-type-options":"nosniff, nosniff","x-correlationid":"00ee98f3-8229-4b65-8f4e-dbc9a79f49ef","x-envoy-upstream-service-time":"16","x-frame-options":"SAMEORIGIN"},"body":{"obligations":[{"periodKey":"18A1","start":"2017-01-01","end":"2017-03-31","due":"2017-05-07","status":"F","received":"2017-05-06"}]}},"duration":144,"createdAt":"2026-01-28T22:27:49.221Z","ttl":1772317669,"ttl_datestamp":"2026-02-28T22:27:49.221Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-3af613d4-a0c0-48ab-8735-ab27a92d59b3","requestId":"8de749a1-4d65-4987-b304-5def0d56631e","amznTraceId":null,"traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","url":"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/returns/18A1","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"8de749a1-4d65-4987-b304-5def0d56631e","traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","x-correlationid":"8de749a1-4d65-4987-b304-5def0d56631e","Gov-Client-Public-IP":"178.231.187.149","Gov-Client-Device-ID":"b02a18d2-a464-4c1f-9c2b-47c9a65110a0","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Public-IP":"178.231.187.149","Gov-Vendor-Forwarded":"by=178.231.187.149&for=178.231.187.149","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392","Gov-Client-Public-IP-Timestamp":"2026-01-28T22:27:47.366Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"cache-control":"no-cache,no-store,max-age=0","connection":"keep-alive","content-length":"242","content-security-policy":"default-src 'self'","content-type":"application/json","date":"Wed, 28 Jan 2026 22:27:48 GMT","strict-transport-security":"max-age=31536000;","vary":"Origin","via":"1.1 0e12b175c31e0e750266df78bf0e1068.cloudfront.net (CloudFront)","x-amz-cf-id":"sCAMj34ZXCYjA6mD2e0JeEGAImcyYgdiuJ6pJp4WbfoOa7HDIwgIxw==","x-amz-cf-pop":"AMS1-P1","x-cache":"Miss from cloudfront","x-content-type-options":"nosniff, nosniff","x-correlationid":"b952eac8-c9f0-4480-8889-a063181988eb","x-envoy-upstream-service-time":"17","x-frame-options":"SAMEORIGIN"},"body":{"periodKey":"18A1","vatDueSales":1000,"vatDueAcquisitions":0,"totalVatDue":1000,"vatReclaimedCurrPeriod":0,"netVatDue":1000,"totalValueSalesExVAT":5000,"totalValuePurchasesExVAT":0,"totalValueGoodsSuppliedExVAT":0,"totalAcquisitionsExVAT":0}},"duration":100,"createdAt":"2026-01-28T22:27:48.047Z","ttl":1772317668,"ttl_datestamp":"2026-02-28T22:27:48.047Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-413b99d1-f55b-4c58-af2f-60031aea1189","requestId":"8de749a1-4d65-4987-b304-5def0d56631e","amznTraceId":null,"traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","url":"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=F","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"8de749a1-4d65-4987-b304-5def0d56631e","traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","x-correlationid":"8de749a1-4d65-4987-b304-5def0d56631e","Gov-Client-Public-IP":"178.231.187.149","Gov-Client-Device-ID":"b02a18d2-a464-4c1f-9c2b-47c9a65110a0","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Public-IP":"178.231.187.149","Gov-Vendor-Forwarded":"by=178.231.187.149&for=178.231.187.149","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392","Gov-Client-Public-IP-Timestamp":"2026-01-28T22:27:47.366Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"cache-control":"no-cache,no-store,max-age=0","connection":"keep-alive","content-length":"134","content-security-policy":"default-src 'self'","content-type":"application/json","date":"Wed, 28 Jan 2026 22:27:47 GMT","strict-transport-security":"max-age=31536000;","vary":"Origin","via":"1.1 0e12b175c31e0e750266df78bf0e1068.cloudfront.net (CloudFront)","x-amz-cf-id":"P1RVcrBiRxkdSlhIvbKIpU33Y_YseUfqi0jGHLgV5z3wEdK1tzaG4A==","x-amz-cf-pop":"AMS1-P1","x-cache":"Miss from cloudfront","x-content-type-options":"nosniff, nosniff","x-correlationid":"4e1f5456-1a60-4b15-bd02-511b0831b015","x-envoy-upstream-service-time":"15","x-frame-options":"SAMEORIGIN"},"body":{"obligations":[{"periodKey":"18A1","start":"2017-01-01","end":"2017-03-31","due":"2017-05-07","status":"F","received":"2017-05-06"}]}},"duration":115,"createdAt":"2026-01-28T22:27:47.815Z","ttl":1772317667,"ttl_datestamp":"2026-02-28T22:27:47.815Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-547bb05b-9cf8-453c-a6e6-629a013438f7","requestId":"056ae9d8-0370-4952-bd9c-74e24aaf4f78","amznTraceId":null,"traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","url":"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/returns","method":"POST","httpRequest":{"method":"POST","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"056ae9d8-0370-4952-bd9c-74e24aaf4f78","traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","x-correlationid":"056ae9d8-0370-4952-bd9c-74e24aaf4f78","Gov-Client-Public-IP":"178.231.187.149","Gov-Client-Device-ID":"bb3fbc56-9ec5-4136-98fe-7d71fe43c24a","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Public-IP":"178.231.187.149","Gov-Vendor-Forwarded":"by=178.231.187.149&for=178.231.187.149","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392","Gov-Client-Public-IP-Timestamp":"2026-01-28T22:27:34.160Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"},"body":"{\"periodKey\":\"18A1\",\"vatDueSales\":1000,\"vatDueAcquisitions\":0,\"totalVatDue\":1000,\"vatReclaimedCurrPeriod\":0,\"netVatDue\":1000,\"totalValueSalesExVAT\":5000,\"totalValuePurchasesExVAT\":0,\"totalValueGoodsSuppliedExVAT\":0,\"totalAcquisitionsExVAT\":0,\"finalised\":true}"},"httpResponse":{"statusCode":201,"headers":{"cache-control":"no-cache,no-store,max-age=0","connection":"keep-alive","content-length":"140","content-security-policy":"default-src 'self'","content-type":"application/json","date":"Wed, 28 Jan 2026 22:27:34 GMT","receipt-id":"613cc208-6c20-42a9-aead-fb5cef56a05a","receipt-signature":"This has been deprecated - DO NOT USE","receipt-timestamp":"2026-01-28T22:27:34Z","strict-transport-security":"max-age=31536000;","vary":"Origin","via":"1.1 5de5e66003332bec09dff893114ac06c.cloudfront.net (CloudFront)","x-amz-cf-id":"DtF15HzbRmDX4eGx9bpqu-fc_Fki4sABSs-NE4UIsMjbpRX2nEDBSQ==","x-amz-cf-pop":"AMS1-P1","x-cache":"Miss from cloudfront","x-content-type-options":"nosniff, nosniff","x-correlationid":"613cc208-6c20-42a9-aead-fb5cef56a05a","x-envoy-upstream-service-time":"31","x-frame-options":"SAMEORIGIN"},"body":{"processingDate":"2026-01-28T22:27:34.850Z","formBundleNumber":"824422898682","paymentIndicator":"DD","chargeRefNumber":"1IwLyFgkLFpSxwmh"}},"duration":139,"createdAt":"2026-01-28T22:27:34.857Z","ttl":1772317654,"ttl_datestamp":"2026-02-28T22:27:34.857Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-62c71c58-6a29-4e6e-8001-bc5a46771a9d","requestId":"056ae9d8-0370-4952-bd9c-74e24aaf4f78","amznTraceId":null,"traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","url":"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Public-IP":"178.231.187.149","Gov-Client-Device-ID":"bb3fbc56-9ec5-4136-98fe-7d71fe43c24a","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Public-IP":"178.231.187.149","Gov-Vendor-Forwarded":"by=178.231.187.149&for=178.231.187.149","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392","Gov-Client-Public-IP-Timestamp":"2026-01-28T22:27:34.160Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"056ae9d8-0370-4952-bd9c-74e24aaf4f78","traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","x-correlationid":"056ae9d8-0370-4952-bd9c-74e24aaf4f78"}},"httpResponse":{"statusCode":200,"headers":{"cache-control":"no-cache,no-store,max-age=0","connection":"keep-alive","content-length":"489","content-security-policy":"default-src 'self'","content-type":"application/json","date":"Wed, 28 Jan 2026 22:27:34 GMT","strict-transport-security":"max-age=31536000;","vary":"Origin","via":"1.1 5de5e66003332bec09dff893114ac06c.cloudfront.net (CloudFront)","x-amz-cf-id":"_babidZpyy9V828O5VSL9MwT7RlvwqrKSkheAfCqmgBqbDkCiLymtA==","x-amz-cf-pop":"AMS1-P1","x-cache":"Miss from cloudfront","x-content-type-options":"nosniff","x-envoy-upstream-service-time":"18","x-frame-options":"SAMEORIGIN"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"At least 1 header is invalid","errors":[{"code":"***MASKED***","message":"Header missing. You will not be able to submit a header if the connection is between client and server in a private network. If this is the case, you must contact us explaining why you cannot submit this header.","headers":["gov-client-public-port"]}],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]}]}},"duration":197,"createdAt":"2026-01-28T22:27:34.714Z","ttl":1772317654,"ttl_datestamp":"2026-02-28T22:27:34.714Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-7576b3a7-49ff-49c8-adbf-c4b65e50d1aa","requestId":"8de749a1-4d65-4987-b304-5def0d56631e","amznTraceId":null,"traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","url":"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Public-IP":"178.231.187.149","Gov-Client-Device-ID":"b02a18d2-a464-4c1f-9c2b-47c9a65110a0","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Public-IP":"178.231.187.149","Gov-Vendor-Forwarded":"by=178.231.187.149&for=178.231.187.149","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392","Gov-Client-Public-IP-Timestamp":"2026-01-28T22:27:47.366Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"8de749a1-4d65-4987-b304-5def0d56631e","traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","x-correlationid":"8de749a1-4d65-4987-b304-5def0d56631e"}},"httpResponse":{"statusCode":200,"headers":{"cache-control":"no-cache,no-store,max-age=0","connection":"keep-alive","content-length":"489","content-security-policy":"default-src 'self'","content-type":"application/json","date":"Wed, 28 Jan 2026 22:27:47 GMT","strict-transport-security":"max-age=31536000;","vary":"Origin","via":"1.1 0e12b175c31e0e750266df78bf0e1068.cloudfront.net (CloudFront)","x-amz-cf-id":"siaS0FZF3y_J1qI5klMp-F2dxRvKN3cIMi3zSlSMFMgTToTEGQ8y6g==","x-amz-cf-pop":"AMS1-P1","x-cache":"Miss from cloudfront","x-content-type-options":"nosniff","x-envoy-upstream-service-time":"18","x-frame-options":"SAMEORIGIN"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"At least 1 header is invalid","errors":[{"code":"***MASKED***","message":"Header missing. You will not be able to submit a header if the connection is between client and server in a private network. If this is the case, you must contact us explaining why you cannot submit this header.","headers":["gov-client-public-port"]}],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]}]}},"duration":124,"createdAt":"2026-01-28T22:27:47.944Z","ttl":1772317667,"ttl_datestamp":"2026-02-28T22:27:47.944Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-800674c2-24f6-49f3-b8f6-eea180b1858e","requestId":"056ae9d8-0370-4952-bd9c-74e24aaf4f78","amznTraceId":null,"traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","url":"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=O","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"056ae9d8-0370-4952-bd9c-74e24aaf4f78","traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","x-correlationid":"056ae9d8-0370-4952-bd9c-74e24aaf4f78","Gov-Client-Public-IP":"178.231.187.149","Gov-Client-Device-ID":"bb3fbc56-9ec5-4136-98fe-7d71fe43c24a","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Public-IP":"178.231.187.149","Gov-Vendor-Forwarded":"by=178.231.187.149&for=178.231.187.149","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392","Gov-Client-Public-IP-Timestamp":"2026-01-28T22:27:34.160Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"cache-control":"no-cache,no-store,max-age=0","connection":"keep-alive","content-length":"110","content-security-policy":"default-src 'self'","content-type":"application/json","date":"Wed, 28 Jan 2026 22:27:34 GMT","strict-transport-security":"max-age=31536000;","vary":"Origin","via":"1.1 5de5e66003332bec09dff893114ac06c.cloudfront.net (CloudFront)","x-amz-cf-id":"PWRZ4-NyENrIxEDjj0Xp6a5_T3MfW5qbfWxM3eo9Uh46i6O9R-BVKg==","x-amz-cf-pop":"AMS1-P1","x-cache":"Miss from cloudfront","x-content-type-options":"nosniff, nosniff","x-correlationid":"a53e7779-5152-4fa0-ac80-065dd471e3b3","x-envoy-upstream-service-time":"16","x-frame-options":"SAMEORIGIN"},"body":{"obligations":[{"periodKey":"18A1","start":"2017-01-01","end":"2017-03-31","due":"2017-05-07","status":"O"}]}},"duration":145,"createdAt":"2026-01-28T22:27:34.511Z","ttl":1772317654,"ttl_datestamp":"2026-02-28T22:27:34.511Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-861907b8-d1a9-4985-9141-afce08f04b82","requestId":"43290fcb-809c-4e70-bf6d-7d5edf427b42","amznTraceId":null,"traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","url":"https://test-api.service.hmrc.gov.uk/oauth/token","method":"POST","httpRequest":{"method":"POST","headers":{"Content-Type":"application/x-www-form-urlencoded","x-request-id":"43290fcb-809c-4e70-bf6d-7d5edf427b42","traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","x-correlationid":"43290fcb-809c-4e70-bf6d-7d5edf427b42"},"body":"grant_type=authorization_code&client_id=uqMHA6RsDGGa7h8EG2VqfqAmv4tV&client_secret=***MASKED***&redirect_uri=https%3A%2F%2Fwanted-finally-anteater.ngrok-free.app%2Factivities%2FsubmitVatCallback.html&code=***MASKED***"},"httpResponse":{"statusCode":200,"headers":{"cache-control":"no-cache,no-store,max-age=0","connection":"keep-alive","content-length":"172","content-security-policy":"default-src 'self'","content-type":"application/json","date":"Wed, 28 Jan 2026 22:27:33 GMT","strict-transport-security":"max-age=31536000;","via":"1.1 5de5e66003332bec09dff893114ac06c.cloudfront.net (CloudFront)","x-amz-cf-id":"K79qcgqSET3ZqfhFt6xk-C-JrvQIRy0R07D04rQEaQJzYSAglnBgyw==","x-amz-cf-pop":"AMS1-P1","x-cache":"Miss from cloudfront","x-content-type-options":"nosniff","x-envoy-upstream-service-time":"52","x-frame-options":"SAMEORIGIN"},"body":{"access_token":"***MASKED***","refresh_token":"***MASKED***","expires_in":14400,"scope":"write:vat read:vat","token_type":"bearer"}},"duration":219,"createdAt":"2026-01-28T22:27:33.734Z","ttl":1772317653,"ttl_datestamp":"2026-02-28T22:27:33.734Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-8633ef56-3906-4202-8ade-d3934d6dad19","requestId":"056ae9d8-0370-4952-bd9c-74e24aaf4f78","amznTraceId":null,"traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","url":"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Public-IP":"178.231.187.149","Gov-Client-Device-ID":"bb3fbc56-9ec5-4136-98fe-7d71fe43c24a","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Public-IP":"178.231.187.149","Gov-Vendor-Forwarded":"by=178.231.187.149&for=178.231.187.149","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392","Gov-Client-Public-IP-Timestamp":"2026-01-28T22:27:34.160Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"056ae9d8-0370-4952-bd9c-74e24aaf4f78","traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","x-correlationid":"056ae9d8-0370-4952-bd9c-74e24aaf4f78"}},"httpResponse":{"statusCode":200,"headers":{"cache-control":"no-cache,no-store,max-age=0","connection":"keep-alive","content-length":"489","content-security-policy":"default-src 'self'","content-type":"application/json","date":"Wed, 28 Jan 2026 22:27:35 GMT","strict-transport-security":"max-age=31536000;","vary":"Origin","via":"1.1 5de5e66003332bec09dff893114ac06c.cloudfront.net (CloudFront)","x-amz-cf-id":"LSGbgRVZCkBL_-gGFrKI2kYoHF1o9WZ-u7ioLJ14Cq4Rg4tHD6cEOg==","x-amz-cf-pop":"AMS1-P1","x-cache":"Miss from cloudfront","x-content-type-options":"nosniff","x-envoy-upstream-service-time":"27","x-frame-options":"SAMEORIGIN"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"At least 1 header is invalid","errors":[{"code":"***MASKED***","message":"Header missing. You will not be able to submit a header if the connection is between client and server in a private network. If this is the case, you must contact us explaining why you cannot submit this header.","headers":["gov-client-public-port"]}],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]}]}},"duration":139,"createdAt":"2026-01-28T22:27:35.767Z","ttl":1772317655,"ttl_datestamp":"2026-02-28T22:27:35.767Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-ae86e4eb-d289-433c-afb2-651a63e2ca45","requestId":"8de749a1-4d65-4987-b304-5def0d56631e","amznTraceId":null,"traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","url":"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Public-IP":"178.231.187.149","Gov-Client-Device-ID":"b02a18d2-a464-4c1f-9c2b-47c9a65110a0","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Public-IP":"178.231.187.149","Gov-Vendor-Forwarded":"by=178.231.187.149&for=178.231.187.149","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392","Gov-Client-Public-IP-Timestamp":"2026-01-28T22:27:47.366Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"8de749a1-4d65-4987-b304-5def0d56631e","traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","x-correlationid":"8de749a1-4d65-4987-b304-5def0d56631e"}},"httpResponse":{"statusCode":200,"headers":{"cache-control":"no-cache,no-store,max-age=0","connection":"keep-alive","content-length":"489","content-security-policy":"default-src 'self'","content-type":"application/json","date":"Wed, 28 Jan 2026 22:27:47 GMT","strict-transport-security":"max-age=31536000;","vary":"Origin","via":"1.1 0e12b175c31e0e750266df78bf0e1068.cloudfront.net (CloudFront)","x-amz-cf-id":"0qSNTIxBcml1w9O_wlGNr2BeJdg-JBnWMqR-CJcfYgKPHSW7eAs6Dw==","x-amz-cf-pop":"AMS1-P1","x-cache":"Miss from cloudfront","x-content-type-options":"nosniff","x-envoy-upstream-service-time":"34","x-frame-options":"SAMEORIGIN"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"At least 1 header is invalid","errors":[{"code":"***MASKED***","message":"Header missing. You will not be able to submit a header if the connection is between client and server in a private network. If this is the case, you must contact us explaining why you cannot submit this header.","headers":["gov-client-public-port"]}],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]}]}},"duration":240,"createdAt":"2026-01-28T22:27:47.696Z","ttl":1772317667,"ttl_datestamp":"2026-02-28T22:27:47.696Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-b7da784c-9604-42e8-a257-44d3241995e5","requestId":"056ae9d8-0370-4952-bd9c-74e24aaf4f78","amznTraceId":null,"traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","url":"https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/obligations?from=2017-01-01&to=2017-03-31&status=O","method":"GET","httpRequest":{"method":"GET","headers":{"Content-Type":"application/json","Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","x-request-id":"056ae9d8-0370-4952-bd9c-74e24aaf4f78","traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","x-correlationid":"056ae9d8-0370-4952-bd9c-74e24aaf4f78","Gov-Client-Public-IP":"178.231.187.149","Gov-Client-Device-ID":"bb3fbc56-9ec5-4136-98fe-7d71fe43c24a","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Public-IP":"178.231.187.149","Gov-Vendor-Forwarded":"by=178.231.187.149&for=178.231.187.149","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392","Gov-Client-Public-IP-Timestamp":"2026-01-28T22:27:34.160Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446"}},"httpResponse":{"statusCode":200,"headers":{"cache-control":"no-cache,no-store,max-age=0","connection":"keep-alive","content-length":"110","content-security-policy":"default-src 'self'","content-type":"application/json","date":"Wed, 28 Jan 2026 22:27:35 GMT","strict-transport-security":"max-age=31536000;","vary":"Origin","via":"1.1 5de5e66003332bec09dff893114ac06c.cloudfront.net (CloudFront)","x-amz-cf-id":"_ne9N3gZ0O1Z5X2n8OBrdEI2oknrJN8DzlaBhK29pEQyz7LVJsNjnQ==","x-amz-cf-pop":"AMS1-P1","x-cache":"Miss from cloudfront","x-content-type-options":"nosniff, nosniff","x-correlationid":"6b3afbe3-f32c-4d78-b190-f442ff165788","x-envoy-upstream-service-time":"14","x-frame-options":"SAMEORIGIN"},"body":{"obligations":[{"periodKey":"18A1","start":"2017-01-01","end":"2017-03-31","due":"2017-05-07","status":"O"}]}},"duration":151,"createdAt":"2026-01-28T22:27:35.922Z","ttl":1772317655,"ttl_datestamp":"2026-02-28T22:27:35.922Z"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","id":"hmrcreq-ebe0f787-7755-4bf4-87c0-8b8cd33daa98","requestId":"8de749a1-4d65-4987-b304-5def0d56631e","amznTraceId":null,"traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","url":"https://test-api.service.hmrc.gov.uk/test/fraud-prevention-headers/validate","method":"GET","httpRequest":{"method":"GET","headers":{"Accept":"application/vnd.hmrc.1.0+json","Authorization":"***MASKED***","Gov-Client-Public-IP":"178.231.187.149","Gov-Client-Device-ID":"b02a18d2-a464-4c1f-9c2b-47c9a65110a0","Gov-Client-User-IDs":"server=anonymous","Gov-Client-Connection-Method":"WEB_APP_VIA_SERVER","Gov-Vendor-Public-IP":"178.231.187.149","Gov-Vendor-Forwarded":"by=178.231.187.149&for=178.231.187.149","Gov-Vendor-Product-Name":"web-submit-diyaccounting-co-uk","Gov-Vendor-Version":"web-submit-diyaccounting-co-uk=1.0.0","Gov-Client-Browser-JS-User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) HeadlessChrome/143.0.7499.4 Safari/537.36","Gov-Client-Multi-Factor":"type=TOTP&timestamp=2026-01-08T00%3A09%3A01Z&unique-reference=test-mfa-1769639226392","Gov-Client-Public-IP-Timestamp":"2026-01-28T22:27:47.366Z","Gov-Client-Screens":"width=1280&height=1446&colour-depth=24&scaling-factor=1","Gov-Client-Timezone":"UTC+01:00","Gov-Client-Window-Size":"width=1280&height=1446","x-request-id":"8de749a1-4d65-4987-b304-5def0d56631e","traceparent":"00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01","x-correlationid":"8de749a1-4d65-4987-b304-5def0d56631e"}},"httpResponse":{"statusCode":200,"headers":{"cache-control":"no-cache,no-store,max-age=0","connection":"keep-alive","content-length":"489","content-security-policy":"default-src 'self'","content-type":"application/json","date":"Wed, 28 Jan 2026 22:27:49 GMT","strict-transport-security":"max-age=31536000;","vary":"Origin","via":"1.1 0e12b175c31e0e750266df78bf0e1068.cloudfront.net (CloudFront)","x-amz-cf-id":"dXESOy1gZB0NkXZWGCIDiPcv-QHx_AED_Wxh-vYATUEVUOqHx7dLGQ==","x-amz-cf-pop":"AMS1-P1","x-cache":"Miss from cloudfront","x-content-type-options":"nosniff","x-envoy-upstream-service-time":"30","x-frame-options":"SAMEORIGIN"},"body":{"specVersion":"3.3","code":"***MASKED***","message":"At least 1 header is invalid","errors":[{"code":"***MASKED***","message":"Header missing. You will not be able to submit a header if the connection is between client and server in a private network. If this is the case, you must contact us explaining why you cannot submit this header.","headers":["gov-client-public-port"]}],"warnings":[{"code":"***MASKED***","message":"Header required","headers":["gov-vendor-license-ids"]}]}},"duration":159,"createdAt":"2026-01-28T22:27:49.074Z","ttl":1772317669,"ttl_datestamp":"2026-02-28T22:27:49.074Z"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-28T22:27:59.931Z","msg":"[dynamodb-export]: ── END hmrc-api-requests.jsonl ──"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-28T22:27:59.931Z","msg":"[dynamodb-export]: Exporting table 'test-receipts-table' from endpoint 'http://127.0.0.1:56953' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/receipts.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-28T22:27:59.936Z","msg":"[dynamodb-export]: ✅ Exported 1 items from table 'test-receipts-table' to '/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/receipts.jsonl'"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-28T22:27:59.936Z","msg":"[dynamodb-export]: ── BEGIN receipts.jsonl ──"}
{"hashedSub":"5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0","receiptId":"2026-01-28T22:27:34.860Z-824422898682","receipt":{"processingDate":"2026-01-28T22:27:34.850Z","formBundleNumber":"824422898682","paymentIndicator":"DD","chargeRefNumber":"1IwLyFgkLFpSxwmh"},"createdAt":"2026-01-28T22:27:34.860Z","ttl":1990391254,"ttl_datestamp":"2033-01-26T22:27:34.860Z"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-28T22:27:59.936Z","msg":"[dynamodb-export]: ── END receipts.jsonl ──"}
{"level":30,"source":"behaviour-tests/helpers/dynamodb-export.js","time":"2026-01-28T22:27:59.936Z","msg":"[dynamodb-export]: ✅ Completed export of all tables"}
[DynamoDB Export]: Export completed: [
  {
    table: [32m'bundles'[39m,
    itemCount: [33m1[39m,
    filePath: [32m'/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/bundles.jsonl'[39m
  },
  {
    table: [32m'hmrc-api-requests'[39m,
    itemCount: [33m14[39m,
    filePath: [32m'/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/hmrc-api-requests.jsonl'[39m
  },
  {
    table: [32m'receipts'[39m,
    itemCount: [33m1[39m,
    filePath: [32m'/Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/receipts.jsonl'[39m
  }
]
Asserting HMRC API request exists: POST /oauth/token
[DynamoDB Assertions]: Found 1 OAuth token exchange request(s)
Asserting HMRC API request exists: POST /organisations/vat/793211922/returns
[DynamoDB Assertions]: Found 1 VAT return POST request(s)
Matched all expected values in https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/returns: { [32m'httpRequest.method'[39m: [32m'POST'[39m, [32m'httpResponse.statusCode'[39m: [33m201[39m }
[DynamoDB Assertions]: VAT POST request body validated - periodKey format: 18A1
Asserting HMRC API request exists: GET /\/organisations\/vat\/793211922\/returns\/\w+/
[DynamoDB Assertions]: Found 1 VAT return GET request(s)
Matched all expected values in https://test-api.service.hmrc.gov.uk/organisations/vat/793211922/returns/18A1: { [32m'httpRequest.method'[39m: [32m'GET'[39m, [32m'httpResponse.statusCode'[39m: [33m200[39m }
[DynamoDB Assertions]: VAT GET response body validated - periodKey format: 18A1
[DynamoDB Assertions]: Found 0 Fraud prevention headers validation feedback GET request(s)
Asserting HMRC API request exists: GET /test/fraud-prevention-headers/validate
[DynamoDB Assertions]: Found 6 Fraud prevention headers validation GET request(s)
[DynamoDB Assertions]: Fraud prevention headers validation GET request #1 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 1
[DynamoDB Assertions]: Warnings: 1
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 1 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 1 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[DynamoDB Assertions]: Fraud prevention headers validation GET request #2 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 1
[DynamoDB Assertions]: Warnings: 1
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 1 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 1 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[DynamoDB Assertions]: Fraud prevention headers validation GET request #3 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 1
[DynamoDB Assertions]: Warnings: 1
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 1 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 1 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[DynamoDB Assertions]: Fraud prevention headers validation GET request #4 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 1
[DynamoDB Assertions]: Warnings: 1
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 1 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 1 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[DynamoDB Assertions]: Fraud prevention headers validation GET request #5 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 1
[DynamoDB Assertions]: Warnings: 1
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 1 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 1 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
[DynamoDB Assertions]: Fraud prevention headers validation GET request #6 validated successfully with details:
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Errors: 1
[DynamoDB Assertions]: Warnings: 1
[DynamoDB Assertions]: Ignored headers: gov-client-multi-factor,gov-vendor-license-ids,gov-client-public-port
[DynamoDB Assertions]: Errors: 0 (out of non-ignored 1 headers)
[DynamoDB Assertions]: Warnings: 0 (out of non-ignored 1 headers)
[DynamoDB Assertions]: Request code: ***MASKED***
[DynamoDB Assertions]: Fraud prevention headers validation GET body validated successfully
{"level":30,"source":"behaviour-tests/helpers/dynamodb-assertions.js","time":"2026-01-28T22:27:59.973Z","msg":"Found 14 HMRC API requests: OAuth (1) with hashedSub 5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0, authenticated (13) with hashedSub 5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0"}
[DynamoDB Assertions]: Found 1 unique hashedSub value(s): 5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0
[afterEach] Saving /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/userSub.txt for test "Click through: Submit a VAT return to HMRC": user
{"level":30,"source":"app/services/subHasher.js","time":"2026-01-28T22:28:00.041Z","message":"Using USER_SUB_HASH_SALT from environment (local dev/test)"}
[fileHelper] Salt initialized successfully for test diagnostics
[afterEach] Saving /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/hashedUserSub.txt for test "Click through: Submit a VAT return to HMRC": 5f202fdb051350c5da3294b66ca72ea2fe0b92e841a7b04d378300a848a3dfb0
Saving /Users/antony/projects/submit.diyaccounting.co.uk/target/behaviour-test-results/submitVat.behaviour-Click--3e6d3-Submit-a-VAT-return-to-HMRC-submitVatBehaviour/traceparent.txt for test "Click through: Submit a VAT return to HMRC": 00-40b449653604a9c9b589431456dd6324-066f33e75da34642-01
{"level":30,"source":"behaviour-tests/helpers/behaviour-helpers.js","time":"2026-01-28T22:28:02.281Z","msg":"[proxy]: kill() called on ngrok proxy, stopping..."}
{"level":30,"source":"app/bin/ngrok.js","time":"2026-01-28T22:28:02.281Z","msg":"[ngrok]: Closing tunnel..."}
{"level":30,"source":"app/bin/ngrok.js","time":"2026-01-28T22:28:02.355Z","msg":"[ngrok]: ✅ Tunnel closed"}
  ✓  1 [submitVatBehaviour] › behaviour-tests/submitVat.behaviour.test.js:187:1 › Click through: Submit a VAT return to HMRC (1.1m)

  1 passed (1.3m)

To open last HTML report run:
[36m[39m
[36m  npx playwright show-report target/test-reports/html-report[39m
[36m[39m
